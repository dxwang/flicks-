(function(){function dc(k,p){return new Promise(function(S,b){function g(b){"https://assets.nflxext.com"==b.origin&&b.source==a.contentWindow&&"ready"==b.data&&(window.clearTimeout(I),window.removeEventListener("message",g),window.addEventListener("message",F),S(a))}var a=document.createElement("iframe");a.setAttribute("src",k);a.setAttribute("style","display:none");a.height=1;a.width=1;var I=window.setTimeout(function(){window.removeEventListener("message",g);document.body.removeChild(a);b(Error("timeout waiting for iframe to load"))},
p);window.addEventListener("message",g);document.body.appendChild(a)})}function x(k,p){return I.then(function(I){return new Promise(function(b,g){var a={cmd:k,msgId:++S,arguments:p};aa.push({msgId:a.msgId,handler:function(a){a=a.data;a.success?b(a.result):g(Error("crypto-iframe error: "+a.result))}});I.contentWindow.postMessage(a,"https://assets.nflxext.com")})})}function F(k){for(var p,S=aa.length;S--&&aa[S].msgId!==k.data.msgId;);(p=0>S)||(p=k.data,p=!("https://assets.nflxext.com"===k.origin&&p&&
p.hasOwnProperty("success")&&p.hasOwnProperty("result")&&p.hasOwnProperty("msgId")));p||(p=aa[S].handler,aa.splice(S,1),p(k))}var k=navigator.userAgent.match(/Chrome\/([0-9]*)/);if(k&&37<=parseInt(k[1])){var S=0,aa=[],I=(new Promise(function(k){function p(){document.removeEventListener("DOMContentLoaded",p);k()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",p):k()})).then(function(){return dc("https://assets.nflxext.com/en_us/ffe/player/html/nfcrypto-iframe-inner-2202400.html",
2E3)}).catch(function(){return dc("https://assets.nflxext.com/en_us/ffe/player/html/nfcrypto-iframe-inner-2202400.html",8E3)}),p={subtle:{}};window.crypto.getRandomValues&&(p.getRandomValues=function(k){return window.crypto.getRandomValues(k)});"encrypt decrypt sign verify digest generateKey deriveKey deriveBits importKey exportKey wrapKey unwrapKey".split(" ").map(function(k){p.subtle[k]=function(){return x(k,Array.prototype.slice.call(arguments))}});window.nfCrypto=p}})();
(function(dc,x){var F;function k(a,b){if(!b||"utf-8"===b)return aa(a);throw Error("unsupported encoding");}function S(a,b){if(!b||"utf-8"===b)return I(a);throw Error("unsupported encoding");}function aa(a){for(var b=0,c,g=a.length,d="";b<g;){c=a[b++];if(c&128)if(192===(c&224))c=((c&31)<<6)+(a[b++]&63);else if(224===(c&240))c=((c&15)<<12)+((a[b++]&63)<<6)+(a[b++]&63);else throw Error("unsupported character");d+=String.fromCharCode(c)}return d}function I(a){var b=a.length,c;c=0;var g,d=0,k;for(g=b;g--;)k=
a.charCodeAt(g),128>k?c++:c=2048>k?c+2:c+3;c=new Uint8Array(c);for(g=0;g<b;g++)k=a.charCodeAt(g),128>k?c[d++]=k:(2048>k?c[d++]=192|k>>>6:(c[d++]=224|k>>>12,c[d++]=128|k>>>6&63),c[d++]=128|k&63);return c}function p(a,b){if(a===b)return!0;if(!a||!b||a.length!=b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!=b[c])return!1;return!0}function Y(a){if(!(a&&a.constructor==Uint8Array||Array.isArray(a)))throw new TypeError("Cannot compute the hash code of "+a);for(var b=1,c=0;c<a.length;++c){var g=a[c];
if("number"!==typeof g)throw new TypeError("Cannot compute the hash code over non-numeric elements: "+g);b=31*b+g&4294967295}return b}function Da(a,b){if(a===b)return!0;if(!a||!b)return!1;b instanceof Array||(b=[b]);for(var c=0;c<b.length;++c){for(var g=b[c],k=!1,d=0;d<a.length;++d){var f=a[d];if(g.equals&&"function"===typeof g.equals&&g.equals(f)||g==f){k=!0;break}}if(!k)return!1}return!0}function pa(a,b){return Da(a,b)&&(a.length==b.length||Da(b,a))}function b(a,b,c){var g;c&&(g=c);if("object"!==
typeof a||"function"!==typeof a.result||"function"!==typeof a.error)throw new TypeError("callback must be an object with function properties 'result' and 'error'.");try{var d=b.call(g,a);d!==x&&a.result(d)}catch(k){try{a.error(k)}catch(f){}}}function g(a,c,g){if("object"!==typeof a||"function"!==typeof a.timeout)throw new TypeError("callback must be an object with function properties 'result', 'timeout', and 'error'.");b(a,c,g)}function a(a,b,c){1E5>a&&(a=1E5+a);Object.defineProperties(this,{internalCode:{value:a,
writable:!1,configurable:!1},responseCode:{value:b,writable:!1,configurable:!1},message:{value:c,writable:!1,configurable:!1}})}function qa(a){switch(a){case Na.PSK:case Na.MGK:return!0;default:return!1}}function Za(a){switch(a){case Na.PSK:case Na.MGK:case Na.X509:case Na.RSA:case Na.NPTICKET:case Na.ECC:return!0;default:return!1}}function f(a){return a.toJSON()}function c(b,c){Nc?c.result(Nc):Promise.resolve().then(function(){return Fa.getKeyByName(b)}).catch(function(){return Fa.generateKey({name:b},
!1,["wrapKey","unwrapKey"])}).then(function(a){Nc=a;c.result(Nc)}).catch(function(b){c.error(new B(a.INTERNAL_EXCEPTION,"Unable to get system key"))})}function n(a,b){var c=b.masterToken,g=b.userIdToken,d=b.serviceTokens;return{NccpMethod:a.nccpMethod,UserId:a.userId,UT:g&&g.serialNumber,MT:c&&c.serialNumber+":"+c.sequenceNumber,STCount:d&&d.length}}function vb(a){return a.uniqueKey()}function xc(c,g,f,n){function p(a,c,g){var d=[];(function w(){a.read(-1,c,{result:function(a){b(g,function(){if(a)d.push(a),
w();else switch(d.length){case 0:return new Uint8Array(0);case 1:return d[0];default:var h,l,t,r=d.length,J=0;for(l=h=0;l<r;l++)h+=d[l].length;h=new Uint8Array(h);for(l=0;l<r;l++)t=d[l],h.set(t,J),J+=t.length;return h}})},timeout:function(){g.timeout()},error:function(a){g.error(a)}})})()}function y(){n.getStoreState({result:function(a){if(a)for(var b=L.slice(),c=0;c<b.length;c++)b[c]({storeState:a})},timeout:function(){c.error("Timeout getting store state",""+e)},error:function(a){c.error("Error getting store state",
""+a)}})}var L=[];this.addEventHandler=function(a,b){switch(a){case "shouldpersist":L.push(b)}};this.send=function(Q,d){var Va=Q.timeout,hb=new Fe(c,f,Q,n.getKeyRequestData()),C=Q.httpLocation,w=Q.serviceTokens;c.trace("Sending MSL request",{NccpMethod:Q.nccpMethod});g.request(f,hb,new Ed(C),Va,{result:function(m){b(d,function(){var h=m&&m.getMessageHeader(),l=h&&h.serviceTokens||[];c.trace("Received MSL response",{NccpMethod:Q.nccpMethod},l.map(vb).join("\n"));if(!m)throw new B(a.INTERNAL_EXCEPTION,
"Null response stream");Q.allowTokenRefresh&&y();if(h=m.getErrorHeader())d.error(h);else{var t={};l.forEach(function(a){t[a.name]=a});w&&w.forEach(function(a){t[a.name]||l.push(a)});l=l.filter(function(a){return yf[a.name]&&!a.isDeleted()});p(m,Va,{result:function(a){b(d,function(){return{body:k(a),serviceTokens:l}})},timeout:function(){d.timeout()},error:function(a){d.error(a)}})}})},timeout:function(){d.timeout()},error:function(a){d.error(a)}})};this.hasUserIdToken=function(a){return!!n.getUserIdToken(a)};
this.removeUserIdToken=function(a){if(a=n.getUserIdToken(a))n.removeUserIdToken(a),y()};this.isErrorReauth=function(a){return a&&a.errorCode==d.USERDATA_REAUTH};this.isErrorHeader=function(a){return a instanceof Zc};this.getErrorCode=function(a){return a&&a.errorCode};this.getStateForMdx=function(a){var b=n.getMasterToken();a=n.getUserIdToken(a);var c=n.getCryptoContext(b);return{masterToken:b,userIdToken:a,cryptoContext:c}};this.buildPlayDataRequest=function(a,b){var d=new Ge;g.request(f,new Fe(c,
f,a),d,a.timeout,{result:function(){b.result(d.getRequest())},error:function(){b.result(d.getRequest())},timeout:function(){b.timeout()}})}}function ib(b,c,d,g,k,f){function n(c){var d;return Promise.resolve().then(function(){d=b.authenticationKeyNames[c];if(!d)throw new B(a.KEY_IMPORT_ERROR,"Invalid config keyName "+c);return Fa.getKeyByName(d)}).then(function(b){return new Promise(function(c,C){Oc(b,{result:c,error:function(){C(new B(a.KEY_IMPORT_ERROR,"Unable to create "+d+" CipherKey"))}})})}).catch(function(b){throw new B(a.KEY_IMPORT_ERROR,
"Unable to import "+d,b);})}return Promise.resolve().then(function(){if(!Fa.getKeyByName)throw new B(a.INTERNAL_EXCEPTION,"No WebCrypto cryptokeys");return Promise.all([n("e"),n("h"),n("w")])}).then(function(a){var Eb={};Eb[c]=new d(b.esn,a[0],a[1],a[2]);a=new g(b.esn);var Va=new Kg,Va=[new k(Va)],hb=new f(c);return{entityAuthFactories:Eb,entityAuthData:a,keyExchangeFactories:Va,keyRequestData:hb}})}function Wb(b,c,d){function g(){return Promise.resolve().then(function(){return Fa.generateKey(c,!1,
["wrapKey","unwrapKey"])}).then(function(a){return k(a.publicKey,a.privateKey)})}function k(b,c){return Promise.all([new Promise(function(c,d){Pc(b,{result:c,error:function(b){d(new B(a.INTERNAL_EXCEPTION,"Unable to create keyx public key",b))}})}),new Promise(function(b,d){$c(c,{result:b,error:function(b){d(new B(a.INTERNAL_EXCEPTION,"Unable to create keyx private key",b))}})})]).then(function(a){a=new Fd("rsaKeypairId",d,a[0],a[1]);f&&(a.storeData={keyxPublicKey:b,keyxPrivateKey:c});return a})}
var f=!b.systemKeyWrapFormat;return Promise.resolve().then(function(){var a=b.storeState,c=a&&a.keyxPublicKey,a=a&&a.keyxPrivateKey;return f&&c&&a?k(c,a):g()}).then(function(a){var c={};c[Na.NONE]=new Lg;var d=new Gd(b.esn),k=[new zf];return{entityAuthFactories:c,entityAuthData:d,keyExchangeFactories:k,keyRequestData:a,createKeyRequestData:f?g:x}})}var Fb=dc.nfCrypto||dc.msCrypto||dc.webkitCrypto||dc.crypto,y=Fb&&(Fb.webkitSubtle||Fb.subtle),zb=dc.nfCryptokeys||dc.msCryptokeys||dc.webkitCryptokeys||
dc.cryptokeys;(function(a){var b=function(){function a(c,d){c instanceof b?(this.abv=c.abv,this.position=c.position):(this.abv=c,this.position=d||0)}a.prototype={readByte:function(){return this.abv[this.position++]},writeByte:function(a){this.abv[this.position++]=a},peekByte:function(a){return this.abv[a]},copyBytes:function(a,b,c){var d=new Uint8Array(this.abv.buffer,this.position,c);a=new Uint8Array(a.buffer,b,c);d.set(a);this.position+=c},seek:function(a){this.position=a},skip:function(a){this.position+=
a},getPosition:function(){return this.position},setPosition:function(a){this.position=a},getRemaining:function(){return this.abv.length-this.position},getLength:function(){return this.abv.length},isEndOfStream:function(){return this.position>=this.abv.length},show:function(){var a;return a="AbvStream: pos "+(this.getPosition().toString()+" of "+this.getLength().toString())}};return a}(),c={};(function(){function a(l,h){h.writeByte(l.tagClass<<6|l.constructed<<5|l.tag);var m=l.payloadLen;if(128>m)h.writeByte(m);
else{for(var r=m,w=0;r;)++w,r>>=8;h.writeByte(128|w);for(r=0;r<w;++r)h.writeByte(m>>8*(w-r-1)&255)}if(l.child)for(l.tag==t.BIT_STRING&&h.writeByte(0),m=l._child;m;){if(!a(m,h))return!1;m=m.next}else switch(l.tag){case t.INTEGER:l.backingStore[l.dataIdx]>>7&&h.writeByte(0);h.copyBytes(l.backingStore,l.dataIdx,l.dataLen);break;case t.BIT_STRING:h.writeByte(0);h.copyBytes(l.backingStore,l.dataIdx,l.dataLen);break;case t.OCTET_STRING:h.copyBytes(l.backingStore,l.dataIdx,l.dataLen);break;case t.OBJECT_IDENTIFIER:h.copyBytes(l.backingStore,
l.dataIdx,l.dataLen)}return!0}function d(a){var l=a.readByte(),h=l&127;if(h==l)return h;if(3<h||0===h)return-1;for(var m=l=0;m<h;++m)l=l<<8|a.readByte();return l}function g(a,l,h){var m=a.backingStore,w=new b(m,l);l+=h;h=a;var J,c,A;if(8<K++)return x;for(;w.getPosition()<l;){w.getPosition();A=w.readByte();if(31==(A&31)){for(c=0;A&128;)c<<=8,c|=A&127;A=c}J=A;c=J&31;if(0>c||30<c)return x;A=d(w);if(0>A||A>w.getRemaining())return x;h.constructed=J&32;h.tagClass=(J&192)>>6;h.tag=c;h.dataLen=A;h.dataIdx=
w.getPosition();c=w;var La=J;J=A;if(La&32)c=!0;else if(La<t.BIT_STRING||La>t.OCTET_STRING)c=!1;else{var C=new b(c);La==t.BIT_STRING&&C.skip(1);C.readByte()>>6&1?c=!1:(La=d(C),c=C.getPosition()-c.getPosition()+La==J)}c&&(c=w.getPosition(),J=A,h.tag==t.BIT_STRING&&(h.dataIdx++,h.dataLen--,c++,J--),h.child=new r(m,h),g(h.child,c,J));h.tag==t.INTEGER&&(c=w.getPosition(),0==w.peekByte(c)&&w.peekByte(c+1)>>7&&(h.dataIdx++,h.dataLen--));w.skip(A);w.getPosition()<l&&(h.next=new r(m,h.parent),h=h.next)}K--;
return a}function k(a,l,h){if(9!=h)return!1;for(h=0;9>h;++h)if(a[l++]!=A[h])return!1;return!0}function Q(a){if(!(a&&a.child&&a.child.next&&a.child.child&&a.child.next.child))return!1;var l=a.child.child;return k(l.backingStore,l.dataIdx,l.dataLen)&&2==a.nChildren&&2==a.child.nChildren&&2==a.child.next.child.nChildren?!0:!1}function f(a){if(!(a&&a.child&&a.child.next&&a.child.next.child&&a.child.next.next&&a.child.next.next.child))return!1;var l=a.child.next.child;return k(l.backingStore,l.dataIdx,
l.dataLen)&&3==a.nChildren&&2==a.child.next.nChildren&&9==a.child.next.next.child.nChildren?!0:!1}function Va(a){var l=J.createSequenceNode(),h=new ka(l);h.addChild(J.createSequenceNode());h.addChild(J.createOidNode(A));h.addSibling(J.createNullNode());h.addToParent(l,J.createBitStringNode(null));h.addChild(J.createSequenceNode());h.addChild(J.createIntegerNode(a.n));h.addSibling(J.createIntegerNode(a.e));return l}function hb(a){a=a.child.next.child.child;var l=a.data;a=a.next;return new E(l,a.data,
null,null)}function C(a){var l=J.createSequenceNode(),h=new ka(l);h.addChild(J.createIntegerNode(new Uint8Array([0])));h.addSibling(J.createSequenceNode());h.addChild(J.createOidNode(A));h.addSibling(J.createNullNode());h.addToParent(l,J.createOctetStringNode(null));h.addChild(J.createSequenceNode());h.addChild(J.createIntegerNode(new Uint8Array([0])));h.addSibling(J.createIntegerNode(a.n));h.addSibling(J.createIntegerNode(a.e));h.addSibling(J.createIntegerNode(a.d));h.addSibling(J.createIntegerNode(a.p));
h.addSibling(J.createIntegerNode(a.q));h.addSibling(J.createIntegerNode(a.dp));h.addSibling(J.createIntegerNode(a.dq));h.addSibling(J.createIntegerNode(a.qi));return l}function w(a){var h=[];a=a.child.next.next.child.child.next;for(var l=0;8>l;l++)h.push(a.data),a=a.next;return new ma(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7])}function m(a,h,l,m){if(!(a instanceof E||a instanceof ma))return x;if(l)for(var r=0;r<l.length;++r)if(-1==nb.indexOf(l[r]))return x;h={kty:"RSA",alg:h,key_ops:l||[],ext:m==x?
!1:m,n:L(a.n,!0),e:L(a.e,!0)};a instanceof ma&&(h.d=L(a.d,!0),h.p=L(a.p,!0),h.q=L(a.q,!0),h.dp=L(a.dp,!0),h.dq=L(a.dq,!0),h.qi=L(a.qi,!0));return h}function h(a){if(!a.kty||"RSA"!=a.kty||!a.n||!a.e)return x;var h="RSA1_5 RSA-OAEP RSA-OAEP-256 RSA-OAEP-384 RSA-OAEP-512 RS256 RS384 RS512".split(" ");if(a.alg&&-1==h.indexOf(a.alg))return x;h=[];a.use?"enc"==a.use?h=["encrypt","decrypt","wrap","unwrap"]:"sig"==a.use&&(h=["sign","verify"]):h=a.key_ops;var l=a.ext,m=O(a.n,!0),r=O(a.e,!0);if(a.d){var t=
O(a.d,!0),w=O(a.p,!0),b=O(a.q,!0),J=O(a.dp,!0),c=O(a.dq,!0),A=O(a.qi,!0);return new ma(m,r,t,w,b,J,c,A,a.alg,h,l)}return new E(m,r,l,h)}function l(a,h,l,m){this.der=a;this.type=h;this.keyOps=l;this.extractable=m}var t={BER:0,BOOLEAN:1,INTEGER:2,BIT_STRING:3,OCTET_STRING:4,NULL:5,OBJECT_IDENTIFIER:6,OBJECT_DESCRIPTOR:7,INSTANCE_OF_EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED_PPV:11,UTF8_STRING:12,RELATIVE_OID:13,SEQUENCE:16,SET:17,NUMERIC_STRING:18,PRINTABLE_STRING:19,TELETEX_STRING:20,T61_STRING:20,VIDEOTEX_STRING:21,
IA5_STRING:22,UTC_TIME:23,GENERALIZED_TIME:24,GRAPHIC_STRING:25,VISIBLE_STRING:26,ISO64_STRING:26,GENERAL_STRING:27,UNIVERSAL_STRING:28,CHARACTER_STRING:29,BMP_STRING:30},r=function(a,h,l,m,r,t){this._data=a;this._parent=h||x;this._constructed=l||!1;this._tagClass=0;this._tag=m||0;this._dataIdx=r||0;this._dataLen=t||0};r.prototype={_child:x,_next:x,get data(){return new Uint8Array(this._data.buffer.slice(this._dataIdx,this._dataIdx+this._dataLen))},get backingStore(){return this._data},get constructed(){return this._constructed},
set constructed(a){this._constructed=0!=a?!0:!1},get tagClass(){return this._tagClass},set tagClass(a){this._tagClass=a},get tag(){return this._tag},set tag(a){this._tag=a},get dataIdx(){return this._dataIdx},set dataIdx(a){this._dataIdx=a},get dataLen(){return this._dataLen},set dataLen(a){this._dataLen=a},get child(){return this._child},set child(a){this._child=a;this._child.parent=this},get next(){return this._next},set next(a){this._next=a},get parent(){return this._parent},set parent(a){this._parent=
a},get payloadLen(){var a=0;if(this._child){for(var h=this._child;h;)a+=h.length,h=h.next;this._tag==t.BIT_STRING&&a++}else switch(this._tag){case t.INTEGER:a=this._dataLen;this._data[this._dataIdx]>>7&&a++;break;case t.BIT_STRING:a=this._dataLen+1;break;case t.OCTET_STRING:a=this._dataLen;break;case t.NULL:a=0;break;case t.OBJECT_IDENTIFIER:k(this._data,this._dataIdx,this._dataLen)&&(a=9)}return a},get length(){var a=this.payloadLen,h;if(127<a)for(h=a;h;)h>>=8,++a;return a+2},get der(){var h=this.length;
if(!h)return x;var h=new Uint8Array(h),l=new b(h);return a(this,l)?h:x},get nChildren(){for(var a=0,h=this._child;h;)a++,h=h.next;return a}};var J={createSequenceNode:function(){return new r(null,null,!0,t.SEQUENCE,null,null)},createOidNode:function(a){return new r(a,null,!1,t.OBJECT_IDENTIFIER,0,a?a.length:0)},createNullNode:function(){return new r(null,null,!1,t.NULL,null,null)},createBitStringNode:function(a){return new r(a,null,!1,t.BIT_STRING,0,a?a.length:0)},createIntegerNode:function(a){return new r(a,
null,!1,t.INTEGER,0,a?a.length:0)},createOctetStringNode:function(a){return new r(a,null,!1,t.OCTET_STRING,0,a?a.length:0)}},ka=function(a){this._currentNode=this._rootNode=a};ka.prototype={addChild:function(a){this.addTo(this._currentNode,a)},addSibling:function(a){this.addTo(this._currentNode.parent,a)},addTo:function(a,h){this._currentNode=h;this._currentNode.parent=a;if(a.child){for(var l=a.child;l.next;)l=l.next;l.next=h}else a.child=h},addToParent:function(a,h){this.findNode(a)&&this.addTo(a,
h)},findNode:function(a){for(var h=this._currentNode;h;){if(a==h)return!0;h=h.parent}return!1}};var K=0,A=new Uint8Array([42,134,72,134,247,13,1,1,1]),E=function(a,h,l,m){this.n=a;this.e=h;this.ext=l;this.keyOps=m},ma=function(a,h,l,m,r,t,w,b,J,c,A){this.n=a;this.e=h;this.d=l;this.p=m;this.q=r;this.dp=t;this.dq=w;this.qi=b;this.alg=J;this.keyOps=c;this.ext=A},nb="sign verify encrypt decrypt wrapKey unwrapKey deriveKey deriveBits".split(" ");l.prototype.getDer=function(){return this.der};l.prototype.getType=
function(){return this.type};l.prototype.getKeyOps=function(){return this.keyOps};l.prototype.getExtractable=function(){return this.extractable};c.parse=function(a){K=0;return g(new r(a),0,a.length)};c.show=function(a,h){};c.isRsaSpki=Q;c.isRsaPkcs8=f;c.NodeFactory=J;c.Builder=ka;c.tagVal=t;c.RsaPublicKey=E;c.RsaPrivateKey=ma;c.buildRsaSpki=Va;c.parseRsaSpki=function(a){a=c.parse(a);return Q?hb(a):x};c.buildRsaPkcs8=C;c.parseRsaPkcs8=function(a){a=c.parse(a);return f(a)?w(a):x};c.buildRsaJwk=m;c.parseRsaJwk=
h;c.RsaDer=l;c.rsaDerToJwk=function(a,h,l,r){a=c.parse(a);if(!a)return x;if(Q(a))a=hb(a);else if(f(a))a=w(a);else return x;return m(a,h,l,r)};c.jwkToRsaDer=function(a){a=h(a);if(!a)return x;var m,r;if(a instanceof E)m="spki",r=Va(a).der;else if(a instanceof ma)m="pkcs8",r=C(a).der;else return x;return new l(r,m,a.keyOps,a.ext)};c.webCryptoAlgorithmToJwkAlg=function(a){return"RSAES-PKCS1-v1_5"==a.name?"RSA1_5":"RSASSA-PKCS1-v1_5"==a.name?"SHA-256"==a.hash.name?"RS256":"SHA-384"==a.hash.name?"RS384":
"SHA-512"==a.hash.name?"RS512":x:x};c.webCryptoUsageToJwkKeyOps=function(a){return a.map(function(a){return"wrapKey"==a?"wrap":"unwrapKey"==a?"unwrap":a})}})();a.ASN1=c})(this);var L,O;(function(){for(var a={},b={},c={"=":0,".":0},d={"=":0,".":0},g=/\s+/g,k=/^[ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/_-]*[=]{0,2}$/,f=64;f--;)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]]=262144*f,b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]]=
4096*f,c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]]=64*f,d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]]=f;for(f=64;f--&&"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]!="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[f];)a["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[f]]=262144*f,b["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[f]]=4096*f,c["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[f]]=
64*f,d["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"[f]]=f;L=function(a,b){for(var c="",d=0,C=a.length,w=C-2,m,h=b?"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",l=b?"":"=";d<w;)m=65536*a[d++]+256*a[d++]+a[d++],c+=h[m>>>18]+h[m>>>12&63]+h[m>>>6&63]+h[m&63];d==w?(m=65536*a[d++]+256*a[d++],c+=h[m>>>18]+h[m>>>12&63]+h[m>>>6&63]+l):d==C-1&&(m=65536*a[d++],c+=h[m>>>18]+h[m>>>12&63]+l+l);return c};
O=function(f,Eb){f=f.replace(g,"");if(Eb){var Va=f.length%4;if(Va)for(var Va=4-Va,hb=0;hb<Va;++hb)f+="="}Va=f.length;if(0!=Va%4||!k.test(f))throw Error("bad base64: "+f);for(var C=Va/4*3-("="==f[Va-1]?1:0)-("="==f[Va-2]?1:0),w=new Uint8Array(C),m=0,h=0;m<Va;)hb=a[f[m++]]+b[f[m++]]+c[f[m++]]+d[f[m++]],w[h++]=hb>>>16,h<C&&(w[h++]=hb>>>8&255,h<C&&(w[h++]=hb&255));return w}})();var Oa={};(function(){function a(c){if(!(this instanceof a))return new a(c);for(var C=0,w=k.length;C<w;C++)this[k[C]]="";this.bufferCheckPosition=
Oa.MAX_BUFFER_LENGTH;this.q=this.c=this.p="";this.opt=c||{};this.closed=this.closedRoot=this.sawRoot=!1;this.tag=this.error=null;this.state=Q.BEGIN;this.stack=new g;this.index=this.position=this.column=0;this.line=1;this.slashed=!1;this.unicodeI=0;this.unicodeS=null;b(this,"onready")}function b(a,c,w){if(a[c])a[c](w)}function c(a,C){var w=a.opt,m=a.textNode;w.trim&&(m=m.trim());w.normalize&&(m=m.replace(/\s+/g," "));a.textNode=m;a.textNode&&b(a,C?C:"onvalue",a.textNode);a.textNode=""}function d(a,
C){c(a);C+="\nLine: "+a.line+"\nColumn: "+a.column+"\nChar: "+a.c;C=Error(C);a.error=C;b(a,"onerror",C);return a}function f(g){g.state!==Q.VALUE&&d(g,"Unexpected end");c(g);g.c="";g.closed=!0;b(g,"onend");a.call(g,g.opt);return g}var g=Array;Oa.parser=function(b){return new a(b)};Oa.CParser=a;Oa.MAX_BUFFER_LENGTH=65536;Oa.DEBUG=!1;Oa.INFO=!1;Oa.EVENTS="value string key openobject closeobject openarray closearray error end ready".split(" ");var k=["textNode","numberNode"];Oa.EVENTS.filter(function(a){return"error"!==
a&&"end"!==a});var Q=0;Oa.STATE={BEGIN:Q++,VALUE:Q++,OPEN_OBJECT:Q++,CLOSE_OBJECT:Q++,OPEN_ARRAY:Q++,CLOSE_ARRAY:Q++,TEXT_ESCAPE:Q++,STRING:Q++,BACKSLASH:Q++,END:Q++,OPEN_KEY:Q++,CLOSE_KEY:Q++,TRUE:Q++,TRUE2:Q++,TRUE3:Q++,FALSE:Q++,FALSE2:Q++,FALSE3:Q++,FALSE4:Q++,NULL:Q++,NULL2:Q++,NULL3:Q++,NUMBER_DECIMAL_POINT:Q++,NUMBER_DIGIT:Q++};for(var Eb in Oa.STATE)Oa.STATE[Oa.STATE[Eb]]=Eb;Q=Oa.STATE;Object.getPrototypeOf||(Object.getPrototypeOf=function(a){return a.__proto__});var Va=/[\\"\n]/g;a.prototype=
{end:function(){f(this)},write:function(a){if(this.error)throw this.error;if(this.closed)return d(this,"Cannot write after close. Assign an onready handler.");if(null===a)return f(this);for(var C=a[0],w=this.p;C;){w=C;this.c=C=a.charAt(this.index++);w!==C?this.p=w:w=this.p;if(!C)break;this.position++;"\n"===C?(this.line++,this.column=0):this.column++;switch(this.state){case Q.BEGIN:"{"===C?this.state=Q.OPEN_OBJECT:"["===C?this.state=Q.OPEN_ARRAY:"\r"!==C&&"\n"!==C&&" "!==C&&"\t"!==C&&d(this,"Non-whitespace before {[.");
continue;case Q.OPEN_KEY:case Q.OPEN_OBJECT:if("\r"===C||"\n"===C||" "===C||"\t"===C)continue;if(this.state===Q.OPEN_KEY)this.stack.push(Q.CLOSE_KEY);else if("}"===C){b(this,"onopenobject");b(this,"oncloseobject");this.state=this.stack.pop()||Q.VALUE;continue}else this.stack.push(Q.CLOSE_OBJECT);'"'===C?this.state=Q.STRING:d(this,'Malformed object key should start with "');continue;case Q.CLOSE_KEY:case Q.CLOSE_OBJECT:if("\r"===C||"\n"===C||" "===C||"\t"===C)continue;":"===C?(this.state===Q.CLOSE_OBJECT?
(this.stack.push(Q.CLOSE_OBJECT),c(this,"onopenobject")):c(this,"onkey"),this.state=Q.VALUE):"}"===C?(c(this),b(this,"oncloseobject",void 0),this.state=this.stack.pop()||Q.VALUE):","===C?(this.state===Q.CLOSE_OBJECT&&this.stack.push(Q.CLOSE_OBJECT),c(this),this.state=Q.OPEN_KEY):d(this,"Bad object");continue;case Q.OPEN_ARRAY:case Q.VALUE:if("\r"===C||"\n"===C||" "===C||"\t"===C)continue;if(this.state===Q.OPEN_ARRAY)if(b(this,"onopenarray"),this.state=Q.VALUE,"]"===C){b(this,"onclosearray");this.state=
this.stack.pop()||Q.VALUE;continue}else this.stack.push(Q.CLOSE_ARRAY);'"'===C?this.state=Q.STRING:"{"===C?this.state=Q.OPEN_OBJECT:"["===C?this.state=Q.OPEN_ARRAY:"t"===C?this.state=Q.TRUE:"f"===C?this.state=Q.FALSE:"n"===C?this.state=Q.NULL:"-"===C?this.numberNode+=C:"0"===C?(this.numberNode+=C,this.state=Q.NUMBER_DIGIT):-1!=="123456789".indexOf(C)?(this.numberNode+=C,this.state=Q.NUMBER_DIGIT):d(this,"Bad value");continue;case Q.CLOSE_ARRAY:if(","===C)this.stack.push(Q.CLOSE_ARRAY),c(this,"onvalue"),
this.state=Q.VALUE;else if("]"===C)c(this),b(this,"onclosearray",void 0),this.state=this.stack.pop()||Q.VALUE;else if("\r"===C||"\n"===C||" "===C||"\t"===C)continue;else d(this,"Bad array");continue;case Q.STRING:var w=this.index-1,m=this.slashed,h=this.unicodeI;a:for(;;){if(Oa.DEBUG)for(;0<h;)if(this.unicodeS+=C,C=a.charAt(this.index++),4===h?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),h=0,w=this.index-1):h++,!C)break a;if('"'===C&&!m){this.state=this.stack.pop()||Q.VALUE;(this.textNode+=
a.substring(w,this.index-1))||b(this,"onvalue","");break}if("\\"===C&&!m&&(m=!0,this.textNode+=a.substring(w,this.index-1),C=a.charAt(this.index++),!C))break;if(m)if(m=!1,"n"===C?this.textNode+="\n":"r"===C?this.textNode+="\r":"t"===C?this.textNode+="\t":"f"===C?this.textNode+="\f":"b"===C?this.textNode+="\b":"u"===C?(h=1,this.unicodeS=""):this.textNode+=C,C=a.charAt(this.index++),w=this.index-1,C)continue;else break;Va.lastIndex=this.index;var l=Va.exec(a);if(null===l){this.index=a.length+1;this.textNode+=
a.substring(w,this.index-1);break}this.index=l.index+1;C=a.charAt(l.index);if(!C){this.textNode+=a.substring(w,this.index-1);break}}this.slashed=m;this.unicodeI=h;continue;case Q.TRUE:if(""===C)continue;"r"===C?this.state=Q.TRUE2:d(this,"Invalid true started with t"+C);continue;case Q.TRUE2:if(""===C)continue;"u"===C?this.state=Q.TRUE3:d(this,"Invalid true started with tr"+C);continue;case Q.TRUE3:if(""===C)continue;"e"===C?(b(this,"onvalue",!0),this.state=this.stack.pop()||Q.VALUE):d(this,"Invalid true started with tru"+
C);continue;case Q.FALSE:if(""===C)continue;"a"===C?this.state=Q.FALSE2:d(this,"Invalid false started with f"+C);continue;case Q.FALSE2:if(""===C)continue;"l"===C?this.state=Q.FALSE3:d(this,"Invalid false started with fa"+C);continue;case Q.FALSE3:if(""===C)continue;"s"===C?this.state=Q.FALSE4:d(this,"Invalid false started with fal"+C);continue;case Q.FALSE4:if(""===C)continue;"e"===C?(b(this,"onvalue",!1),this.state=this.stack.pop()||Q.VALUE):d(this,"Invalid false started with fals"+C);continue;
case Q.NULL:if(""===C)continue;"u"===C?this.state=Q.NULL2:d(this,"Invalid null started with n"+C);continue;case Q.NULL2:if(""===C)continue;"l"===C?this.state=Q.NULL3:d(this,"Invalid null started with nu"+C);continue;case Q.NULL3:if(""===C)continue;"l"===C?(b(this,"onvalue",null),this.state=this.stack.pop()||Q.VALUE):d(this,"Invalid null started with nul"+C);continue;case Q.NUMBER_DECIMAL_POINT:"."===C?(this.numberNode+=C,this.state=Q.NUMBER_DIGIT):d(this,"Leading zero not followed by .");continue;
case Q.NUMBER_DIGIT:-1!=="0123456789".indexOf(C)?this.numberNode+=C:"."===C?(-1!==this.numberNode.indexOf(".")&&d(this,"Invalid number has two dots"),this.numberNode+=C):"e"===C||"E"===C?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||d(this,"Invalid number has two exponential"),this.numberNode+=C):"+"===C||"-"===C?("e"!==w&&"E"!==w&&d(this,"Invalid symbol in number"),this.numberNode+=C):(this.numberNode&&b(this,"onvalue",parseFloat(this.numberNode)),this.numberNode="",this.index--,
this.state=this.stack.pop()||Q.VALUE);continue;default:d(this,"Unknown state: "+this.state)}}if(this.position>=this.bufferCheckPosition){a=Math.max(Oa.MAX_BUFFER_LENGTH,10);w=C=0;for(m=k.length;w<m;w++){h=this[k[w]].length;if(h>a)switch(k[w]){case "text":break;default:d(this,"Max buffer length exceeded: "+k[w])}C=Math.max(C,h)}this.bufferCheckPosition=Oa.MAX_BUFFER_LENGTH-C+this.position}return this},resume:function(){this.error=null;return this},close:function(){return this.write(null)}}})();var be,
ce;(function(){function a(b,c){c||(c=b.length);return b.reduce(function(a,b,d){return d<c?a+String.fromCharCode(b):a},"")}for(var b={},c=0;256>c;++c){var d=a([c]);b[d]=c}for(var g=Object.keys(b).length,f=[],c=0;256>c;++c)f[c]=[c];be=function(c){function d(a,r){for(;0<r;){if(h>=m.length)return!1;if(r>l){var t=a,t=t>>>r-l;m[h]|=t&255;r-=l;l=8;++h}else r<=l&&(t=a,t<<=l-r,t&=255,t>>>=8-l,m[h]|=t&255,l-=r,r=0,0==l&&(l=8,++h))}return!0}var f={},k;for(k in b)f[k]=b[k];for(var hb=g,C=[],w=8,m=new Uint8Array(c.length),
h=0,l=8,t=0;t<c.length;++t){var r=c[t];C.push(r);k=a(C);var J=f[k];if(!J){C=a(C,C.length-1);if(!d(f[C],w))return null;0!=hb>>w&&++w;f[k]=hb++;C=[r]}}return 0<C.length&&(k=a(C),J=f[k],!d(J,w))?null:m.subarray(0,8>l?h+1:h)};ce=function(a){for(var b=f.slice(),c=0,d=0,g=8,C=new Uint8Array(Math.ceil(1.5*a.length)),w=0,m=0,h=[];c<a.length&&!(8*(a.length-c)-d<g);){for(var l=m=0;l<g;){var t=Math.min(g-l,8-d),r=a[c],r=r<<d,r=r&255,r=r>>>8-t,l=l+t,d=d+t;8==d&&(d=0,++c);m|=(r&255)<<g-l}l=b[m];0==h.length?++g:
(l?h.push(l[0]):h.push(h[0]),b[b.length]=h,h=[],b.length==1<<g&&++g,l||(l=b[m]));m=w+l.length;m>=C.length&&(t=new Uint8Array(Math.ceil(1.5*m)),t.set(C),C=t);C.set(l,w);w=m;h=h.concat(l)}return C.subarray(0,w)}})();var na,Ha,ad,Hd,ud,Af,Qc,Id,d;(function(){na="utf-8";Ha=9007199254740992;var a=ad={GZIP:"GZIP",LZW:"LZW"};Object.freeze(ad);Hd=function(b){for(var c=[a.GZIP,a.LZW],d=0;d<c.length&&0<b.length;++d)for(var g=c[d],f=0;f<b.length;++f)if(b[f]==g)return g;return null};var b=ud={AES_CBC_PKCS5Padding:"AES/CBC/PKCS5Padding",
AESWrap:"AESWrap",RSA_ECB_PKCS1Padding:"RSA/ECB/PKCS1Padding"};Object.freeze(ud);Af=function(a){return b.AES_CBC_PKCS5Padding==a?b.AES_CBC_PKCS5Padding:b.RSA_ECB_PKCS1Padding==a?b.RSA_ECB_PKCS1Padding:b[a]};var c=Qc={HmacSHA256:"HmacSHA256",SHA256withRSA:"SHA256withRSA"};Object.freeze(Qc);Id=function(a){return c[a]};d={FAIL:1,TRANSIENT_FAILURE:2,ENTITY_REAUTH:3,USER_REAUTH:4,KEYX_REQUIRED:5,ENTITYDATA_REAUTH:6,USERDATA_REAUTH:7,EXPIRED:8,REPLAYED:9,SSOTOKEN_REJECTED:10};Object.freeze(d)})();var ea=
{isObjectLiteral:function(a){return null!==a&&"object"===typeof a&&a.constructor===Object},extendDeep:function(){var a=arguments[0],b=1,c=arguments.length,d=!1,g,f,k,Q;"boolean"===typeof a&&(d=a,a=arguments[1],b=2);for(;b<c;b++)if(null!=(g=arguments[b]))for(f in g)d&&f in a||(Q=g[f],a!==Q&&Q!==x&&(k=a[f],a[f]=null!==k&&null!==Q&&"object"===typeof k&&"object"===typeof Q?ea.extendDeep(d,{},k,Q):Q));return a}};(function(){function a(b,c){return function(){var a=b.base,d;b.base=c;d=b.apply(this,arguments);
b.base=a;return d}}function b(c,d,g){var C,w,m,h;g=g||Q;h=!!g.extendAll;for(C in d)w=d.__lookupGetter__(C),m=d.__lookupSetter__(C),w||m?(w&&c.__defineGetter__(C,w),m&&c.__defineSetter__(C,m)):(w=d[C],m=c[C],"function"===typeof w&&"function"===typeof m&&w!==m?(w.base!==Function.prototype.base&&(w=a(w,m)),w.base=m):(h||g[C])&&ea.isObjectLiteral(w)&&ea.isObjectLiteral(m)&&(w=ea.extendDeep({},m,w)),c[C]=w)}function c(){var a=Array.prototype.slice,b=a.call(arguments,1);return this.extend({init:function C(){var c=
a.call(arguments,0);C.base.apply(this,b.concat(c))}})}function d(a,c){var g=new this(k);b(g,a,c);return f(g)}function g(a,c){b(this.prototype,a,c);return this}function f(a){var b=function(){var a=this.init;a&&arguments[0]!==k&&a.apply(this,arguments)};a&&(b.prototype=a);b.prototype.constructor=b;b.extend=d;b.bind=c;b.mixin=g;return b}var k={},Q={actions:!0};Function.prototype.base=function(){};ea.Class={create:f,mixin:b,extend:function(a,b){var c=f();c.prototype=new a;return c.extend(b)}};ea.mixin=
function(){ea.log&&ea.log.warn("util.mixin is deprecated.  Please change your code to use util.Class.mixin()");b.apply(null,arguments)}})();(function(){function a(b,c){return function(){var a=b.base,w;b.base=c;w=b.apply(this,arguments);b.base=a;return w}}function b(c,d,C){var w,m,h,l;C=C||Q;l=!!C.extendAll;for(w in d)m=d.__lookupGetter__(w),h=d.__lookupSetter__(w),m||h?(m&&c.__defineGetter__(w,m),h&&c.__defineSetter__(w,h)):(m=d[w],h=c[w],"function"===typeof m&&"function"===typeof h&&m!==h?(m.base!==
n&&(m=a(m,h)),m.base=h):(l||C[w])&&ea.isObjectLiteral(m)&&ea.isObjectLiteral(h)&&(m=ea.extendDeep({},h,m)),c[w]=m)}function c(){var a=Array.prototype.slice,b=a.call(arguments,1);return this.extend({init:function w(){var m=a.call(arguments,0);w.base.apply(this,b.concat(m))}})}function d(a,c){var C=new this(k);b(C,a,c);return f(C)}function g(a,c){b(this.prototype,a,c);return this}function f(a){var b=function(){var a=this.init;a&&arguments[0]!==k&&a.apply(this,arguments)};a&&(b.prototype=a);b.prototype.constructor=
b;b.extend=d;b.bind=c;b.mixin=g;return b}var k={},Q={actions:!0},n=function(){};Function.prototype.base=n;ea.Class={create:f,mixin:b,extend:function(a,b){var c=f();c.prototype=new a;return c.extend(b)}};ea.mixin=function(){ea.log&&ea.log.warn("util.mixin is deprecated.  Please change your code to use util.Class.mixin()");b.apply(null,arguments)}})();var Ga;(function(){function a(b){return b==Ha?1:b+1}function b(c){if(0===Object.keys(c._waiters).length)return 0;for(var d=a(c._nextWaiter);!c._waiters[d];)d=
a(d);return d}Ga=ea.Class.create({init:function(){Object.defineProperties(this,{_queue:{value:[],writable:!1,enumerable:!1,configurable:!1},_waiters:{value:{},writable:!1,enumerable:!1,configurable:!1},_nextWaiter:{value:0,writable:!0,enumerable:!1,configurable:!1},_lastWaiter:{value:0,writable:!0,enumerable:!1,configurable:!1}})},cancel:function(a){if(this._waiters[a]){var c=this._waiters[a];delete this._waiters[a];a==this._nextWaiter&&(this._nextWaiter=b(this));c.call(this,x)}},cancelAll:function(){for(;0!==
this._nextWaiter;)this.cancel(this._nextWaiter)},poll:function(c,d){var f=this,k=a(this._lastWaiter);this._lastWaiter=k;g(d,function(){if(0<this._queue.length){var a=this._queue.shift();setTimeout(function(){d.result(a)},0)}else{var g;-1!=c&&(g=setTimeout(function(){delete f._waiters[k];k==f._nextWaiter&&(f._nextWaiter=b(f));d.timeout()},c));this._waiters[k]=function(a){clearTimeout(g);setTimeout(function(){d.result(a)},0)};this._nextWaiter||(this._nextWaiter=k)}},f);return k},add:function(a){if(this._nextWaiter){var c=
this._waiters[this._nextWaiter];delete this._waiters[this._nextWaiter];this._nextWaiter=b(this);c.call(this,a)}else this._queue.push(a)}})})();var de;(function(){var a=0-Ha;de=ea.Class.create({nextBoolean:function(){var a=new Uint8Array(1);Fb.getRandomValues(a);return a[0]&1?!0:!1},nextInt:function(a){if(null!==a&&a!==x){if("number"!==typeof a)throw new TypeError("n must be of type number");if(1>a)throw new RangeError("n must be greater than zero");--a;var b=new Uint8Array(4);Fb.getRandomValues(b);
return Math.floor(((b[3]&127)<<24|b[2]<<16|b[1]<<8|b[0])/2147483648*(a-0+1)+0)}a=new Uint8Array(4);Fb.getRandomValues(a);b=(a[3]&127)<<24|a[2]<<16|a[1]<<8|a[0];return a[3]&128?-b:b},nextLong:function(){for(var b=a;b==a;){b=new Uint8Array(7);Fb.getRandomValues(b);var c=16777216*((b[6]&31)<<24|b[5]<<16|b[4]<<8|b[3])+(b[2]<<16|b[1]<<8|b[0]),b=b[6]&128?-c-1:c}return b},nextBytes:function(a){Fb.getRandomValues(a)}})})();var Fc;(function(){function a(b){return b==Ha?1:b+1}function b(c){if(0===Object.keys(c._waitingReaders).length)return 0;
for(var d=a(c._nextReader);!c._waitingReaders[d];)d=a(d);return d}function c(b){if(0===Object.keys(b._waitingWriters).length)return 0;for(var d=a(b._nextWriter);!b._waitingWriters[d];)d=a(d);return d}Fc=ea.Class.create({init:function(){Object.defineProperties(this,{_readers:{value:{},writable:!1,enumerable:!1,configurable:!1},_waitingReaders:{value:{},writable:!1,enumerable:!1,configurable:!1},_writer:{value:null,writable:!0,enumerable:!1,configurable:!1},_waitingWriters:{value:{},writable:!1,enumerable:!1,
configurable:!1},_nextReader:{value:0,writable:!0,enumerable:!1,configurable:!1},_nextWriter:{value:0,writable:!0,enumerable:!1,configurable:!1},_lastNumber:{value:0,writable:!0,enumerable:!1,configurable:!1}})},cancel:function(a){if(this._waitingReaders[a]){var d=this._waitingReaders[a];delete this._waitingReaders[a];a==this._nextReader&&(this._nextReader=b(this));d.call(this,!0)}this._waitingWriters[a]&&(d=this._waitingWriters[a],delete this._waitingWriters[a],a==this._nextWriter&&(this._nextWriter=
c(this)),d.call(this,!0))},cancelAll:function(){for(;0!==this._nextWriter;)this.cancel(this._nextWriter);for(;0!==this._nextReader;)this.cancel(this._nextReader)},readLock:function(c,d){var f=this,k=a(this._lastNumber);this._lastNumber=k;g(d,function(){if(!this._writer&&0===Object.keys(this._waitingWriters).length)return this._readers[k]=!0,k;var a;-1!=c&&(a=setTimeout(function(){delete f._waitingReaders[k];k==f._nextReader&&(f._nextReader=b(f));d.timeout()},c));this._waitingReaders[k]=function(b){clearTimeout(a);
b?setTimeout(function(){d.result(x)},0):(f._readers[k]=!0,setTimeout(function(){d.result(k)},0))};this._nextReader||(this._nextReader=k)},f);return k},writeLock:function(b,d){var f=this,k=a(this._lastNumber);this._lastNumber=k;g(d,function(){if(0===Object.keys(this._readers).length&&0===Object.keys(this._waitingReaders).length&&!this._writer)return this._writer=k;var a;-1!=b&&(a=setTimeout(function(){delete f._waitingWriters[k];k==f._nextWriter&&(f._nextWriter=c(f));d.timeout()},b));this._waitingWriters[k]=
function(b){clearTimeout(a);b?setTimeout(function(){d.result(x)},0):(f._writer=k,setTimeout(function(){d.result(k)},0))};this._nextWriter||(this._nextWriter=k)},f);return k},unlock:function(b){if(b==this._writer)this._writer=null;else{if(!this._readers[b])throw new W("There is no reader or writer with ticket number "+b+".");delete this._readers[b]}if(this._nextWriter)0<Object.keys(this._readers).length||(b=this._waitingWriters[this._nextWriter],delete this._waitingWriters[this._nextWriter],this._nextWriter=
c(this),b.call(this,!1));else{for(var d=this._nextReader;0<Object.keys(this._waitingReaders).length;d=a(d))this._waitingReaders[d]&&(b=this._waitingReaders[d],delete this._waitingReaders[d],b.call(this,!1));this._nextReader=0}}})})();ea.Class.mixin(a,{JSON_PARSE_ERROR:new a(0,d.FAIL,"Error parsing JSON."),JSON_ENCODE_ERROR:new a(1,d.FAIL,"Error encoding JSON."),ENVELOPE_HASH_MISMATCH:new a(2,d.FAIL,"Computed hash does not match envelope hash."),INVALID_PUBLIC_KEY:new a(3,d.FAIL,"Invalid public key provided."),
INVALID_PRIVATE_KEY:new a(4,d.FAIL,"Invalid private key provided."),PLAINTEXT_ILLEGAL_BLOCK_SIZE:new a(5,d.FAIL,"Plaintext is not a multiple of the block size."),PLAINTEXT_BAD_PADDING:new a(6,d.FAIL,"Plaintext contains incorrect padding."),CIPHERTEXT_ILLEGAL_BLOCK_SIZE:new a(7,d.FAIL,"Ciphertext is not a multiple of the block size."),CIPHERTEXT_BAD_PADDING:new a(8,d.FAIL,"Ciphertext contains incorrect padding."),ENCRYPT_NOT_SUPPORTED:new a(9,d.FAIL,"Encryption not supported."),DECRYPT_NOT_SUPPORTED:new a(10,
d.FAIL,"Decryption not supported."),ENVELOPE_KEY_ID_MISMATCH:new a(11,d.FAIL,"Encryption envelope key ID does not match crypto context key ID."),CIPHERTEXT_ENVELOPE_PARSE_ERROR:new a(12,d.FAIL,"Error parsing ciphertext envelope."),CIPHERTEXT_ENVELOPE_ENCODE_ERROR:new a(13,d.FAIL,"Error encoding ciphertext envelope."),SIGN_NOT_SUPPORTED:new a(14,d.FAIL,"Sign not supported."),VERIFY_NOT_SUPPORTED:new a(15,d.FAIL,"Verify not suppoprted."),SIGNATURE_ERROR:new a(16,d.FAIL,"Signature not initialized or unable to process data/signature."),
HMAC_ERROR:new a(17,d.FAIL,"Error computing HMAC."),ENCRYPT_ERROR:new a(18,d.FAIL,"Error encrypting plaintext."),DECRYPT_ERROR:new a(19,d.FAIL,"Error decrypting ciphertext."),INSUFFICIENT_CIPHERTEXT:new a(20,d.FAIL,"Insufficient ciphertext for decryption."),SESSION_KEY_CREATION_FAILURE:new a(21,d.FAIL,"Error when creating session keys."),ASN1_PARSE_ERROR:new a(22,d.FAIL,"Error parsing ASN.1."),ASN1_ENCODE_ERROR:new a(23,d.FAIL,"Error encoding ASN.1."),INVALID_SYMMETRIC_KEY:new a(24,d.FAIL,"Invalid symmetric key provided."),
INVALID_ENCRYPTION_KEY:new a(25,d.FAIL,"Invalid encryption key."),INVALID_HMAC_KEY:new a(26,d.FAIL,"Invalid HMAC key."),WRAP_NOT_SUPPORTED:new a(27,d.FAIL,"Wrap not supported."),UNWRAP_NOT_SUPPORTED:new a(28,d.FAIL,"Unwrap not supported."),UNIDENTIFIED_JWK_TYPE:new a(29,d.FAIL,"Unidentified JSON web key type."),UNIDENTIFIED_JWK_USAGE:new a(30,d.FAIL,"Unidentified JSON web key usage."),UNIDENTIFIED_JWK_ALGORITHM:new a(31,d.FAIL,"Unidentified JSON web key algorithm."),WRAP_ERROR:new a(32,d.FAIL,"Error wrapping plaintext."),
UNWRAP_ERROR:new a(33,d.FAIL,"Error unwrapping ciphertext."),INVALID_JWK:new a(34,d.FAIL,"Invalid JSON web key."),INVALID_JWK_KEYDATA:new a(35,d.FAIL,"Invalid JSON web key keydata."),UNSUPPORTED_JWK_ALGORITHM:new a(36,d.FAIL,"Unsupported JSON web key algorithm."),WRAP_KEY_CREATION_FAILURE:new a(37,d.FAIL,"Error when creating wrapping key."),INVALID_WRAP_CIPHERTEXT:new a(38,d.FAIL,"Invalid wrap ciphertext."),UNSUPPORTED_JWE_ALGORITHM:new a(39,d.FAIL,"Unsupported JSON web encryption algorithm."),JWE_ENCODE_ERROR:new a(40,
d.FAIL,"Error encoding JSON web encryption header."),JWE_PARSE_ERROR:new a(41,d.FAIL,"Error parsing JSON web encryption header."),INVALID_ALGORITHM_PARAMS:new a(42,d.FAIL,"Invalid algorithm parameters."),JWE_ALGORITHM_MISMATCH:new a(43,d.FAIL,"JSON web encryption header algorithms mismatch."),KEY_IMPORT_ERROR:new a(44,d.FAIL,"Error importing key."),KEY_EXPORT_ERROR:new a(45,d.FAIL,"Error exporting key."),DIGEST_ERROR:new a(46,d.FAIL,"Error in digest."),UNSUPPORTED_KEY:new a(47,d.FAIL,"Unsupported key type or algorithm."),
UNSUPPORTED_JWE_SERIALIZATION:new a(48,d.FAIL,"Unsupported JSON web encryption serialization."),XML_PARSE_ERROR:new a(49,d.FAIL,"Error parsing XML."),XML_ENCODE_ERROR:new a(50,d.FAIL,"Error encoding XML."),INVALID_WRAPPING_KEY:new a(51,d.FAIL,"Invalid wrapping key."),UNIDENTIFIED_CIPHERTEXT_ENVELOPE:new a(52,d.FAIL,"Unidentified ciphertext envelope version."),UNIDENTIFIED_SIGNATURE_ENVELOPE:new a(53,d.FAIL,"Unidentified signature envelope version."),UNSUPPORTED_CIPHERTEXT_ENVELOPE:new a(54,d.FAIL,
"Unsupported ciphertext envelope version."),UNSUPPORTED_SIGNATURE_ENVELOPE:new a(55,d.FAIL,"Unsupported signature envelope version."),UNIDENTIFIED_CIPHERSPEC:new a(56,d.FAIL,"Unidentified cipher specification."),UNIDENTIFIED_ALGORITHM:new a(57,d.FAIL,"Unidentified algorithm."),SIGNATURE_ENVELOPE_PARSE_ERROR:new a(58,d.FAIL,"Error parsing signature envelope."),SIGNATURE_ENVELOPE_ENCODE_ERROR:new a(59,d.FAIL,"Error encoding signature envelope."),INVALID_SIGNATURE:new a(60,d.FAIL,"Invalid signature."),
WRAPKEY_FINGERPRINT_NOTSUPPORTED:new a(61,d.FAIL,"Wrap key fingerprint not supported"),UNIDENTIFIED_JWK_KEYOP:new a(62,d.FAIL,"Unidentified JSON web key key operation."),MASTERTOKEN_UNTRUSTED:new a(1E3,d.ENTITY_REAUTH,"Master token is not trusted."),MASTERTOKEN_KEY_CREATION_ERROR:new a(1001,d.ENTITY_REAUTH,"Unable to construct symmetric keys from master token."),MASTERTOKEN_EXPIRES_BEFORE_RENEWAL:new a(1002,d.ENTITY_REAUTH,"Master token expiration timestamp is before the renewal window opens."),MASTERTOKEN_SESSIONDATA_MISSING:new a(1003,
d.ENTITY_REAUTH,"No master token session data found."),MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_RANGE:new a(1004,d.ENTITY_REAUTH,"Master token sequence number is out of range."),MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(1005,d.ENTITY_REAUTH,"Master token serial number is out of range."),MASTERTOKEN_TOKENDATA_INVALID:new a(1006,d.ENTITY_REAUTH,"Invalid master token data."),MASTERTOKEN_SIGNATURE_INVALID:new a(1007,d.ENTITY_REAUTH,"Invalid master token signature."),MASTERTOKEN_SESSIONDATA_INVALID:new a(1008,
d.ENTITY_REAUTH,"Invalid master token session data."),MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_SYNC:new a(1009,d.ENTITY_REAUTH,"Master token sequence number does not have the expected value."),MASTERTOKEN_TOKENDATA_MISSING:new a(1010,d.ENTITY_REAUTH,"No master token data found."),MASTERTOKEN_TOKENDATA_PARSE_ERROR:new a(1011,d.ENTITY_REAUTH,"Error parsing master token data."),MASTERTOKEN_SESSIONDATA_PARSE_ERROR:new a(1012,d.ENTITY_REAUTH,"Error parsing master token session data."),MASTERTOKEN_IDENTITY_REVOKED:new a(1013,
d.ENTITY_REAUTH,"Master token entity identity is revoked."),MASTERTOKEN_REJECTED_BY_APP:new a(1014,d.ENTITY_REAUTH,"Master token is rejected by the application."),USERIDTOKEN_MASTERTOKEN_MISMATCH:new a(2E3,d.USER_REAUTH,"User ID token master token serial number does not match master token serial number."),USERIDTOKEN_NOT_DECRYPTED:new a(2001,d.USER_REAUTH,"User ID token is not decrypted or verified."),USERIDTOKEN_MASTERTOKEN_NULL:new a(2002,d.USER_REAUTH,"User ID token requires a master token."),
USERIDTOKEN_EXPIRES_BEFORE_RENEWAL:new a(2003,d.USER_REAUTH,"User ID token expiration timestamp is before the renewal window opens."),USERIDTOKEN_USERDATA_MISSING:new a(2004,d.USER_REAUTH,"No user ID token user data found."),USERIDTOKEN_MASTERTOKEN_NOT_FOUND:new a(2005,d.USER_REAUTH,"User ID token is bound to an unknown master token."),USERIDTOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(2006,d.USER_REAUTH,"User ID token master token serial number is out of range."),USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(2007,
d.USER_REAUTH,"User ID token serial number is out of range."),USERIDTOKEN_TOKENDATA_INVALID:new a(2008,d.USER_REAUTH,"Invalid user ID token data."),USERIDTOKEN_SIGNATURE_INVALID:new a(2009,d.USER_REAUTH,"Invalid user ID token signature."),USERIDTOKEN_USERDATA_INVALID:new a(2010,d.USER_REAUTH,"Invalid user ID token user data."),USERIDTOKEN_IDENTITY_INVALID:new a(2011,d.USER_REAUTH,"Invalid user ID token user identity."),RESERVED_2012:new a(2012,d.USER_REAUTH,"The entity is not associated with the user."),
USERIDTOKEN_IDENTITY_NOT_FOUND:new a(2013,d.USER_REAUTH,"The user identity was not found."),USERIDTOKEN_PASSWORD_VERSION_CHANGED:new a(2014,d.USER_REAUTH,"The user identity must be reauthenticated because the password version changed."),USERIDTOKEN_USERAUTH_DATA_MISMATCH:new a(2015,d.USER_REAUTH,"The user ID token and user authentication data user identities do not match."),USERIDTOKEN_TOKENDATA_MISSING:new a(2016,d.USER_REAUTH,"No user ID token data found."),USERIDTOKEN_TOKENDATA_PARSE_ERROR:new a(2017,
d.USER_REAUTH,"Error parsing user ID token data."),USERIDTOKEN_USERDATA_PARSE_ERROR:new a(2018,d.USER_REAUTH,"Error parsing user ID token user data."),USERIDTOKEN_REVOKED:new a(2019,d.USER_REAUTH,"User ID token is revoked."),USERIDTOKEN_REJECTED_BY_APP:new a(2020,d.USER_REAUTH,"User ID token is rejected by the application."),SERVICETOKEN_MASTERTOKEN_MISMATCH:new a(3E3,d.FAIL,"Service token master token serial number does not match master token serial number."),SERVICETOKEN_USERIDTOKEN_MISMATCH:new a(3001,
d.FAIL,"Service token user ID token serial number does not match user ID token serial number."),SERVICETOKEN_SERVICEDATA_INVALID:new a(3002,d.FAIL,"Service token data invalid."),SERVICETOKEN_MASTERTOKEN_NOT_FOUND:new a(3003,d.FAIL,"Service token is bound to an unknown master token."),SERVICETOKEN_USERIDTOKEN_NOT_FOUND:new a(3004,d.FAIL,"Service token is bound to an unknown user ID token."),SERVICETOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(3005,d.FAIL,"Service token master token serial number is out of range."),
SERVICETOKEN_USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE:new a(3006,d.FAIL,"Service token user ID token serial number is out of range."),SERVICETOKEN_TOKENDATA_INVALID:new a(3007,d.FAIL,"Invalid service token data."),SERVICETOKEN_SIGNATURE_INVALID:new a(3008,d.FAIL,"Invalid service token signature."),SERVICETOKEN_TOKENDATA_MISSING:new a(3009,d.FAIL,"No service token data found."),UNIDENTIFIED_ENTITYAUTH_SCHEME:new a(4E3,d.FAIL,"Unable to identify entity authentication scheme."),ENTITYAUTH_FACTORY_NOT_FOUND:new a(4001,
d.FAIL,"No factory registered for entity authentication scheme."),X509CERT_PARSE_ERROR:new a(4002,d.ENTITYDATA_REAUTH,"Error parsing X.509 certificate data."),X509CERT_ENCODE_ERROR:new a(4003,d.ENTITYDATA_REAUTH,"Error encoding X.509 certificate data."),X509CERT_VERIFICATION_FAILED:new a(4004,d.ENTITYDATA_REAUTH,"X.509 certificate verification failed."),ENTITY_NOT_FOUND:new a(4005,d.FAIL,"Entity not recognized."),INCORRECT_ENTITYAUTH_DATA:new a(4006,d.FAIL,"Entity used incorrect entity authentication data type."),
RSA_PUBLICKEY_NOT_FOUND:new a(4007,d.ENTITYDATA_REAUTH,"RSA public key not found."),NPTICKET_GRACE_PERIOD_EXCEEDED:new a(4008,d.ENTITYDATA_REAUTH,"Fake NP-Tickets cannot be used after the grace period when the Playstation Network is up."),NPTICKET_SERVICE_ID_MISSING:new a(4009,d.ENTITYDATA_REAUTH,"NP-Ticket service ID is missing."),NPTICKET_SERVICE_ID_DISALLOWED:new a(4010,d.ENTITYDATA_REAUTH,"NP-Ticket service ID is not allowed."),NPTICKET_NOT_YET_VALID:new a(4011,d.ENTITYDATA_REAUTH,"NP-Ticket issuance date is in the future."),
NPTICKET_EXPIRED:new a(4012,d.ENTITYDATA_REAUTH,"NP-Ticket has expired."),NPTICKET_PRIVATE_KEY_NOT_FOUND:new a(4013,d.ENTITYDATA_REAUTH,"No private key found for NP-Ticket GUID."),NPTICKET_COOKIE_VERIFICATION_FAILED:new a(4014,d.ENTITYDATA_REAUTH,"NP-Ticket cookie signature verification failed."),NPTICKET_INCORRECT_COOKIE_VERSION:new a(4015,d.ENTITYDATA_REAUTH,"Incorrect NP-Ticket cookie version."),NPTICKET_BROKEN:new a(4016,d.ENTITYDATA_REAUTH,"NP-Ticket broken."),NPTICKET_VERIFICATION_FAILED:new a(4017,
d.ENTITYDATA_REAUTH,"NP-Ticket signature verification failed."),NPTICKET_ERROR:new a(4018,d.ENTITYDATA_REAUTH,"Unknown NP-Ticket TCM error."),NPTICKET_CIPHER_INFO_NOT_FOUND:new a(4019,d.ENTITYDATA_REAUTH,"No cipher information found for NP-Ticket."),NPTICKET_INVALID_CIPHER_INFO:new a(4020,d.ENTITYDATA_REAUTH,"Cipher information for NP-Ticket is invalid."),NPTICKET_UNSUPPORTED_VERSION:new a(4021,d.ENTITYDATA_REAUTH,"Unsupported NP-Ticket version."),NPTICKET_INCORRECT_KEY_LENGTH:new a(4022,d.ENTITYDATA_REAUTH,
"Incorrect NP-Ticket public key length."),UNSUPPORTED_ENTITYAUTH_DATA:new a(4023,d.FAIL,"Unsupported entity authentication data."),CRYPTEX_RSA_KEY_SET_NOT_FOUND:new a(4024,d.FAIL,"Cryptex RSA key set not found."),ENTITY_REVOKED:new a(4025,d.FAIL,"Entity is revoked."),ENTITY_REJECTED_BY_APP:new a(4026,d.ENTITYDATA_REAUTH,"Entity is rejected by the application."),FORCE_LOGIN:new a(5E3,d.USERDATA_REAUTH,"User must login again."),NETFLIXID_COOKIES_EXPIRED:new a(5001,d.USERDATA_REAUTH,"Netflix ID cookie identity has expired."),
NETFLIXID_COOKIES_BLANK:new a(5002,d.USERDATA_REAUTH,"Netflix ID or Secure Netflix ID cookie is blank."),UNIDENTIFIED_USERAUTH_SCHEME:new a(5003,d.FAIL,"Unable to identify user authentication scheme."),USERAUTH_FACTORY_NOT_FOUND:new a(5004,d.FAIL,"No factory registered for user authentication scheme."),EMAILPASSWORD_BLANK:new a(5005,d.USERDATA_REAUTH,"Email or password is blank."),AUTHMGR_COMMS_FAILURE:new a(5006,d.TRANSIENT_FAILURE,"Error communicating with authentication manager."),EMAILPASSWORD_INCORRECT:new a(5007,
d.USERDATA_REAUTH,"Email or password is incorrect."),UNSUPPORTED_USERAUTH_DATA:new a(5008,d.FAIL,"Unsupported user authentication data."),SSOTOKEN_BLANK:new a(5009,d.SSOTOKEN_REJECTED,"SSO token is blank."),SSOTOKEN_NOT_ASSOCIATED:new a(5010,d.USERDATA_REAUTH,"SSO token is not associated with a Netflix user."),USERAUTH_USERIDTOKEN_INVALID:new a(5011,d.USERDATA_REAUTH,"User authentication data user ID token is invalid."),PROFILEID_BLANK:new a(5012,d.USERDATA_REAUTH,"Profile ID is blank."),UNIDENTIFIED_USERAUTH_MECHANISM:new a(5013,
d.FAIL,"Unable to identify user authentication mechanism."),UNSUPPORTED_USERAUTH_MECHANISM:new a(5014,d.FAIL,"Unsupported user authentication mechanism."),SSOTOKEN_INVALID:new a(5015,d.SSOTOKEN_REJECTED,"SSO token invalid."),USERAUTH_MASTERTOKEN_MISSING:new a(5016,d.USERDATA_REAUTH,"User authentication required master token is missing."),ACCTMGR_COMMS_FAILURE:new a(5017,d.TRANSIENT_FAILURE,"Error communicating with the account manager."),SSO_ASSOCIATION_FAILURE:new a(5018,d.TRANSIENT_FAILURE,"SSO user association failed."),
SSO_DISASSOCIATION_FAILURE:new a(5019,d.TRANSIENT_FAILURE,"SSO user disassociation failed."),MDX_USERAUTH_VERIFICATION_FAILED:new a(5020,d.USERDATA_REAUTH,"MDX user authentication data verification failed."),USERAUTH_USERIDTOKEN_NOT_DECRYPTED:new a(5021,d.USERDATA_REAUTH,"User authentication data user ID token is not decrypted or verified."),MDX_USERAUTH_ACTION_INVALID:new a(5022,d.USERDATA_REAUTH,"MDX user authentication data action is invalid."),CTICKET_DECRYPT_ERROR:new a(5023,d.USERDATA_REAUTH,
"CTicket decryption failed."),USERAUTH_MASTERTOKEN_INVALID:new a(5024,d.USERDATA_REAUTH,"User authentication data master token is invalid."),USERAUTH_MASTERTOKEN_NOT_DECRYPTED:new a(5025,d.USERDATA_REAUTH,"User authentication data master token is not decrypted or verified."),CTICKET_CRYPTOCONTEXT_ERROR:new a(5026,d.USERDATA_REAUTH,"Error creating CTicket crypto context."),MDX_PIN_BLANK:new a(5027,d.USERDATA_REAUTH,"MDX controller or target PIN is blank."),MDX_PIN_MISMATCH:new a(5028,d.USERDATA_REAUTH,
"MDX controller and target PIN mismatch."),MDX_USER_UNKNOWN:new a(5029,d.USERDATA_REAUTH,"MDX controller user ID token or CTicket is not decrypted or verified."),USERAUTH_USERIDTOKEN_MISSING:new a(5030,d.USERDATA_REAUTH,"User authentication required user ID token is missing."),MDX_CONTROLLERDATA_INVALID:new a(5031,d.USERDATA_REAUTH,"MDX controller authentication data is invalid."),USERAUTH_ENTITY_MISMATCH:new a(5032,d.USERDATA_REAUTH,"User authentication data does not match entity identity."),USERAUTH_INCORRECT_DATA:new a(5033,
d.FAIL,"Entity used incorrect key request data type"),SSO_ASSOCIATION_WITH_NONMEMBER:new a(5034,d.USERDATA_REAUTH,"SSO user association failed because the customer is not a member."),SSO_ASSOCIATION_WITH_FORMERMEMBER:new a(5035,d.USERDATA_REAUTH,"SSO user association failed because the customer is a former member."),SSO_ASSOCIATION_CONFLICT:new a(5036,d.USERDATA_REAUTH,"SSO user association failed because the token identifies a different member."),USER_REJECTED_BY_APP:new a(5037,d.USERDATA_REAUTH,
"User is rejected by the application."),PROFILE_SWITCH_DISALLOWED:new a(5038,d.TRANSIENT_FAILURE,"Unable to switch user profile."),MEMBERSHIPCLIENT_COMMS_FAILURE:new a(5039,d.TRANSIENT_FAILURE,"Error communicating with the membership manager."),USERIDTOKEN_IDENTITY_NOT_ASSOCIATED_WITH_ENTITY:new a(5040,d.USER_REAUTH,"The entity is not associated with the user."),UNSUPPORTED_COMPRESSION:new a(6E3,d.FAIL,"Unsupported compression algorithm."),COMPRESSION_ERROR:new a(6001,d.FAIL,"Error compressing data."),
UNCOMPRESSION_ERROR:new a(6002,d.FAIL,"Error uncompressing data."),MESSAGE_ENTITY_NOT_FOUND:new a(6003,d.FAIL,"Message header entity authentication data or master token not found."),PAYLOAD_MESSAGE_ID_MISMATCH:new a(6004,d.FAIL,"Payload chunk message ID does not match header message ID ."),PAYLOAD_SEQUENCE_NUMBER_MISMATCH:new a(6005,d.FAIL,"Payload chunk sequence number does not match expected sequence number."),PAYLOAD_VERIFICATION_FAILED:new a(6006,d.FAIL,"Payload chunk payload signature verification failed."),
MESSAGE_DATA_MISSING:new a(6007,d.FAIL,"No message data found."),MESSAGE_FORMAT_ERROR:new a(6008,d.FAIL,"Malformed message data."),MESSAGE_VERIFICATION_FAILED:new a(6009,d.FAIL,"Message header/error data signature verification failed."),HEADER_DATA_MISSING:new a(6010,d.FAIL,"No header data found."),PAYLOAD_DATA_MISSING:new a(6011,d.FAIL,"No payload data found in non-EOM payload chunk."),PAYLOAD_DATA_CORRUPT:new a(6012,d.FAIL,"Corrupt payload data found in non-EOM payload chunk."),UNIDENTIFIED_COMPRESSION:new a(6013,
d.FAIL,"Unidentified compression algorithm."),MESSAGE_EXPIRED:new a(6014,d.EXPIRED,"Message expired and not renewable. Rejected."),MESSAGE_ID_OUT_OF_RANGE:new a(6015,d.FAIL,"Message ID is out of range."),INTERNAL_CODE_NEGATIVE:new a(6016,d.FAIL,"Error header internal code is negative."),UNEXPECTED_RESPONSE_MESSAGE_ID:new a(6017,d.FAIL,"Unexpected response message ID. Possible replay."),RESPONSE_REQUIRES_ENCRYPTION:new a(6018,d.KEYX_REQUIRED,"Message response requires encryption."),PAYLOAD_SEQUENCE_NUMBER_OUT_OF_RANGE:new a(6019,
d.FAIL,"Payload chunk sequence number is out of range."),PAYLOAD_MESSAGE_ID_OUT_OF_RANGE:new a(6020,d.FAIL,"Payload chunk message ID is out of range."),MESSAGE_REPLAYED:new a(6021,d.REPLAYED,"Non-replayable message replayed."),INCOMPLETE_NONREPLAYABLE_MESSAGE:new a(6022,d.FAIL,"Non-replayable message sent non-renewable or without key request data or without a master token."),HEADER_SIGNATURE_INVALID:new a(6023,d.FAIL,"Invalid Header signature."),HEADER_DATA_INVALID:new a(6024,d.FAIL,"Invalid header data."),
PAYLOAD_INVALID:new a(6025,d.FAIL,"Invalid payload."),PAYLOAD_SIGNATURE_INVALID:new a(6026,d.FAIL,"Invalid payload signature."),RESPONSE_REQUIRES_MASTERTOKEN:new a(6027,d.KEYX_REQUIRED,"Message response requires a master token."),RESPONSE_REQUIRES_USERIDTOKEN:new a(6028,d.USER_REAUTH,"Message response requires a user ID token."),REQUEST_REQUIRES_USERAUTHDATA:new a(6029,d.FAIL,"User-associated message requires user authentication data."),UNEXPECTED_MESSAGE_SENDER:new a(6030,d.FAIL,"Message sender is equal to the local entity or not the master token entity."),
NONREPLAYABLE_MESSAGE_REQUIRES_MASTERTOKEN:new a(6031,d.FAIL,"Non-replayable message requires a master token."),NONREPLAYABLE_ID_OUT_OF_RANGE:new a(6032,d.FAIL,"Non-replayable message non-replayable ID is out of range."),MESSAGE_SERVICETOKEN_MISMATCH:new a(6033,d.FAIL,"Service token master token or user ID token serial number does not match the message token serial numbers."),MESSAGE_PEER_SERVICETOKEN_MISMATCH:new a(6034,d.FAIL,"Peer service token master token or user ID token serial number does not match the message peer token serial numbers."),
RESPONSE_REQUIRES_INTEGRITY_PROTECTION:new a(6035,d.KEYX_REQUIRED,"Message response requires integrity protection."),HANDSHAKE_DATA_MISSING:new a(6036,d.FAIL,"Handshake message is not renewable or does not contain key request data."),MESSAGE_RECIPIENT_MISMATCH:new a(6037,d.FAIL,"Message recipient does not match local identity."),UNIDENTIFIED_KEYX_SCHEME:new a(7E3,d.FAIL,"Unable to identify key exchange scheme."),KEYX_FACTORY_NOT_FOUND:new a(7001,d.FAIL,"No factory registered for key exchange scheme."),
KEYX_REQUEST_NOT_FOUND:new a(7002,d.FAIL,"No key request found matching header key response data."),UNIDENTIFIED_KEYX_KEY_ID:new a(7003,d.FAIL,"Unable to identify key exchange key ID."),UNSUPPORTED_KEYX_KEY_ID:new a(7004,d.FAIL,"Unsupported key exchange key ID."),UNIDENTIFIED_KEYX_MECHANISM:new a(7005,d.FAIL,"Unable to identify key exchange mechanism."),UNSUPPORTED_KEYX_MECHANISM:new a(7006,d.FAIL,"Unsupported key exchange mechanism."),KEYX_RESPONSE_REQUEST_MISMATCH:new a(7007,d.FAIL,"Key exchange response does not match request."),
KEYX_PRIVATE_KEY_MISSING:new a(7008,d.FAIL,"Key exchange private key missing."),UNKNOWN_KEYX_PARAMETERS_ID:new a(7009,d.FAIL,"Key exchange parameters ID unknown or invalid."),KEYX_MASTER_TOKEN_MISSING:new a(7010,d.FAIL,"Master token required for key exchange is missing."),KEYX_INVALID_PUBLIC_KEY:new a(7011,d.FAIL,"Key exchange public key is invalid."),KEYX_PUBLIC_KEY_MISSING:new a(7012,d.FAIL,"Key exchange public key missing."),KEYX_WRAPPING_KEY_MISSING:new a(7013,d.FAIL,"Key exchange wrapping key missing."),
KEYX_WRAPPING_KEY_ID_MISSING:new a(7014,d.FAIL,"Key exchange wrapping key ID missing."),KEYX_INVALID_WRAPPING_KEY:new a(7015,d.FAIL,"Key exchange wrapping key is invalid."),KEYX_INCORRECT_DATA:new a(7016,d.FAIL,"Entity used incorrect wrapping key data type"),CRYPTEX_ENCRYPTION_ERROR:new a(8E3,d.FAIL,"Error encrypting data with cryptex."),CRYPTEX_DECRYPTION_ERROR:new a(8001,d.FAIL,"Error decrypting data with cryptex."),CRYPTEX_MAC_ERROR:new a(8002,d.FAIL,"Error computing MAC with cryptex."),CRYPTEX_VERIFY_ERROR:new a(8003,
d.FAIL,"Error verifying MAC with cryptex."),CRYPTEX_CONTEXT_CREATION_FAILURE:new a(8004,d.FAIL,"Error creating cryptex cipher or MAC context."),DATAMODEL_DEVICE_ACCESS_ERROR:new a(8005,d.TRANSIENT_FAILURE,"Error accessing data model device."),DATAMODEL_DEVICETYPE_NOT_FOUND:new a(8006,d.FAIL,"Data model device type not found."),CRYPTEX_KEYSET_UNSUPPORTED:new a(8007,d.FAIL,"Cryptex key set not supported."),CRYPTEX_PRIVILEGE_EXCEPTION:new a(8008,d.FAIL,"Insufficient privileges for cryptex operation."),
CRYPTEX_WRAP_ERROR:new a(8009,d.FAIL,"Error wrapping data with cryptex."),CRYPTEX_UNWRAP_ERROR:new a(8010,d.FAIL,"Error unwrapping data with cryptex."),CRYPTEX_COMMS_FAILURE:new a(8011,d.TRANSIENT_FAILURE,"Error comunicating with cryptex."),CRYPTEX_SIGN_ERROR:new a(8012,d.FAIL,"Error computing signature with cryptex."),INTERNAL_EXCEPTION:new a(9E3,d.TRANSIENT_FAILURE,"Internal exception."),MSL_COMMS_FAILURE:new a(9001,d.FAIL,"Error communicating with MSL entity."),NONE:new a(9999,d.FAIL,"Special unit test error.")});
Object.freeze(a);var B;(function(){B=ea.Class.create(Error());B.mixin({init:function(a,b,c){function d(){return g?g:this.cause&&this.cause instanceof B?this.cause.messageId:x}Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var f=a.message;b&&(f+=" ["+b+"]");var g,k=this.stack;Object.defineProperties(this,{message:{value:f,writable:!1,configurable:!0},error:{value:a,writable:!1,configurable:!0},cause:{value:c,writable:!1,configurable:!0},name:{value:"MslException",writable:!1,
configurable:!0},masterToken:{value:null,writable:!0,configurable:!1},entityAuthenticationData:{value:null,writable:!0,configurable:!1},userIdToken:{value:null,writable:!0,configurable:!1},userAuthenticationData:{value:null,writable:!0,configurable:!1},messageId:{get:d,set:function(a){if(0>a||a>Ha)throw new RangeError("Message ID "+a+" is outside the valid range.");d()||(g=a)},configurable:!0},stack:{get:function(){var a=this.toString();k&&(a+="\n"+k);c&&c.stack&&(a+="\nCaused by "+c.stack);return a},
configurable:!0}})},setEntity:function(a){!a||this.masterToken||this.entityAuthenticationData||(a instanceof Xb?this.masterToken=a:a instanceof bd&&(this.entityAuthenticationData=a));return this},setUser:function(a){!a||this.userIdToken||this.userAuthenticationData||(a instanceof vd?this.userIdToken=a:a instanceof cd&&(this.userAuthenticationData=a));return this},setMessageId:function(a){this.messageId=a;return this},toString:function(){return this.name+": "+this.message}})})();var T=B.extend({init:function wf(a,
b,c){wf.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslCryptoException",writable:!1,configurable:!0}})}}),Z=B.extend({init:function xf(a,b,c){xf.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslEncodingException",writable:!1,configurable:!0}})}}),yc=B.extend({init:function Hg(a,b,c){Hg.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslEntityAuthException",writable:!1,configurable:!0}})}}),Bb;(function(){Bb=ea.Class.create(Error());Bb.mixin({init:function(a,
b,c){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var d=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},requestCause:{value:c,writable:!1,configurable:!1},name:{value:"MslErrorResponseException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();d&&(a+="\n"+d);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+": "+
this.message}})})();var ob;(function(){ob=ea.Class.create(Error());ob.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslIoException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+
": "+this.message}})})();var W;(function(){W=ea.Class.create(Error());W.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslInternalException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},toString:function(){return this.name+
": "+this.message}})})();var sb;(function(){sb=ea.Class.create(Error());sb.mixin({init:function(a,b){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);var c=this.stack;Object.defineProperties(this,{message:{value:a,writable:!1,configurable:!1},cause:{value:b,writable:!1,configurable:!1},name:{value:"MslInterruptedException",writable:!1,configurable:!0},stack:{get:function(){var a=this.toString();c&&(a+="\n"+c);b&&b.stack&&(a+="\nCaused by "+b.stack);return a},configurable:!0}})},
toString:function(){return this.name+": "+this.message}})})();var Ra=B.extend({init:function Ig(a,b,c){Ig.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslKeyExchangeException",writable:!1,configurable:!0}})}}),oc=B.extend({init:function Ee(a,b){Ee.base.call(this,a);Object.defineProperties(this,{masterToken:{value:b,writable:!1,configurable:!1},name:{value:"MslMasterTokenException",writable:!1,configurable:!0}})}}),Aa=B.extend({init:function Jg(a,b,c){Jg.base.call(this,a,b,c);Object.defineProperties(this,
{name:{value:"MslMessageException",writable:!1,configurable:!0}})}}),Pa=B.extend({init:function Q(a,b,c){Q.base.call(this,a,b,c);Object.defineProperties(this,{name:{value:"MslUserAuthException",writable:!1,configurable:!0}})}}),Fa,Ka,Sa;(function(){function a(b){return"undefined"===typeof b?!1:b}function b(a){return a&&a.length?(Ka===f.V2014_02&&(a=a.map(function(a){return"wrap"==a?"wrapKey":"unwrap"==a?"unwrapKey":a})),a):Ka===f.V2014_02?"encrypt decrypt sign verify deriveKey wrapKey unwrapKey".split(" "):
"encrypt decrypt sign verify deriveKey wrap unwrap".split(" ")}function c(a,b,h,l,t){return Promise.resolve().then(function(){return y.importKey(a,b,h,l,t)}).catch(function(c){if("spki"!==a&&"pkcs8"!==a)throw c;c=ASN1.webCryptoAlgorithmToJwkAlg(h);var d=ASN1.webCryptoUsageToJwkKeyOps(t);c=ASN1.rsaDerToJwk(b,c,d,l);if(!c)throw Error("Could not make valid JWK from DER input");c=JSON.stringify(c);return y.importKey("jwk",I(c),h,l,t)})}function d(a,b){return Promise.resolve().then(function(){return y.exportKey(a,
b)}).catch(function(h){if("spki"!==a&&"pkcs8"!==a)throw h;return y.exportKey("jwk",b).then(function(a){a=JSON.parse(aa(new Uint8Array(a)));a=ASN1.jwkToRsaDer(a);if(!a)throw Error("Could not make valid DER from JWK input");return a.getDer().buffer})})}var f=Sa={LEGACY:1,V2014_01:2,V2014_02:3,LATEST:3};Object.freeze(Sa);Ka=f.LATEST;Fa={encrypt:function(a,b,h){switch(Ka){case f.LEGACY:return new Promise(function(l,c){var r=y.encrypt(a,b,h);r.oncomplete=function(a){l(a.target.result)};r.onerror=function(a){c(a)}});
case f.V2014_01:case f.V2014_02:return y.encrypt(a,b,h).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},decrypt:function(a,b,h){switch(Ka){case f.LEGACY:return new Promise(function(l,c){var r=y.decrypt(a,b,h);r.oncomplete=function(a){l(a.target.result)};r.onerror=function(a){c(a)}});case f.V2014_01:case f.V2014_02:return y.decrypt(a,b,h).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},sign:function(a,b,h){switch(Ka){case f.LEGACY:return new Promise(function(l,c){var r=y.sign(a,b,h);r.oncomplete=function(a){l(a.target.result)};r.onerror=function(a){c(a)}});case f.V2014_01:case f.V2014_02:return y.sign(a,b,h).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},verify:function(a,b,h,l){switch(Ka){case f.LEGACY:return new Promise(function(c,r){var d=y.verify(a,b,h,l);d.oncomplete=function(a){c(a.target.result)};
d.onerror=function(a){r(a)}});case f.V2014_01:case f.V2014_02:return y.verify(a,b,h,l);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},digest:function(a,b){switch(Ka){case f.LEGACY:return new Promise(function(h,l){var c=y.digest(a,b);c.oncomplete=function(a){h(a.target.result)};c.onerror=function(a){l(a)}});case f.V2014_01:case f.V2014_02:return y.digest(a,b).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+
".");}},generateKey:function(c,m,h){var l=a(m),t=b(h);switch(Ka){case f.LEGACY:return new Promise(function(a,h){var b=y.generateKey(c,l,t);b.oncomplete=function(h){a(h.target.result)};b.onerror=function(a){h(a)}});case f.V2014_01:case f.V2014_02:return y.generateKey(c,l,t);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},deriveKey:function(c,m,h,l,t){var r=a(l),d=b(t);switch(Ka){case f.LEGACY:return new Promise(function(a,b){var l=y.deriveKey(c,m,h,r,d);l.oncomplete=
function(h){a(h.target.result)};l.onerror=function(a){b(a)}});case f.V2014_01:case f.V2014_02:return y.deriveKey(c,m,h,r,d);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},importKey:function(d,m,h,l,t){var r=a(l),J=b(t);switch(Ka){case f.LEGACY:return new Promise(function(a,b){var l=y.importKey(d,m,h,r,J);l.oncomplete=function(h){a(h.target.result)};l.onerror=function(a){b(a)}});case f.V2014_01:case f.V2014_02:return c(d,m,h,r,J);default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}},exportKey:function(a,b){switch(Ka){case f.LEGACY:return new Promise(function(h,l){var c=y.exportKey(a,b);c.oncomplete=function(a){h(a.target.result)};c.onerror=function(a){l(a)}});case f.V2014_01:case f.V2014_02:return d(a,b).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},wrapKey:function(a,b,h,l){switch(Ka){case f.LEGACY:return new Promise(function(a,c){var d=y.wrapKey(b,h,l);d.oncomplete=function(h){a(h.target.result)};
d.onerror=function(a){c(a)}});case f.V2014_01:case f.V2014_02:return y.wrapKey(a,b,h,l).then(function(a){return new Uint8Array(a)});default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}},unwrapKey:function(c,m,h,l,t,r,d){switch(Ka){case f.LEGACY:return new Promise(function(a,b){var l=y.unwrapKey(m,t,h);l.oncomplete=function(h){a(h.target.result)};l.onerror=function(a){b(a)}});case f.V2014_01:case f.V2014_02:return y.unwrapKey(c,m,h,l,t,a(r),b(d));default:throw Error("Unsupported Web Crypto version "+
WEB_CRYPTO_VERSION+".");}}};zb&&zb.getKeyByName&&(Fa.getKeyByName=function(a){switch(Ka){case f.LEGACY:return new Promise(function(b,h){var l=zb.getKeyByName(a);l.oncomplete=function(a){b(a.target.result)};l.onerror=function(a){h(a)}});case f.V2014_01:case f.V2014_02:return zb.getKeyByName(a);default:throw Error("Unsupported Web Crypto version "+WEB_CRYPTO_VERSION+".");}})})();var ec={name:"AES-KW"},pc={name:"AES-CBC"},Mb={name:"HMAC",hash:{name:"SHA-256"}},Ba={name:"RSA-OAEP",hash:{name:"SHA-1"}},
Ya={name:"RSAES-PKCS1-v1_5"},pb={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},qb=["encrypt","decrypt"],wb=["wrap","unwrap"],ga=["sign","verify"],Nb,Oc,Cb;(function(){Nb=ea.Class.create({init:function(c,d,f){function g(a){b(d,function(){var b=a?L(a):x;Object.defineProperties(k,{rawKey:{value:c,writable:!1,configurable:!1},keyData:{value:a,writable:!1,configurable:!1},keyDataB64:{value:b,writable:!1,configurable:!1}});return this},k)}var k=this;b(d,function(){if(!c||"object"!=typeof c)throw new T(a.INVALID_SYMMETRIC_KEY);
!f&&c.extractable?Fa.exportKey("raw",c).then(function(a){g(new Uint8Array(a))},function(b){d.error(new T(a.KEY_EXPORT_ERROR,"raw"))}):g(f)},k)},size:function(){return this.keyData.length},toByteArray:function(){return this.keyData},toBase64:function(){return this.keyDataB64}});Oc=function(a,b){new Nb(a,b)};Cb=function(c,d,f,g){b(g,function(){try{c="string"==typeof c?O(c):c}catch(b){throw new T(a.INVALID_SYMMETRIC_KEY,"keydata "+c,b);}Fa.importKey("raw",c,d,!0,f).then(function(a){new Nb(a,g,c)},function(b){g.error(new T(a.INVALID_SYMMETRIC_KEY))})})}})();
var ee,Pc,Gc;(function(){ee=ea.Class.create({init:function(c,d,f){function g(a){b(d,function(){Object.defineProperties(k,{rawKey:{value:c,writable:!1,configurable:!1},encoded:{value:a,writable:!1,configurable:!1}});return this},k)}var k=this;b(d,function(){if(!c||"object"!=typeof c||"public"!=c.type)throw new TypeError("Only original public crypto keys are supported.");!f&&c.extractable?Fa.exportKey("spki",c).then(function(a){g(new Uint8Array(a))},function(b){d.error(new T(a.KEY_EXPORT_ERROR,"spki"))}):
g(f)})},getEncoded:function(){return this.encoded}});Pc=function(a,b){new ee(a,b)};Gc=function(c,d,f,g){b(g,function(){try{c="string"==typeof c?O(c):c}catch(b){throw new T(a.INVALID_PUBLIC_KEY,"spki "+c,b);}Fa.importKey("spki",c,d,!0,f).then(function(a){new ee(a,g,c)},function(b){g.error(new T(a.INVALID_PUBLIC_KEY))})})}})();var He,$c;(function(){He=ea.Class.create({init:function(c,d,f){function g(a){b(d,function(){Object.defineProperties(k,{rawKey:{value:c,writable:!1,configurable:!1},encoded:{value:a,
writable:!1,configurable:!1}});return this},k)}var k=this;b(d,function(){if(!c||"object"!=typeof c||"private"!=c.type)throw new TypeError("Only original private crypto keys are supported.");!f&&c.extractable?Fa.exportKey("pkcs8",c).then(function(a){g(new Uint8Array(a))},function(b){d.error(new T(a.KEY_EXPORT_ERROR,"pkcs8"))}):g(f)})},getEncoded:function(){return this.encoded}});$c=function(a,b){new He(a,b)}})();var Hb,Ie,Wa,fe;(function(){var c=fe={V1:1,V2:2};Hb=ea.Class.create({init:function(a,d,
f,g){b(g,function(){var b=c.V1,m=a,h=null,l;for(l in ud)if(ud[l]==a){b=c.V2;m=null;h=a;break}Object.defineProperties(this,{version:{value:b,writable:!1,enumerable:!1,configurable:!1},keyId:{value:m,writable:!1,configurable:!1},cipherSpec:{value:h,writable:!1,configurable:!1},iv:{value:d,writable:!1,configurable:!1},ciphertext:{value:f,writable:!1,configurable:!1}});return this},this)},toJSON:function(){var a={};switch(this.version){case c.V1:a.keyid=this.keyId;this.iv&&(a.iv=L(this.iv));a.ciphertext=
L(this.ciphertext);a.sha256="AA==";break;case c.V2:a.version=this.version;a.cipherspec=this.cipherSpec;this.iv&&(a.iv=L(this.iv));a.ciphertext=L(this.ciphertext);break;default:throw new W("Ciphertext envelope version "+this.version+" encoding unsupported.");}return a}});Ie=function(a,b,c,d){new Hb(a,b,c,d)};Wa=function(d,f,g){b(g,function(){var b=d.keyid,w=d.cipherspec,m=d.iv,h=d.ciphertext,l=d.sha256;if(!f)if((f=d.version)&&"number"===typeof f&&f===f){var t=!1,r;for(r in c)if(c[r]==f){t=!0;break}if(!t)throw new T(a.UNIDENTIFIED_CIPHERTEXT_ENVELOPE,
"ciphertext envelope "+JSON.stringify(d));}else f=c.V1;switch(f){case c.V1:if("string"!==typeof b||m&&"string"!==typeof m||"string"!==typeof h||"string"!==typeof l)throw new Z(a.JSON_PARSE_ERROR,"ciphertext envelope "+JSON.stringify(d));break;case c.V2:r=d.version;if(r!=c.V2)throw new T(a.UNIDENTIFIED_CIPHERTEXT_ENVELOPE,"ciphertext envelope "+JSON.stringify(d));if("string"!==typeof w||m&&"string"!==typeof m||"string"!==typeof h)throw new Z(a.JSON_PARSE_ERROR,"ciphertext envelope "+JSON.stringify(d));
w=Af(w);if(!w)throw new T(a.UNIDENTIFIED_CIPHERSPEC,"ciphertext envelope "+JSON.stringify(d));b=w;break;default:throw new T(a.UNSUPPORTED_CIPHERTEXT_ENVELOPE,"ciphertext envelope "+JSON.stringify(d));}try{m&&(m=O(m)),h=O(h)}catch(J){throw new T(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,"encryption envelope "+JSON.stringify(d),J);}new Hb(b,m,h,g)})}})();var Ob,ge,Ib,he;(function(){var c=he={V1:1,V2:2};Ob=ea.Class.create({init:function(a,b,d){var f;switch(a){case c.V1:f=d;break;case c.V2:f={};f.version=a;f.algorithm=
b;f.signature=L(d);f=S(JSON.stringify(f),na);break;default:throw new W("Signature envelope version "+a+" encoding unsupported.");}Object.defineProperties(this,{version:{value:a,writable:!1,enumerable:!1,configurable:!1},algorithm:{value:b,writable:!1,configurable:!1},signature:{value:d,writable:!1,configurable:!1},bytes:{value:f,writable:!1,configurable:!1}})}});ge=function(){var a,d,f,g;2==arguments.length?(a=c.V1,d=arguments[0],f=null,g=arguments[1]):3==arguments.length&&(a=c.V2,f=arguments[0],
d=arguments[1],g=arguments[2]);b(g,function(){return new Ob(a,f,d)})};Ib=function(d,f,g){b(g,function(){if(f)switch(f){case c.V1:return new Ob(c.V1,null,d);case c.V2:try{var b=k(d,na),w=JSON.parse(b),m=parseInt(w.version),h=w.algorithm,l=w.signature;if(!m||"number"!==typeof m||m!=m||"string"!==typeof h||"string"!==typeof l)throw new Z(a.JSON_PARSE_ERROR,"signature envelope "+L(d));if(c.V2!=m)throw new T(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+L(d));var t=Id(h);if(!t)throw new T(a.UNIDENTIFIED_ALGORITHM,
"signature envelope "+L(d));var r=O(l);if(!r)throw new T(a.INVALID_SIGNATURE,"signature envelope "+Base64Util.encode(d));return new Ob(c.V2,t,r)}catch(J){if(J instanceof SyntaxError)throw new Z(a.JSON_PARSE_ERROR,"signature envelope "+L(d),J);throw J;}default:throw new T(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+L(d));}try{b=k(d,na),w=JSON.parse(b)}catch(g){w=null}if(w&&w.version){if(b=w.version,"number"!==typeof b||b!==b)b=c.V1}else b=c.V1;switch(b){case c.V1:return new Ob(b,null,d);
case c.V2:t=w.algorithm;l=w.signature;if("string"!==typeof t||"string"!==typeof l)return new Ob(c.V1,null,d);t=Id(t);if(!t)return new Ob(c.V1,null,d);try{r=O(l)}catch(K){return new Ob(c.V1,null,d)}return new Ob(b,t,r);default:throw new T(a.UNSUPPORTED_SIGNATURE_ENVELOPE,"signature envelope "+d);}})}})();var wd=ea.Class.create({encrypt:function(a,b){},decrypt:function(a,b){},wrap:function(a,b){},unwrap:function(a,b,c,d){},sign:function(a,b){},verify:function(a,b,c){}}),Hc,zc;(function(){var c=zc={RSA_OAEP:Ba.name,
A128KW:ec.name};F="A128GCM";Hc=ea.Class.create({init:function(a,b,d,f,w){switch(b){case c.RSA_OAEP:w=w&&(w.rawKey||w);f=f&&(f.rawKey||f);break;case c.A128KW:w=f=f&&(f.rawKey||f);break;default:throw new W("Unsupported algorithm: "+b);}Object.defineProperties(this,{_ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},_algo:{value:b,writable:!1,enumerable:!1,configurable:!1},_enc:{value:d,writable:!1,enumerable:!1,configurable:!1},_wrapKey:{value:w,writable:!1,enumerable:!1,configurable:!1},_unwrapKey:{value:f,
writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(b,c){c.error(new T(a.ENCRYPT_NOT_SUPPORTED))},decrypt:function(b,c){c.error(new T(a.DECRYPT_NOT_SUPPORTED))},wrap:function(c,d){b(d,function(){Fa.wrapKey("jwe+jwk",c.rawKey,this._wrapKey,this._wrapKey.algorithm).then(function(a){d.result(a)},function(b){d.error(new T(a.WRAP_ERROR))})},this)},unwrap:function(c,d,f,g){function w(c){b(g,function(){switch(c.type){case "secret":Oc(c,g);break;case "public":Pc(c,g);break;case "private":$c(c,
g);break;default:throw new T(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(g,function(){Fa.unwrapKey("jwe+jwk",c,this._unwrapKey,this._unwrapKey.algorithm,d,!1,f).then(function(a){w(a)},function(){g.error(new T(a.UNWRAP_ERROR))})},this)},sign:function(b,c){c.error(new T(a.SIGN_NOT_SUPPORTED))},verify:function(b,c,d){d.error(new T(a.VERIFY_NOT_SUPPORTED))}})})();var dd=wd.extend({encrypt:function(a,b){b.result(a)},decrypt:function(a,b){b.result(a)},wrap:function(a,b){b.result(a)},unwrap:function(a,b,c,
d){d.result(a)},sign:function(a,b){b.result(new Uint8Array(0))},verify:function(a,b,c){c.result(!0)}}),ed,cb;(function(){var c=cb={ENCRYPT_DECRYPT_OAEP:1,ENCRYPT_DECRYPT_PKCS1:2,WRAP_UNWRAP_OAEP:3,WRAP_UNWRAP_PKCS1:4,SIGN_VERIFY:5};ed=wd.extend({init:function Va(a,b,d,m,h){Va.base.call(this);d&&(d=d.rawKey);m&&(m=m.rawKey);Object.defineProperties(this,{id:{value:b,writable:!1,enumerable:!1,configurable:!1},privateKey:{value:d,writable:!1,enumerable:!1,configurable:!1},publicKey:{value:m,writable:!1,
enumerable:!1,configurable:!1},transform:{value:h==c.ENCRYPT_DECRYPT_PKCS1?Ya:h==c.ENCRYPT_DECRYPT_OAEP?Ba:"nullOp",writable:!1,enumerable:!1,configurable:!1},wrapTransform:{value:h==c.WRAP_UNWRAP_PKCS1?Ya:h==c.WRAP_UNWRAP_OAEP?Ba:"nullOp",writable:!1,enumerable:!1,configurable:!1},algo:{value:h==c.SIGN_VERIFY?pb:"nullOp",writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(c,d){var f=this;b(d,function(){if("nullOp"==this.transform)return c;if(!this.publicKey)throw new T(a.ENCRYPT_NOT_SUPPORTED,
"no public key");if(0==c.length)return c;Fa.encrypt(f.transform,f.publicKey,c).then(function(b){Ie(f.id,null,b,{result:function(b){try{var c=JSON.stringify(b);d.result(S(c,na))}catch(l){d.error(new T(a.ENCRYPT_ERROR,null,l))}},error:function(b){b instanceof B||(b=new T(a.ENCRYPT_ERROR,null,b));d.error(b)}})},function(b){d.error(new T(a.ENCRYPT_ERROR))})},this)},decrypt:function(c,d){var f=this;b(d,function(){if("nullOp"==this.transform)return c;if(!this.privateKey)throw new T(a.DECRYPT_NOT_SUPPORTED,
"no private key");if(0==c.length)return c;var b;try{var m=k(c,na);b=JSON.parse(m)}catch(h){if(h instanceof SyntaxError)throw new T(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,null,h);throw new T(a.DECRYPT_ERROR,null,h);}Wa(b,fe.V1,{result:function(b){try{if(b.keyId!=f.id)throw new T(a.ENVELOPE_KEY_ID_MISMATCH);var c=d.result;Fa.decrypt(f.transform,f.privateKey,b.ciphertext).then(c,function(b){d.error(new T(a.DECRYPT_ERROR))})}catch(h){h instanceof B?d.error(h):d.error(new T(a.DECRYPT_ERROR,null,h))}},error:function(b){b instanceof
Z&&(b=new T(a.CIPHERTEXT_ENVELOPE_ENCODE_ERROR,null,b));b instanceof B||(b=new T(a.DECRYPT_ERROR,null,b));d.error(b)}})},this)},wrap:function(c,d){b(d,function(){if("nullOp"==this.wrapTransform||!this.publicKey)throw new T(a.WRAP_NOT_SUPPORTED,"no public key");var b=d.result;Fa.wrapKey("jwk",c.rawKey,this.publicKey,this.wrapTransform).then(b,function(b){d.error(new T(a.WRAP_ERROR))})},this)},unwrap:function(c,d,f,g){function m(c){b(g,function(){switch(c.type){case "secret":Oc(c,g);break;case "public":Pc(c,
g);break;case "private":$c(c,g);break;default:throw new T(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(g,function(){if("nullOp"==this.wrapTransform||!this.privateKey)throw new T(a.UNWRAP_NOT_SUPPORTED,"no private key");Fa.unwrapKey("jwk",c,this.privateKey,{name:this.privateKey.algorithm.name,hash:{name:"SHA-1"}},d,!1,f).then(m,function(b){g.error(new T(a.UNWRAP_ERROR))})},this)},sign:function(c,d){b(d,function(){if("nullOp"==this.algo)return new Uint8Array(0);if(!this.privateKey)throw new T(a.SIGN_NOT_SUPPORTED,
"no private key");Fa.sign(this.algo,this.privateKey,c).then(function(a){ge(a,{result:function(a){d.result(a.bytes)},error:d.error})},function(b){d.error(new T(a.SIGNATURE_ERROR))})},this)},verify:function(c,d,f){var g=this;b(f,function(){if("nullOp"==this.algo)return!0;if(!this.publicKey)throw new T(a.VERIFY_NOT_SUPPORTED,"no public key");Ib(d,he.V1,{result:function(d){b(f,function(){var b=f.result;Fa.verify(this.algo,this.publicKey,d.signature,c).then(b,function(b){f.error(new T(a.SIGNATURE_ERROR))})},
g)},error:f.error})},this)}})})();var fc;(function(){fc=wd.extend({init:function Eb(a,b,c,d,m){Eb.base.call(this);c=c&&c.rawKey;d=d&&d.rawKey;m=m&&m.rawKey;Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},id:{value:b,writable:!1,enumerable:!1,configurable:!1},encryptionKey:{value:c,writable:!1,enumerable:!1,configurable:!1},hmacKey:{value:d,writable:!1,enumerable:!1,configurable:!1},wrapKey:{value:m,writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(c,
d){var f=this;b(d,function(){if(!this.encryptionKey)throw new T(a.ENCRYPT_NOT_SUPPORTED,"no encryption/decryption key");if(0==c.length)return c;var b=new Uint8Array(16);this.ctx.getRandom().nextBytes(b);Fa.encrypt({name:pc.name,iv:b},f.encryptionKey,c).then(function(c){c=new Uint8Array(c);Ie(f.id,b,c,{result:function(b){try{var c=JSON.stringify(b);d.result(S(c,na))}catch(l){d.error(new T(a.ENCRYPT_ERROR,null,l))}},error:function(b){b instanceof B||(b=new T(a.ENCRYPT_ERROR,null,b));d.error(b)}})},
function(b){d.error(new T(a.ENCRYPT_ERROR))})},this)},decrypt:function(c,d){var f=this;b(d,function(){if(!this.encryptionKey)throw new T(a.DECRYPT_NOT_SUPPORTED,"no encryption/decryption key");if(0==c.length)return c;var b;try{var g=k(c,na);b=JSON.parse(g)}catch(m){if(m instanceof SyntaxError)throw new T(a.CIPHERTEXT_ENVELOPE_PARSE_ERROR,null,m);throw new T(a.DECRYPT_ERROR,null,m);}Wa(b,fe.V1,{result:function(b){try{if(b.keyId!=f.id)throw new T(a.ENVELOPE_KEY_ID_MISMATCH);Fa.decrypt({name:pc.name,
iv:b.iv},f.encryptionKey,b.ciphertext).then(function(a){a=new Uint8Array(a);d.result(a)},function(){d.error(new T(a.DECRYPT_ERROR))})}catch(c){c instanceof B?d.error(c):d.error(new T(a.DECRYPT_ERROR,null,c))}},error:function(b){b instanceof Z&&(b=new T(a.CIPHERTEXT_ENVELOPE_ENCODE_ERROR,null,b));b instanceof B||(b=new T(a.DECRYPT_ERROR,null,b));d.error(b)}})},this)},wrap:function(c,d){b(d,function(){if(!this.wrapKey)throw new T(a.WRAP_NOT_SUPPORTED,"no wrap/unwrap key");Fa.wrapKey("raw",c.rawKey,
this.wrapKey,this.wrapKey.algorithm).then(function(a){d.result(a)},function(b){d.error(new T(a.WRAP_ERROR))})},this)},unwrap:function(c,d,f,g){function w(c){b(g,function(){switch(c.type){case "secret":Oc(c,g);break;case "public":Pc(c,g);break;case "private":$c(c,g);break;default:throw new T(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(g,function(){if(!this.wrapKey)throw new T(a.UNWRAP_NOT_SUPPORTED,"no wrap/unwrap key");Fa.unwrapKey("raw",c,this.wrapKey,this.wrapKey.algorithm,d,!1,f).then(function(a){w(a)},
function(b){g.error(new T(a.UNWRAP_ERROR))})},this)},sign:function(c,d){var f=this;b(d,function(){if(!this.hmacKey)throw new T(a.SIGN_NOT_SUPPORTED,"no HMAC key.");Fa.sign(Mb,this.hmacKey,c).then(function(a){b(d,function(){var b=new Uint8Array(a);ge(b,{result:function(a){d.result(a.bytes)},error:d.error})},f)},function(){d.error(new T(a.HMAC_ERROR))})},this)},verify:function(c,d,f){var g=this;b(f,function(){if(!this.hmacKey)throw new T(a.VERIFY_NOT_SUPPORTED,"no HMAC key.");Ib(d,he.V1,{result:function(d){b(f,
function(){Fa.verify(Mb,this.hmacKey,d.signature,c).then(function(a){f.result(a)},function(b){f.error(new T(a.HMAC_ERROR))})},g)},error:f.error})},this)}})})();var Jb=fc.extend({init:function Eb(b,c,d,f,m){if(d||f||m)Eb.base.call(this,b,d+"_"+c.sequenceNumber,f,m,null);else{if(!c.isDecrypted())throw new oc(a.MASTERTOKEN_UNTRUSTED,c);Eb.base.call(this,b,c.identity+"_"+c.sequenceNumber,c.encryptionKey,c.hmacKey,null)}}}),Je=wd.extend({encrypt:function(a,b){b.result(a)},decrypt:function(a,b){b.result(a)},
wrap:function(a,b){b.error(new W("Wrap is unsupported by the MSL token crypto context."))},unwrap:function(a,b,c,d){d.error(new W("Unwrap is unsupported by the MSL token crypto context."))},sign:function(a,b){b.result(new Uint8Array(0))},verify:function(a,b,c){c.result(!1)}}),Na={PSK:"PSK",MGK:"MGK",X509:"X509",RSA:"RSA",NPTICKET:"NPTICKET",ECC:"ECC",NONE:"NONE"};Object.freeze(Na);var bd,ie;(function(){bd=ea.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,
configurable:!1}})},getIdentity:function(){},getAuthData:function(){},equals:function(a){return this===a?!0:a instanceof bd?this.scheme==a.scheme:!1},toJSON:function(){var a={};a.scheme=this.scheme;a.authdata=this.getAuthData();return a}});ie=function(b,c){var d=c.scheme,f=c.authdata;if(!d||!f)throw new Z(a.JSON_PARSE_ERROR,"entityauthdata "+JSON.stringify(c));if(!Na[d])throw new yc(a.UNIDENTIFIED_ENTITYAUTH_SCHEME,d);var g=b.getEntityAuthenticationFactory(d);if(!g)throw new yc(a.ENTITYAUTH_FACTORY_NOT_FOUND,
d);return g.createData(b,f)}})();var Jd=ea.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createData:function(a,b){},getCryptoContext:function(a,b){}}),qc,Ke;(function(){qc=bd.extend({init:function Va(a){Va.base.call(this,Na.MGK);Object.defineProperties(this,{identity:{value:a,writable:!1,configurable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function hb(a){return this===
a?!0:a instanceof qc?hb.base.call(this,this,a)&&this.identity==a.identity:!1}});Ke=function(b){var c=b.identity;if(!c)throw new Z(a.JSON_PARSE_ERROR,"mgk authdata"+JSON.stringify(b));return new qc(c)}})();var Mg=Jd.extend({init:function Va(a){Va.base.call(this,Na.MGK);Object.defineProperties(this,{localIdentity:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return Ke(b)},getCryptoContext:function(b,c){if(!(c instanceof qc))throw new W("Incorrect authentication data type "+
JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw(new yc(a.ENTITY_NOT_FOUND,"mgk "+c.identity)).setEntity(c);return new dd}}),rc,Bf;(function(){rc=bd.extend({init:function hb(a){hb.base.call(this,Na.PSK);Object.defineProperties(this,{identity:{value:a,writable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function C(a){return this===a?!0:a instanceof rc?C.base.call(this,this,a)&&this.identity==a.identity:
!1}});Bf=function(b){var c=b.identity;if(!c)throw new Z(a.JSON_PARSE_ERROR,"psk authdata"+JSON.stringify(b));return new rc(c)}})();var Le;Le=Jd.extend({init:function hb(a){hb.base.call(this,Na.PSK);Object.defineProperties(this,{localIdentity:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return Bf(b)},getCryptoContext:function(b,c){if(!(c instanceof rc))throw new W("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.getIdentity()!=this.localIdentity)throw(new yc(a.ENTITY_NOT_FOUND,
"psk "+c.identity)).setEntity(c);return new dd}});var je,Cf;(function(){je=bd.extend({init:function C(a,b){C.base.call(this,Na.RSA);Object.defineProperties(this,{identity:{value:a,writable:!1,configurable:!1},publicKeyId:{value:b,writable:!1,configurable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;a.pubkeyid=this.publicKeyId;return a},equals:function w(a){return this===a?!0:a instanceof je?w.base.call(this,this,a)&&this.identity==a.identity&&
this.publicKeyId==a.publicKeyId:!1}});Cf=function(b){var c=b.identity,h=b.pubkeyid;if(!c||"string"!==typeof c||!h||"string"!==typeof h)throw new Z(a.JSON_PARSE_ERROR,"RSA authdata"+JSON.stringify(b));return new je(c,h)}})();var Ng=Jd.extend({init:function C(a){C.base.call(this,Na.RSA);Object.defineProperties(this,{store:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createData:function(a,b){return Cf(b)},getCryptoContext:function(b,c){if(!(c instanceof je))throw new W("Incorrect authentication data type "+
c+".");var d=c.identity,h=c.publicKeyId,l=this.store.getPublicKey(h);if(!l)throw(new yc(a.RSA_PUBLICKEY_NOT_FOUND,h)).setEntity(c);return new ed(b,d,null,l,cb.SIGN_VERIFY)}}),Gd,Df;(function(){Gd=bd.extend({init:function w(a){w.base.call(this,Na.NONE);Object.defineProperties(this,{identity:{value:a,writable:!1}})},getIdentity:function(){return this.identity},getAuthData:function(){var a={};a.identity=this.identity;return a},equals:function m(a){return this===a?!0:a instanceof Gd?m.base.call(this,
this,a)&&this.identity==a.identity:!1}});Df=function(b){var c=b.identity;if(!c)throw new Z(a.JSON_PARSE_ERROR,"Unauthenticated authdata"+JSON.stringify(b));return new Gd(c)}})();var Lg=Jd.extend({init:function w(){w.base.call(this,Na.NONE)},createData:function(a,b){return Df(b)},getCryptoContext:function(a,b){if(!(b instanceof Gd))throw new W("Incorrect authentication data type "+JSON.stringify(b)+".");return new dd}}),Og=ea.Class.create({init:function(){Object.defineProperties(this,{rsaKeys:{value:{},
writable:!1,enumerable:!1,configurable:!1}})},addPublicKey:function(a,b){if(!(b instanceof ee))throw new W("Incorrect key data type "+b+".");this.rsaKeys[a]=b},getIdentities:function(){return Object.keys(this.rsaKeys)},removePublicKey:function(a){delete this.rsaKeys[a]},getPublicKey:function(a){return this.rsaKeys[a]}}),Me=ea.Class.create({abort:function(){},close:function(){},mark:function(){},reset:function(){},markSupported:function(){},read:function(a,b,c){}}),ke=ea.Class.create({abort:function(){},
close:function(a,b){},write:function(a,b,c,l,d){},flush:function(a,b){}}),Pg=ea.Class.create({init:function(a){Object.defineProperties(this,{_data:{value:a,writable:!1,enumerable:!1,configurable:!1},_closed:{value:!1,writable:!0,enumerable:!1,configurable:!1},_currentPosition:{value:0,writable:!0,enumerable:!1,configurable:!1},_mark:{value:-1,writable:!0,enumerable:!1,configurable:!1}})},abort:function(){},close:function(){this._close=!0},mark:function(){this._mark=this._currentPosition},reset:function(){if(-1==
this._mark)throw new ob("Stream has not been marked.");this._currentPosition=this._mark},markSupported:function(){return!0},read:function(a,b,c){g(c,function(){if(this._closed)throw new ob("Stream is already closed.");if(this._currentPosition==this._data.length)return null;-1==a&&(a=this._data.length-this._currentPosition);var b=this._data.subarray(this._currentPosition,this._currentPosition+a);this._currentPosition+=b.length;return b},this)}}),Ef=ea.Class.create({init:function(){var a={_closed:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_result:{value:new Uint8Array(0),writable:!0,enuemrable:!1,configurable:!1},_buffered:{value:[],writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},abort:function(){},close:function(a,b){this._closed=!0;b.result(!0)},write:function(a,b,c,l,d){g(d,function(){if(this._closed)throw new ob("Stream is already closed.");if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+
c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");var l=a.subarray(b,c);this._buffered.push(l);return l.length},this)},flush:function(a,b){for(;0<this._buffered.length;){var c=this._buffered.shift();if(this._result){var l=new Uint8Array(this._result.length+c.length);l.set(this._result);l.set(c,this._result.length);this._result=l}else this._result=new Uint8Array(c)}b.result(!0)},size:function(){this.flush(1,{result:function(){}});return this._result.length},
toByteArray:function(){this.flush(1,{result:function(){}});return this._result}}),Ed,Qg=ea.Class.create({getResponse:function(a,b,c){}});(function(){var a=ke.extend({init:function(a,b){var c={_httpLocation:{value:a,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:b,writable:!0,enumerable:!1,configurable:!1},_buffer:{value:new Ef,writable:!1,enumerable:!1,configurable:!1},_response:{value:x,writable:!0,enumerable:!1,configurable:!1},_abortToken:{value:x,writable:!0,enumerable:!1,configurable:!1},
_responseQueue:{value:new Ga,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,c)},setTimeout:function(a){this._timeout=a},getResponse:function(a,b){var c=this;this._responseQueue.poll(a,{result:function(a){g(b,function(){a&&this._responseQueue.add(a);return a},c)},timeout:function(){g(b,function(){this._response={isTimeout:!0};this._responseQueue.add(this._response);this.abort();b.timeout()},c)},error:function(a){g(b,function(){this._response={isError:!0};this._responseQueue.add(this._response);
throw a;},c)}})},abort:function(){this._abortToken&&this._abortToken.abort()},close:function(a,b){var c=this;g(b,function(){if(this._response)return!0;var a=this._buffer.toByteArray();0<a.length&&(this._abortToken=this._httpLocation.getResponse({body:a},this._timeout,{result:function(a){c._response={response:a};c._responseQueue.add(c._response)},timeout:function(){c._response={isTimeout:!0};c._responseQueue.add(c._response)},error:function(a){c._response={isError:!0,error:a};c._responseQueue.add(c._response)}}));
return!0},this)},write:function(a,b,c,d,f){g(f,function(){if(this._response)throw new ob("HttpOutputStream already closed.");this._buffer.write(a,b,c,d,f)},this)},flush:function(a,b){g(b,function(){if(this._response)return!0;this._buffer.flush(a,b)},this)}}),b=Me.extend({init:function(a){Object.defineProperties(this,{_out:{value:a,writable:!1,enumerable:!1,configurable:!1},_buffer:{value:x,writable:!0,enumerable:!1,configurable:!1},_exception:{value:x,writable:!0,enumerable:!1,configurable:!1},_timedout:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_json:{value:x,writable:!0,enumerable:!1,configurable:!1}})},abort:function(){this._out.abort()},close:function(){this._buffer&&this._buffer.close()},mark:function(){this._buffer||this._buffer.mark()},reset:function(){this._buffer&&this._buffer.reset()},markSupported:function(){if(this._buffer)return this._buffer.markSupported()},read:function(a,b,c){function d(r){g(c,function(){if(!r)return new Uint8Array(0);
this._out.getResponse(b,{result:function(d){g(c,function(){var r;if(d.isTimeout)this._timedout=!0,c.timeout();else{if(d.isError)throw this._exception=d.error||new ob("Unknown HTTP exception."),this._exception;if(!d.response)throw this._exception=new ob("Missing HTTP response."),this._exception;d.response.json!==x&&(this._json=d.response.json,this.getJSON=function(){return f._json});r=d.response.content||I("string"===typeof d.response.body?d.response.body:JSON.stringify(this._json));this._buffer=new Pg(r);
this._buffer.read(a,b,c)}},f)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},f)}var f=this;g(c,function(){if(this._exception)throw this._exception;if(this._timedout)c.timeout();else{if(this._aborted)return new Uint8Array(0);this._buffer?this._buffer.read(a,b,c):this._out.close(b,{result:function(a){d(a)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})}},f)}});Ed=ea.Class.create({init:function(a,b){Object.defineProperties(this,{_httpLocation:{value:a,writable:!1,
enumerable:!1,configurable:!1},_timeout:{value:b,writable:!0,enumerable:!1,configurable:!1}})},setTimeout:function(a){this._timeout=a},openConnection:function(){var c=new a(this._httpLocation,this._timeout);return{input:new b(c),output:c}}})})();var Ge;(function(){var a=ke.extend({init:function(){var a={_buffer:{value:new Uint8Array,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},setTimeout:function(){},getResponse:function(a,b){b.result({success:!1,content:null,errorHttpCode:x,
errorSubCode:x})},abort:function(){},close:function(a,b){b.result(!0)},write:function(a,b,c,d,f){try{if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");var m=a.subarray(b,c),g=new Uint8Array(this._buffer.length+m.length);g.set(this._buffer);g.set(m,this._buffer.length);this._buffer=g;f.result(m.length)}catch(A){f.error(A)}},flush:function(a,
b){b.result(!0)},request:function(){return this._buffer}}),b=Me.extend({init:function(){},abort:function(){},close:function(){},mark:function(){},reset:function(){},markSupported:function(){},read:function(a,b,c){c.result(new Uint8Array(16))}});Ge=ea.Class.create({init:function(){var c={output:{value:new a,writable:!1,enumerable:!1,configurable:!1},input:{value:new b,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,c)},setTimeout:function(){},openConnection:function(){return{input:this.input,
output:this.output}},getRequest:function(){return aa(this.output.request())}})})();var Ff=function(a,b,c){function d(a){a=new Rg(k(a,"utf-8"));var b=[],c;for(c=a.nextValue();c!==x;)b.push(c),c=a.nextValue();return b}(function(a,b,d){a.read(-1,b,{result:function(a){a&&a.length?d(null,a):d(null,null)},timeout:function(){c.timeout()},error:function(a){d(a,null)}})})(a,b,function(b,r){b?c.error(b):r?a.getJSON!==x&&"function"===typeof a.getJSON?c.result(a.getJSON()):c.result(d(r)):c.result(null)})},gc=
{SYMMETRIC_WRAPPED:"SYMMETRIC_WRAPPED",ASYMMETRIC_WRAPPED:"ASYMMETRIC_WRAPPED",DIFFIE_HELLMAN:"DIFFIE_HELLMAN",JWE_LADDER:"JWE_LADDER",JWK_LADDER:"JWK_LADDER",AUTHENTICATED_DH:"AUTHENTICATED_DH"};Object.freeze(gc);var Kd,Gf;(function(){Kd=ea.Class.create({init:function(a){Object.defineProperties(this,{keyExchangeScheme:{value:a,writable:!1,configurable:!1}})},getKeydata:function(){},toJSON:function(){var a={};a.scheme=this.keyExchangeScheme;a.keydata=this.getKeydata();return a},equals:function(a){return this===
a?!0:a instanceof Kd?this.keyExchangeScheme==a.keyExchangeScheme:!1},uniqueKey:function(){return this.keyExchangeScheme}});Gf=function(c,d,h){b(h,function(){var b=d.scheme,f=d.keydata;if(!b||!f||"object"!==typeof f)throw new Z(a.JSON_PARSE_ERROR,"keyrequestdata "+JSON.stringify(d));if(!gc[b])throw new Ra(a.UNIDENTIFIED_KEYX_SCHEME,b);var r=c.getKeyExchangeFactory(b);if(!r)throw new Ra(a.KEYX_FACTORY_NOT_FOUND,b);r.createRequestData(c,f,h)})}})();var Ld,Ne;(function(){Ld=ea.Class.create({init:function(a,
b){Object.defineProperties(this,{masterToken:{value:a,writable:!1,configurable:!1},keyExchangeScheme:{value:b,wrtiable:!1,configurable:!1}})},getKeydata:function(){},toJSON:function(){var a={};a.mastertoken=this.masterToken;a.scheme=this.keyExchangeScheme;a.keydata=this.getKeydata();return a},equals:function(a){return this===a?!0:a instanceof Ld?this.masterToken.equals(a.masterToken)&&this.keyExchangeScheme==a.keyExchangeScheme:!1},uniqueKey:function(){return this.masterToken.uniqueKey()+":"+this.keyExchangeScheme}});
Ne=function(c,d,h){b(h,function(){var l=d.mastertoken,f=d.scheme,r=d.keydata;if(!f||!l||"object"!==typeof l||!r||"object"!==typeof r)throw new Z(a.JSON_PARSE_ERROR,"keyresponsedata "+JSON.stringify(d));if(!gc[f])throw new Ra(a.UNIDENTIFIED_KEYX_SCHEME,f);Rc(c,l,{result:function(d){b(h,function(){var b=c.getKeyExchangeFactory(f);if(!b)throw new Ra(a.KEYX_FACTORY_NOT_FOUND,f);return b.createResponseData(c,d,r)})},error:function(a){h.error(a)}})})}})();var hc;(function(){var c=ea.Class.create({init:function(a,
b){Object.defineProperties(this,{keyResponseData:{value:a,writable:!1,configurable:!1},cryptoContext:{value:b,writable:!1,configurable:!1}})}});hc=ea.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},createRequestData:function(a,b,c){},createResponseData:function(a,b,c){},generateResponse:function(a,b,c,d){},getCryptoContext:function(a,b,c,d,f){},generateSessionKeys:function(c,d){b(d,function(){var b=new Uint8Array(16),f=new Uint8Array(32);
c.getRandom().nextBytes(b);c.getRandom().nextBytes(f);Cb(b,pc,qb,{result:function(b){Cb(f,Mb,ga,{result:function(a){d.result({encryptionKey:b,hmacKey:a})},error:function(b){d.error(new T(a.SESSION_KEY_CREATION_FAILURE,null,b))}})},error:function(b){d.error(new T(a.SESSION_KEY_CREATION_FAILURE,null,b))}})})},importSessionKeys:function(a,b,c){Cb(a,pc,qb,{result:function(a){Cb(b,Mb,ga,{result:function(b){c.result({encryptionKey:a,hmacKey:b})},error:function(a){c.error(a)}})},error:function(a){c.error(a)}})}});
hc.KeyExchangeData=c})();var Hf,Oe,If;(function(){function c(h,l,f,g,k){b(k,function(){switch(l){case d.PSK:var c=new rc(g),E=h.getEntityAuthenticationFactory(Na.PSK);if(!E)throw new Ra(a.UNSUPPORTED_KEYX_MECHANISM,l);c=E.getCryptoContext(h,c);return new Hc(h,zc.A128KW,F,x);case d.MGK:c=new qc(g);E=h.getEntityAuthenticationFactory(Na.MGK);if(!E)throw new Ra(a.UNSUPPORTED_KEYX_MECHANISM,l);c=E.getCryptoContext(h,c);return new Hc(h,zc.A128KW,F,x);case d.WRAP:c=h.getMslCryptoContext();c.unwrap(f,ec,
wb,{result:function(a){b(k,function(){return new Hc(h,zc.A128KW,F,a)})},error:k.error});break;default:throw new Ra(a.UNSUPPORTED_KEYX_MECHANISM,l);}})}var d={PSK:"PSK",MGK:"MGK",WRAP:"WRAP"},h=Oe=Kd.extend({init:function r(a,b){r.base.call(this,gc.JWE_LADDER);switch(a){case d.WRAP:if(!b)throw new W("Previous wrapping key based key exchange requires the previous wrapping key data and ID.");break;default:b=null}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},wrapdata:{value:b,
writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.mechanism=this.mechanism;this.wrapdata&&(a.wrapdata=L(this.wrapdata));return a},equals:function J(a){return a===this?!0:a instanceof Oe?J.base.call(this,a)&&this.mechanism==a.mechanism&&p(this.wrapdata,a.wrapdata):!1},uniqueKey:function ka(){var a=ka.base.call(this)+":"+this.mechanism;this.wrapdata&&(a+=":"+Y(this.wrapdata));return a}}),l=If=Ld.extend({init:function K(a,b,c,d,h){K.base.call(this,a,gc.JWE_LADDER);Object.defineProperties(this,
{wrapKey:{value:b,writable:!1,configurable:!1},wrapdata:{value:c,writable:!1,configurable:!1},encryptionKey:{value:d,writable:!1,configurable:!1},hmacKey:{value:h,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.wrapkey=L(this.wrapKey);a.wrapdata=L(this.wrapdata);a.encryptionkey=L(this.encryptionKey);a.hmackey=L(this.hmacKey);return a},equals:function A(a){return this===a?!0:a instanceof If?A.base.call(this,a)&&p(this.wrapKey,a.wrapKey)&&p(this.wrapdata,a.wrapdata)&&p(this.encryptionKey,
a.encryptionKey)&&p(this.hmacKey,a.hmacKey):!1},uniqueKey:function E(){return E.base.call(this)+":"+Y(this.wrapKey)+":"+Y(this.wrapdata)+":"+Y(this.encryptionKey)+":"+Y(this.hmacKey)}});Hf=hc.extend({init:function ma(a){ma.base.call(this,gc.JWE_LADDER);Object.defineProperties(this,{repository:{value:a,writable:!1,enumerable:!1,configurable:!1}})},createRequestData:function(c,l,f){b(f,function(){var b=l.mechanism,c=l.wrapdata;if(!b||b==d.WRAP&&(!c||"string"!==typeof c))throw new Z(a.JSON_PARSE_ERROR,
"keydata "+JSON.stringify(l));if(!d[b])throw new Ra(a.UNIDENTIFIED_KEYX_MECHANISM,b);var f;switch(b){case d.WRAP:try{f=O(c)}catch(g){throw new Ra(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());}if(null==f||0==f.length)throw new Ra(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());break;default:f=null}return new h(b,f)})},createResponseData:function(b,c,d){b=d.wrapkey;var h=d.wrapdata,f=d.encryptionkey,g=d.hmackey;if(!(b&&"string"===typeof b&&h&&"string"===typeof h&&f&&"string"===typeof f&&
g)||"string"!==typeof g)throw new Z(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(d));var m,k,w,da;try{m=O(b),k=O(h)}catch(La){throw new T(a.INVALID_SYMMETRIC_KEY,"keydata "+JSON.stringify(d),La);}try{w=O(f)}catch(mb){throw new T(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(d),mb);}try{da=O(g)}catch(Ab){throw new T(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(d),Ab);}return new l(c,m,k,w,da)},generateResponse:function(d,f,g,m){function k(a,c,h){Ja.generateSessionKeys(d,{result:function(d){b(m,
function(){fa(a,c,h,d.encryptionKey,d.hmacKey)},Ja)},error:function(a){b(m,function(){a instanceof B&&a.setEntity(da);throw a;})}})}function fa(a,h,l,g,k){b(m,function(){c(d,f.mechanism,f.wrapdata,a,{result:function(a){a.wrap(h,{result:function(a){Ec(h,l,g,k,a)},error:function(a){b(m,function(){a instanceof B&&a.setEntity(da);throw a;})}})},error:function(a){b(m,function(){a instanceof B&&a.setEntity(da);throw a;})}})},Ja)}function Ec(a,c,h,l,f){b(m,function(){var g=new Hc(d,zc.A128KW,F,a);g.wrap(h,
{result:function(a){g.wrap(l,{result:function(b){sa(c,f,h,a,l,b)},error:function(a){b(m,function(){a instanceof B&&a.setEntity(da);throw a;})}})},error:function(a){b(m,function(){a instanceof B&&a.setEntity(da);throw a;})}})},Ja)}function sa(a,c,h,f,k,fa){b(m,function(){var la=d.getTokenFactory();da?la.renewMasterToken(d,da,h,k,{result:function(h){b(m,function(){var b=new Jb(d,h),g=new l(h,c,a,f,fa);return new hc.KeyExchangeData(g,b,m)},Ja)},error:function(a){b(m,function(){a instanceof B&&a.setEntity(da);
throw a;})}}):la.createMasterToken(d,g,h,k,{result:function(h){b(m,function(){var b=new Jb(d,h),g=new l(h,c,a,f,fa);return new hc.KeyExchangeData(g,b,m)},Ja)},error:m.error})},Ja)}var Ja=this,da;b(m,function(){if(!(f instanceof h))throw new W("Key request data "+JSON.stringify(f)+" was not created by this factory.");var c=g;if(g instanceof Xb){if(!g.isVerified())throw new oc(a.MASTERTOKEN_UNTRUSTED,g);da=g;c=g.identity}var l=new Uint8Array(16);d.getRandom().nextBytes(l);Cb(l,ec,wb,{result:function(a){b(m,
function(){d.getMslCryptoContext().wrap(a,{result:function(b){k(c,a,b)},error:function(a){b(m,function(){a instanceof B&&a.setEntity(da);throw a;},Ja)}})},Ja)},error:function(c){b(m,function(){throw(new T(a.WRAP_KEY_CREATION_FAILURE,null,c)).setEntity(da);},Ja)}})},Ja)},getCryptoContext:function(c,f,g,k,la){function fa(a,d,h,l,f){b(la,function(){var g=new Hc(c,zc.A128KW,F,f);g.unwrap(d.encryptionKey,pc,qb,{result:function(f){g.unwrap(d.hmacKey,Mb,ga,{result:function(a){b(la,function(){this.repository.addCryptoContext(d.wrapdata,
g);this.repository.removeCryptoContext(h);return new Jb(c,d.masterToken,l,f,a)},w)},error:function(c){b(la,function(){c instanceof B&&c.setEntity(a);throw c;})}})},error:function(c){b(la,function(){c instanceof B&&c.setEntity(a);throw c;})}})},w)}var w=this;b(la,function(){if(!(f instanceof h))throw new W("Key request data "+JSON.stringify(f)+" was not created by this factory.");if(!(g instanceof l))throw new W("Key response data "+JSON.stringify(g)+" was not created by this factory.");var k=f.mechanism,
Gb=f.wrapdata;c.getEntityAuthenticationData(null,{result:function(h){b(la,function(){var l=h.getIdentity(),f;switch(k){case d.PSK:f=new rc(l);var Ab=c.getEntityAuthenticationFactory(Na.PSK);if(!Ab)throw(new Ra(a.UNSUPPORTED_KEYX_MECHANISM,k)).setEntity(h);f=Ab.getCryptoContext(c,f);f=new Hc(c,zc.A128KW,F,x);break;case d.MGK:f=new qc(l);Ab=c.getEntityAuthenticationFactory(Na.MGK);if(!Ab)throw(new Ra(a.UNSUPPORTED_KEYX_MECHANISM,k)).setEntity(h);f=Ab.getCryptoContext(c,f);f=new Hc(c,zc.A128KW,F,f.wrapKey);
break;case d.WRAP:f=this.repository.getCryptoContext(Gb);if(!f)throw(new Ra(a.KEYX_WRAPPING_KEY_MISSING,L(Gb))).setEntity(h);break;default:throw(new Ra(a.UNSUPPORTED_KEYX_MECHANISM,k)).setEntity(h);}f.unwrap(g.wrapKey,ec,wb,{result:function(a){fa(h,g,Gb,l,a)},error:function(a){b(la,function(){a instanceof B&&a.setEntity(h);throw a;})}})},w)},error:la.error})},w)}})})();var Qe,Pb,Ea;(function(){function c(h,l,g,k,A){b(A,function(){switch(l){case d.PSK:var c=new rc(k),ma=h.getEntityAuthenticationFactory(Na.PSK);
if(!ma)throw new Ra(a.UNSUPPORTED_KEYX_MECHANISM,l);c=ma.getCryptoContext(h,c);return new f(x);case d.MGK:c=new qc(k);ma=h.getEntityAuthenticationFactory(Na.MGK);if(!ma)throw new Ra(a.UNSUPPORTED_KEYX_MECHANISM,l);c=ma.getCryptoContext(h,c);return new f(x);case d.WRAP:c=h.getMslCryptoContext();c.unwrap(g,ec,wb,{result:function(a){b(A,function(){return new f(a)})},error:A.error});break;default:throw new Ra(a.UNSUPPORTED_KEYX_MECHANISM,l);}})}var d={PSK:"PSK",MGK:"MGK",WRAP:"WRAP"},h=Pb=Kd.extend({init:function J(a,
b){J.base.call(this,gc.JWK_LADDER);switch(a){case d.WRAP:if(!b)throw new W("Previous wrapping key based key exchange requires the previous wrapping key data and ID.");break;default:b=null}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},wrapdata:{value:b,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.mechanism=this.mechanism;this.wrapdata&&(a.wrapdata=L(this.wrapdata));return a},equals:function ka(a){return a===this?!0:a instanceof Pb?ka.base.call(this,
a)&&this.mechanism==a.mechanism&&p(this.wrapdata,a.wrapdata):!1},uniqueKey:function K(){var a=K.base.call(this)+":"+this.mechanism;this.wrapdata&&(a+=":"+Y(this.wrapdata));return a}}),l=Ea=Ld.extend({init:function A(a,b,c,d,h){A.base.call(this,a,gc.JWK_LADDER);Object.defineProperties(this,{wrapKey:{value:b,writable:!1,configurable:!1},wrapdata:{value:c,writable:!1,configurable:!1},encryptionKey:{value:d,writable:!1,configurable:!1},hmacKey:{value:h,writable:!1,configurable:!1}})},getKeydata:function(){var a=
{};a.wrapkey=L(this.wrapKey);a.wrapdata=L(this.wrapdata);a.encryptionkey=L(this.encryptionKey);a.hmackey=L(this.hmacKey);return a},equals:function E(a){return this===a?!0:a instanceof Ea?E.base.call(this,a)&&p(this.wrapKey,a.wrapKey)&&p(this.wrapdata,a.wrapdata)&&p(this.encryptionKey,a.encryptionKey)&&p(this.hmacKey,a.hmacKey):!1},uniqueKey:function ma(){return ma.base.call(this)+":"+Y(this.wrapKey)+":"+Y(this.wrapdata)+":"+Y(this.encryptionKey)+":"+Y(this.hmacKey)}}),f=wd.extend({init:function(a){a&&
a.rawKey&&(a=a.rawKey);Object.defineProperties(this,{_wrapKey:{value:a,writable:!1,enumerable:!1,configurable:!1}})},encrypt:function(b,c){c.error(new T(a.ENCRYPT_NOT_SUPPORTED))},decrypt:function(b,c){c.error(new T(a.DECRYPT_NOT_SUPPORTED))},wrap:function(c,d){b(d,function(){Fa.wrapKey("jwk",c.rawKey,this._wrapKey,ec).then(function(a){d.result(a)},function(b){d.error(new T(a.WRAP_ERROR))})},this)},unwrap:function(c,d,h,l){function f(c){b(l,function(){switch(c.type){case "secret":Oc(c,l);break;case "public":Pc(c,
l);break;case "private":$c(c,l);break;default:throw new T(a.UNSUPPORTED_KEY,"type: "+c.type);}})}b(l,function(){Fa.unwrapKey("jwk",c,this._wrapKey,ec,d,!1,h).then(function(a){f(a)},function(b){l.error(new T(a.UNWRAP_ERROR))})},this)},sign:function(b,c){c.error(new T(a.SIGN_NOT_SUPPORTED))},verify:function(b,c,d){d.error(new T(a.VERIFY_NOT_SUPPORTED))}});Qe=hc.extend({init:function nb(a){nb.base.call(this,gc.JWK_LADDER);Object.defineProperties(this,{repository:{value:a,writable:!1,enumerable:!1,configurable:!1}})},
createRequestData:function(c,l,f){b(f,function(){var b=l.mechanism,c=l.wrapdata;if(!b||b==d.WRAP&&(!c||"string"!==typeof c))throw new Z(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(l));if(!d[b])throw new Ra(a.UNIDENTIFIED_KEYX_MECHANISM,b);var f;switch(b){case d.WRAP:try{f=O(c)}catch(g){throw new Ra(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());}if(null==f||0==f.length)throw new Ra(a.KEYX_WRAPPING_KEY_MISSING,"keydata "+l.toString());break;default:f=null}return new h(b,f)})},createResponseData:function(b,
c,d){b=d.wrapkey;var h=d.wrapdata,f=d.encryptionkey,g=d.hmackey;if(!(b&&"string"===typeof b&&h&&"string"===typeof h&&f&&"string"===typeof f&&g)||"string"!==typeof g)throw new Z(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(d));var m,t,k,La;try{m=O(b),t=O(h)}catch(mb){throw new T(a.INVALID_SYMMETRIC_KEY,"keydata "+JSON.stringify(d),mb);}try{k=O(f)}catch(Ab){throw new T(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(d),Ab);}try{La=O(g)}catch(w){throw new T(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(d),
w);}return new l(c,m,t,k,La)},generateResponse:function(d,g,m,k){function fa(a,c,h){da.generateSessionKeys(d,{result:function(d){b(k,function(){Ec(a,c,h,d.encryptionKey,d.hmacKey)},da)},error:function(a){b(k,function(){a instanceof B&&a.setEntity(La);throw a;})}})}function Ec(a,h,l,f,m){b(k,function(){c(d,g.mechanism,g.wrapdata,a,{result:function(a){a.wrap(h,{result:function(a){sa(h,l,f,m,a)},error:function(a){b(k,function(){a instanceof B&&a.setEntity(La);throw a;})}})},error:function(a){b(k,function(){a instanceof
B&&a.setEntity(La);throw a;})}})},da)}function sa(a,c,d,h,l){b(k,function(){var g=new f(a);g.wrap(d,{result:function(a){g.wrap(h,{result:function(b){Ja(c,l,d,a,h,b)},error:function(a){b(k,function(){a instanceof B&&a.setEntity(La);throw a;})}})},error:function(a){b(k,function(){a instanceof B&&a.setEntity(La);throw a;})}})},da)}function Ja(a,c,h,f,g,t){b(k,function(){var fa=d.getTokenFactory();La?fa.renewMasterToken(d,La,h,g,{result:function(h){b(k,function(){var b=new Jb(d,h),g=new l(h,c,a,f,t);
return new hc.KeyExchangeData(g,b,k)},da)},error:function(a){b(k,function(){a instanceof B&&a.setEntity(La);throw a;})}}):fa.createMasterToken(d,m,h,g,{result:function(h){b(k,function(){var b=new Jb(d,h),g=new l(h,c,a,f,t);return new hc.KeyExchangeData(g,b,k)},da)},error:k.error})},da)}var da=this,La;b(k,function(){if(!(g instanceof h))throw new W("Key request data "+JSON.stringify(g)+" was not created by this factory.");var c=m;if(m instanceof Xb){if(!m.isVerified())throw new oc(a.MASTERTOKEN_UNTRUSTED,
m);La=m;c=m.identity}var l=new Uint8Array(16);d.getRandom().nextBytes(l);Cb(l,ec,wb,{result:function(a){b(k,function(){d.getMslCryptoContext().wrap(a,{result:function(b){fa(c,a,b)},error:function(a){b(k,function(){a instanceof B&&a.setEntity(La);throw a;},da)}})},da)},error:function(c){b(k,function(){throw(new T(a.WRAP_KEY_CREATION_FAILURE,null,c)).setEntity(La);},da)}})},da)},getCryptoContext:function(c,g,k,la,fa){function w(a,d,h,l,g){b(fa,function(){var m=new f(g);m.unwrap(d.encryptionKey,pc,qb,
{result:function(f){m.unwrap(d.hmacKey,Mb,ga,{result:function(a){b(fa,function(){this.repository.addCryptoContext(d.wrapdata,m);this.repository.removeCryptoContext(h);return new Jb(c,d.masterToken,l,f,a)},sa)},error:function(c){b(fa,function(){c instanceof B&&c.setEntity(a);throw c;})}})},error:function(c){b(fa,function(){c instanceof B&&c.setEntity(a);throw c;})}})},sa)}var sa=this;b(fa,function(){if(!(g instanceof h))throw new W("Key request data "+JSON.stringify(g)+" was not created by this factory.");
if(!(k instanceof l))throw new W("Key response data "+JSON.stringify(k)+" was not created by this factory.");var la=g.mechanism,da=g.wrapdata;c.getEntityAuthenticationData(null,{result:function(h){b(fa,function(){var l=h.getIdentity(),g;switch(la){case d.PSK:g=new rc(l);var nc=c.getEntityAuthenticationFactory(Na.PSK);if(!nc)throw(new Ra(a.UNSUPPORTED_KEYX_MECHANISM,la)).setEntity(h);g=nc.getCryptoContext(c,g);g=new f(g.wrapKey);break;case d.MGK:g=new qc(l);nc=c.getEntityAuthenticationFactory(Na.MGK);
if(!nc)throw(new Ra(a.UNSUPPORTED_KEYX_MECHANISM,la)).setEntity(h);g=nc.getCryptoContext(c,g);g=new f(g.wrapKey);break;case d.WRAP:g=this.repository.getCryptoContext(da);if(!g)throw(new Ra(a.KEYX_WRAPPING_KEY_MISSING,L(da))).setEntity(h);break;default:throw(new Ra(a.UNSUPPORTED_KEYX_MECHANISM,la)).setEntity(h);}g.unwrap(k.wrapKey,ec,wb,{result:function(a){w(h,k,da,l,a)},error:function(a){b(fa,function(){a instanceof B&&a.setEntity(h);throw a;})}})},sa)},error:fa.error})},sa)}})})();var ta=ea.Class.create({addCryptoContext:function(a,
b){},getCryptoContext:function(a){},removeCryptoContext:function(a){}}),zf,Md,Fd,Nd;(function(){function c(b,h,l,f,g){switch(l){case d.JWE_RSA:case d.JWEJS_RSA:return new Hc(b,zc.RSA_OAEP,F,f,g);case d.JWK_RSA:return new ed(b,h,f,g,cb.WRAP_UNWRAP_OAEP);case d.JWK_RSAES:return new ed(b,h,f,g,cb.WRAP_UNWRAP_PKCS1);default:throw new T(a.UNSUPPORTED_KEYX_MECHANISM,l);}}var d=Md={RSA:"RSA",ECC:"ECC",JWE_RSA:"JWE_RSA",JWEJS_RSA:"JWEJS_RSA",JWK_RSA:"JWK_RSA",JWK_RSAES:"JWK_RSAES"},h=Fd=Kd.extend({init:function J(a,
b,c,d){J.base.call(this,gc.ASYMMETRIC_WRAPPED);Object.defineProperties(this,{keyPairId:{value:a,writable:!1,configurable:!1},mechanism:{value:b,writable:!1,configurable:!1},publicKey:{value:c,writable:!1,configurable:!1},privateKey:{value:d,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.keypairid=this.keyPairId;a.mechanism=this.mechanism;a.publickey=L(this.publicKey.getEncoded());return a},equals:function ka(a){if(a===this)return!0;if(!(a instanceof Fd))return!1;var b=this.privateKey===
a.privateKey||this.privateKey&&a.privateKey&&p(this.privateKey.getEncoded(),a.privateKey.getEncoded());return ka.base.call(this,a)&&this.keyPairId==a.keyPairId&&this.mechanism==a.mechanism&&p(this.publicKey.getEncoded(),a.publicKey.getEncoded())&&b},uniqueKey:function K(){var a=this.publicKey.getEncoded(),b=this.privateKey&&this.privateKey.getEncoded(),a=K.base.call(this)+":"+this.keyPairId+":"+this.mechanism+":"+Y(a);b&&(a+=":"+Y(b));return a}}),l=function(c,l){b(l,function(){var b=c.keypairid,f=
c.mechanism,g=c.publickey;if(!b||"string"!==typeof b||!f||!g||"string"!==typeof g)throw new Z(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(c));if(!d[f])throw new Ra(a.UNIDENTIFIED_KEYX_MECHANISM,f);try{var k=O(g);switch(f){case d.JWE_RSA:case d.JWEJS_RSA:case d.JWK_RSA:Gc(k,Ba,wb,{result:function(a){l.result(new h(b,f,a,null))},error:function(a){l.error(a)}});break;case d.JWK_RSAES:Gc(k,Ya,wb,{result:function(a){l.result(new h(b,f,a,null))},error:function(a){l.error(a)}});break;default:throw new T(a.UNSUPPORTED_KEYX_MECHANISM,
f);}}catch(t){if(!(t instanceof B))throw new T(a.INVALID_PUBLIC_KEY,"keydata "+JSON.stringify(c),t);throw t;}})},f=Nd=Ld.extend({init:function A(a,b,c,d){A.base.call(this,a,gc.ASYMMETRIC_WRAPPED);Object.defineProperties(this,{keyPairId:{value:b,writable:!1,configurable:!1},encryptionKey:{value:c,writable:!1,configurable:!1},hmacKey:{value:d,writable:!1,configurable:!1}})},getKeydata:function(){var a={};a.keypairid=this.keyPairId;a.encryptionkey=L(this.encryptionKey);a.hmackey=L(this.hmacKey);return a},
equals:function E(a){return this===a?!0:a instanceof Nd?E.base.call(this,a)&&this.keyPairId==a.keyPairId&&p(this.encryptionKey,a.encryptionKey)&&p(this.hmacKey,a.hmacKey):!1},uniqueKey:function ma(){return ma.base.call(this)+":"+this.keyPairId+":"+Y(this.encryptionKey)+":"+Y(this.hmacKey)}});zf=hc.extend({init:function nb(){nb.base.call(this,gc.ASYMMETRIC_WRAPPED)},createRequestData:function(a,b,c){l(b,c)},createResponseData:function(b,c,d){b=d.keypairid;var h=d.encryptionkey,l=d.hmackey;if(!b||"string"!==
typeof b||!h||"string"!==typeof h||!l||"string"!==typeof l)throw new Z(a.JSON_PARSE_ERROR,"keydata "+JSON.stringify(d));var g;try{g=O(h)}catch(m){throw new T(a.INVALID_ENCRYPTION_KEY,"keydata "+JSON.stringify(d),m);}var k;try{k=O(l)}catch(w){throw new T(a.INVALID_HMAC_KEY,"keydata "+JSON.stringify(d),w);}return new f(c,b,g,k)},generateResponse:function(a,d,l,g){function m(h,f){b(g,function(){var m=c(a,d.keyPairId,d.mechanism,null,d.publicKey);m.wrap(h,{result:function(a){b(g,function(){m.wrap(f,{result:function(b){k(h,
a,f,b)},error:function(a){b(g,function(){a instanceof B&&l instanceof Xb&&a.setEntity(l);throw a;},sa)}})},sa)},error:function(a){b(g,function(){a instanceof B&&l instanceof Xb&&a.setEntity(l);throw a;},sa)}})},sa)}function k(c,h,m,fa){b(g,function(){var k=a.getTokenFactory();l instanceof Xb?k.renewMasterToken(a,l,c,m,{result:function(c){b(g,function(){var b=new Jb(a,c),l=new f(c,d.keyPairId,h,fa);return new hc.KeyExchangeData(l,b,g)},sa)},error:function(a){b(g,function(){a instanceof B&&a.setEntity(l);
throw a;},sa)}}):k.createMasterToken(a,l,c,m,{result:function(c){b(g,function(){var b=new Jb(a,c),l=new f(c,d.keyPairId,h,fa);return new hc.KeyExchangeData(l,b,g)},sa)},error:g.error})},sa)}var sa=this;b(g,function(){if(!(d instanceof h))throw new W("Key request data "+JSON.stringify(d)+" was not created by this factory.");this.generateSessionKeys(a,{result:function(a){m(a.encryptionKey,a.hmacKey)},error:function(a){b(g,function(){a instanceof B&&l instanceof Xb&&a.setEntity(l);throw a;},sa)}})},
sa)},getCryptoContext:function(d,l,g,m,k){var Ec=this;b(k,function(){if(!(l instanceof h))throw new W("Key request data "+JSON.stringify(l)+" was not created by this factory.");if(!(g instanceof f))throw new W("Key response data "+JSON.stringify(g)+" was not created by this factory.");var sa=l.keyPairId,n=g.keyPairId;if(sa!=n)throw(new Ra(a.KEYX_RESPONSE_REQUEST_MISMATCH,"request "+sa+"; response "+n)).setEntity(m);n=l.privateKey;if(!n)throw(new Ra(a.KEYX_PRIVATE_KEY_MISSING,"request Asymmetric private key")).setEntity(m);
var da=c(d,sa,l.mechanism,n,null);da.unwrap(g.encryptionKey,pc,qb,{result:function(a){da.unwrap(g.hmacKey,Mb,ga,{result:function(c){d.getEntityAuthenticationData(null,{result:function(h){b(k,function(){var b=h.getIdentity();return new Jb(d,g.masterToken,b,a,c)},Ec)},error:function(a){b(k,function(){a instanceof B&&a.setEntity(m);throw a;},Ec)}})},error:function(a){b(k,function(){a instanceof B&&a.setEntity(m);throw a;},Ec)}})},error:function(a){b(k,function(){a instanceof B&&a.setEntity(m);throw a;
},Ec)}})},Ec)}})})();var Rg=ea.Class.create({init:function(a){var b=Oa.parser(),c=[],d=[],f,g,k,ka=0,K=!1;b.onerror=function(a){K||(K=!0,b.end())};b.onopenobject=function(a){if(f)f[k]={},d.push(f),f=f[k];else if(g){var b={};d.push(g);g.push(b);f=b;g=x}else f={};k=a};b.oncloseobject=function(){var a=d.pop();a?"object"===typeof a?f=a:(f=x,g=a):(c.push(f),ka=b.index,f=x)};b.onopenarray=function(){if(f)f[k]=[],d.push(f),g=f[k],f=x;else if(g){var a=[];d.push(g);g.push(a);g=a}else g=[]};b.onclosearray=
function(){var a=d.pop();a?"object"===typeof a?(f=a,g=x):g=a:(c.push(g),ka=b.index,g=x)};b.onkey=function(a){k=a};b.onvalue=function(a){f?f[k]=a:g?g.push(a):(c.push(a),ka=b.index)};b.write(a).close();Object.defineProperties(this,{_values:{value:c,writable:!1,enumerable:!1,configurable:!1},_lastIndex:{value:ka,writable:!0,enumerable:!1,configurable:!1}})},more:function(){return 0<this._values.length},nextValue:function(){return 0==this._values.length?x:this._values.shift()},lastIndex:function(){return this._lastIndex}}),
me,Re,Kf,Se,Lf,ne;(function(){var c=Re="entityauthdata",d=Kf="mastertoken",h=Se="headerdata",l=Lf="errordata",f=ne="signature";me=function(g,k,ka,K){b(K,function(){var b=k[c],E=k[d],ma=k[f];if(b&&"object"!==typeof b||E&&"object"!==typeof E||"string"!==typeof ma)throw new Z(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(k));var nb;try{nb=O(ma)}catch(nc){throw new Aa(a.HEADER_SIGNATURE_INVALID,"header/errormsg "+JSON.stringify(k),nc);}var Gb=null;b&&(Gb=ie(g,b));var la=k[h];if(la!=x&&null!=la){if("string"!==
typeof la)throw new Z(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(k));E?Rc(g,E,{result:function(a){Te(g,la,Gb,a,nb,ka,K)},error:function(a){K.error(a)}}):Te(g,la,Gb,null,nb,ka,K)}else if(b=k[l],b!=x&&null!=b){if("string"!==typeof b)throw new Z(a.JSON_PARSE_ERROR,"header/errormsg "+JSON.stringify(k));Mf(g,b,Gb,nb,K)}else throw new Z(a.JSON_PARSE_ERROR,JSON.stringify(k));})}})();var Zc,Nf,Mf;(function(){function c(a,b){this.errordata=a;this.signature=b}Zc=ea.Class.create({init:function(c,d,
l,f,g,k,w,K,A,E){var ma=this;b(E,function(){0>k&&(k=-1);if(0>f||f>Ha)throw new W("Message ID "+f+" is out of range.");if(!d)throw new Aa(a.MESSAGE_ENTITY_NOT_FOUND);if(A)return Object.defineProperties(this,{entityAuthenticationData:{value:d,writable:!1,configurable:!1},recipient:{value:l,writable:!1,configurable:!1},messageId:{value:f,writable:!1,configurable:!1},errorCode:{value:g,writable:!1,configurable:!1},internalCode:{value:k,writable:!1,configurable:!1},errorMessage:{value:w,writable:!1,configurable:!1},
userMessage:{value:K,writable:!1,configurable:!1},errordata:{value:A.errordata,writable:!1,enumerable:!1,configurable:!1},signature:{value:A.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var nb={};l&&(nb.recipient=l);nb.messageid=f;nb.errorcode=g;0<k&&(nb.internalcode=k);w&&(nb.errormsg=w);K&&(nb.usermsg=K);var nc;try{nc=c.getEntityAuthenticationFactory(d.scheme).getCryptoContext(c,d)}catch(Gb){throw Gb instanceof B&&(Gb.setEntity(d),Gb.setMessageId(f)),Gb;}nb=S(JSON.stringify(nb),na);
nc.encrypt(nb,{result:function(a){b(E,function(){nc.sign(a,{result:function(c){b(E,function(){Object.defineProperties(this,{entityAuthenticationData:{value:d,writable:!1,configurable:!1},recipient:{value:l,writable:!1,configurable:!1},messageId:{value:f,writable:!1,configurable:!1},errorCode:{value:g,writable:!1,configurable:!1},internalCode:{value:k,writable:!1,configurable:!1},errorMessage:{value:w,writable:!1,configurable:!1},userMessage:{value:K,writable:!1,configurable:!1},errordata:{value:a,
writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},ma)},error:function(a){b(E,function(){a instanceof B&&(a.setEntity(d),a.setMessageId(f));throw a;},ma)}})},ma)},error:function(a){b(E,function(){a instanceof B&&(a.setEntity(d),a.setMessageId(f));throw a;},ma)}})},ma)},toJSON:function(){var a={};a[Re]=this.entityAuthenticationData;a[Lf]=L(this.errordata);a[ne]=L(this.signature);return a}});Nf=function(a,b,c,d,f,g,k,K,A){new Zc(a,
b,c,d,f,g,k,K,null,A)};Mf=function(f,h,l,g,r){b(r,function(){if(!l)throw new Aa(a.MESSAGE_ENTITY_NOT_FOUND);var J;try{var ka=l.scheme,K=f.getEntityAuthenticationFactory(ka);if(!K)throw new yc(a.ENTITYAUTH_FACTORY_NOT_FOUND,ka);J=K.getCryptoContext(f,l)}catch(A){throw A instanceof B&&A.setEntity(l),A;}try{h=O(h)}catch(E){throw(new Aa(a.HEADER_DATA_INVALID,h,E)).setEntity(l);}if(!h||0==h.length)throw(new Aa(a.HEADER_DATA_MISSING,h)).setEntity(l);J.verify(h,g,{result:function(A){b(r,function(){if(!A)throw(new T(a.MESSAGE_VERIFICATION_FAILED)).setEntity(l);
J.decrypt(h,{result:function(J){b(r,function(){var b=k(J,na),A;try{A=JSON.parse(b)}catch(K){if(K instanceof SyntaxError)throw(new Z(a.JSON_PARSE_ERROR,"errordata "+b,K)).setEntity(l);throw K;}var fa=A.recipient!==x?A.recipient:null,E=parseInt(A.messageid),ka=parseInt(A.errorcode),ma=parseInt(A.internalcode),da=A.errormsg,La=A.usermsg;if(fa&&"string"!==typeof fa||!E||E!=E||!ka||ka!=ka||A.internalcode&&ma!=ma||da&&"string"!==typeof da||La&&"string"!==typeof La)throw(new Z(a.JSON_PARSE_ERROR,"errordata "+
b)).setEntity(l);if(0>E||E>Ha)throw(new Aa(a.MESSAGE_ID_OUT_OF_RANGE,"errordata "+b)).setEntity(l);A=!1;for(var mb in d)if(d[mb]==ka){A=!0;break}A||(ka=d.FAIL);if(ma){if(0>ma)throw(new Aa(a.INTERNAL_CODE_NEGATIVE,"errordata "+b)).setEntity(l).setMessageId(E);}else ma=-1;b=new c(h,g);new Zc(f,l,fa,E,ka,ma,da,La,b,r)})},error:function(a){b(r,function(){a instanceof B&&a.setEntity(l);throw a;})}})})},error:function(a){b(r,function(){a instanceof B&&a.setEntity(l);throw a;})}})})}})();var Of=ea.Class.create({getUserMessage:function(a,
b){}}),Od,Pf,Ue;(function(){Ue=function(a,b){if(!a||!b)return null;var c=a.compressionAlgorithms.filter(function(a){for(var c=0;c<b.compressionAlgorithms.length;++c)if(a==b.compressionAlgorithms[c])return!0;return!1}),d=a.languages.filter(function(a){for(var c=0;c<b.languages.length;++c)if(a==b.languages[c])return!0;return!1});return new Od(c,d)};Od=ea.Class.create({init:function(a,b){a||(a=[]);b||(b=[]);a.sort();Object.defineProperties(this,{compressionAlgorithms:{value:a,writable:!1,enumerable:!0,
configurable:!1},languages:{value:b,writable:!1,enumerable:!0,configurable:!1}})},toJSON:function(){var a={};a.compressionalgos=this.compressionAlgorithms;a.languages=this.languages;return a},equals:function(a){return this===a?!0:a instanceof Od?pa(this.compressionAlgorithms,a.compressionAlgorithms)&&pa(this.languages,a.languages):!1},uniqueKey:function(){return this.compressionAlgorithms.join(":")+"|"+this.languages.join(":")}});Pf=function(b){var c=b.compressionalgos,d=b.languages;if(c&&!(c instanceof
Array)||d&&!(d instanceof Array))throw new Z(a.JSON_PARSE_ERROR,"capabilities "+JSON.stringify(b));b=[];for(var f=0;c&&f<c.length;++f){var g=c[f];ad[g]&&b.push(g)}return new Od(b,d)}})();var Pd,Qf,Te,Rf,Sf;(function(){function c(a,b,d,h,f){this.customer=a;this.sender=b;this.messageCryptoContext=d;this.headerdata=h;this.signature=f}function d(a,b,c,h,f,l,g,k,r,m,t,J,A,K,E,ka,w,ma,n,p){return{cryptoContext:{value:b,writable:!1,configurable:!1},customer:{value:c,writable:!1,configurable:!1},entityAuthenticationData:{value:h,
writable:!1,configurable:!1},masterToken:{value:f,writable:!1,configurable:!1},sender:{value:l,writable:!1,configurable:!1},messageId:{value:g,writable:!1,configurable:!1},nonReplayableId:{value:ka,writable:!1,configurable:!1},keyRequestData:{value:k,writable:!1,configurable:!1},keyResponseData:{value:r,writable:!1,configurable:!1},userAuthenticationData:{value:m,writable:!1,configurable:!1},userIdToken:{value:t,writable:!1,configurable:!1},serviceTokens:{value:J,writable:!1,configurable:!1},peerMasterToken:{value:A,
writable:!1,configurable:!1},peerUserIdToken:{value:K,writable:!1,configurable:!1},peerServiceTokens:{value:E,writable:!1,configurable:!1},messageCapabilities:{value:ma,writable:!1,configurable:!1},renewable:{value:w,writable:!1,enumerable:!1,configurable:!1},headerdata:{value:n,writable:!1,enumerable:!1,configurable:!1},signature:{value:p,writable:!1,enumerable:!1,configurable:!1}}}function h(b,c,d){if(d){if(c=b.getMslStore().getCryptoContext(d))return c;if(!d.isVerified()||!d.isDecrypted())throw new oc(a.MASTERTOKEN_UNTRUSTED,
d);return new Jb(b,d)}d=c.scheme;var h=b.getEntityAuthenticationFactory(d);if(!h)throw new yc(a.ENTITYAUTH_FACTORY_NOT_FOUND,d);return h.getCryptoContext(b,c)}function f(c,d,h,l,g){b(g,function(){d.verify(h,l,{result:function(c){b(g,function(){if(!c)throw new T(a.MESSAGE_VERIFICATION_FAILED);d.decrypt(h,{result:function(a){b(g,function(){return k(a,na)})},error:function(a){g.error(a)}})})},error:function(a){g.error(a)}})})}function g(a,c,d){b(d,function(){if(c)Ne(a,c,d);else return null})}function r(a,
c,d,h){b(h,function(){if(c)gd(a,c,d,h);else return null})}function J(a,c,d,h){b(h,function(){if(d)Tf(a,c,d,h);else return null})}function ka(c,d,h,f,l,g,k){function r(d,k,t){if(k>=d.length){var J=[],A;for(A in m)J.push(m[A]);t.result(J)}else{J=d[k];if("object"!==typeof J)throw new Z(a.JSON_PARSE_ERROR,"headerdata "+g);oe(c,J,h,f,l,{result:function(a){b(t,function(){m[a.uniqueKey()]=a;r(d,k+1,t)})},error:function(a){t.error(a)}})}}var m={};b(k,function(){if(d){if(!(d instanceof Array))throw new Z(a.JSON_PARSE_ERROR,
"headerdata "+g);r(d,0,k)}else return[]})}function K(c,d,h,f,l,g){function k(c,d,h){b(h,function(){var b=d.peermastertoken;if(b&&"object"!==typeof b)throw new Z(a.JSON_PARSE_ERROR,"headerdata "+l);if(!b)return null;Rc(c,b,h)})}function r(c,d,h,f){b(f,function(){var b=d.peeruseridtoken;if(b&&"object"!==typeof b)throw new Z(a.JSON_PARSE_ERROR,"headerdata "+l);if(!b)return null;gd(c,b,h,f)})}b(g,function(){if(!c.isPeerToPeer())return{peerMasterToken:null,peerUserIdToken:null,peerServiceTokens:[]};k(c,
d,{result:function(a){b(g,function(){var k=h?h.masterToken:a;r(c,d,k,{result:function(h){b(g,function(){ka(c,d.peerservicetokens,k,h,f,l,{result:function(c){b(g,function(){return{peerMasterToken:a,peerUserIdToken:h,peerServiceTokens:c}})},error:function(a){b(g,function(){a instanceof B&&(a.setEntity(k),a.setUser(h));throw a;})}})})},error:function(a){b(g,function(){a instanceof B&&a.setEntity(k);throw a;})}})})},error:g.error})})}function A(c,d,h,f){function l(a,d){b(f,function(){if(d>=a.length)return g;
Gf(c,a[d],{result:function(c){b(f,function(){g.push(c);l(a,d+1)})},error:function(a){f.error(a)}})})}var g=[];b(f,function(){var b=d.keyrequestdata;if(!b)return g;if(!(b instanceof Array))throw new Z(a.JSON_PARSE_ERROR,"headerdata "+h);l(b,0)})}var E=Rf=ea.Class.create({init:function(a,b,c,d,h,f,l,g,k){Object.defineProperties(this,{messageId:{value:a,writable:!1,configurable:!1},nonReplayableId:{value:b,writable:!1,configurable:!1},renewable:{value:c,writable:!1,configurable:!1},capabilities:{value:d,
writable:!1,configurable:!1},keyRequestData:{value:h,writable:!1,configurable:!1},keyResponseData:{value:f,writable:!1,configurable:!1},userAuthData:{value:l,writable:!1,configurable:!1},userIdToken:{value:g,writable:!1,configurable:!1},serviceTokens:{value:k,writable:!1,configurable:!1}})}}),ma=Sf=ea.Class.create({init:function(a,b,c){Object.defineProperties(this,{peerMasterToken:{value:a,writable:!1,configurable:!1},peerUserIdToken:{value:b,writable:!1,configurable:!1},peerServiceTokens:{value:c,
writable:!1,configurable:!1}})}});Pd=ea.Class.create({init:function(a,c,f,l,g,k,r){function t(A){b(r,function(){c=f?null:c;var t=l.nonReplayableId,K=l.renewable,E=l.capabilities,kb=l.messageId,ka=l.keyRequestData?l.keyRequestData:[],w=l.keyResponseData,ma=l.userAuthData,n=l.userIdToken,p=l.serviceTokens?l.serviceTokens:[],Ja,y,L;a.isPeerToPeer()?(Ja=g.peerMasterToken,y=g.peerUserIdToken,L=g.peerServiceTokens?g.peerServiceTokens:[]):(y=Ja=null,L=[]);if(0>kb||kb>Ha)throw new W("Message ID "+kb+" is out of range.");
if(!c&&!f)throw new W("Message entity authentication data or master token must be provided.");var O,I;w?a.isPeerToPeer()?(O=f,I=w.masterToken):(O=w.masterToken,I=Ja):(O=f,I=Ja);if(n&&(!O||!n.isBoundTo(O)))throw new W("User ID token must be bound to a master token.");if(y&&(!I||!y.isBoundTo(I)))throw new W("Peer user ID token must be bound to a peer master token.");p.forEach(function(a){if(a.isMasterTokenBound()&&(!O||!a.isBoundTo(O)))throw new W("Master token bound service tokens must be bound to the provided master token.");
if(a.isUserIdTokenBound()&&(!n||!a.isBoundTo(n)))throw new W("User ID token bound service tokens must be bound to the provided user ID token.");},this);L.forEach(function(a){if(a.isMasterTokenBound()&&(!I||!a.isBoundTo(I)))throw new W("Master token bound peer service tokens must be bound to the provided peer master token.");if(a.isUserIdTokenBound()&&(!y||!a.isBoundTo(y)))throw new W("User ID token bound peer service tokens must be bound to the provided peer user ID token.");},this);if(k){var F=k.customer,
aa=k.messageCryptoContext,x=d(a,aa,F,c,f,A,kb,ka,w,ma,n,p,Ja,y,L,t,K,E,k.headerdata,k.signature);Object.defineProperties(this,x);return this}var F=n?n.customer:null,x={};A&&(x.sender=A);x.messageid=kb;"number"===typeof t&&(x.nonreplayableid=t);x.renewable=K;E&&(x.capabilities=E);0<ka.length&&(x.keyrequestdata=ka);w&&(x.keyresponsedata=w);ma&&(x.userauthdata=ma);n&&(x.useridtoken=n);0<p.length&&(x.servicetokens=p);Ja&&(x.peermastertoken=Ja);y&&(x.peeruseridtoken=y);0<L.length&&(x.peerservicetokens=
L);var aa;try{aa=h(a,c,f)}catch(Y){throw Y instanceof B&&(Y.setEntity(f),Y.setEntity(c),Y.setUser(n),Y.setUser(ma),Y.setMessageId(kb)),Y;}x=S(JSON.stringify(x),na);aa.encrypt(x,{result:function(h){b(r,function(){aa.sign(h,{result:function(l){b(r,function(){var b=d(a,aa,F,c,f,A,kb,ka,w,ma,n,p,Ja,y,L,t,K,E,h,l);Object.defineProperties(this,b);return this},J)},error:function(a){b(r,function(){a instanceof B&&(a.setEntity(f),a.setEntity(c),a.setUser(n),a.setUser(ma),a.setMessageId(kb));throw a;},J)}})},
J)},error:function(a){b(r,function(){a instanceof B&&(a.setEntity(f),a.setEntity(c),a.setUser(n),a.setUser(ma),a.setMessageId(kb));throw a;},J)}})},J)}var J=this;b(r,function(){k?t(k.sender):f?a.getEntityAuthenticationData(null,{result:function(a){a=a.getIdentity();t(a)},error:r.error}):t(null)},J)},isEncrypting:function(){return this.masterToken||qa(this.entityAuthenticationData.scheme)},isRenewable:function(){return this.renewable},toJSON:function(){var a={};this.masterToken?a[Kf]=this.masterToken:
a[Re]=this.entityAuthenticationData;a[Se]=L(this.headerdata);a[ne]=L(this.signature);return a}});Qf=function(a,b,c,d,h,f){new Pd(a,b,c,d,h,null,f)};Te=function(d,k,m,n,fa,p,sa){b(sa,function(){m=n?null:m;if(!m&&!n)throw new Aa(a.MESSAGE_ENTITY_NOT_FOUND);var Ja=k;try{k=O(Ja)}catch(da){throw new Aa(a.HEADER_DATA_INVALID,Ja,da);}if(!k||0==k.length)throw new Aa(a.HEADER_DATA_MISSING,Ja);var La;try{La=h(d,m,n)}catch(mb){throw mb instanceof B&&(mb.setEntity(n),mb.setEntity(m)),mb;}f(d,La,k,fa,{result:function(h){b(sa,
function(){var f;try{f=JSON.parse(h)}catch(l){if(l instanceof SyntaxError)throw(new Z(a.JSON_PARSE_ERROR,"headerdata "+h,l)).setEntity(n).setEntity(m);throw l;}var mb=parseInt(f.messageid);if(!mb||mb!=mb)throw(new Z(a.JSON_PARSE_ERROR,"headerdata "+h)).setEntity(n).setEntity(m);if(0>mb||mb>Ha)throw(new Aa(a.MESSAGE_ID_OUT_OF_RANGE,"headerdata "+h)).setEntity(n).setEntity(m);var le=n?f.sender:null;if(n&&(!le||"string"!==typeof le))throw(new Z(a.JSON_PARSE_ERROR,"headerdata "+h)).setEntity(n).setEntity(m).setMessageId(mb);
var da=f.keyresponsedata;if(da&&"object"!==typeof da)throw(new Z(a.JSON_PARSE_ERROR,"headerdata "+h)).setEntity(n).setEntity(m).setMessageId(mb);var Ja=sa;sa={result:function(a){Ja.result(a)},error:function(a){a instanceof B&&(a.setEntity(n),a.setEntity(m),a.setMessageId(mb));Ja.error(a)}};g(d,da,{result:function(l){b(sa,function(){var g=!d.isPeerToPeer()&&l?l.masterToken:n,t=f.useridtoken;if(t&&"object"!==typeof t)throw new Z(a.JSON_PARSE_ERROR,"headerdata "+h);r(d,t,g,{result:function(r){b(sa,function(){var t=
f.userauthdata;if(t&&"object"!==typeof t)throw new Z(a.JSON_PARSE_ERROR,"headerdata "+h);J(d,g,t,{result:function(t){b(sa,function(){var J;if(t){var kb=t.scheme,da=d.getUserAuthenticationFactory(kb);if(!da)throw(new Pa(a.USERAUTH_FACTORY_NOT_FOUND,kb)).setUser(r).setUser(t);kb=n?n.identity:m.getIdentity();J=da.authenticate(d,kb,t,r)}else J=r?r.customer:null;ka(d,f.servicetokens,g,r,p,h,{result:function(g){b(sa,function(){var kb=f.nonreplayableid!==x?parseInt(f.nonreplayableid):null,ka=f.renewable;
if(kb!=kb||"boolean"!==typeof ka)throw new Z(a.JSON_PARSE_ERROR,"headerdata "+h);if(0>kb||kb>Ha)throw new Aa(a.NONREPLAYABLE_ID_OUT_OF_RANGE,"headerdata "+h);var da=null,Pe=f.capabilities;if(Pe){if("object"!==typeof Pe)throw new Z(a.JSON_PARSE_ERROR,"headerdata "+h);da=Pf(Pe)}A(d,f,h,{result:function(a){K(d,f,l,p,h,{result:function(h){b(sa,function(){var b=h.peerMasterToken,f=h.peerUserIdToken,A=h.peerServiceTokens,K=new E(mb,kb,ka,da,a,l,t,r,g),b=new ma(b,f,A),f=new c(J,le,La,k,fa);new Pd(d,m,n,
K,b,f,sa)})},error:sa.error})},error:function(a){b(sa,function(){a instanceof B&&(a.setUser(r),a.setUser(t));throw a;})}})})},error:function(a){b(sa,function(){a instanceof B&&(a.setEntity(g),a.setUser(r),a.setUser(t));throw a;})}})})},error:sa.error})})},error:sa.error})})},error:sa.error})})},error:sa.error})})}})();var Ve,Wf,We;(function(){function c(a,b){this.payload=a;this.signature=b}Ve=ea.Class.create({init:function(a,c,d,f,g,k,ka,K){var A=this;b(K,function(){if(0>a||a>Ha)throw new W("Sequence number "+
a+" is outside the valid range.");if(0>c||c>Ha)throw new W("Message ID "+c+" is outside the valid range.");if(ka)return Object.defineProperties(this,{sequenceNumber:{value:a,writable:!1,configurable:!1},messageId:{value:c,writable:!1,configurable:!1},compressionAlgo:{value:f,writable:!1,configurable:!1},data:{value:g,writable:!1,configurable:!1},endofmsg:{value:d,writable:!1,enumerable:!1,configurable:!1},payload:{value:ka.payload,writable:!1,enumerable:!1,configurable:!1},signature:{value:ka.signature,
writable:!1,enumerable:!1,configurable:!1}}),this;var E;f?(E=re(f,g),E||(f=null,E=g)):(f=null,E=g);var w={};w.sequencenumber=a;w.messageid=c;d&&(w.endofmsg=d);f&&(w.compressionalgo=f);w.data=L(E);E=S(JSON.stringify(w),na);k.encrypt(E,{result:function(E){b(K,function(){k.sign(E,{result:function(k){b(K,function(){Object.defineProperties(this,{sequenceNumber:{value:a,writable:!1,configurable:!1},messageId:{value:c,writable:!1,configurable:!1},compressionAlgo:{value:f,writable:!1,configurable:!1},data:{value:g,
writable:!1,configurable:!1},endofmsg:{value:d,writable:!1,enumerable:!1,configurable:!1},payload:{value:E,writable:!1,enumerable:!1,configurable:!1},signature:{value:k,writable:!1,enumerable:!1,configurable:!1}});return this},A)},error:function(a){K.error(a)}})},A)},error:function(a){K.error(a)}})},A)},isEndOfMessage:function(){return this.endofmsg},toJSON:function(){var a={};a.payload=L(this.payload);a.signature=L(this.signature);return a}});Wf=function(a,b,c,d,f,g,k){new Ve(a,b,c,d,f,g,null,k)};
We=function(d,h,f){b(f,function(){var g=d.payload,r=d.signature;if(!g||"string"!==typeof g||"string"!==typeof r)throw new Z(a.JSON_PARSE_ERROR,"payload chunk "+JSON.stringify(d));var J,ka;try{J=O(g)}catch(K){throw new Aa(a.PAYLOAD_INVALID,"payload chunk "+JSON.stringify(d),K);}try{ka=O(r)}catch(A){throw new Aa(a.PAYLOAD_SIGNATURE_INVALID,"payload chunk "+JSON.stringify(d),A);}h.verify(J,ka,{result:function(d){b(f,function(){if(!d)throw new T(a.PAYLOAD_VERIFICATION_FAILED);h.decrypt(J,{result:function(d){b(f,
function(){var b=k(d,na),g;try{g=JSON.parse(b)}catch(r){if(r instanceof SyntaxError)throw new Z(a.JSON_PARSE_ERROR,"payload chunk payload "+b,r);throw r;}var m=parseInt(g.sequencenumber),t=parseInt(g.messageid),A=g.endofmsg,K=g.compressionalgo;g=g.data;if(!m||m!=m||!t||t!=t||A&&"boolean"!==typeof A||K&&"string"!==typeof K||"string"!==typeof g)throw new Z(a.JSON_PARSE_ERROR,"payload chunk payload "+b);if(0>m||m>Ha)throw new B(a.PAYLOAD_SEQUENCE_NUMBER_OUT_OF_RANGE,"payload chunk payload "+b);if(0>
t||t>Ha)throw new B(a.PAYLOAD_MESSAGE_ID_OUT_OF_RANGE,"payload chunk payload "+b);A||(A=!1);if(K&&!ad[K])throw new Aa(a.UNIDENTIFIED_COMPRESSION,K);var E;try{E=O(g)}catch(n){throw new Aa(a.PAYLOAD_DATA_CORRUPT,g,n);}if(E&&0!=E.length)b=K?se(K,E):E;else{if(0<g.length)throw new Aa(a.PAYLOAD_DATA_CORRUPT,g);if(A)b=new Uint8Array(0);else throw new Aa(a.PAYLOAD_DATA_MISSING,g);}E=new c(J,ka);new Ve(m,t,A,K,b,h,E,f)})},error:function(a){f.error(a)}})})},error:function(a){f.error(a)}})})}})();var Qd,hd,
xd,id,Xf,Xe;(function(){function c(d,f,h,l,g){function k(){b(g,function(){t>=f.length&&(t=0,++m);if(m>=w.length){if(n)throw n;throw new Ra(a.KEYX_FACTORY_NOT_FOUND,JSON.stringify(f));}var c=w[m],h=f[t];c.scheme!=h.keyExchangeScheme?(++t,k()):c.generateResponse(d,h,la,{result:function(a){g.result(a)},error:function(a){b(g,function(){if(!(a instanceof B))throw a;n=a;++t;k()})}})})}var m=0,t=0,w=d.getKeyExchangeFactories(),n,la=h?h:l;k()}function d(a,f,h,l,g){b(g,function(){var d=f.keyRequestData;if(f.isRenewable()&&
0<d.length)l?l.isRenewable()||l.isExpired()?c(a,d,l,null,g):a.getTokenFactory().isNewestMasterToken(a,l,{result:function(f){b(g,function(){if(f)return null;c(a,d,l,null,g)})},error:g.error}):c(a,d,null,h.getIdentity(),g);else return null})}function f(c,d,h,l){b(l,function(){var b=d.userIdToken,f=d.userAuthenticationData,g=d.messageId;if(b&&b.isVerified()){if(b.isRenewable()&&d.isRenewable()||b.isExpired()||!b.isBoundTo(h)){f=c.getTokenFactory();f.renewUserIdToken(c,b,h,l);return}}else if(d.isRenewable()&&
h&&f){b=d.customer;if(!b){var b=f.scheme,k=c.getUserAuthenticationFactory(b);if(!k)throw(new Pa(a.USERAUTH_FACTORY_NOT_FOUND,b)).setEntity(h).setUser(f).setMessageId(g);b=k.authenticate(c,h.identity,f,null)}f=c.getTokenFactory();f.createUserIdToken(c,b,h,l);return}return b})}var l=new Uint8Array(0),g=hd=function(a){if(0>a||a>Ha)throw new W("Message ID "+a+" is outside the valid range.");return a==Ha?0:a+1};xd=function(a){if(0>a||a>Ha)throw new W("Message ID "+a+" is outside the valid range.");return 0==
a?Ha:a-1};id=function(a,c,d,f,h){b(h,function(){if(f==x||null==f){var l=a.getRandom();do f=l.nextLong();while(0>f||f>Ha)}else if(0>f||f>Ha)throw new W("Message ID "+f+" is outside the valid range.");a.getEntityAuthenticationData(null,{result:function(l){b(h,function(){var b=a.getMessageCapabilities();return new Qd(a,f,b,l,c,d,null,null,null,null,null)})},error:function(a){h.error(a)}})})};Xf=function(a,c,l){b(l,function(){function k(a){b(l,function(){a instanceof B&&(a.setEntity(A),a.setEntity(E),
a.setUser(w),a.setUser(n),a.setMessageId(p));throw a;})}var A=c.masterToken,E=c.entityAuthenticationData,w=c.userIdToken,n=c.userAuthenticationData,p=c.messageId,y=g(p);d(a,c,E,A,{result:function(d){b(l,function(){var g=d?d.keyResponseData.masterToken:g=A;a.getEntityAuthenticationData(null,{result:function(m){b(l,function(){f(a,c,g,{result:function(f){b(l,function(){w=f;var b=Ue(c.messageCapabilities,a.getMessageCapabilities()),h=c.keyResponseData,l=c.serviceTokens;return a.isPeerToPeer()?new Qd(a,
y,b,m,h?h.masterToken:c.peerMasterToken,c.peerUserIdToken,c.peerServiceTokens,A,w,l,d):new Qd(a,y,b,m,h?h.masterToken:A,w,l,null,null,null,d)})},error:k})})},error:k})})},error:k})})};Xe=function(a,c,d,f,h){b(h,function(){a.getEntityAuthenticationData(null,{result:function(l){b(h,function(){var b;if(c!=x&&null!=c)b=g(c);else{var k=a.getRandom();do b=k.nextInt();while(0>b||b>Ha)}Nf(a,l,b,d.responseCode,d.internalCode,d.message,f,h)})},error:function(a){h.error(a)}})})};Qd=ea.Class.create({init:function(a,
b,c,d,f,h,l,g,k,m,t){if(!a.isPeerToPeer()&&(g||k))throw new W("Cannot set peer master token or peer user ID token when not in peer-to-peer mode.");var fa;fa=t&&!a.isPeerToPeer()?t.keyResponseData.masterToken:f;var w={};a.getMslStore().getServiceTokens(fa,h).forEach(function(a){w[a.name]=a},this);l&&l.forEach(function(a){w[a.name]=a},this);var n,p,da={};a.isPeerToPeer()&&(n=g,p=k,l=t?t.keyResponseData.masterToken:g,a.getMslStore().getServiceTokens(l,k).forEach(function(a){da[a.name]=a},this),m&&m.forEach(function(a){da[a.name]=
a},this));Object.defineProperties(this,{_ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},_entityAuthData:{value:d,writable:!1,enumerable:!1,configurable:!1},_masterToken:{value:f,writable:!0,enumerable:!1,configurable:!1},_messageId:{value:b,writable:!1,enumerable:!1,configurable:!1},_capabilities:{value:c,writable:!1,enumerable:!1,configurable:!1},_keyExchangeData:{value:t,writable:!1,enumerable:!1,configurable:!1},_nonReplayable:{value:!1,writable:!0,enumerable:!1,configurable:!1},_renewable:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_keyRequestData:{value:{},writable:!1,enumerable:!1,configurable:!1},_userAuthData:{value:null,writable:!0,enumerable:!1,configurable:!1},_userIdToken:{value:h,writable:!0,enumerable:!1,configurable:!1},_serviceTokens:{value:w,writable:!1,enumerable:!1,configurable:!1},_peerMasterToken:{value:n,writable:!0,enumerable:!1,configurable:!1},_peerUserIdToken:{value:p,writable:!0,enumerable:!1,configurable:!1},_peerServiceTokens:{value:da,writable:!1,enumerable:!1,
configurable:!1}})},getMessageId:function(){return this._messageId},getMasterToken:function(){return this._masterToken},getUserIdToken:function(){return this._userIdToken},getKeyExchangeData:function(){return this._keyExchangeData},willEncryptHeader:function(){return this._masterToken||qa(this._entityAuthData.scheme)},willEncryptPayloads:function(){return this._masterToken||!this._ctx.isPeerToPeer()&&this._keyExchangeData||qa(this._entityAuthData.scheme)},willIntegrityProtectHeader:function(){return this._masterToken||
Za(this._entityAuthData.scheme)},willIntegrityProtectPayloads:function(){return this._masterToken||!this._ctx.isPeerToPeer()&&this._keyExchangeData||Za(this._entityAuthData.scheme)},getHeader:function(c){b(c,function(){var b=this._keyExchangeData?this._keyExchangeData.keyResponseData:null,d=[],f;for(f in this._serviceTokens)d.push(this._serviceTokens[f]);var h=[],l;for(l in this._keyRequestData)h.push(this._keyRequestData[l]);if(this._nonReplayable){if(!this._masterToken)throw new Aa(a.NONREPLAYABLE_MESSAGE_REQUIRES_MASTERTOKEN);
l=this._ctx.getMslStore().getNonReplayableId(this._masterToken)}else l=null;b=new Rf(this._messageId,l,this._renewable,this._capabilities,h,b,this._userAuthData,this._userIdToken,d);d=[];for(f in this._peerServiceTokens)d.push(this._peerServiceTokens[f]);f=new Sf(this._peerMasterToken,this._peerUserIdToken,d);Qf(this._ctx,this._entityAuthData,this._masterToken,b,f,c)},this)},isNonReplayable:function(){return this._nonReplayable},setNonReplayable:function(a){this._nonReplayable=a;return this},isRenewable:function(){return this._renewable},
setRenewable:function(a){this._renewable=a;return this},setAuthTokens:function(a,b){if(b&&!b.isBoundTo(a))throw new W("User ID token must be bound to master token.");if(this._keyExchangeData&&!this._ctx.isPeerToPeer())throw new W("Attempt to set message builder master token when key exchange data exists as a trusted network server.");var c;try{c=this._ctx.getMslStore().getServiceTokens(a,b)}catch(d){if(d instanceof B)throw new W("Invalid master token and user ID token combination despite checking above.",
d);throw d;}var f=[],h;for(h in this._serviceTokens)f.push(this._serviceTokens[h]);f.forEach(function(c){(c.isUserIdTokenBound()&&!c.isBoundTo(b)||c.isMasterTokenBound()&&!c.isBoundTo(a))&&delete this._serviceTokens[c.name]},this);c.forEach(function(a){this._serviceTokens[a.name]=a},this);this._masterToken=a;this._userIdToken=b},setUserAuthenticationData:function(a){this._userAuthData=a;return this},setCustomer:function(a,c){var d=this;b(c,function(){if(!this._ctx.isPeerToPeer()&&null!=this._userIdToken||
this._ctx.isPeerToPeer()&&null!=this._peerUserIdToken)throw new W("User ID token or peer user ID token already exists for the remote user.");var f;f=this._keyExchangeData?this._keyExchangeData.keyResponseData.masterToken:this._ctx.isPeerToPeer()?this._peerMasterToken:this._masterToken;if(!f)throw new W("User ID token or peer user ID token cannot be created because no corresponding master token exists.");this._ctx.getTokenFactory().createUserIdToken(this._ctx,a,f,{result:function(a){b(c,function(){this._ctx.isPeerToPeer()?
this._peerUserIdToken=a:(this._userIdToken=a,this._userAuthData=null);return!0},d)},error:function(a){c.error(a)}})},d)},addKeyRequestData:function(a){this._keyRequestData[a.uniqueKey()]=a;return this},removeKeyRequestData:function(a){delete this._keyRequestData[a.uniqueKey()];return this},addServiceToken:function(b){var c;c=this._keyExchangeData&&!this._ctx.isPeerToPeer()?this._keyExchangeData.keyResponseData.masterToken:this._masterToken;if(b.isMasterTokenBound()&&!b.isBoundTo(c))throw(new Aa(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,
"st "+JSON.stringify(b)+"; mt "+JSON.stringify(c))).setEntity(c);if(b.isUserIdTokenBound()&&!b.isBoundTo(this._userIdToken))throw(new Aa(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; uit "+JSON.stringify(this._userIdToken))).setEntity(c).setUser(this._userIdToken);this._serviceTokens[b.name]=b;return this},addServiceTokenIfAbsent:function(a){this._serviceTokens[a.name]||this.addServiceToken(a);return this},excludeServiceToken:function(a){delete this._serviceTokens[a];return this},
deleteServiceToken:function(a,c){var d=this;b(c,function(){var f=this._serviceTokens[a];if(!f)return this;var h=f.isMasterTokenBound()?this._masterToken:null,f=f.isUserIdTokenBound()?this._userIdToken:null;sc(this._ctx,a,l,h,f,!1,null,new dd,{result:function(a){b(c,function(){return this.addServiceToken(a)},d)},error:function(a){a instanceof B&&(a=new W("Failed to create and add empty service token to message.",a));c.error(a)}})},d)},getServiceTokens:function(){var a=[],b;for(b in this._serviceTokens)a.push(this._serviceTokens[b]);
return a},getPeerMasterToken:function(){return this._peerMasterToken},getPeerUserIdToken:function(){return this._peerUserIdToken},setPeerAuthTokens:function(b,c){if(!this._ctx.isPeerToPeer())throw new W("Cannot set peer master token or peer user ID token when not in peer-to-peer mode.");if(c&&!b)throw new W("Peer master token cannot be null when setting peer user ID token.");if(c&&!c.isBoundTo(b))throw(new Aa(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit "+c+"; mt "+b)).setEntity(b).setUser(c);var d;try{d=
this._ctx.getMslStore().getServiceTokens(b,c)}catch(f){if(f instanceof B)throw new W("Invalid peer master token and user ID token combination despite proper check.",f);throw f;}Object.keys(this._peerServiceTokens).forEach(function(a){var d=this._peerServiceTokens[a];d.isUserIdTokenBound()&&!d.isBoundTo(c)?delete this._peerServiceTokens[a]:d.isMasterTokenBound()&&!d.isBoundTo(b)&&delete this._peerServiceTokens[a]},this);d.forEach(function(a){var b=a.name;this._peerServiceTokens[b]||(this._peerServiceTokens[b]=
a)},this);this._peerUserIdToken=c;this._peerMasterToken=b;return this},addPeerServiceToken:function(b){if(!this._ctx.isPeerToPeer())throw new W("Cannot set peer service tokens when not in peer-to-peer mode.");if(b.isMasterTokenBound()&&!b.isBoundTo(this._peerMasterToken))throw(new Aa(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,"st "+JSON.stringify(b)+"; mt "+JSON.stringify(this._peerMasterToken))).setEntity(this._peerMasterToken);if(b.isUserIdTokenBound()&&!b.isBoundTo(this._peerUserIdToken))throw(new Aa(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,
"st "+JSON.stringify(b)+"; uit "+JSON.stringify(this._peerUserIdToken))).setEntity(this._peerMasterToken).setUser(this._peerUserIdToken);this._peerServiceTokens[b.name]=b;return this},addPeerServiceTokenIfAbsent:function(a){this._peerServiceTokens[a.name]||this.addPeerServiceToken(a);return this},excludePeerServiceToken:function(a){delete this._peerServiceTokens[a];return this},deletePeerServiceToken:function(a,c){var d=this;b(c,function(){var f=this._peerServiceTokens[a];if(!f)return this;var h=
f.isMasterTokenBound()?this._peerMasterToken:null,f=f.isUserIdTokenBound()?this._peerUserIdToken:null;sc(this._ctx,a,l,h,f,!1,null,new dd,{result:function(a){b(c,function(){return this.addPeerServiceToken(a)},d)},error:function(a){a instanceof B&&(a=new W("Failed to create and add empty peer service token to message.",a));c.error(a)}})},d)},getPeerServiceTokens:function(){var a=[],b;for(b in this._peerServiceTokens)a.push(this._peerServiceTokens[b]);return a}})})();var Rd;(function(){function a(b,
c){return c[b]?c[b]:c[""]}function c(a){var b=a.builder.getKeyExchangeData();return b&&!a.ctx.isPeerToPeer()?b.keyResponseData.masterToken:a.builder.getMasterToken()}Rd=ea.Class.create({init:function(a,b,c){a={ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},cryptoContexts:{value:b.getCryptoContexts(),writable:!1,enumerable:!1,configurable:!1},builder:{value:c,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},isPrimaryMasterTokenAvailable:function(){return c(this)?
!0:!1},isPrimaryUserIdTokenAvailable:function(){return this.builder.getUserIdToken()?!0:!1},isPeerMasterTokenAvailable:function(){return this.builder.getPeerMasterToken()?!0:!1},isPeerUserIdTokenAvailable:function(){return this.builder.getPeerUserIdToken()?!0:!1},getPrimaryServiceTokens:function(){return this.builder.getServiceTokens()},getPeerServiceTokens:function(){return this.builder.getPeerServiceTokens()},addPrimaryServiceToken:function(a){try{return this.builder.addServiceToken(a),!0}catch(b){if(b instanceof
Aa)return!1;throw b;}},addPeerServiceToken:function(a){try{return this.builder.addPeerServiceToken(a),!0}catch(b){if(b instanceof Aa)return!1;throw b;}},addUnboundPrimaryServiceToken:function(c,d,f,g,k){var m=this;b(k,function(){var K=a(c,this.cryptoContexts);if(!K)return!1;sc(this.ctx,c,d,null,null,f,g,K,{result:function(a){b(k,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof Aa)throw new W("Service token bound to incorrect authentication tokens despite being unbound.",b);
throw b;}return!0},m)},error:function(a){k.error(a)}})},m)},addUnboundPeerServiceToken:function(c,d,f,g,k){var m=this;b(k,function(){var K=a(c,this.cryptoContexts);if(!K)return!1;sc(this.ctx,c,d,null,null,f,g,K,{result:function(a){b(k,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof Aa)throw new W("Service token bound to incorrect authentication tokens despite being unbound.",b);throw b;}return!0},m)},error:function(a){k.error(a)}})},m)},addMasterBoundPrimaryServiceToken:function(d,
f,g,k,J){var n=this;b(J,function(){var K=c(this);if(!K)return!1;var A=a(d,this.cryptoContexts);if(!A)return!1;sc(this.ctx,d,f,K,null,g,k,A,{result:function(a){b(J,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof Aa)throw new W("Service token bound to incorrect authentication tokens despite setting correct master token.",b);throw b;}return!0},n)},error:function(a){J.error(a)}})},n)},addMasterBoundPeerServiceToken:function(c,d,f,g,k){var m=this;b(k,function(){var K=this.builder.getPeerMasterToken();
if(!K)return!1;var A=a(c,this.cryptoContexts);if(!A)return!1;sc(this.ctx,c,d,K,null,f,g,A,{result:function(a){b(k,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof Aa)throw new W("Service token bound to incorrect authentication tokens despite setting correct master token.",b);throw b;}return!0},m)},error:function(a){k.error(a)}})},m)},addUserBoundPrimaryServiceToken:function(d,f,g,k,J){var n=this;b(J,function(){var K=c(this);if(!K)return!1;var A=this.builder.getUserIdToken();
if(!A)return!1;var E=a(d,this.cryptoContexts);if(!E)return!1;sc(this.ctx,d,f,K,A,g,k,E,{result:function(a){b(J,function(){try{this.builder.addServiceToken(a)}catch(b){if(b instanceof Aa)throw new W("Service token bound to incorrect authentication tokens despite setting correct master token and user ID token.",b);throw b;}return!0},n)},error:function(a){J.error(a)}})},n)},addUserBoundPeerServiceToken:function(c,d,f,g,k){var m=this;b(k,function(){var n=this.builder.getPeerMasterToken();if(!n)return!1;
var A=this.builder.getPeerUserIdToken();if(!A)return!1;var E=a(c,this.cryptoContexts);if(!E)return!1;sc(this.ctx,c,d,n,A,f,g,E,{result:function(a){b(k,function(){try{this.builder.addPeerServiceToken(a)}catch(b){if(b instanceof Aa)throw new W("Service token bound to incorrect authentication tokens despite setting correct master token and user ID token.",b);throw b;}return!0},m)},error:function(a){k.error(a)}})},m)},excludePrimaryServiceToken:function(a){for(var b=this.builder.getServiceTokens(),c=
0;c<b.length;++c)if(b[c].name==a)return this.builder.excludeServiceToken(a),!0;return!1},excludePeerServiceToken:function(a){for(var b=this.builder.getPeerServiceTokens(),c=0;c<b.length;++c)if(b[c].name==a)return this.builder.excludePeerServiceToken(a),!0;return!1},deletePrimaryServiceToken:function(a,c){b(c,function(){for(var b=this.builder.getServiceTokens(),d=0;d<b.length;++d)if(b[d].name==a){this.builder.deleteServiceToken(a,{result:function(){c.result(!0)},error:function(a){c.error(a)}});return}return!1},
this)},deletePeerServiceToken:function(a,c){b(c,function(){for(var b=this.builder.getPeerServiceTokens(),d=0;d<b.length;++d)if(b[d].name==a){this.builder.deletePeerServiceToken(a,{result:function(){c.result(!0)},error:function(a){c.error(a)}});return}return!1},this)}})})();var Yf,te;(function(){function c(d,f,l,g){b(g,function(){function c(){b(g,function(){if(p>=l.length){if(E)throw E;throw new Ra(a.KEYX_RESPONSE_REQUEST_MISMATCH,JSON.stringify(l));}var f=l[p];n!=f.keyExchangeScheme?(++p,c()):A.getCryptoContext(d,
f,w,k,{result:g.result,error:function(a){b(g,function(){if(!(a instanceof B))throw a;E=a;++p;c()})}})})}var k=f.masterToken,w=f.keyResponseData;if(!w)return null;var n=w.keyExchangeScheme,A=d.getKeyExchangeFactory(n);if(!A)throw new Ra(a.KEYX_FACTORY_NOT_FOUND,n);var E,p=0;c()})}Yf=Me.extend({init:function(b,d,f,k,r,n,ka){var K=this;g(ka,function(){function g(){K._ready=!0;K._readyQueue.add(!0)}function E(a,b){try{var c=b.masterToken;a.getTokenFactory().isMasterTokenRevoked(a,c,{result:function(d){d?
(K._errored=(new oc(d,c)).setUser(b.userIdToken).setUser(b.userAuthenticationData).setMessageId(b.messageId),g()):ka(a,b)},error:function(a){a instanceof B&&(a.setEntity(b.masterToken),a.setUser(b.userIdToken),a.setUser(b.userAuthenticationData),a.setMessageId(b.messageId));K._errored=a;g()}})}catch(d){d instanceof B&&(d.setEntity(b.masterToken),d.setUser(b.userIdToken),d.setUser(b.userAuthenticationData),d.setMessageId(b.messageId)),K._errored=d,g()}}function ka(a,b){try{var c=b.masterToken,d=b.userIdToken;
d?a.getTokenFactory().isUserIdTokenRevoked(a,c,d,{result:function(f){f?(K._errored=(new MslUserIdTokenException(f,d)).setEntity(c).setUser(d).setMessageId(b.messageId),g()):p(a,b)},error:function(a){a instanceof B&&(a.setEntity(b.masterToken),a.setUser(b.userIdToken),a.setUser(b.userAuthenticationData),a.setMessageId(b.messageId));K._errored=a;g()}}):p(a,b)}catch(f){f instanceof B&&(f.setEntity(b.masterToken),f.setUser(b.userIdToken),f.setUser(b.userAuthenticationData),f.setMessageId(b.messageId)),
K._errored=f,g()}}function p(b,c){try{var d=c.masterToken;d.isExpired()?c.isRenewable()&&0!=c.keyRequestData.length?b.getTokenFactory().isMasterTokenRenewable(b,d,{result:function(a){a?(K._errored=(new Aa(a,"Master token is expired and not renewable.")).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),g()):y(b,c)},error:function(a){a instanceof B&&(a.setEntity(c.masterToken),a.setUser(c.userIdToken),a.setUser(c.userAuthenticationData),a.setMessageId(c.messageId));
K._errored=a;g()}}):(K._errored=(new Aa(a.MESSAGE_EXPIRED,JSON.stringify(c))).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),g()):y(b,c)}catch(f){f instanceof B&&(f.setEntity(c.masterToken),f.setUser(c.userIdToken),f.setUser(c.userAuthenticationData),f.setMessageId(c.messageId)),K._errored=f,g()}}function y(b,c){try{var d=c.masterToken,f=c.nonReplayableId;"number"===typeof f?d?b.getTokenFactory().acceptNonReplayableId(b,d,f,{result:function(b){b||(K._errored=
(new Aa(a.MESSAGE_REPLAYED,JSON.stringify(c))).setEntity(d).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId));g()},error:function(a){a instanceof B&&(a.setEntity(d),a.setUser(c.userIdToken),a.setUser(c.userAuthenticationData),a.setMessageId(c.messageId));K._errored=a;g()}}):(K._errored=(new Aa(a.INCOMPLETE_NONREPLAYABLE_MESSAGE,JSON.stringify(c))).setEntity(c.entityAuthenticationData).setUser(c.userIdToken).setUser(c.userAuthenticationData).setMessageId(c.messageId),
g()):g()}catch(h){h instanceof B&&(h.setEntity(c.masterToken),h.setEntity(c.entityAuthenticationData),h.setUser(c.userIdToken),h.setUser(c.userAuthenticationData),h.setMessageId(c.messageId)),K._errored=h,g()}}var L={_source:{value:d,writable:!1,enumerable:!1,configurable:!1},_parser:{value:x,writable:!0,enumerable:!1,configurable:!1},_charset:{value:f,writable:!1,enumerable:!1,configurable:!1},_remainingData:{value:"",writable:!0,enumerable:!1,configurable:!1},_timeout:{value:n,writable:!1,enumerable:!1,
configurable:!1},_header:{value:x,writable:!0,enumerable:!1,configurable:!1},_cryptoContext:{value:x,writable:!0,enumerable:!1,configurable:!1},_keyxCryptoContext:{value:x,writable:!0,enumerable:!1,configurable:!1},_payloadSequenceNumber:{value:1,writable:!0,enuemrable:!1,configurable:!1},_eom:{value:!1,writable:!0,enumerable:!1,configurable:!1},_closeSource:{value:!1,writable:!0,enumerable:!1,configurable:!1},_payloads:{value:[],writable:!0,enumerable:!1,configurable:!1},_payloadIndex:{value:-1,
writable:!0,enumerable:!1,configurable:!1},_payloadOffset:{value:0,writable:!0,enuemrable:!1,configurable:!1},_markOffset:{value:0,writable:!0,enumerable:!1,configurable:!1},_currentPayload:{value:null,writable:!0,enumerable:!1,configurable:!1},_readException:{value:null,writable:!0,enumerable:!1,configurable:!1},_ready:{value:!1,writable:!0,enumerable:!1,configurable:!1},_readyQueue:{value:new Ga,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},
_timedout:{value:!1,writable:!0,enumerable:!1,configurable:!1},_errored:{value:null,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,L);Ff(K._source,n,{result:function(d){K._json=d;K._jsonIndex=0;null===K._json?(K._errored=new Z(a.MESSAGE_DATA_MISSING),g()):me(b,K._json[K._jsonIndex++],r,{result:function(a){K._header=a;if(K._header instanceof Zc)K._keyxCryptoContext=null,K._cryptoContext=null,g();else{var d=K._header;c(b,d,k,{result:function(a){try{K._keyxCryptoContext=a;b.isPeerToPeer()||
!K._keyxCryptoContext?K._cryptoContext=d.cryptoContext:K._cryptoContext=K._keyxCryptoContext;try{var c=d.masterToken;c&&(b.isPeerToPeer()||c.isVerified())?E(b,d):y(b,d)}catch(f){f instanceof B&&(f.setEntity(d.masterToken),f.setUser(d.userIdToken),f.setUser(d.userAuthenticationData),f.setMessageId(d.messageId)),K._errored=f,g()}}catch(h){h instanceof B&&(h.setEntity(d.masterToken),h.setEntity(d.entityAuthenticationData),h.setUser(d.userIdToken),h.setUser(d.userAuthenticationData),h.setMessageId(d.messageId)),
K._errored=h,g()}},error:function(a){a instanceof B&&(a.setEntity(d.masterToken),a.setEntity(d.entityAuthenticationData),a.setUser(d.userIdToken),a.setUser(d.userAuthenticationData),a.setMessageId(d.messageId));K._errored=a;g()}})}},error:function(a){K._errored=a;g()}})},timeout:function(){K._timedout=!0;g()},error:function(a){K._errored=a;g()}});return this},K)},nextData:function(b,c){var d=this;g(c,function(){function b(a){g(a,function(){var c;if(this._jsonIndex<this._json.length)return c=this._json[this._jsonIndex++];
Ff(this._source,this._timeout,{result:function(c){c&&c.length&&0<c.length?(c.forEach(function(a){this._json.push(a)}),b(a)):(this._eom=!0,a.result(null))},timeout:function(){a.timeout()},error:function(b){a.error(b)}})},d)}var f=this.getMessageHeader();if(!f)throw new W("Read attempted with error message.");if(-1!=this._payloadIndex&&this._payloadIndex<this._payloads.length)return this._payloads[this._payloadIndex++];if(this._eom)return null;b({result:function(b){g(c,function(){if(!b)return null;
if("object"!==typeof b)throw new Z(a.MESSAGE_FORMAT_ERROR);We(b,this._cryptoContext,{result:function(b){g(c,function(){var c=f.masterToken,d=f.entityAuthenticationData,h=f.userIdToken,g=f.getUserAuthenticationData;if(b.messageId!=f.messageId)throw(new Aa(a.PAYLOAD_MESSAGE_ID_MISMATCH,"payload mid "+b.messageId+" header mid "+f.messageId)).setEntity(c).setEntity(d).setUser(h).setUser(g);if(b.sequenceNumber!=this._payloadSequenceNumber)throw(new Aa(a.PAYLOAD_SEQUENCE_NUMBER_MISMATCH,"payload seqno "+
b.sequenceNumber+" expected seqno "+this._payloadSequenceNumber)).setEntity(c).setEntity(d).setUser(h).setUser(g);++this._payloadSequenceNumber;b.isEndOfMessage()&&(this._eom=!0);c=b.data;this._payloads.push(c);this._payloadIndex=-1;return c},d)},error:function(b){b instanceof SyntaxError&&(b=new Z(a.JSON_PARSE_ERROR,"payloadchunk",b));c.error(b)}})},d)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},d)},isReady:function(a,b){function c(){g(b,function(){if(this._aborted)return!1;
if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;return!0}},d)}var d=this;g(b,function(){this._ready?c():this._readyQueue.poll(a,{result:function(a){g(b,function(){if(a===x)return!1;c()},d)},timeout:function(){b.timeout()},error:function(a){b.error(a)}})},d)},getMessageHeader:function(){return this._header instanceof Pd?this._header:null},getErrorHeader:function(){return this._header instanceof Zc?this._header:null},getIdentity:function(){var a=this.getMessageHeader();if(a){var b=
a.masterToken;return b?b.identity:a.entityAuthenticationData.getIdentity()}return this.getErrorHeader().entityAuthenticationData.getIdentity()},getCustomer:function(){var a=this.getMessageHeader();return a?a.customer:null},getPayloadCryptoContext:function(){return this._cryptoContext},getKeyExchangeCryptoContext:function(){return this._keyxCryptoContext},closeSource:function(a){this._closeSource=a},abort:function(){this._aborted=!0;this._source.abort();this._readyQueue.cancelAll()},close:function(){this._closeSource&&
this._source.close()},mark:function(){if(this._currentPayload){for(;0<this._payloads.length&&this._payloads[0]!==this._currentPayload;)this._payloads.shift();this._payloadIndex=0;this._currentPayload=this._payloads[this._payloadIndex++];this._markOffset=this._payloadOffset}else this._payloadIndex=-1,this._payloads=[]},markSupported:function(){return!0},read:function(a,b,c){function d(){g(c,function(){function d(c){g(c,function(){if(t&&w>=t.length)return t.subarray(0,w);var l=-1;if(this._currentPayload){var k=
this._currentPayload.length-this._payloadOffset;if(!t){var p=k;if(-1!=this._payloadIndex)for(var ka=this._payloadIndex;ka<this._payloads.length;++ka)p+=this._payloads[ka].length;0<p&&(t=new Uint8Array(p))}k=Math.min(k,t?t.length-w:0);0<k&&(l=this._currentPayload.subarray(this._payloadOffset,this._payloadOffset+k),t.set(l,n),l=k,n+=k,this._payloadOffset+=k)}-1!=l?(w+=l,d(c)):this.nextData(b,{result:function(b){g(c,function(){if(this._aborted)return t?t.subarray(0,w):new Uint8Array(0);this._currentPayload=
b;this._payloadOffset=0;if(this._currentPayload)d(c);else return 0==w&&0!=a?null:t?t.subarray(0,w):new Uint8Array(0)},f)},timeout:function(){c.timeout(t?t.subarray(0,w):new Uint8Array(0))},error:function(a){g(c,function(){a instanceof B&&(a=new ob("Error reading the payload chunk.",a));if(0<w)return f._readException=a,t.subarray(0,w);throw a;},f)}})},f)}if(this._aborted)return new Uint8Array(0);if(this._timedout)c.timeout(new Uint8Array(0));else{if(this._errored)throw this._errored;if(null!=this._readException){var k=
this._readException;this._readException=null;throw k;}var t=-1!=a?new Uint8Array(a):x,n=0,w=0;d(c)}},f)}var f=this;g(c,function(){if(-1>a)throw new RangeError("read requested with illegal length "+a);this._ready?d():this._readyQueue.poll(b,{result:function(a){a===x?c.result(!1):d()},timeout:function(){c.timeout(new Uint8Array(0))},error:function(a){c.error(a)}})},f)},reset:function(){this._payloadIndex=0;0<this._payloads.length?(this._currentPayload=this._payloads[this._payloadIndex++],this._payloadOffset=
this._markOffset):this._currentPayload=null}});te=function(a,b,c,d,f,g,k){new Yf(a,b,c,d,f,g,k)}})();var Zf,Sd;(function(){Zf=ke.extend({init:function(a,b,c,d,f,k,n){var p=this;g(n,function(){function g(){p._ready=!0;p._readyQueue.add(!0)}var n=Ue(a.getMessageCapabilities(),d.messageCapabilities),J=null;n&&(J=Hd(n.compressionAlgorithms));n={_destination:{value:b,writable:!1,enumerable:!1,configurable:!1},_charset:{value:c,writable:!1,enumerable:!1,configurable:!1},_capabilities:{value:n,writable:!1,
enumerable:!1,configurable:!1},_header:{value:d,writable:!1,enumerable:!1,configurable:!1},_compressionAlgo:{value:J,writable:!0,enumerable:!1,configurable:!1},_cryptoContext:{value:f,writable:!1,enumerable:!1,configurable:!1},_payloadSequenceNumber:{value:1,writable:!0,enumerable:!1,configurable:!1},_currentPayload:{value:[],writable:!0,enumerable:!1,configurable:!1},_closed:{value:!1,writable:!0,enumerable:!1,configurable:!1},_payloads:{value:[],writable:!1,enumerable:!1,configurable:!1},_ready:{value:!1,
writable:!0,enumerable:!1,configurable:!1},_readyQueue:{value:new Ga,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_timedout:{value:!1,writable:!0,enumerable:!1,configurable:!1},_errored:{value:null,writable:!0,enumerable:!1,configurable:!1}};Object.defineProperties(this,n);var ma=S(JSON.stringify(d),c);b.write(ma,0,ma.length,k,{result:function(a){try{p._aborted?g():a<ma.length?(p._timedout=!0,g()):b.flush(k,{result:function(a){p._aborted||
(p._timedout=!a);g()},timeout:function(){p._timedout=!0;g()},error:function(a){p._errored=a;g()}})}catch(c){p._errored=c,g()}},timeout:function(){p._timedout=!0;g()},error:function(a){p._errored=a;g()}});return this},p)},setCompressionAlgorithm:function(a,b,c){function d(){f.flush(b,{result:function(b){g(c,function(){if(!b)throw new ob("flush() aborted");this._compressionAlgo=a;return!0},f)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})}var f=this;g(c,function(){if(!this.getMessageHeader())throw new W("Cannot write payload data for an error message.");
if(this._compressionAlgo==a)return!0;if(a){if(!this._capabilities)return!1;for(var b=this._capabilities.compressionAlgorithms,c=0;c<b.length;++c)if(b[c]==a){d();return}return!1}d()},f)},getMessageHeader:function(){return this._header instanceof Pd?this._header:null},getErrorMessage:function(){return this._header instanceof Zc?this._header:null},getPayloads:function(){return this._payloads},abort:function(){this._aborted=!0;this._destination.abort();this._readyQueue.cancelAll()},close:function(a,b){var c=
this;g(b,function(){if(this._aborted)return!1;if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;if(this._closed)return!0;this._closed=!0;this.flush(a,{result:function(a){g(b,function(){a&&(this._currentPayload=null);return a},c)},timeout:function(){b.timeout()},error:function(a){b.error(a)}})}},c)},flush:function(a,b){function c(){g(b,function(){if(this._aborted)return!1;if(this._timedout)b.timeout();else{if(this._errored)throw this._errored;if(!this._currentPayload||!this._closed&&
0==this._currentPayload.length)return!0;var c=this.getMessageHeader();if(!c)return!0;var f=0;this._currentPayload&&this._currentPayload.forEach(function(a){f+=a.length});for(var h=new Uint8Array(f),k=0,n=0;this._currentPayload&&n<this._currentPayload.length;++n){var A=this._currentPayload[n];h.set(A,k);k+=A.length}Wf(this._payloadSequenceNumber,c.messageId,this._closed,this._compressionAlgo,h,this._cryptoContext,{result:function(c){g(b,function(){this._payloads.push(c);var f=S(JSON.stringify(c),this._charset);
this._destination.write(f,0,f.length,a,{result:function(f){g(b,function(){if(this._aborted)return!1;f<c.length?b.timeout():this._destination.flush(a,{result:function(a){g(b,function(){if(this._aborted)return!1;if(a)return++this._payloadSequenceNumber,this._currentPayload=this._closed?null:[],!0;b.timeout()},d)},timeout:function(){b.timeout()},error:function(a){a instanceof B&&(a=new ob("Error encoding payload chunk [sequence number "+d._payloadSequenceNumber+"].",a));b.error(a)}})},d)},timeout:function(a){b.timeout()},
error:function(a){a instanceof B&&(a=new ob("Error encoding payload chunk [sequence number "+d._payloadSequenceNumber+"].",a));b.error(a)}})},d)},error:function(a){a instanceof B&&(a=new ob("Error encoding payload chunk [sequence number "+d._payloadSequenceNumber+"].",a));b.error(a)}})}},d)}var d=this;g(b,function(){this._ready?c():this._readyQueue.poll(a,{result:function(a){a===x?b.result(!1):c()},timeout:function(){b.timeout()},error:function(a){b.error(a)}})},d)},write:function(a,b,c,d,f){g(f,
function(){if(this._aborted)return!1;if(this._timedout)f.timeout();else{if(this._errored)throw this._errored;if(this._closed)throw new ob("Message output stream already closed.");if(0>b)throw new RangeError("Offset cannot be negative.");if(0>c)throw new RangeError("Length cannot be negative.");if(b+c>a.length)throw new RangeError("Offset plus length cannot be greater than the array length.");if(!this.getMessageHeader())throw new W("Cannot write payload data for an error message.");var d=a.subarray(b,
b+c);this._currentPayload.push(d);return d.length}},this)}});Sd=function(a,b,c,d,f,g,k){new Zf(a,b,c,d,f,g,k)}})();var $f=ea.Class.create({sentHeader:function(a){},receivedHeader:function(a){}});Object.freeze({USERDATA_REAUTH:d.USERDATA_REAUTH,SSOTOKEN_REJECTED:d.SSOTOKEN_REJECTED});var ag=ea.Class.create({getCryptoContexts:function(){},getRecipient:function(){},isEncrypted:function(){},isIntegrityProtected:function(){},isNonReplayable:function(){},isRequestingTokens:function(){},getUserId:function(){},
getUserAuthData:function(a,b,c,d){},getCustomer:function(){},getKeyRequestData:function(a){},updateServiceTokens:function(a,b,c){},write:function(a,b,c){},getDebugContext:function(){}});ea.Class.create({getInputStream:function(a){},getOutputStream:function(a){}});var Ye;(function(){function c(a){return function(){a.abort()}}function f(a,b){Object.defineProperties(this,{masterToken:{value:a,writable:!1,configurable:!1},ticket:{value:b,writable:!1,configurable:!1}})}function h(a,b){Object.defineProperties(this,
{builder:{value:a,writable:!1,configurable:!1},msgCtx:{value:b,writable:!1,configurable:!1}})}function l(a,b,c){Object.defineProperties(this,{requestHeader:{value:a,writable:!1,configurable:!1},payloads:{value:b,writable:!1,configurable:!1},handshake:{value:c,writable:!1,configurable:!1}})}function k(a,b){Object.defineProperties(this,{requestHeader:{value:b.requestHeader,writable:!1,configurable:!1},payloads:{value:b.payloads,writable:!1,configurable:!1},handshake:{value:b.handshake,writable:!1,configurable:!1},
response:{value:a,writable:!1,configurable:!1}})}function r(a){for(;a;){if(a instanceof sb)return!0;a=a instanceof B?a.cause:x}return!1}function n(a,b,c,d,f,h,l,k,m){Xe(b,d,f,h,{result:function(d){c&&c.sentHeader(d);Sd(b,l,na,d,null,null,k,{result:function(b){a.setAbort(function(){b.abort()});b.close(k,{result:function(a){g(m,function(){if(!a)throw new sb("sendError aborted.");return a})},timeout:function(){m.timeout()},error:function(a){m.error(a)}})},timeout:function(){},error:function(a){m.error(a)}})},
error:function(a){m.error(a)}})}var p=ke.extend({close:function(a,b){b.result(!0)},write:function(a,c,d,f,g){b(g,function(){return Math.min(a.length-c,d)})},flush:function(a,b){b.result(!0)}}),K=Of.extend({getUserMessage:function(a,b){return null}}),A=ag.extend({init:function(a){Object.defineProperties(this,{_appCtx:{value:a,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContexts:function(){return this._appCtx.getCryptoContexts()},isEncrypted:function(){return this._appCtx.isEncrypted()},
isIntegrityProtected:function(){return this._appCtx.isIntegrityProtected()},isNonReplayable:function(){return this._appCtx.isNonReplayable()},isRequestingTokens:function(){return this._appCtx.isRequestingTokens()},getUserId:function(){return this._appCtx.getUserId()},getUserAuthData:function(a,b,c,d){this._appCtx.getUserAuthData(a,b,c,d)},getCustomer:function(){return this._appCtx.getCustomer()},getKeyRequestData:function(a){this._appCtx.getKeyRequestData(a)},updateServiceTokens:function(a,b,c){this._appCtx.updateServiceTokens(a,
b,c)},write:function(a,b,c){this._appCtx.write(a,b,c)},getDebugContext:function(){return this._appCtx.getDebugContext()}}),E=A.extend({init:function da(a,b){da.base.call(this,b);Object.defineProperties(this,{_payloads:{value:a,writable:!1,enumerable:!1,configurable:!1}})},write:function(a,b,c){function d(h,l){if(h==f._payloads.length)c.result(!0);else{var k=f._payloads[h];a.setCompressionAlgorithm(k.compressionAlgo,b,{result:function(m){a.write(k.data,0,k.data.length,b,{result:function(m){g(c,function(){k.isEndOfMessage()?
d(h+1,l):a.flush(b,{result:function(a){c.result(a)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},f)},timeout:function(a){c.timeout(a)},error:function(a){c.error(a)}})},timeout:function(){},error:function(a){c.error(a)}})}}var f=this;d(0)}}),ma=A.extend({init:function La(a){La.base.call(this,a)},isEncrypted:function(){return!1},isNonReplayable:function(){return!1},write:function(a,b,c){c.result(!0)}}),y={},L,O,la,fa,S=ea.Class.create({init:function(a){a||(a=new K);Object.defineProperties(this,
{_filterFactory:{value:null,writable:!0,enumerable:!1,configurable:!1},_renewingContexts:{value:[],writable:!1,enumerable:!1,configurable:!1},_masterTokenLocks:{value:{},writable:!1,enumerable:!1,configurable:!1},_messageRegistry:{value:a,writable:!1,enumerable:!1,configurable:!1}})},setFilterFactory:function(a){this._filterFactory=a},getNewestMasterToken:function(a,b,c,d){var h=this;g(d,function(){var l=b.getMslStore(),k=l.getMasterToken();if(!k)return null;var t=k.uniqueKey(),n=this._masterTokenLocks[t];
n||(n=new Fc,this._masterTokenLocks[t]=n);var r=n.readLock(c,{result:function(r){g(d,function(){if(r===x)throw new sb("getNewestMasterToken aborted.");var w=l.getMasterToken();if(k.equals(w))return new f(k,r);n.unlock(r);n.writeLock(c,{result:function(f){g(d,function(){if(f===x)throw new sb("getNewestMasterToken aborted.");delete this._masterTokenLocks[t];n.unlock(f);return this.getNewestMasterToken(a,b,c,d)},h)},timeout:function(){d.timeout()},error:function(a){d.error(a)}})},h)},timeout:function(){d.timeout()},
error:function(a){d.error(a)}});a.setAbort(function(){r&&(n.cancel(r),r=x)})},h)},deleteMasterToken:function(a,b){if(b){var c=this;setTimeout(function(){var d=b.uniqueKey(),f=c._masterTokenLocks[d];f||(f=new Fc,c._masterTokenLocks[d]=f);f.writeLock(-1,{result:function(g){a.getMslStore().removeCryptoContext(b);delete c._masterTokenLocks[d];f.unlock(g)},timeout:function(){throw new W("Unexpected timeout received.");},error:function(a){throw a;}})},0)}},releaseMasterToken:function(a){if(a&&a.masterToken){var b=
a.masterToken.uniqueKey(),b=this._masterTokenLocks[b];if(!b)throw new W("Master token read/write lock does not exist when it should.");b.unlock(a.ticket)}},updateOutgoingCryptoContexts:function(a,b,c){var d=a.getMslStore();!a.isPeerToPeer()&&c&&(d.setCryptoContext(c.keyResponseData.masterToken,c.cryptoContext),this.deleteMasterToken(a,b.masterToken))},updateIncomingCryptoContexts:function(a,b,c){var d=c.getMessageHeader();if(d){var f=a.getMslStore();if(d=d.keyResponseData)f.setCryptoContext(d.masterToken,
c.getKeyExchangeCryptoContext()),this.deleteMasterToken(a,b.masterToken)}},storeServiceTokens:function(a,b,c,d){a=a.getMslStore();for(var f=[],g=0;g<d.length;++g){var h=d[g];if(!h.isBoundTo(b)||!b.isVerified()){var l=h.data;l&&0==l.length?a.removeServiceTokens(h.name,h.isMasterTokenBound()?b:null,h.isUserIdTokenBound()?c:null):f.push(h)}}0<f.length&&a.addServiceTokens(f)},buildRequest:function(a,c,d,f,g){var h=this;this.getNewestMasterToken(a,c,f,{result:function(a){b(g,function(){var f=a&&a.masterToken,
l;if(f){l=d.getUserId();var k=c.getMslStore();l=(l=l?k.getUserIdToken(l):null)&&l.isBoundTo(f)?l:null}else l=null;id(c,f,l,null,{result:function(c){b(g,function(){c.setNonReplayable(d.isNonReplayable());return{builder:c,tokenTicket:a}})},error:function(c){b(g,function(){this.releaseMasterToken(a);c instanceof B&&(c=new W("User ID token not bound to master token despite internal check.",c));throw c;},h)}})},h)},timeout:function(){g.timeout()},error:function(a){g.error(a)}})},buildResponse:function(a,
b,c,d,f,h){var l=this;Xf(b,d,{result:function(k){g(h,function(){k.setNonReplayable(c.isNonReplayable());if(!b.isPeerToPeer()&&!d.keyResponseData)return{builder:k,tokenTicket:null};this.getNewestMasterToken(a,b,f,{result:function(a){g(h,function(){var d=a&&a.masterToken,f;if(d){f=c.getUserId();var g=b.getMslStore();f=(f=f?g.getUserIdToken(f):null)&&f.isBoundTo(d)?f:null}else f=null;k.setAuthTokens(d,f);return{builder:k,tokenTicket:a}},l)},timeout:function(){h.timeout()},error:function(a){h.error(a)}})},
l)},error:function(a){h.error(a)}})},buildErrorResponse:function(a,b,c,f,l,k,m){function t(a,d){g(m,function(){var f=hd(l.messageId),k=new E(d,c);id(b,null,null,f,{result:function(c){g(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(a.peerMasterToken,a.peerUserIdToken);c.setNonReplayable(k.isNonReplayable());return{errorResult:new h(c,k),tokenTicket:null}},r)},error:function(a){m.error(a)}})},r)}function n(d,f){r.getNewestMasterToken(a,b,k,{result:function(a){g(m,function(){var k=a&&a.masterToken,
t=hd(l.messageId),n=new E(f,c);id(b,k,null,t,{result:function(c){g(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(d.peerMasterToken,d.peerUserIdToken);c.setNonReplayable(n.isNonReplayable());return{errorResult:new h(c,n),tokenTicket:a}},r)},error:function(a){m.error(a)}})},r)},timeout:function(){m.timeout()},error:function(a){m.error(a)}})}var r=this;g(m,function(){var w=f.requestHeader,A=f.payloads,p=l.errorCode;switch(p){case d.ENTITYDATA_REAUTH:case d.ENTITY_REAUTH:b.getEntityAuthenticationData(p,
{result:function(a){g(m,function(){if(!a)return null;t(w,A)},r)},error:function(a){m.error(a)}});break;case d.USERDATA_REAUTH:case d.SSOTOKEN_REJECTED:c.getUserAuthData(p,!1,!0,{result:function(a){g(m,function(){if(!a)return null;n(w,A)},r)},error:function(a){m.error(a)}});break;case d.USER_REAUTH:n(w,A);break;case d.KEYX_REQUIRED:var p=hd(l.messageId),J=new E(A,c);id(b,null,null,p,{result:function(a){g(m,function(){b.isPeerToPeer()&&a.setPeerAuthTokens(w.peerMasterToken,w.peerUserIdToken);a.setRenewable(!0);
a.setNonReplayable(J.isNonReplayable());return{errorResult:new h(a,J),tokenTicket:null}},r)},error:function(a){m.error(a)}});break;case d.EXPIRED:this.getNewestMasterToken(a,b,k,{result:function(a){g(m,function(){var d=a&&a.masterToken,f=w.userIdToken,k=hd(l.messageId),t=new E(A,c);id(b,d,f,k,{result:function(c){g(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(w.peerMasterToken,w.peerUserIdToken);w.masterToken.equals(d)&&c.setRenewable(!0);c.setNonReplayable(t.isNonReplayable());return{errorResult:new h(c,
t),tokenTicket:a}},r)},error:function(a){m.error(a)}},r)},r)},timeout:function(){m.timeout()},error:function(a){m.error(a)}});break;case d.REPLAYED:this.getNewestMasterToken(a,b,k,{result:function(a){g(m,function(){var d=a&&a.masterToken,f=w.userIdToken,k=hd(l.messageId),t=new E(A,c);id(b,d,f,k,{result:function(c){g(m,function(){b.isPeerToPeer()&&c.setPeerAuthTokens(w.peerMasterToken,w.peerUserIdToken);w.masterToken.equals(d)?(c.setRenewable(!0),c.setNonReplayable(!1)):c.setNonReplayable(t.isNonReplayable());
return{errorResult:new h(c,t),tokenTicket:a}},r)},error:function(a){m.error(a)}})},r)},timeout:function(){m.timeout()},error:function(a){m.error(a)}});break;default:return null}},r)},cleanupContext:function(a,b,c){switch(c.errorCode){case d.ENTITY_REAUTH:this.deleteMasterToken(a,b.masterToken);break;case d.USER_REAUTH:c=b.userIdToken,b.masterToken&&c&&a.getMslStore().removeUserIdToken(c)}},send:function(a,b,c,d,f,h,k){function m(a,d,h){g(k,function(){var l=f.getPeerUserIdToken();!b.isPeerToPeer()&&
!d||b.isPeerToPeer()&&!l?(l=c.getCustomer())?f.setCustomer(l,{result:function(b){g(k,function(){d=f.getUserIdToken();t(a,d,h)},A)},error:function(a){k.error(a)}}):t(a,d,h):t(a,d,h)},A)}function t(a,b,d){g(k,function(){var h=!d&&(!c.isEncrypted()||f.willEncryptPayloads())&&(!c.isIntegrityProtected()||f.willIntegrityProtectPayloads())&&(!c.isNonReplayable()||f.isNonReplayable()&&a);h||f.setNonReplayable(!1);var l=[];f.isRenewable()&&(!a||a.isRenewable()||c.isNonReplayable())?c.getKeyRequestData({result:function(c){g(k,
function(){for(var d=0;d<c.length;++d){var g=c[d];l.push(g);f.addKeyRequestData(g)}r(a,b,h,l)},A)},error:function(a){k.error(a)}}):r(a,b,h,l)},A)}function r(l,m,t,w){g(k,function(){var r=new Rd(b,c,f);c.updateServiceTokens(r,!t,{result:function(r){f.getHeader({result:function(r){g(k,function(){var g=c.getDebugContext();g&&g.sentHeader(r);g=f.getKeyExchangeData();this.updateOutgoingCryptoContexts(b,r,g);this.storeServiceTokens(b,l,m,r.serviceTokens);g=!b.isPeerToPeer()&&g?g.cryptoContext:r.cryptoContext;
if(a.isAborted())throw new sb("send aborted.");var w=null!=this._filterFactory?this._filterFactory.getOutputStream(d):d;Sd(b,w,na,r,g,h,{result:function(b){a.setAbort(function(){b.abort()});n(b,r,t)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},A)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},error:function(a){k.error(a)}})},A)}function n(d,f,l){if(l)c.write(d,h,{result:function(b){g(k,function(){if(a.isAborted())throw new sb("MessageOutputStream write aborted.");
w(d,f,l)},A)},timeout:function(){k.timeout()},error:function(a){k.error(a)}});else{var m=new p,t=new dd;Sd(b,m,na,f,t,h,{result:function(b){c.write(b,h,{result:function(c){g(k,function(){if(a.isAborted())throw new sb("MessageOutputStream proxy write aborted.");b.close(h,{result:function(a){g(k,function(){if(!a)throw new sb("MessageOutputStream proxy close aborted.");var c=b.getPayloads();w(d,f,l,c)},A)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})},A)},timeout:function(){k.timeout()},
error:function(a){k.error(a)}})},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}}function w(a,b,c,d){a.close(h,{result:function(f){g(k,function(){if(!f)throw new sb("MessageOutputStream close aborted.");d||(d=a.getPayloads());return new l(b,d,!c)},A)},timeout:function(){k.timeout()},error:function(a){k.error(a)}})}var A=this;g(k,function(){var a=f.getMasterToken(),b=f.getUserIdToken(),d=!1;if(c.getUserId()){var h=!b;c.getUserAuthData(null,f.isRenewable(),h,{result:function(c){g(k,
function(){c&&(f.willEncryptHeader()&&f.willIntegrityProtectHeader()?f.setUserAuthenticationData(c):d=!0);m(a,b,d)},A)},error:function(a){k.error(a)}})}else m(a,b,d)},A)},receive:function(b,c,f,h,l,k,m){var t=this;g(m,function(){if(b.isAborted())throw new sb("receive aborted.");var r=[];l&&(r=l.keyRequestData.filter(function(){return!0}));var n=f.getCryptoContexts(),w=this._filterFactory?this._filterFactory.getInputStream(h):h;te(c,w,na,r,n,k,{result:function(h){b.setAbort(function(){h.abort()});
h.isReady(k,{result:function(b){g(m,function(){if(!b)throw new sb("MessageInputStream aborted.");var k=h.getMessageHeader(),r=h.getErrorHeader(),n=f.getDebugContext();n&&n.receivedHeader(k?k:r);if(l&&(n=r?r.errorCode:null,k||n!=d.FAIL&&n!=d.TRANSIENT_FAILURE&&n!=d.ENTITY_REAUTH&&n!=d.ENTITYDATA_REAUTH)){var n=k?k.messageId:r.messageId,w=hd(l.messageId);if(n!=w)throw new Aa(a.UNEXPECTED_RESPONSE_MESSAGE_ID,"expected "+w+"; received "+n);}c.getEntityAuthenticationData(null,{result:function(b){g(m,function(){var d=
b.getIdentity(),g;if(k){g=k.entityAuthenticationData;var m=k.masterToken;g=m?k.sender:g.getIdentity();if(m&&m.isDecrypted()&&m.identity!=g||d==g)throw new Aa(a.UNEXPECTED_MESSAGE_SENDER,g);l&&this.updateIncomingCryptoContexts(c,l,h);d=k.keyResponseData;c.isPeerToPeer()?(d=d?d.masterToken:k.peerMasterToken,m=k.peerUserIdToken,g=k.peerServiceTokens):(d=d?d.masterToken:k.masterToken,m=k.userIdToken,g=k.serviceTokens);var t=f.getUserId();t&&m&&!m.isVerified()&&c.getMslStore().addUserIdToken(t,m);this.storeServiceTokens(c,
d,m,g)}else if(g=r.entityAuthenticationData.getIdentity(),d==g)throw new Aa(a.UNEXPECTED_MESSAGE_SENDER,g);return h},t)},error:m.error})},t)},timeout:function(){m.timeout()},error:function(a){m.error(a)}})},timeout:function(){m.timeout()},error:function(a){m.error(a)}})},t)},sendReceive:function(a,b,c,d,f,h,l,m,r){function n(A,p){g(r,function(){h.setRenewable(p);this.send(a,b,c,f,h,l,{result:function(f){g(r,function(){var h=f.requestHeader.keyRequestData;m||f.handshake||!h.isEmpty()?this.receive(a,
b,c,d,f.requestHeader,l,{result:function(a){g(r,function(){p&&this.releaseRenewalLock(b,A,a);return new k(a,f)},w)},timeout:function(){g(r,function(){p&&this.releaseRenewalLock(b,A,null);r.timeout()},w)},error:function(a){g(r,function(){p&&this.releaseRenewalLock(b,A,null);throw a;},w)}}):g(r,function(){p&&this.releaseRenewalLock(b,A,null);return new k(null,f)},w)},w)},timeout:function(){g(r,function(){p&&this.releaseRenewalLock(b,A,null);r.timeout()},w)},error:function(a){g(r,function(){p&&this.releaseRenewalLock(b,
A,null);throw a;},w)}})},w)}var w=this;g(r,function(){var d=new Ga;this.acquireRenewalLock(a,b,c,d,h,l,{result:function(a){n(d,a)},timeout:function(){r.timeout()},error:function(a){a instanceof sb?r.result(null):r.error(a)}})},w)},acquireRenewalLock:function(a,b,c,d,f,h,l){function k(r,n,w){g(l,function(){if(a.isAborted())throw new sb("acquireRenewalLock aborted.");for(var A=null,p=0;p<this._renewingContexts.length;++p){var J=this._renewingContexts[p];if(J.ctx===b){A=J.queue;break}}if(!A)return this._renewingContexts.push({ctx:b,
queue:d}),!0;var K=A.poll(h,{result:function(a){g(l,function(){if(a===x)throw new sb("acquireRenewalLock aborted.");A.add(a);if(a===y||a.isExpired())k(a,n,w);else{if(w&&!n||n&&!n.isBoundTo(a)){var d=b.getMslStore().getUserIdToken(w);n=d&&d.isBoundTo(a)?d:null}f.setAuthTokens(a,n);f.isRenewable()&&a.equals(r)?k(a,n,w):c.isRequestingTokens()&&!n?k(a,n,w):m(a,n)}},t)},timeout:function(){},error:function(a){}});a.setAbort(function(){K&&(A.cancel(K),K=x)})},t)}function m(f,h){g(l,function(){if(a.isAborted())throw new sb("acquireRenewalLock aborted.");
if(!f||f.isRenewable()||!h&&c.getUserId()||h&&h.isRenewable()){for(var g=null,l=0;l<this._renewingContexts.length;++l){var k=this._renewingContexts[l];if(k.ctx===b){g=k.queue;break}}if(!g)return this._renewingContexts.push({ctx:b,queue:d}),!0}return!1},t)}var t=this;g(l,function(){var a=f.getMasterToken(),b=f.getUserIdToken(),d=c.getUserId();c.isEncrypted()&&!f.willEncryptPayloads()||c.isIntegrityProtected()&&!f.willIntegrityProtectPayloads()||f.isRenewable()||!a&&c.isNonReplayable()||a&&a.isExpired()||
!(b||!d||f.willEncryptHeader()&&f.willIntegrityProtectHeader())||c.isRequestingTokens()&&(!a||d&&!b)?k(a,b,d):m(a,b)},t)},releaseRenewalLock:function(a,b,c){for(var d,f,h=0;h<this._renewingContexts.length;++h){var g=this._renewingContexts[h];if(g.ctx===a){d=h;f=g.queue;break}}if(f!==b)throw new W("Attempt to release renewal lock that is not owned by this queue.");c?(c=c.messageHeader)?(f=c.keyResponseData)?b.add(f.masterToken):(a=a.isPeerToPeer()?c.peerMasterToken:c.masterToken)?b.add(a):b.add(y):
b.add(y):b.add(y);this._renewingContexts.splice(d,1)}});Ye=ea.Class.create({init:function(){var a={_impl:{value:new S,writable:!1,enumerable:!1,configurable:!1},_shutdown:{value:!1,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},setFilterFactory:function(a){this._impl.setFilterFactory(a)},shutdown:function(){this._shutdown=!0},receive:function(a,b,d,f,h,g){if(this._shutdown)throw new B("MslControl is shutdown.");var l=new L(this._impl,a,b,d,f,h);setTimeout(function(){l.call(g)},
0);return c(l)},respond:function(a,b,d,f,h,g,l){if(this._shutdown)throw new B("MslControl is shutdown.");var k=new O(this._impl,a,b,d,f,h,g);setTimeout(function(){k.call(l)},0);return c(k)},error:function(a,b,d,f,h,g,l){if(this._shutdown)throw new B("MslControl is shutdown.");var k=new la(this._impl,a,b,d,f,h,g);setTimeout(function(){k.call(l)},0);return c(k)},request:function(a,b){if(this._shutdown)throw new B("MslControl is shutdown.");var d,f,h,g,l;if(5==arguments.length){if(d=arguments[2],h=f=
null,g=arguments[3],l=arguments[4],a.isPeerToPeer()){l.error(new W("This method cannot be used in peer-to-peer mode."));return}}else if(6==arguments.length&&(d=null,f=arguments[2],h=arguments[3],g=arguments[4],l=arguments[5],!a.isPeerToPeer())){l.error(new W("This method cannot be used in trusted network mode."));return}var k=new fa(this._impl,a,b,d,f,h,null,0,g);setTimeout(function(){k.call(l)},0);return c(k)}});L=ea.Class.create({init:function(a,b,c,d,f,h){Object.defineProperties(this,{_ctrl:{value:a,
writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_input:{value:d,writable:!1,enumerable:!1,configurable:!1},_output:{value:f,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:h,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:x,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},
abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},call:function(b){function c(f){g(b,function(){var c=f.messageHeader;if(!c)return f;this.setAbort(function(){f.abort()});f.mark(Number.MAX_VALUE);f.read(1,h._timeout,{result:function(a){g(b,function(){if(a&&0==a.length)return null;if(a)return f.reset(),f;d(f)},h)},timeout:function(){b.timeout()},error:function(d){g(b,function(){if(r(d))return null;var f=c?c.messageId:null,l,k;d instanceof
ob?(l=a.MSL_COMMS_FAILURE,k=d):(l=a.INTERNAL_EXCEPTION,k=new W("Error peeking into the message payloads."));n(this,this._ctx,this._msgCtx.getDebugContext(),f,l,null,this._output,this._timeout,{result:function(a){b.error(k)},timeout:function(){b.timeout()},error:function(a){g(b,function(){if(r(a))return null;throw new Bb("Error peeking into the message payloads.",a,d);},h)}})},h)}})},h)}function d(c){g(b,function(){c.close();this._ctrl.buildResponse(this,this._ctx,this._msgCtx,c.messageHeader,this._timeout,
{result:function(a){g(b,function(){var d=a.builder,h=a.tokenTicket,g=c.messageHeader,l=new ma(this._msgCtx);if(!this._ctx.isPeerToPeer()||g.isEncrypting()||g.keyResponseData)f(g,d,l,h);else{var k=new fa(this._ctrl,this._ctx,l,null,this._input,this._output,a,1,this._timeout);this.setAbort(function(){k.abort()});k.call(b)}},h)},timeout:function(){b.timeout()},error:function(d){g(b,function(){if(r(d))return null;var f,l,k,m;d instanceof B?(f=d.messageId,l=d.error,k=c.messageHeader.messageCapabilities,
k=this._ctrl.messageRegistry.getUserMessage(l,k?k.languages:null),m=d):(f=requestHeader?requestHeader.messageId:null,l=a.INTERNAL_EXCEPTION,k=null,m=new W("Error creating an automatic handshake response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),f,l,k,this._output,this._timeout,{result:function(a){b.error(m)},timeout:function(){b.timeout()},error:function(a){g(b,function(){if(r(a))return null;throw new Bb("Error creating an automatic handshake response.",a,d);},h)}})},h)}})},h)}function f(c,
d,l,k){g(b,function(){d.setRenewable(!1);this._ctrl.send(this._ctx,l,this._output,d,this._timeout,{result:function(a){g(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(k);return null},h)},timeout:function(){g(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(k);b.timeout()},h)},error:function(d){g(b,function(){this._ctx.isPeerToPeer()&&this._ctrl.releaseMasterToken(k);if(r(d))return null;var f,l,m,t;d instanceof B?(f=d.messageId,l=d.error,m=c?c.messageCapabilities:
null,m=this._ctrl.messageRegistry.getUserMessage(l,m?m.languages:null),t=d):d instanceof ob?(f=c?c.messageId:null,l=a.MSL_COMMS_FAILURE,m=null,t=d):(f=c?c.messageId:null,l=a.INTERNAL_EXCEPTION,m=null,t=new W("Error sending an automatic handshake response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),f,l,m,this._output,this._timeout,{result:function(a){b.error(t)},timeout:function(){b.timeout()},error:function(a){g(b,function(){if(r(a))return null;throw new Bb("Error sending an automatic handshake response.",
a,d);},h)}})},h)}})},h)}var h=this;g(b,function(){this._ctrl.receive(this,this._ctx,this._msgCtx,this._input,null,this._timeout,{result:function(a){c(a)},timeout:function(){b.timeout()},error:function(c){g(b,function(){if(r(c))return null;var d,f,l,k;c instanceof B?(d=c.messageId,f=c.error,l=this._ctrl.messageRegistry.getUserMessage(f,null),k=c):(d=null,f=a.INTERNAL_EXCEPTION,l=null,k=new W("Error receiving the message header.",c));n(this,this._ctx,this._msgCtx.getDebugContext(),d,f,l,this._output,
this._timeout,{result:function(a){b.error(k)},timeout:function(){b.timeout()},error:function(a){g(b,function(){if(r(a))return null;throw new Bb("Error receiving the message header.",a,c);},h)}})},h)}})},h)}});O=ea.Class.create({init:function(a,b,c,d,f,h,g){Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_input:{value:d,writable:!1,enumerable:!1,
configurable:!1},_output:{value:f,writable:!1,enumerable:!1,configurable:!1},_request:{value:h,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:g,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:x,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},trustedNetworkExecute:function(b,
c,d){var f=this;g(d,function(){if(12<c+1)return!1;var h;if(h=this._msgCtx.isIntegrityProtected()&&!b.willIntegrityProtectHeader()?a.RESPONSE_REQUIRES_INTEGRITY_PROTECTION:this._msgCtx.isEncrypted()&&!b.willEncryptPayloads()?a.RESPONSE_REQUIRES_ENCRYPTION:null){var l=xd(b.getMessageId());n(this,this._ctx,this._msgCtx.getDebugContext(),l,h,null,this._output,this._timeout,{result:function(a){d.result(!1)},timeout:function(){d.timeout()},error:function(a){g(d,function(){if(r(a))return!1;throw new Bb("Response requires encryption or integrity protection but cannot be protected: "+
h,a,null);},f)}})}else!this._msgCtx.getCustomer()||b.getMasterToken()||b.getKeyExchangeData()?(b.setRenewable(!1),this._ctrl.send(this._ctx,this._msgCtx,this._output,b,this._timeout,{result:function(a){d.result(!0)},timeout:function(){d.timeout()},error:function(a){d.error(a)}})):(l=xd(b.getMessageId()),n(this,this._ctx,this._msgCtx.getDebugContext(),l,a.RESPONSE_REQUIRES_MASTERTOKEN,null,this._output,this._timeout,{result:function(a){d.result(!1)},timeout:function(){d.timeout()},error:function(a){g(d,
function(){if(r(a))return!1;throw new Bb("Response wishes to attach a user ID token but there is no master token.",a,null);},f)}}))},f)},peerToPeerExecute:function(b,c,d,f){function h(a){g(f,function(){var c=a.response;c.close();c=c.getErrorHeader();this._ctrl.cleanupContext(this._ctx,a.requestHeader,c);this._ctrl.buildErrorResponse(this,this._ctx,b,a,c,{result:function(a){g(f,function(){if(!a)return!1;var b=a.errorResult,c=a.tokenTicket;this.peerToPeerExecute(b.msgCtx,b.builder,d,{result:function(a){g(f,
function(){this._ctrl.releaseMasterToken(c);return a},l)},timeout:function(){g(f,function(){this._ctrl.releaseMasterToken(c);f.timeout()},l)},error:function(a){g(f,function(){this._ctrl.releaseMasterToken(c);throw a;},l)}})},l)}})},l)}var l=this;g(f,function(){if(12<d+2)return!1;if(null!=b.getCustomer()&&null==c.getPeerMasterToken()&&null==c.getKeyExchangeData()){var k=xd(c.getMessageId());n(this,this._ctx,b.getDebugContext(),k,a.RESPONSE_REQUIRES_MASTERTOKEN,null,this._output,this._timeout,{result:function(a){f.result(!1)},
timeout:function(){f.timeout()},error:function(a){g(f,function(){if(r(a))return!1;throw new Bb("Response wishes to attach a user ID token but there is no master token.",a,null);},l)}})}else this._ctrl.sendReceive(this._ctx,b,this._input,this._output,c,this._timeout,!1,{result:function(a){g(f,function(){function c(){m.read(32768,l._timeout,{result:function(a){g(f,function(){a?c():k()},l)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}function k(){g(f,function(){var c=new E(a.payloads,
b);this._ctrl.buildResponse(this,this._ctx,c,t,this._timeout,{result:function(a){g(f,function(){var b=a.tokenTicket;this.peerToPeerExecute(c,a.builder,d,{result:function(a){g(f,function(){this._ctrl.releaseMasterToken(b);return a},l)},timeout:function(){g(f,function(){this._ctrl.releaseMasterToken(b);f.timeout()},l)},error:function(a){g(f,function(){this._ctrl.releaseMasterToken(b);throw a;},l)}})},l)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},l)}var m=a.response;d+=2;if(!m)return!0;
var t=m.getMessageHeader();if(t){var r=a.payloads,r=0<r.length&&0<r[0].data.length;if(a.handshake&&r)c();else return!0}else h(a)},l)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},l)},call:function(b){var c=this;this._ctrl.buildResponse(this,this._ctx,this._msgCtx,this._request,this._timeout,{result:function(d){g(b,function(){var f=d.builder,h=d.tokenTicket;this._ctx.isPeerToPeer()?this.peerToPeerExecute(this._msgCtx,f,3,{result:function(a){g(b,function(){this._ctx.isPeerToPeer()&&
this.releaseMasterToken(h);return a},c)},timeout:function(){g(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);b.timeout()},c)},error:function(d){g(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);if(r(d))return!1;var l=xd(f.getMessageId()),k,m,t;d instanceof B?(k=d.error,m=this._request.messageCapabilities,m=this._ctrl.messageRegistry.getUserMessage(k,m?m.languages:null),t=d):d instanceof ob?(k=a.MSL_COMMS_FAILURE,m=null,t=d):(k=a.INTERNAL_EXCEPTION,m=null,t=new W("Error sending the response.",
d));n(this,this._ctx,this._msgCtx.getDebugContext(),l,k,m,this._output,this._timeout,{result:function(a){b.error(t)},timeout:function(){b.timeout()},error:function(a){g(b,function(){if(r(a))return!1;throw new Bb("Error sending the response.",a,null);},c)}})},c)}}):this.trustedNetworkExecute(f,3,{result:function(a){g(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);return a},c)},timeout:function(){g(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);b.timeout()},c)},
error:function(d){g(b,function(){this._ctx.isPeerToPeer()&&this.releaseMasterToken(h);if(r(d))return!1;var l=xd(f.getMessageId()),k,m,t;d instanceof B?(k=d.error,m=this._request.messageCapabilities,m=this._ctrl.messageRegistry.getUserMessage(k,m?m.languages:null),t=d):d instanceof ob?(k=a.MSL_COMMS_FAILURE,m=null,t=d):(k=a.INTERNAL_EXCEPTION,m=null,t=new W("Error sending the response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),l,k,m,this._output,this._timeout,{result:function(a){b.error(t)},
timeout:function(){b.timeout()},error:function(a){g(b,function(){if(r(a))return!1;throw new Bb("Error sending the response.",a,null);},c)}})},c)}})},c)},timeout:function(){b.timeout()},error:function(d){g(b,function(){if(r(d))return!1;var f,h,l,k;d instanceof B?(f=d.messageId,h=d.error,l=this._request.messageCapabilities,l=this._ctrl.messageRegistry.getUserMessage(h,l?l.languages:null),k=d):(f=null,h=a.INTERNAL_EXCEPTION,l=null,k=new W("Error building the response.",d));n(this,this._ctx,this._msgCtx.getDebugContext(),
f,h,l,this._output,this._timeout,{result:function(a){b.error(k)},timeout:function(){b.timeout()},error:function(a){g(b,function(){if(r(a))return null;throw new Bb("Error building the response.",a,d);},c)}})},c)}})}});la=ea.Class.create({init:function(a,b,c,d,f,h,g){Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_appError:{value:d,writable:!1,
enumerable:!1,configurable:!1},_output:{value:output,writable:!1,enumerable:!1,configurable:!1},_request:{value:h,writable:!1,enumerable:!1,configurable:!1},_timeout:{value:g,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:x,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=
a},call:function(b){var c=this;g(b,function(){var d;if(this._appError==ENTITY_REJECTED)d=this._request.masterToken?a.MASTERTOKEN_REJECTED_BY_APP:a.ENTITY_REJECTED_BY_APP;else if(this._appError==USER_REJECTED)d=this._request.userIdToken?a.USERIDTOKEN_REJECTED_BY_APP:a.USER_REJECTED_BY_APP;else throw new W("Unhandled application error "+this._appError+".");var f=this._request.messageCapabilities,f=this._ctrl.messageRegistry.getUserMessage(d,f?f.languages:null);n(this,this._ctx,this._msgCtx.getDebugContext(),
this._request.messageId,d,f,this._output,this._timeout,{result:function(a){b.result(a)},timeout:b.timeout,error:function(a){g(b,function(){if(r(a))return!1;if(a instanceof B)throw a;throw new W("Error building the error response.",a);},c)}})},c)}});var sa={result:function(){},timeout:function(){},error:function(){}};fa=ea.Class.create({init:function(a,b,c,d,f,h,g,l,k){var m;g?(m=g.builder,g=g.tokenTicket):g=m=null;Object.defineProperties(this,{_ctrl:{value:a,writable:!1,enumerable:!1,configurable:!1},
_ctx:{value:b,writable:!1,enumerable:!1,configurable:!1},_msgCtx:{value:c,writable:!1,enumerable:!1,configurable:!1},_remoteEntity:{value:d,writable:!1,enumerable:!1,configurable:!1},_input:{value:f,writable:!0,enumerable:!1,configurable:!1},_output:{value:h,writable:!0,enumerable:!1,configurable:!1},_openedStreams:{value:!1,writable:!0,enumerable:!1,configurable:!1},_builder:{value:m,writable:!0,enumerable:!1,configurable:!1},_tokenTicket:{value:g,writable:!0,enumerable:!1,configurable:!1},_timeout:{value:k,
writable:!1,enumerable:!1,configurable:!1},_msgCount:{value:l,writable:!1,enumerable:!1,configurable:!1},_aborted:{value:!1,writable:!0,enumerable:!1,configurable:!1},_abortFunc:{value:x,writable:!0,enumerable:!1,configurable:!1}})},isAborted:function(){return this._aborted},abort:function(){this._aborted=!0;this._abortFunc&&this._abortFunc.call(this)},setAbort:function(a){this._abortFunc=a},execute:function(a,b,c,d,f){function h(b){function l(a){g(f,function(){var c=b.response;return a?a:c},k)}g(f,
function(){var h=b.response;h.close();var m=h.getErrorHeader();this._ctrl.cleanupContext(this._ctx,b.requestHeader,m);this._ctrl.buildErrorResponse(this,this._ctx,a,b,m,c,{result:function(a){g(f,function(){if(!a)return h;var b=a.errorResult,m=a.tokenTicket,t=b.builder,b=b.msgCtx;if(this._ctx.isPeerToPeer())this.execute(b,t,this._timeout,d,{result:function(a){g(f,function(){this._ctrl.releaseMasterToken(m);l(a)},k)},timeout:function(){g(f,function(){this._ctrl.releaseMasterToken(m);f.timeout()},k)},
error:function(a){g(f,function(){this._ctrl.releaseMasterToken(m);f.error(a)},k)}});else{this._openedStreams&&(this._input.close(),this._output.close(c,sa));var r=new fa(this._ctrl,this._ctx,b,this._remoteEntity,null,null,{builder:t,tokenTicket:m},d,this._timeout);this.setAbort(function(){r.abort()});r.call({result:function(a){l(a)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},k)}function l(b){g(f,function(){function h(){m.read(32768,
k._timeout,{result:function(a){a?h():l()},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}function l(){g(f,function(){var h=new E(b.payloads,a);this._ctrl.buildResponse(this,this._ctx,a,t,c,{result:function(a){g(f,function(){var b=a.tokenTicket;this.execute(h,a.builder,this._timeout,d,{result:function(a){g(f,function(){this._ctrl.releaseMasterToken(b);return a},k)},timeout:function(){g(f,function(){this._ctrl.releaseMasterToken(b);f.timeout()},k)},error:function(a){g(f,function(){this._ctrl.releaseMasterToken(b);
throw a;},k)}})},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})},k)}var m=b.response,t=m.getMessageHeader(),r=b.payloads,r=0<r.length&&0<r[0].data.length;if(!this._ctx.isPeerToPeer()){if(!b.handshake||!r)return m;this._openedStreams&&(this._input.close(),this._output.close(c,sa));var n=new E(b.payloads,a);this._ctrl.buildResponse(this,this._ctx,a,t,c,{result:function(a){g(f,function(){var b=new fa(this._ctrl,this._ctx,n,this._remoteEntity,null,null,a,d,this._timeout);this.setAbort(function(){b.abort()});
b.call(f)},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}else if(b.handshake&&r)h();else if(0<t.keyRequestData.length){var w=new ma(a);this._ctrl.buildResponse(this,this._ctx,w,t,c,{result:function(a){g(f,function(){var b=a.builder,c=a.tokenTicket;m.mark();m.read(1,this._timeout,{result:function(a){g(f,function(){function h(){m.read(32768,k._timeout,{result:function(a){a?h():l()},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}function l(){k.execute(w,b,k._timeout,
d,{result:function(a){g(f,function(){this._ctrl.releaseMasterToken(c);return a},k)},timeout:function(){g(f,function(){this._ctrl.releaseMasterToken(c);f.timeout()},k)},error:function(a){g(f,function(){this._ctrl.releaseMasterToken(c);throw a;},k)}})}if(a)if(m.reset(),12>=d+1)b.setRenewable(!1),this._ctrl.send(this,this._ctx,w,this._output,b,this._timeout,{result:function(a){g(f,function(){this.releaseMasterToken(c);return m},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}});else return this.releaseMasterToken(c),
m;else h()},k)},timeout:function(){g(f,function(){this.releaseMasterToken(c);f.timeout()},k)},error:function(a){g(f,function(){this.releaseMasterToken(c);throw a;},k)}})},k)},timeout:function(){f.timeout()},error:function(a){f.error(a)}})}},k)}var k=this;g(f,function(){if(12<d+2)return null;this._ctrl.sendReceive(this,this._ctx,a,this._input,this._output,b,c,!0,{result:function(a){g(f,function(){if(!a)return null;var b=a.response;d+=2;b.getMessageHeader()?l(a):h(a)},k)},timeout:function(){f.timeout()},
error:function(a){f.error(a)}})},k)},call:function(a){function b(d,f,h){g(a,function(){this.execute(this._msgCtx,d,h,this._msgCount,{result:function(b){g(a,function(){this._ctrl.releaseMasterToken(f);this._openedStreams&&this._output.close(h,sa);b&&b.closeSource(this._openedStreams);return b},c)},timeout:function(){g(a,function(){this._ctrl.releaseMasterToken(f);this._openedStreams&&(this._output.close(h,sa),this._input.close());a.timeout()},c)},error:function(b){g(a,function(){this._ctrl.releaseMasterToken(f);
this._openedStreams&&(this._output.close(h,sa),this._input.close());if(r(b))return null;throw b;},c)}})},c)}var c=this;g(a,function(){var d=this._timeout;if(!this._input||!this._output)try{this._remoteEntity.setTimeout(this._timeout);var f=Date.now(),h=this._remoteEntity.openConnection();this._output=h.output;this._input=h.input;-1!=d&&(d=this._timeout-(Date.now()-f));this._openedStreams=!0}catch(l){this._builder&&this._ctrl.releaseMasterToken(this._tokenTicket);this._output&&this._output.close(this._timeout,
sa);this._input&&this._input.close();if(r(l))return null;throw l;}this._builder?b(this._builder,this._tokenTicket,d):this._ctrl.buildRequest(this,this._ctx,this._msgCtx,this._timeout,{result:function(f){g(a,function(){b(f.builder,f.tokenTicket,d)},c)},timeout:function(){g(a,function(){this._openedStreams&&(this._output.close(this._timeout,sa),this._input.close());a.timeout()},c)},error:function(b){g(a,function(){this._openedStreams&&(this._output.close(this._timeout,sa),this._input.close());if(r(b))return null;
throw b;},c)}})},c)}})})();var jd,Ze;(function(){jd=ea.Class.create({init:function(a){Object.defineProperties(this,{id:{value:a,writable:!1,configurable:!1}})},toJSON:function(){var a={};a.id=this.id;return a},equals:function(a){return this===a?!0:a instanceof jd?this.id==a.id:!1},uniqueKey:function(){return this.id}});Ze=function(b){var c=b.id;if(!c)throw new Z(a.JSON_PARSE_ERROR,JSON.stringify(b));return new jd(c)}})();ea.Class.create({isNewestMasterToken:function(a,b,c){},isMasterTokenRevoked:function(a,
b){},acceptNonReplayableId:function(a,b,c,d){},createMasterToken:function(a,b,c,d,f){},isMasterTokenRenewable:function(a,b,c){},renewMasterToken:function(a,b,c,d,f){},isUserIdTokenRevoked:function(a,b,c,d){},createUserIdToken:function(a,b,c,d){},renewUserIdToken:function(a,b,c,d){}});var Xb,Rc;(function(){function c(a,b,d,f){this.sessiondata=a;this.tokendata=b;this.signature=d;this.verified=f}Xb=ea.Class.create({init:function(a,c,d,f,g,k,n,w,A,p,y){var B=this;b(y,function(){if(d.getTime()<c.getTime())throw new W("Cannot construct a master token that expires before its renewal window opens.");
if(0>f||f>Ha)throw new W("Sequence number "+f+" is outside the valid range.");if(0>g||g>Ha)throw new W("Serial number "+g+" is outside the valid range.");var O=Math.floor(c.getTime()/1E3),I=Math.floor(d.getTime()/1E3),la;if(p)la=p.sessiondata;else{var fa={};k&&(fa.issuerdata=k);fa.identity=n;fa.encryptionkey=L(w.toByteArray());fa.hmackey=L(A.toByteArray());la=S(JSON.stringify(fa),na)}if(p)return Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:O,
writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:I,writable:!1,enumerable:!1,configurable:!1},sequenceNumber:{value:f,writable:!1,configurable:!1},serialNumber:{value:g,writable:!1,configurable:!1},issuerData:{value:k,writable:!1,configurable:!1},identity:{value:n,writable:!1,configurable:!1},encryptionKey:{value:w,writable:!1,configurable:!1},hmacKey:{value:A,writable:!1,configurable:!1},sessiondata:{value:la,writable:!1,enumerable:!1,configurable:!1},verified:{value:p.verified,
writable:!1,enumerable:!1,configurable:!1},tokendata:{value:p.tokendata,writable:!1,enumerable:!1,configurable:!1},signature:{value:p.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var x=a.getMslCryptoContext();x.encrypt(la,{result:function(c){b(y,function(){var d={};d.renewalwindow=O;d.expiration=I;d.sequencenumber=f;d.serialnumber=g;d.sessiondata=L(c);var h=S(JSON.stringify(d),na);x.sign(h,{result:function(c){b(y,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,
configurable:!1},renewalWindowSeconds:{value:O,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:I,writable:!1,enumerable:!1,configurable:!1},sequenceNumber:{value:f,writable:!1,enumerable:!1,configurable:!1},serialNumber:{value:g,writable:!1,enumerable:!1,configurable:!1},issuerData:{value:k,writable:!1,configurable:!1},identity:{value:n,writable:!1,configurable:!1},encryptionKey:{value:w,writable:!1,configurable:!1},hmacKey:{value:A,writable:!1,configurable:!1},sessiondata:{value:la,
writable:!1,enumerable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:h,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},B)},error:function(a){y.error(a)}})},B)},error:function(a){y.error(a)}})},this)},get renewalWindow(){return new Date(1E3*this.renewalWindowSeconds)},get expiration(){return new Date(1E3*this.expirationSeconds)},isDecrypted:function(){return this.sessiondata?
!0:!1},isVerified:function(){return this.verified},isRenewable:function(a){return this.isVerified()?this.renewalWindow.getTime()<=this.ctx.getTime():!0},isExpired:function(a){return this.isVerified()?this.expiration.getTime()<=this.ctx.getTime():!1},isNewerThan:function(a){if(this.sequenceNumber==a.sequenceNumber)return this.expiration>a.expiration;if(this.sequenceNumber>a.sequenceNumber){var b=this.sequenceNumber-Ha+127;return a.sequenceNumber>=b}b=a.sequenceNumber-Ha+127;return this.sequenceNumber<
b},toJSON:function(){var a={};a.tokendata=L(this.tokendata);a.signature=L(this.signature);return a},equals:function(a){return this===a?!0:a instanceof Xb?this.serialNumber==a.serialNumber&&this.sequenceNumber==a.sequenceNumber&&this.expiration.getTime()==a.expiration.getTime():!1},uniqueKey:function(){return this.serialNumber+":"+this.sequenceNumber+this.expiration.getTime()}});Rc=function(d,f,g){b(g,function(){var t=d.getMslCryptoContext(),r=f.tokendata,n=f.signature;if("string"!==typeof r||"string"!==
typeof n)throw new Z(a.JSON_PARSE_ERROR,"mastertoken "+JSON.stringify(f));var p,K;try{p=O(r)}catch(A){throw new B(a.MASTERTOKEN_TOKENDATA_INVALID,"mastertoken "+JSON.stringify(f),A);}if(!p||0==p.length)throw new Z(a.MASTERTOKEN_TOKENDATA_MISSING,"mastertoken "+JSON.stringify(f));try{K=O(n)}catch(E){throw new B(a.MASTERTOKEN_SIGNATURE_INVALID,"mastertoken "+JSON.stringify(f),E);}t.verify(p,K,{result:function(f){b(g,function(){var h,r,n,A,J,E=k(p,na);try{var y=JSON.parse(E);h=parseInt(y.renewalwindow);
r=parseInt(y.expiration);n=parseInt(y.sequencenumber);A=parseInt(y.serialnumber);J=y.sessiondata}catch(L){if(L instanceof SyntaxError)throw new Z(a.MASTERTOKEN_TOKENDATA_PARSE_ERROR,"mastertokendata "+E,L);throw L;}if(!h||h!=h||!r||r!=r||"number"!==typeof n||n!=n||"number"!==typeof A||A!=A||"string"!==typeof J)throw new Z(a.MASTERTOKEN_TOKENDATA_PARSE_ERROR,"mastertokendata "+E);if(r<h)throw new B(a.MASTERTOKEN_EXPIRES_BEFORE_RENEWAL,"mastertokendata "+E);if(0>n||n>Ha)throw new B(a.MASTERTOKEN_SEQUENCE_NUMBER_OUT_OF_RANGE,
"mastertokendata "+E);if(0>A||A>Ha)throw new B(a.MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"mastertokendata "+E);var da=new Date(1E3*h),S=new Date(1E3*r),I;try{I=O(J)}catch(x){throw new B(a.MASTERTOKEN_SESSIONDATA_INVALID,J,x);}if(!I||0==I.length)throw new B(a.MASTERTOKEN_SESSIONDATA_MISSING,J);f?t.decrypt(I,{result:function(h){b(g,function(){var t,r,J,E,fa=k(h,na);try{var y=JSON.parse(fa);t=y.issuerdata;r=y.identity;J=y.encryptionkey;E=y.hmackey}catch(B){if(B instanceof SyntaxError)throw new Z(a.MASTERTOKEN_SESSIONDATA_PARSE_ERROR,
"sessiondata "+fa,B);throw B;}if(t&&"object"!==typeof t||!r||"string"!==typeof J||"string"!==typeof E)throw new Z(a.MASTERTOKEN_SESSIONDATA_PARSE_ERROR,"sessiondata "+fa);Cb(J,pc,qb,{result:function(k){Cb(E,Mb,ga,{result:function(a){b(g,function(){var b=new c(h,p,K,f);new Xb(d,da,S,n,A,t,r,k,a,b,g)})},error:function(b){g.error(new T(a.MASTERTOKEN_KEY_CREATION_ERROR,b))}})},error:function(b){g.error(new T(a.MASTERTOKEN_KEY_CREATION_ERROR,b))}})})},error:function(a){g.error(a)}}):(h=new c(null,p,K,
f),new Xb(d,da,S,n,A,null,null,null,null,h,g))})},error:function(a){g.error(a)}})})}})();var vd,gd;(function(){function c(a,b,d){this.tokendata=a;this.signature=b;this.verified=d}vd=ea.Class.create({init:function(a,c,d,f,g,k,n,w,A){var p=this;b(A,function(){if(d.getTime()<c.getTime())throw new W("Cannot construct a user ID token that expires before its renewal window opens.");if(!f)throw new W("Cannot construct a user ID token without a master token.");if(0>g||g>Ha)throw new W("Serial number "+g+
" is outside the valid range.");var y=Math.floor(c.getTime()/1E3),O=Math.floor(d.getTime()/1E3),I=f.serialNumber;if(w){var x=w.tokendata,la=w.signature,fa=w.verified,I=f.serialNumber;Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:y,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:O,writable:!1,enumerable:!1,configurable:!1},mtSerialNumber:{value:I,writable:!1,configurable:!1},serialNumber:{value:g,writable:!1,configurable:!1},
issuerData:{value:k,writable:!1,configurable:!1},customer:{value:n,writable:!1,configurable:!1},verified:{value:fa,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:x,writable:!1,enumerable:!1,configurable:!1},signature:{value:la,writable:!1,enumerable:!1,configurable:!1}});return this}x={};k&&(x.issuerdata=k);x.identity=n;var x=S(JSON.stringify(x),na),aa=a.getMslCryptoContext();aa.encrypt(x,{result:function(c){b(A,function(){var d={};d.renewalwindow=y;d.expiration=O;d.mtserialnumber=I;
d.serialnumber=g;d.userdata=L(c);var h=S(JSON.stringify(d),na);aa.sign(h,{result:function(c){b(A,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},renewalWindowSeconds:{value:y,writable:!1,enumerable:!1,configurable:!1},expirationSeconds:{value:O,writable:!1,enumerable:!1,configurable:!1},mtSerialNumber:{value:f.serialNumber,writable:!1,configurable:!1},serialNumber:{value:g,writable:!1,configurable:!1},issuerData:{value:k,writable:!1,configurable:!1},
customer:{value:n,writable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:h,writable:!1,enumerable:!1,configurable:!1},signature:{value:c,writable:!1,enumerable:!1,configurable:!1}});return this},p)},error:function(a){b(A,function(){a instanceof B&&a.setEntity(f);throw a;},p)}})},p)},error:function(a){b(A,function(){a instanceof B&&a.setEntity(f);throw a;},p)}})},this)},get renewalWindow(){return new Date(1E3*this.renewalWindowSeconds)},get expiration(){return new Date(1E3*
this.expirationSeconds)},isVerified:function(){return this.verified},isDecrypted:function(){return this.customer?!0:!1},isRenewable:function(){return this.renewalWindow.getTime()<=this.ctx.getTime()},isExpired:function(){return this.expiration.getTime()<=this.ctx.getTime()},isBoundTo:function(a){return a&&a.serialNumber==this.mtSerialNumber},toJSON:function(){var a={};a.tokendata=L(this.tokendata);a.signature=L(this.signature);return a},equals:function(a){return this===a?!0:a instanceof vd?this.serialNumber==
a.serialNumber&&this.mtSerialNumber==a.mtSerialNumber:!1},uniqueKey:function(){return this.serialNumber+":"+this.mtSerialNumber}});gd=function(d,f,g,t){b(t,function(){var r=d.getMslCryptoContext(),n=f.tokendata,p=f.signature;if("string"!==typeof n||"string"!==typeof p)throw(new Z(a.JSON_PARSE_ERROR,"useridtoken "+JSON.stringify(f))).setEntity(g);var K,A;try{K=O(n)}catch(E){throw(new B(a.USERIDTOKEN_TOKENDATA_INVALID,"useridtoken "+JSON.stringify(f),E)).setEntity(g);}if(!K||0==K.length)throw(new Z(a.USERIDTOKEN_TOKENDATA_MISSING,
"useridtoken "+JSON.stringify(f))).setEntity(g);try{A=O(p)}catch(y){throw(new B(a.USERIDTOKEN_TOKENDATA_INVALID,"useridtoken "+JSON.stringify(f),y)).setEntity(g);}r.verify(K,A,{result:function(f){b(t,function(){var h,n,p,J,E,y=k(K,na);try{var L=JSON.parse(y);h=parseInt(L.renewalwindow);n=parseInt(L.expiration);p=parseInt(L.mtserialnumber);J=parseInt(L.serialnumber);E=L.userdata}catch(ma){if(ma instanceof SyntaxError)throw(new Z(a.USERIDTOKEN_TOKENDATA_PARSE_ERROR,"usertokendata "+y,ma)).setEntity(g);
throw ma;}if(!h||h!=h||!n||n!=n||"number"!==typeof p||p!=p||"number"!==typeof J||J!=J||"string"!==typeof E)throw(new Z(a.USERIDTOKEN_TOKENDATA_PARSE_ERROR,"usertokendata "+y)).setEntity(g);if(n<h)throw(new B(a.USERIDTOKEN_EXPIRES_BEFORE_RENEWAL,"mastertokendata "+y)).setEntity(g);if(0>p||p>Ha)throw(new B(a.USERIDTOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"usertokendata "+y)).setEntity(g);if(0>J||J>Ha)throw(new B(a.USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"usertokendata "+y)).setEntity(g);var ka=new Date(1E3*
h),I=new Date(1E3*n);if(!g||p!=g.serialNumber)throw(new B(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+p+"; mt "+JSON.stringify(g))).setEntity(g);var S;try{S=O(E)}catch(x){throw(new B(a.USERIDTOKEN_USERDATA_INVALID,E,x)).setEntity(g);}if(!S||0==S.length)throw(new B(a.USERIDTOKEN_USERDATA_MISSING,E)).setEntity(g);f?r.decrypt(S,{result:function(h){b(t,function(){var b,n,r=k(h,na);try{var p=JSON.parse(r);b=p.issuerdata;n=p.identity}catch(E){if(E instanceof SyntaxError)throw(new Z(a.USERIDTOKEN_USERDATA_PARSE_ERROR,
"userdata "+r)).setEntity(g);throw E;}if(b&&"object"!==typeof b||"object"!==typeof n)throw(new Z(a.USERIDTOKEN_USERDATA_PARSE_ERROR,"userdata "+r)).setEntity(g);var y;try{y=Ze(n)}catch(L){throw(new B(a.USERIDTOKEN_IDENTITY_INVALID,"userdata "+r,L)).setEntity(g);}n=new c(K,A,f);new vd(d,ka,I,g,J,b,y,n,t)})},error:function(a){b(t,function(){a instanceof B&&a.setEntity(g);throw a;})}}):(h=new c(K,A,f),new vd(d,ka,I,g,J,null,null,h,t))})},error:function(a){b(t,function(){a instanceof B&&a.setEntity(g);
throw a;})}})})}})();var Sc,sc,oe;(function(){function c(b,d){var f=b.tokendata;if("string"!==typeof f)throw new Z(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b));var g;try{g=O(f)}catch(m){throw new B(a.SERVICETOKEN_TOKENDATA_INVALID,"servicetoken "+JSON.stringify(b),m);}if(!g||0==g.length)throw new Z(a.SERVICETOKEN_TOKENDATA_MISSING,"servicetoken "+JSON.stringify(b));var n;try{n=JSON.parse(k(g,na)).name}catch(w){if(w instanceof SyntaxError)throw new Z(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b),
w);throw w;}if(!n)throw new Z(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(b));return d[n]?d[n]:d[""]}function d(a,b,c){this.tokendata=a;this.signature=b;this.verified=c}Sc=ea.Class.create({init:function(a,c,d,f,g,k,m,n,w,p){var y=this;b(p,function(){if(f&&g&&!g.isBoundTo(f))throw new W("Cannot construct a service token bound to a master token and user ID token where the user ID token is not bound to the same master token.");var O=f?f.serialNumber:-1,I=g?g.serialNumber:-1;if(w)return aa=w.tokendata,
Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},name:{value:c,writable:!1,configurable:!1},mtSerialNumber:{value:O,writable:!1,configurable:!1},uitSerialNumber:{value:I,writable:!1,configurable:!1},data:{value:d,writable:!1,configurable:!1},encrypted:{value:k,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:m,writable:!1,configurable:!1},verified:{value:w.verified,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:aa,writable:!1,enumerable:!1,
configurable:!1},signature:{value:w.signature,writable:!1,enumerable:!1,configurable:!1}}),this;var x;m?(x=re(m,d),x.length<d.length||(m=null,x=d)):(m=null,x=d);var fa={};fa.name=c;-1!=O&&(fa.mtserialnumber=O);-1!=I&&(fa.uitserialnumber=I);fa.encrypted=k;m&&(fa.compressionalgo=m);if(k&&0<x.length)n.encrypt(x,{result:function(w){b(p,function(){fa.servicedata=L(w);var E=S(JSON.stringify(fa),na);n.sign(E,{result:function(f){b(p,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,
configurable:!1},name:{value:c,writable:!1,configurable:!1},mtSerialNumber:{value:O,writable:!1,configurable:!1},uitSerialNumber:{value:I,writable:!1,configurable:!1},data:{value:d,writable:!1,configurable:!1},encrypted:{value:k,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:m,writable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:E,writable:!1,enumerable:!1,configurable:!1},signature:{value:f,writable:!1,enumerable:!1,configurable:!1}});
return this},y)},error:function(a){b(p,function(){a instanceof B&&(a.setEntity(f),a.setUser(g));throw a;})}})},y)},error:function(a){b(p,function(){a instanceof B&&(a.setEntity(f),a.setUser(g));throw a;})}});else{fa.servicedata=L(x);var aa=S(JSON.stringify(fa),na);n.sign(aa,{result:function(f){b(p,function(){Object.defineProperties(this,{ctx:{value:a,writable:!1,enumerable:!1,configurable:!1},name:{value:c,writable:!1,configurable:!1},mtSerialNumber:{value:O,writable:!1,configurable:!1},uitSerialNumber:{value:I,
writable:!1,configurable:!1},data:{value:d,writable:!1,configurable:!1},encrypted:{value:k,writable:!1,enumerable:!1,configurable:!1},compressionAlgo:{value:m,writable:!1,configurable:!1},verified:{value:!0,writable:!1,enumerable:!1,configurable:!1},tokendata:{value:aa,writable:!1,enumerable:!1,configurable:!1},signature:{value:f,writable:!1,enumerable:!1,configurable:!1}});return this},y)},error:function(a){b(p,function(){a instanceof B&&(a.setEntity(f),a.setUser(g));throw a;})}})}},this)},isEncrypted:function(){return this.encrypted},
isVerified:function(){return this.verified},isDecrypted:function(){return this.data?!0:!1},isDeleted:function(){return this.data&&0==this.data.length},isMasterTokenBound:function(){return-1!=this.mtSerialNumber},isBoundTo:function(a){return a?a instanceof Xb?a.serialNumber==this.mtSerialNumber:a instanceof vd?a.serialNumber==this.uitSerialNumber:!1:!1},isUserIdTokenBound:function(){return-1!=this.uitSerialNumber},isUnbound:function(){return-1==this.mtSerialNumber&&-1==this.uitSerialNumber},toJSON:function(){var a=
{};a.tokendata=L(this.tokendata);a.signature=L(this.signature);return a},equals:function(a){return this===a?!0:a instanceof Sc?this.name==a.name&&this.mtSerialNumber==a.mtSerialNumber&&this.uitSerialNumber==a.uitSerialNumber:!1},uniqueKey:function(){return this.name+":"+this.mtSerialNumber+":"+this.uitSerialNumber}});sc=function(a,b,c,d,f,g,k,m,n){new Sc(a,b,c,d,f,g,k,m,null,n)};oe=function(f,g,t,n,p,y){b(y,function(){!p||p instanceof wd||(p=c(g,p));var K=g.tokendata,A=g.signature;if("string"!==typeof K||
"string"!==typeof A)throw(new Z(a.JSON_PARSE_ERROR,"servicetoken "+JSON.stringify(g))).setEntity(t).setEntity(n);var E,L;try{E=O(K)}catch(I){throw(new B(a.SERVICETOKEN_TOKENDATA_INVALID,"servicetoken "+JSON.stringify(g),I)).setEntity(t).setEntity(n);}if(!E||0==E.length)throw(new Z(a.SERVICETOKEN_TOKENDATA_MISSING,"servicetoken "+JSON.stringify(g))).setEntity(t).setEntity(n);try{L=O(A)}catch(S){throw(new B(a.SERVICETOKEN_SIGNATURE_INVALID,"servicetoken "+JSON.stringify(g),S)).setEntity(t).setEntity(n);
}var x,la,fa,aa,Y,F,da=k(E,na);try{var T=JSON.parse(da);x=T.name;la=T.mtserialnumber?parseInt(T.mtserialnumber):-1;fa=T.uitserialnumber?parseInt(T.uitserialnumber):-1;aa=T.encrypted;Y=T.compressionalgo;F=T.servicedata}catch(W){if(W instanceof SyntaxError)throw(new Z(a.JSON_PARSE_ERROR,"servicetokendata "+da,W)).setEntity(t).setEntity(n);throw W;}if(!x||"number"!==typeof la||la!=la||"number"!==typeof fa||fa!=fa||"boolean"!==typeof aa||Y&&"string"!==typeof Y||"string"!==typeof F)throw(new Z(a.JSON_PARSE_ERROR,
"servicetokendata "+da)).setEntity(t).setEntity(n);if(T.mtserialnumber&&0>la||la>Ha)throw(new B(a.SERVICETOKEN_MASTERTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"servicetokendata "+da)).setEntity(t).setEntity(n);if(T.uitserialnumber&&0>fa||fa>Ha)throw(new B(a.SERVICETOKEN_USERIDTOKEN_SERIAL_NUMBER_OUT_OF_RANGE,"servicetokendata "+da)).setEntity(t).setEntity(n);if(-1!=la&&(!t||la!=t.serialNumber))throw(new B(a.SERVICETOKEN_MASTERTOKEN_MISMATCH,"st mtserialnumber "+la+"; mt "+t)).setEntity(t).setEntity(n);if(-1!=
fa&&(!n||fa!=n.serialNumber))throw(new B(a.SERVICETOKEN_USERIDTOKEN_MISMATCH,"st uitserialnumber "+fa+"; uit "+n)).setEntity(t).setEntity(n);aa=!0===aa;var qa;if(Y){if(!ad[Y])throw new B(a.UNIDENTIFIED_COMPRESSION,Y);qa=Y}else qa=null;p?p.verify(E,L,{result:function(c){b(y,function(){if(c){var g;try{g=O(F)}catch(k){throw(new B(a.SERVICETOKEN_SERVICEDATA_INVALID,"servicetokendata "+da,k)).setEntity(t).setEntity(n);}if(!g||0!=F.length&&0==g.length)throw(new B(a.SERVICETOKEN_SERVICEDATA_INVALID,"servicetokendata "+
da)).setEntity(t).setEntity(n);if(aa&&0<g.length)p.decrypt(g,{result:function(a){b(y,function(){var b=qa?se(qa,a):a,g=new d(E,L,c);new Sc(f,x,b,-1!=la?t:null,-1!=fa?n:null,aa,qa,p,g,y)})},error:function(a){b(y,function(){a instanceof B&&(a.setEntity(t),a.setUser(n));throw a;})}});else{g=qa?se(qa,g):g;var l=new d(E,L,c);new Sc(f,x,g,-1!=la?t:null,-1!=fa?n:null,aa,qa,p,l,y)}}else g=""==F?new Uint8Array(0):null,l=new d(E,L,c),new Sc(f,x,g,-1!=la?t:null,-1!=fa?n:null,aa,qa,p,l,y)})},error:function(a){b(y,
function(){a instanceof B&&(a.setEntity(t),a.setUser(n));throw a;})}}):(K=""==F?new Uint8Array(0):null,A=new d(E,L,!1),new Sc(f,x,K,-1!=la?t:null,-1!=fa?n:null,aa,qa,p,A,y))})}})();var tc={EMAIL_PASSWORD:"EMAIL_PASSWORD",NETFLIXID:"NETFLIXID",SSO:"SSO",SWITCH_PROFILE:"SWITCH_PROFILE",MDX:"MDX"};Object.freeze(tc);var cd,Tf;(function(){cd=ea.Class.create({init:function(a){Object.defineProperties(this,{scheme:{value:a,writable:!1,configurable:!1}})},getAuthData:function(){},equals:function(a){return this===
a?!0:a instanceof cd?this.scheme==a.scheme:!1},toJSON:function(){var a={};a.scheme=this.scheme;a.authdata=this.getAuthData();return a}});Tf=function(c,d,f,g){b(g,function(){var b=f.scheme,k=f.authdata;if(!b||!k)throw new Z(a.JSON_PARSE_ERROR,"userauthdata "+JSON.stringify(f));if(!tc[b])throw new Pa(a.UNIDENTIFIED_USERAUTH_SCHEME,b);var n=c.getUserAuthenticationFactory(b);if(!n)throw new Pa(a.USERAUTH_FACTORY_NOT_FOUND,b);n.createData(c,d,k,g)})}})();var ue=ea.Class.create({init:function(a){Object.defineProperties(this,
{scheme:{value:a,writable:!1,configurable:!1}})},createData:function(a,b,c,d){},authenticate:function(a,b,c,d){}}),kd,$e;(function(){kd=cd.extend({init:function m(a,b){m.base.call(this,tc.NETFLIXID);Object.defineProperties(this,{netflixId:{value:a,writable:!1,configurable:!1},secureNetflixId:{value:b,writable:!1,configurable:!1}})},getAuthData:function(){var a={};a.netflixid=this.netflixId;this.secureNetflixId&&(a.securenetflixid=this.secureNetflixId);return a},equals:function h(a){return this===
a?!0:a instanceof kd?h.base.call(this,a)&&this.netflixId==a.netflixId&&this.secureNetflixId==a.secureNetflixId:!1}});$e=function(b){var c=b.netflixid,d=b.securenetflixid;if(!c)throw new Z(a.JSON_PARSE_ERROR,"NetflixId authdata "+JSON.stringify(b));return new kd(c,d)}})();var Ug=ue.extend({init:function m(){m.base.call(this,tc.NETFLIXID)},createData:function(a,c,d,f){b(f,function(){return $e(d)})},authenticate:function(b,c,d,f){if(!(d instanceof kd))throw new W("Incorrect authentication data type "+
d+".");b=d.secureNetflixId;if(!d.netflixId||!b)throw(new Pa(a.NETFLIXID_COOKIES_BLANK)).setUser(d);throw(new Pa(a.UNSUPPORTED_USERAUTH_DATA,this.scheme)).setUser(d);}}),Td,bg;(function(){Td=cd.extend({init:function h(a,b){h.base.call(this,tc.EMAIL_PASSWORD);Object.defineProperties(this,{email:{value:a,writable:!1,configurable:!1},password:{value:b,writable:!1,configurable:!1}})},getAuthData:function(){var a={};a.email=this.email;a.password=this.password;return a},equals:function l(a){return this===
a?!0:a instanceof Td?l.base.call(this,this,a)&&this.email==a.email&&this.password==a.password:!1}});bg=function(b){var c=b.email,d=b.password;if(!c||!d)throw new Z(a.JSON_PARSE_ERROR,"email/password authdata "+JSON.stringify(b));return new Td(c,d)}})();var Vg=ue.extend({init:function h(){h.base.call(this,tc.EMAIL_PASSWORD)},createData:function(a,c,d,f){b(f,function(){return bg(d)})},authenticate:function(b,c,d,f){if(!(d instanceof Td))throw new W("Incorrect authentication data type "+d+".");b=d.password;
if(!d.email||!b)throw(new Pa(a.EMAILPASSWORD_BLANK)).setUser(d);throw(new Pa(a.UNSUPPORTED_USERAUTH_DATA,this.scheme)).setUser(d);}}),Tc,cg,ve,Ud,Ic,af;(function(){function c(a,b){return"<"+a+">"+b+"</"+a+">"}function d(a){return a.replace(/[<>&"']/g,function(a){return A[a]})}function f(a){return encodeURIComponent(a).replace("%20","+").replace(/[!'()]/g,escape).replace(/\*/g,"%2A")}var g=ve={MSL:"MSL",NTBA:"NTBA",MSL_LEGACY:"MSL_LEGACY"},n=ea.Class.create({getAction:function(){},getNonce:function(){},
getPin:function(){},getSignature:function(){},getEncoding:function(){},equals:function(){}}),y=Ud=n.extend({init:function(c,d,f,g,h,k,l){function n(g){b(l,function(){var b;try{var k={};k.useridtoken=c;k.action=d;k.nonce=f;k.pin=L(g);b=S(JSON.stringify(k),na)}catch(n){throw new Z(a.JSON_ENCODE_ERROR,"MSL-based MDX authdata",n);}h.sign(b,{result:function(a){t(b,a)},error:l.error})},r)}function t(a,h){b(l,function(){Object.defineProperties(this,{_userIdToken:{value:c,writable:!1,enumerable:!1,configurable:!1},
_action:{value:d,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:f,writable:!1,enumerable:!1,configurable:!1},_pin:{value:g,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:a,writable:!1,enumerable:!1,configurable:!1},_signature:{value:h,writable:!1,enumerable:!1,configurable:!1}});return this},r)}var r=this;b(l,function(){k?t(k.encoding,k.signature):h.encrypt(S(g,na),{result:function(a){n(a)},error:l.error})},r)},getUserIdToken:function(){return this._userIdToken},getAction:function(){return this._action},
getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof y?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin&&this._userIdToken.equals(a._userIdToken):!1}});Ud.ACTION="userauth";var K=function(c,d,f,g,h){function l(g){b(h,function(){var l=k(f,na),t,r,p,A;try{var y=JSON.parse(l);t=y.useridtoken;r=y.action;p=y.nonce;A=y.pin}catch(E){if(E instanceof
SyntaxError)throw new Z(a.JSON_PARSE_ERROR,"MDX authdata "+l,E);throw E;}if(!(t&&"object"===typeof t&&r&&"string"===typeof r&&p&&"number"===typeof p&&A)||"string"!==typeof A)throw new Z(a.JSON_PARSE_ERROR,"MDX authdata "+l);gd(c,t,d,{result:function(c){b(h,function(){if(!c.isDecrypted())throw new Pa(a.USERAUTH_USERIDTOKEN_NOT_DECRYPTED,"MDX authdata "+l);n(g,c,r,p,A)})},error:function(c){b(h,function(){if(c instanceof B)throw new Pa(a.USERAUTH_USERIDTOKEN_INVALID,"MDX authdata "+l,c);throw c;})}})})}
function n(a,c,d,l,t){b(h,function(){var n=O(t);a.decrypt(n,{result:function(a){b(h,function(){var b=k(a,na);new y(c,d,l,b,null,{encoding:f,signature:g},h)})},error:h.error})})}b(h,function(){var k;try{var n=c.getMslStore().getCryptoContext(d);k=n?n:new Jb(c,d)}catch(t){if(t instanceof oc)throw new Pa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+L(f));throw t;}k.verify(f,g,{result:function(c){b(h,function(){if(!c)throw new T(a.MDX_USERAUTH_VERIFICATION_FAILED,"MDX authdata "+L(f));l(k)})},
error:h.error})})},A={"<":"&lt;",">":"&gt;","&":"&amp;",'"':"&quot;","'":"&apos;"},E=Ic=n.extend({init:function(a,b,f,g){var k=c("action",d(a)),n=c("nonce",b.toString());f=c("pin",f);k=c("registerdata",k+n+f);k=S(k,"utf-8");Object.defineProperties(this,{_action:{value:a,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:b,writable:!1,enumerable:!1,configurable:!1},_pin:{value:null,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:k,writable:!1,enumerable:!1,configurable:!1},_signature:{value:g,
writable:!1,enumerable:!1,configurable:!1}})},getAction:function(){return this._action},getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof E?this._action==a._action&&this._nonce==a._nonce&&this._pin==a._pin:!1}});Ic.ACTION="regpairrequest";var I=af=n.extend({init:function(a,g,k,n,r,p){function A(k){b(p,function(){var b=L(k),r=c("action",
d(a)),A=c("nonce",g.toString()),E=c("pin",b),r=c("registerdata",r+A+E),J=S(r,"utf-8"),b="action="+f(a)+"&nonce="+f(g.toString())+"&pin="+f(b);n.sign(S(b,"utf-8"),{result:function(a){y(J,a)},error:p.error})},E)}function y(c,d){b(p,function(){Object.defineProperties(this,{_action:{value:a,writable:!1,enumerable:!1,configurable:!1},_nonce:{value:g,writable:!1,enumerable:!1,configurable:!1},_pin:{value:k,writable:!1,enumerable:!1,configurable:!1},_encoding:{value:c,writable:!1,enumerable:!1,configurable:!1},
_signature:{value:d,writable:!1,enumerable:!1,configurable:!1}});return this},E)}var E=this;b(p,function(){r?y(r.encoding,r.signature):n.encrypt(S(k,"utf-8"),{result:function(a){A(a)},error:p.error})},E)},getAction:function(){return this._action},getNonce:function(){return this._nonce},getPin:function(){return this._pin},getSignature:function(){return this._signature},getEncoding:function(){return this._encoding},equals:function(a){return this===a?!0:a instanceof I?this._action==a._action&&this._nonce==
a._nonce&&this._pin==a._pin:!1}});af.ACTION=Ic.ACTION;var x=function(c,d,g,h,l){b(l,function(){var n=c.getMslStore().getCryptoContext(d),r=n?n:new Jb(c,d),n=k(g,"utf-8"),p=(new DOMParser).parseFromString(n,"application/xml"),n=p.getElementsByTagName("action"),A=p.getElementsByTagName("nonce"),p=p.getElementsByTagName("pin"),y=n&&1==n.length&&n[0].firstChild?n[0].firstChild.nodeValue:null,E=A&&1==A.length&&A[0].firstChild?parseInt(A[0].firstChild.nodeValue):null,J=p&&1==p.length&&p[0].firstChild?p[0].firstChild.nodeValue:
null;if(!y||!E||!J)throw new Z(a.XML_PARSE_ERROR,"MDX authdata "+L(g));n="action="+f(y)+"&nonce="+f(E.toString())+"&pin="+f(J);r.verify(S(n,"utf-8"),h,{result:function(c){b(l,function(){if(!c)throw new T(a.MDX_USERAUTH_VERIFICATION_FAILED,"MDX authdata "+L(g));var d=O(J);r.decrypt(d,{result:function(a){b(l,function(){var b=k(a,"utf-8");new I(y,E,b,null,{encoding:g,signature:h},l)})},error:l.error})})},error:l.error})})};Tc=cd.extend({init:function Gb(a,b,c,d,f,h){Gb.base.call(this,tc.MDX);var k=null,
l=null,n=null;if("string"===typeof c)a=g.MSL_LEGACY,n=c;else if(c instanceof Uint8Array)a=g.NTBA,l=c;else if(c instanceof Xb)a=g.MSL,k=c;else throw new TypeError("Controller token "+c+" is not a master token, encrypted CTicket, or MSL token construct.");var t=c=null,p=null,A=null;if(h){var E=h.controllerAuthData;c=E.getAction();t=E.getPin();p=h.userIdToken;E instanceof y?A=E.getUserIdToken().customer:p&&(A=p.customer)}Object.defineProperties(this,{mechanism:{value:a,writable:!1,configurable:!1},action:{value:c,
writable:!1,configurable:!1},targetPin:{value:b,writable:!1,configurable:!1},controllerPin:{value:t,writable:!1,configurable:!1},customer:{value:A,writable:!1,configurable:!1},_masterToken:{value:k,writable:!1,enumerable:!1,configurable:!1},_encryptedCTicket:{value:l,writable:!1,enumerable:!1,configurable:!1},_mslTokens:{value:n,writable:!1,enumerable:!1,configurable:!1},_controllerEncoding:{value:d,writable:!1,enumerable:!1,configurable:!1},_signature:{value:f,writable:!1,enumerable:!1,configurable:!1}})},
getAuthData:function(){var a={};switch(this.mechanism){case g.MSL:var b=JSON.parse(JSON.stringify(this._masterToken));a.mastertoken=b;break;case g.NTBA:b=k(this._encryptedCTicket,"utf-8");a.cticket=b;break;case g.MSL_LEGACY:a.cticket=this._mslTokens;break;default:throw new W("Unsupported MDX mechanism.");}a.pin=this.targetPin;a.mdxauthdata=L(this._controllerEncoding);a.signature=L(this._signature);return a},equals:function la(a){return this===a?!0:a instanceof Tc?la.base.call(this,a)&&(this._masterToken==
a._masterToken||this._masterToken&&this._masterToken.equals(a._masterToken))&&(this._encryptedCTicket==a._encryptedCTicket||this._encryptedCTicket&&p(this._encryptedCTicket,a._encryptedCTicket))&&this._mslTokens==a._mslTokens&&p(this._controllerEncoding,a._controllerEncoding)&&p(this._signature,a._signature):!1}});cg=function(c,d,f){function g(h,k,l,n){Rc(c,k,{result:function(g){b(f,function(){if(!g.isDecrypted())throw new Pa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+d.toString());K(c,
g,l,n,{result:function(a){b(f,function(){var b=a.getEncoding(),d=a.getSignature();return new Tc(c,h,g,b,d,{controllerAuthData:a,userIdToken:null})})},error:f.error})})},error:function(c){b(f,function(){if(c instanceof B)throw new Pa(a.USERAUTH_MASTERTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),c);throw c;})}})}function h(c,d,g,k){b(f,function(){throw new Pa(a.UNSUPPORTED_USERAUTH_MECHANISM,"NtbaControllerData$parse");})}function l(g,h,n,t){function r(f,g){b(g,function(){var h;try{h=O(f)}catch(l){throw new Pa(a.USERAUTH_MASTERTOKEN_INVALID,
"MDX authdata "+JSON.stringify(d),l);}if(!h||0==h.length)throw new Pa(a.USERAUTH_MASTERTOKEN_MISSING,"MDX authdata "+JSON.stringify(d));try{var n=JSON.parse(k(h,"utf-8"));Rc(c,n,{result:function(c){b(g,function(){if(!c.isDecrypted())throw new Pa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+d.toString());return c})},error:function(c){b(g,function(){if(c instanceof B)throw new Pa(a.USERAUTH_MASTERTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),c);throw c;})}})}catch(t){if(t instanceof SyntaxError)throw new Z(a.JSON_PARSE_ERROR,
"MDX authdata "+JSON.stringify(d),t);throw t;}})}function p(f,g,h){b(h,function(){var l;try{l=O(f)}catch(n){throw new Pa(a.USERAUTH_USERIDTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),n);}if(!l||0==l.length)throw new Pa(a.USERAUTH_USERIDTOKEN_MISSING,"MDX authdata "+JSON.stringify(d));try{var t=JSON.parse(k(l,"utf-8"));gd(c,t,g,{result:function(c){b(h,function(){if(!c.isDecrypted())throw new Pa(a.USERAUTH_USERIDTOKEN_NOT_DECRYPTED,"MDX authdata "+JSON.stringify(d));return c})},error:function(c){b(h,
function(){if(c instanceof B)throw new Pa(a.USERAUTH_USERIDTOKEN_INVALID,"MDX authdata "+JSON.stringify(d),c);throw c;})}})}catch(r){if(r instanceof SyntaxError)throw new Z(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d),r);throw r;}})}b(f,function(){var k=h.split(",");if(3!=k.length||"1"!=k[0])throw new Pa(a.UNIDENTIFIED_USERAUTH_MECHANISM,"MDX authdata "+JSON.stringify(d));r(k[1],{result:function(l){p(k[2],l,{result:function(k){x(c,l,n,t,{result:function(a){b(f,function(){return new Tc(c,g,
h,n,t,{controllerAuthData:a,userIdToken:k})})},error:function(c){b(f,function(){if(c instanceof oc)throw new Pa(a.USERAUTH_MASTERTOKEN_NOT_DECRYPTED,"MDX authdata "+JSON.stringify(d),c);throw c;})}})},error:f.error})},error:f.error})})}b(f,function(){var b=d.pin,c=d.mdxauthdata,f=d.signature;if(!b||"string"!==typeof b||!c||"string"!==typeof c||!f||"string"!==typeof f)throw new Z(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));var k,n;try{k=O(c),n=O(f)}catch(t){throw new Pa(a.MDX_CONTROLLERDATA_INVALID,
"MDX authdata "+JSON.stringify(d),t);}if(d.mastertoken){c=d.mastertoken;if(!c||"object"!==typeof c)throw new Z(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));g(b,c,k,n)}else if(d.cticket){c=d.cticket;if(!c||"string"!==typeof c)throw new Z(a.JSON_PARSE_ERROR,"MDX authdata "+JSON.stringify(d));-1==c.indexOf(",")?h(b,c,k,n):l(b,c,k,n)}else throw new Pa(a.UNIDENTIFIED_USERAUTH_MECHANISM,"MDX authdata "+JSON.stringify(d));})}})();var dg;(function(){var b=Ud.ACTION,c=Ic.ACTION,d=af.ACTION;dg=ue.extend({init:function J(){J.base.call(this,
tc.MDX)},createData:function(a,b,c,d){cg(a,c,d)},authenticate:function(f,g,k,n){if(!(k instanceof Tc))throw new W("Incorrect authentication data type "+k.getClass().getName()+".");f=k.action;switch(k.mechanism){case ve.MSL:if(b!=f)throw(new Pa(a.MDX_USERAUTH_ACTION_INVALID)).setUser(k);break;case ve.NTBA:if(c!=f)throw(new Pa(a.MDX_USERAUTH_ACTION_INVALID)).setUser(k);break;case ve.MSL_LEGACY:if(d!=f)throw(new Pa(a.MDX_USERAUTH_ACTION_INVALID)).setUser(k);}f=k.controllerPin;g=k.targetPin;if(!f||!g)throw(new Pa(a.MDX_PIN_BLANK)).setUser(k);
if(f!=g)throw(new Pa(a.MDX_PIN_MISMATCH)).setUser(k);f=k.customer;if(!f)throw(new Pa(a.MDX_USER_UNKNOWN)).setUser(k);if(n&&(n=n.customer,!f.equals(n)))throw(new Pa(a.USERIDTOKEN_USERAUTH_DATA_MISMATCH,"uad customer "+f+"; uit customer "+n)).setUser(k);return f}})})();Object.freeze({ENTITY_REAUTH:d.ENTITY_REAUTH,ENTITYDATA_REAUTH:d.ENTITYDATA_REAUTH});var Wg=ea.Class.create({getTime:function(){},getRandom:function(){},isPeerToPeer:function(){},getMessageCapabilities:function(){},getEntityAuthenticationData:function(a,
b){},getMslCryptoContext:function(){},getEntityAuthenticationFactory:function(a){},getUserAuthenticationFactory:function(a){},getTokenFactory:function(){},getKeyExchangeFactory:function(a){},getKeyExchangeFactories:function(){},getMslStore:function(){}}),eg=ea.Class.create({setCryptoContext:function(a,b){},getMasterToken:function(){},getNonReplayableId:function(a){},getCryptoContext:function(a){},removeCryptoContext:function(a){},clearCryptoContexts:function(){},addUserIdToken:function(a,b){},getUserIdToken:function(a){},
removeUserIdToken:function(a){},clearUserIdTokens:function(){},addServiceTokens:function(a){},getServiceTokens:function(a,b){},removeServiceTokens:function(a,b,c){},clearServiceTokens:function(){}}),re,se;(function(){var b=ad;re=function(c,d){switch(c){case b.LZW:return be(d);case b.GZIP:return gzip$compress(d);default:throw new B(a.UNSUPPORTED_COMPRESSION,c);}};se=function(c,d,f){switch(c){case b.LZW:return ce(d);case b.GZIP:return gzip$uncompress(d);default:throw new B(a.UNSUPPORTED_COMPRESSION,
c.name());}}})();eg.extend({setCryptoContext:function(a,b){},getMasterToken:function(){return null},getNonReplayableId:function(a){return 1},getCryptoContext:function(a){return null},removeCryptoContext:function(a){},clearCryptoContexts:function(){},addUserIdToken:function(a,b){},getUserIdToken:function(a){return null},removeUserIdToken:function(a){},clearUserIdTokens:function(){},addServiceTokens:function(a){},getServiceTokens:function(b,c){if(c){if(!b)throw new B(a.USERIDTOKEN_MASTERTOKEN_NULL);
if(!c.isBoundTo(b))throw new B(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+c.mtSerialNumber+"; mt "+b.serialNumber);}return[]},removeServiceTokens:function(b,c,d){if(d&&c&&!d.isBoundTo(c))throw new B(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+d.masterTokenSerialNumber+"; mt "+c.serialNumber);},clearServiceTokens:function(){}});var fg;(function(){fg=eg.extend({init:function l(){l.base.call(this);Object.defineProperties(this,{masterTokens:{value:{},writable:!1,enumerable:!1,
configurable:!1},cryptoContexts:{value:{},writable:!1,enumerable:!1,configurable:!1},userIdTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},nonReplayableIds:{value:{},writable:!1,enumerable:!1,configurable:!1},unboundServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},mtServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1},uitServiceTokens:{value:{},writable:!1,enumerable:!1,configurable:!1}})},setCryptoContext:function(a,b){if(b){var c=a.uniqueKey();this.masterTokens[c]=
a;this.cryptoContexts[c]=b}else this.removeCryptoContext(a)},getMasterToken:function(){var a=null,b;for(b in this.masterTokens){var c=this.masterTokens[b];if(!a||c.isNewerThan(a))a=c}return a},getNonReplayableId:function(a){a=a.serialNumber;var b;b=this.nonReplayableIds[a]!==x?this.nonReplayableIds[a]:0;if(0>b||b>Ha)throw new W("Non-replayable ID "+b+" is outside the valid range.");b=b==Ha?0:b+1;return this.nonReplayableIds[a]=b},getCryptoContext:function(a){return this.cryptoContexts[a.uniqueKey()]},
removeCryptoContext:function(a){var b=a.uniqueKey();if(this.masterTokens[b]){delete this.masterTokens[b];delete this.cryptoContexts[b];var b=a.serialNumber,c;for(c in this.masterTokens)if(this.masterTokens[c].serialNumber==b)return;delete this.nonReplayableIds[b];Object.keys(this.userIdTokens).forEach(function(b){b=this.userIdTokens[b];b.isBoundTo(a)&&this.removeUserIdToken(b)},this);try{this.removeServiceTokens(null,a,null)}catch(d){if(d instanceof B)throw new W("Unexpected exception while removing master token bound service tokens.",
d);throw d;}}},clearCryptoContexts:function(){[this.masterTokens,this.cryptoContexts,this.nonReplayableIds,this.userIdTokens,this.uitServiceTokens,this.mtServiceTokens].forEach(function(a){for(var b in a)delete a[b]},this)},addUserIdToken:function(b,c){var d=!1,f;for(f in this.masterTokens)if(c.isBoundTo(this.masterTokens[f])){d=!0;break}if(!d)throw new B(a.USERIDTOKEN_MASTERTOKEN_NOT_FOUND,"uit mtserialnumber "+c.mtSerialNumber);this.userIdTokens[b]=c},getUserIdToken:function(a){return this.userIdTokens[a]},
removeUserIdToken:function(a){var b=null,c;for(c in this.masterTokens){var d=this.masterTokens[c];if(a.isBoundTo(d)){b=d;break}}Object.keys(this.userIdTokens).forEach(function(c){if(this.userIdTokens[c].equals(a)){delete this.userIdTokens[c];try{this.removeServiceTokens(null,b,a)}catch(d){if(d instanceof B)throw new W("Unexpected exception while removing user ID token bound service tokens.",d);throw d;}}},this)},clearUserIdTokens:function(){for(var a in this.userIdTokens){var b=this.userIdTokens[a];
try{this.removeServiceTokens(null,null,b)}catch(c){if(c instanceof B)throw new W("Unexpected exception while removing user ID token bound service tokens.",c);throw c;}delete this.userIdTokens[a]}},addServiceTokens:function(b){b.forEach(function(b){if(b.isUnbound())this.unboundServiceTokens[b.uniqueKey()]=b;else{if(b.isMasterTokenBound()){var c=!1,d;for(d in this.masterTokens)if(b.isBoundTo(this.masterTokens[d])){c=!0;break}if(!c)throw new B(a.SERVICETOKEN_MASTERTOKEN_NOT_FOUND,"st mtserialnumber "+
b.mtSerialNumber);}if(b.isUserIdTokenBound()){var c=!1,f;for(f in this.userIdTokens)if(b.isBoundTo(this.userIdTokens[f])){c=!0;break}if(!c)throw new B(a.SERVICETOKEN_USERIDTOKEN_NOT_FOUND,"st uitserialnumber "+b.uitSerialNumber);}b.isMasterTokenBound()&&((f=this.mtServiceTokens[b.mtSerialNumber])||(f={}),f[b.uniqueKey()]=b,this.mtServiceTokens[b.mtSerialNumber]=f);b.isUserIdTokenBound()&&((f=this.uitServiceTokens[b.uitSerialNumber])||(f={}),f[b.uniqueKey()]=b,this.uitServiceTokens[b.uitSerialNumber]=
f)}},this)},getServiceTokens:function(b,c){if(c){if(!b)throw new B(a.USERIDTOKEN_MASTERTOKEN_NULL);if(!c.isBoundTo(b))throw new B(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+c.mtSerialNumber+"; mt "+b.serialNumber);}var d={},f;for(f in this.unboundServiceTokens){var g=this.unboundServiceTokens[f];d[g.uniqueKey()]=g}if(b&&(g=this.mtServiceTokens[b.serialNumber]))for(f in g){var k=g[f];k.isUserIdTokenBound()||(d[f]=k)}if(c&&(g=this.uitServiceTokens[c.serialNumber]))for(f in g)k=g[f],k.isBoundTo(b)&&
(d[f]=k);g=[];for(f in d)g.push(d[f]);return g},removeServiceTokens:function(b,c,d){if(d&&c&&!d.isBoundTo(c))throw new B(a.USERIDTOKEN_MASTERTOKEN_MISMATCH,"uit mtserialnumber "+d.mtSerialNumber+"; mt "+c.serialNumber);if(b&&!c&&!d){Object.keys(this.unboundServiceTokens).forEach(function(a){this.unboundServiceTokens[a].name==b&&delete this.unboundServiceTokens[a]},this);for(var f in this.mtServiceTokens){var g=this.mtServiceTokens[f],k=Object.keys(g);k.forEach(function(a){g[a].name==b&&delete g[a]},
this);this.mtServiceTokens[f]=g}for(var n in this.uitServiceTokens)g=this.uitServiceTokens[n],f=Object.keys(g),f.forEach(function(a){g[a].name==b&&delete g[a]},this),this.uitServiceTokens[n]=g}if(c&&!d){if(g=this.mtServiceTokens[c.serialNumber])k=Object.keys(g),k.forEach(function(a){var c=g[a];b&&c.name!=b||delete g[a]},this),this.mtServiceTokens[c.serialNumber]=g;for(n in this.uitServiceTokens){var p=this.uitServiceTokens[n];f=Object.keys(p);f.forEach(function(a){var d=p[a];b&&d.name!=b||d.isBoundTo(c)&&
delete p[a]},this);this.uitServiceTokens[n]=p}}d&&(g=this.uitServiceTokens[d.serialNumber])&&(f=Object.keys(g),f.forEach(function(a){var d=g[a];b&&d.name!=b||c&&!d.isBoundTo(c)||delete g[a]},this),this.uitServiceTokens[d.serialNumber]=g)},clearServiceTokens:function(){[this.unboundServiceTokens,this.mtServiceTokens,this.uitServiceTokens].forEach(function(a){for(var b in a)delete a[b]},this)}})})();var Kg=ta.extend({init:function l(){l.base.call(this);Object.defineProperties(this,{_contextMap:{value:{},
writable:!1,enumerable:!1,configurable:!1}})},addCryptoContext:function(a,b){if(b&&a&&a.length){var c=L(a);this._contextMap[c]=b}},getCryptoContext:function(a){return a&&a.length?(a=L(a),this._contextMap[a]||null):null},removeCryptoContext:function(a){a&&a.length&&(a=L(a),delete this._contextMap[a])}}),ic=Mg.extend({init:function t(a,b,c,d){t.base.call(this,a);Object.defineProperties(this,{_kde:{value:b,writable:!1,enumerable:!1,configurable:!1},_kdh:{value:c,writable:!1,enumerable:!1,configurable:!1},
_kdw:{value:d,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContext:function(b,c){if(!(c instanceof qc))throw new W("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw new yc(a.ENTITY_NOT_FOUND,"mgk "+c.identity);return new fc(b,this.localIdentity,this._kde,this._kdh,this._kdw)}}),yd=Le.extend({init:function r(a,b,c,d){r.base.call(this,a);Object.defineProperties(this,{_kpe:{value:b,writable:!1,enumerable:!1,configurable:!1},_kph:{value:c,writable:!1,
enumerable:!1,configurable:!1},_kpw:{value:d,writable:!1,enumerable:!1,configurable:!1}})},getCryptoContext:function(b,c){if(!(c instanceof rc))throw new W("Incorrect authentication data type "+JSON.stringify(c)+".");if(c.identity!=this.localIdentity)throw new yc(a.ENTITY_NOT_FOUND,"psk "+c.identity);return new fc(b,this.localIdentity,this._kpe,this._kph,this._kpw)}}),we=fg.extend({init:function J(a,b,c,d,f,g){J.base.call(this);this._log=a;this._esn=b;this._keyRequestData=c;this._createKeyRequestData=
d;this._systemKeyName=f;this._systemKeyWrapFormat=g},setCryptoContext:function ka(a,b,c){var d=this;d._log.trace("Adding MasterToken",{SequenceNumber:a.sequenceNumber,SerialNumber:a.serialNumber,Expiration:a.expiration.getTime()});ka.base.call(this,a,b);!c&&(a=d._createKeyRequestData)&&(d._log.trace("Generating new keyx request data"),a().then(function(a){d._keyRequestData=a},function(a){d._log.error("Unable to generate new keyx request data",""+a)}))},addUserIdToken:function K(a,b){this._log.trace("Adding UserIdToken",
{UserId:a,SerialNumber:b.serialNumber,MTSerialNumber:b.mtSerialNumber,Expiration:b.expiration.getTime()});K.base.call(this,a,b)},addServiceTokens:function A(a){A.base.call(this,a.filter(function(a){return!yf[a.name]}))},getKeyRequestData:function(){return this._keyRequestData},getStoreState:function(a){var c=this;b(a,function(){var d=c.getMasterToken();d?c.getKeysForStore(d,{result:function(g){b(a,function(){var a=c.userIdTokens,b=Object.keys(a).map(function(b){var g=a[b];return{userId:b,userIdTokenJSON:a[b].toJSON(),
serviceTokenJSONList:c.getServiceTokens(d,g).map(f)}});g.esn=c._esn;g.masterTokenJSON=d.toJSON();g.userList=b;var k=c._keyRequestData.storeData;k&&Object.keys(k).forEach(function(a){g[a]=k[a]});return g})},timeout:a.timeout,error:a.error}):a.result(null)})},getKeysForStore:function(c,d){var f=this;b(d,function(){var b=f.getCryptoContext(c),b={encryptionKey:b.encryptionKey,hmacKey:b.hmacKey};if(b.encryptionKey&&b.hmacKey)if(f._systemKeyWrapFormat)f.wrapKeysWithSystemKey(b,d);else return b;else throw new B(a.INTERNAL_EXCEPTION,
"Unable to get CryptoContext keys");})},wrapKeysWithSystemKey:function(d,f){var g=this;c(this._systemKeyName,{result:function(c){b(f,function(){var b=d.encryptionKey,k=d.hmacKey,n=b[zd],p=k[zd];if(n&&p)return{wrappedEncryptionKey:n,wrappedHmacKey:p};Promise.resolve().then(function(){return Promise.all([Fa.wrapKey(g._systemKeyWrapFormat,b,c,c.algorithm),Fa.wrapKey(g._systemKeyWrapFormat,k,c,c.algorithm)])}).then(function(a){n=L(a[0]);b[zd]=n;p=L(a[1]);k[zd]=p;f.result({wrappedEncryptionKey:n,wrappedHmacKey:p})}).catch(function(b){f.error(new B(a.INTERNAL_EXCEPTION,
"Error wrapping key with SYSTEM key",b))})})},timeout:f.timeout,error:f.error})},unwrapKeysWithSystemKey:function(d,f){var g=this;c(this._systemKeyName,{result:function(c){b(f,function(){var b=O(d.wrappedEncryptionKey),k=O(d.wrappedHmacKey);Promise.resolve().then(function(){return Promise.all([Fa.unwrapKey(g._systemKeyWrapFormat,b,c,c.algorithm,pc,!1,qb),Fa.unwrapKey(g._systemKeyWrapFormat,k,c,c.algorithm,Mb,!1,ga)])}).then(function(a){var b=a[0];a=a[1];b[zd]=d.wrappedEncryptionKey;a[zd]=d.wrappedHmacKey;
f.result({encryptionKey:b,hmacKey:a})}).catch(function(b){f.error(new B(a.INTERNAL_EXCEPTION,"Error unwrapping with SYSTEM key",b))})})},timeout:f.timeout,error:f.error})},loadStoreState:function(a,b,c,d){function f(d){function g(){if(!y&&L&&B&&I){y=!0;var c=new Jb(b,L,a.esn,{rawKey:B},{rawKey:I});n.setCryptoContext(L,c,!0);d.result(L)}}function k(a,b){p.error(a,b&&""+b);y||(y=!0,d.error())}var y,L,B,I;c.masterTokenJSON?(Rc(b,c.masterTokenJSON,{result:function(a){L=a;g()},timeout:function(){k("Timeout parsing MasterToken")},
error:function(a){k("Error parsing MasterToken",a)}}),n._systemKeyWrapFormat?n.unwrapKeysWithSystemKey(c,{result:function(a){B=a.encryptionKey;I=a.hmacKey;g()},timeout:function(){k("Timeout unwrapping keys")},error:function(a){k("Error unwrapping keys",a)}}):Promise.resolve().then(function(){return Fa.encrypt({name:pc.name,iv:new Uint8Array(16)},c.encryptionKey,new Uint8Array(1))}).then(function(a){B=c.encryptionKey}).catch(function(a){k("Error loading encryptionKey")}).then(function(){return Fa.sign(Mb,
c.hmacKey,new Uint8Array(1))}).then(function(a){I=c.hmacKey;g()}).catch(function(a){k("Error loading hmacKey")})):k("Persisted store is corrupt")}function g(a,d){var f;try{f=c.userList.slice()}catch(p){}f?function Ab(){var c=f.shift();c?gd(b,c.userIdTokenJSON,a,{result:function(b){try{n.addUserIdToken(c.userId,b),k(a,b,c.serviceTokenJSONList,{result:Ab,timeout:Ab,error:Ab})}catch(d){Ab()}},timeout:Ab,error:Ab}):d.result()}():d.result()}function k(a,c,d,f){var g;try{g=d.slice()}catch(p){}if(g){var A=
n.getCryptoContext(a);(function fd(){var d=g.shift();d?oe(b,d,a,c,A,{result:function(a){n.addServiceTokens([a]);fd()},timeout:function(){fd()},error:function(){fd()}}):f.result()})()}else f.result()}var n=this,p=n._log;c.esn!=n._esn?(p.error("ESN mismatch, starting fresh"),d.error()):f({result:function(a){g(a,d)},timeout:d.timeout,error:d.error})}}),yf={"streaming.servicetokens.movie":!0,"streaming.servicetokens.license":!0},zd="$netflix$msl$wrapsys",Nc,gg=Wg.extend({init:function(a,b,c,d,f,g){var k=
new Od([ad.LZW]),n=new Og;n.addPublicKey(b,c);d[Na.RSA]=new Ng(n);b={};b[tc.EMAIL_PASSWORD]=new Vg;b[tc.NETFLIXID]=new Ug;b[tc.MDX]=new dg;a={_mslCryptoContext:{value:new Je,writable:!0,enumerable:!1,configurable:!1},_capabilities:{value:k,writable:!1,enumerable:!1,configurable:!1},_entityAuthData:{value:f,writable:!0,enumerable:!1,configurable:!1},_entityAuthFactories:{value:d,writable:!1,enumerable:!1,configurable:!1},_userAuthFactories:{value:b,writable:!1,enumerable:!1,configurable:!1},_keyExchangeFactories:{value:g,
writable:!1,enumerable:!1,configurable:!1},_store:{value:a,writable:!1,enumerable:!1,configurable:!1}};Object.defineProperties(this,a)},getTime:function(){return Date.now()},getRandom:function(){return new de},isPeerToPeer:function(){return!1},getMessageCapabilities:function(){return this._capabilities},getEntityAuthenticationData:function(a,b){b.result(this._entityAuthData)},getMslCryptoContext:function(){return this._mslCryptoContext},getEntityAuthenticationFactory:function(a){return this._entityAuthFactories[a]},
getUserAuthenticationFactory:function(a){return this._userAuthFactories[a]},getTokenFactory:function(){return null},getKeyExchangeFactory:function(a){return this._keyExchangeFactories.filter(function(b){return b.scheme==a})[0]},getKeyExchangeFactories:function(){return this._keyExchangeFactories},getMslStore:function(){return this._store}}),Fe=ag.extend({init:function(a,b,c,d){this._log=a;this._mslContext=b;this._mslRequest=c;this._keyRequestData=d},getCryptoContexts:function(){return{}},isEncrypted:function(){return!!this._mslRequest.encrypted},
isNonReplayable:function(){return!!this._mslRequest.nonReplayable},isRequestingTokens:function(){return!0},getUserId:function(){return this._mslRequest.userId||null},getUserAuthData:function(a,c,d,f){var g=this._mslRequest,k=this._mslContext;b(f,function(){if(a)return null;if(g.email)return new Td(g.email,g.password);if(g.netflixId)return new kd(g.netflixId,g.secureNetflixId);if(g.mdxControllerToken){var b=(new Ic("regpairrequest",g.mdxNonce,g.mdxEncryptedPinB64,g.mdxSignature)).getEncoding();return new Tc(k,
g.mdxPin,g.mdxControllerToken,b,g.mdxSignature)}if(d&&g.getIdCookies){var c=g.getIdCookies(),b=c.netflixId,c=c.secureNetflixId;if(b)return new kd(b,c)}return null})},getCustomer:function(){return null},getKeyRequestData:function(a){a.result(this._mslRequest.allowTokenRefresh?[this._keyRequestData]:[])},updateServiceTokens:function(a,b,c){var d=this._log,f=(this._mslRequest.serviceTokens||[]).slice(),g=this._mslContext;b=g.getMslStore();var k=a.builder.getMasterToken(),n=this.getUserId(),p=b.getUserIdToken(n);
(function Ja(){var b=f.shift();if(b)try{b instanceof Sc?(a.addPrimaryServiceToken(b),Ja()):oe(g,b,k,p,null,{result:function(b){try{a.addPrimaryServiceToken(b)}catch(c){d.warn("Exception adding service token",""+c)}Ja()},timeout:function(){d.warn("Timeout parsing service token");Ja()},error:function(a){d.warn("Error parsing service token",""+a);Ja()}})}catch(n){d.warn("Exception processing service token",""+n),Ja()}else c.result(!0)})()},write:function(a,b,c){var d=S(this._mslRequest.body);a.write(d,
0,d.length,b,{result:function(f){f!=d.length?c.error(new ob("Not all data was written to output.")):a.flush(b,{result:function(){c.result(!0)},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},timeout:function(){c.timeout()},error:function(a){c.error(a)}})},getDebugContext:function(){this._dc||(this._dc=new Xg(this._log,this._mslRequest));return this._dc}}),Xg=$f.extend({init:function(a,b){this._log=a;this._mslRequest=b},sentHeader:function(a){this._log.trace("Sent MSL header",n(this._mslRequest,
a),a.serviceTokens&&a.serviceTokens.map(vb).join("\n"))},receivedHeader:function(a){var b=n(this._mslRequest,a),c=a.errorCode;c?this._log.warn("Received MSL error header",b,{errorCode:c,errorMessage:a.errorMessage,internalCode:a.internalCode}):this._log.trace("Received MSL header",b)}}),bf={PSK:function(a){return ib(a,Na.PSK,yd,rc,Qe,Pb)},MGK:function(a){return ib(a,Na.MGK,ic,qc,Qe,Pb)},MGK_WITH_FALLBACK:function(b){var c;switch(b.esnPrefix){case "GOOGEUR001":case "GOOGLEXX01":c="PSK";break;default:c=
"MGK"}var d=bf[c];if(!d)throw new B(a.INTERNAL_EXCEPTION,"Invalid fallback authenticationType: "+c);return d(b)},MGK_JWE:function(a){return ib(a,Na.MGK,ic,qc,Hf,Oe)},JWK_RSA:function(a){return Wb(a,{name:"RSA-OAEP",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-1"}},Md.JWK_RSA)},JWK_RSAES:function(a){return Wb(a,{name:"RSAES-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])},Md.JWK_RSAES)},JWEJS_RSA:function(a){return Wb(a,{name:"RSA-OAEP",modulusLength:2048,
publicExponent:new Uint8Array([1,0,1])},Md.JWEJS_RSA)}};dc.netflix=dc.netflix||{};dc.netflix.msl={createMslClient:function(b,c){var d=b.log,f,g,k,n=b.notifyMilestone||function(){};Promise.resolve().then(function(){if(!(y&&y.generateKey&&y.importKey&&y.unwrapKey))throw new B(a.INTERNAL_EXCEPTION,"No WebCrypto");Ka=y.generateKey({name:"AES-CBC",length:128},!0,qb).then?Sa.V2014_02:Sa.LEGACY;n("mslisik");return Fa.importKey("spki",b.serverIdentityKeyData,pb,!1,["verify"])}).then(function(b){return new Promise(function(c,
d){Pc(b,{result:c,error:function(){d(new B(a.KEY_IMPORT_ERROR,"Unable to create server identity verification key"))}})})}).then(function(c){f=c;if(c=bf[b.authenticationType])return n("mslcc"),c(b);throw new B(a.INTERNAL_EXCEPTION,"Invalid authenticationType: "+b.authenticationType);}).then(function(a){g=new we(d,b.esn,a.keyRequestData,a.createKeyRequestData,b.authenticationKeyNames.s,b.systemKeyWrapFormat);k=new gg(g,b.serverIdentityId,f,a.entityAuthFactories,a.entityAuthData,a.keyExchangeFactories);
var c=b.storeState;if(c)return n("mslss"),d.info("Loading store state"),new Promise(function(a,d){g.loadStoreState(b,k,c,{result:a,timeout:a,error:a})});d.info("No store state, starting fresh")}).then(function(){var a=new Ye;n("msldone");c.result(new xc(d,a,k,g))}).catch(function(a){c.error(a)})},IHttpLocation:Qg,MslIoException:ob}})(window);
(function(){(function x(F,k,S){function aa(p,Da){if(!k[p]){if(!F[p]){var pa="function"==typeof require?require:void 0;if(!Da&&pa)return pa(p,!0);if(I)return I(p,!0);pa=Error("Cannot find module '"+p+"'");throw pa.code="MODULE_NOT_FOUND",pa;}pa=k[p]={Va:{}};F[p][0].call(pa.Va,function(b){var g=F[p][1][b];return aa(g?g:b)},pa,pa.Va,x,F,k,S)}return k[p].Va}for(var I="function"==typeof require?require:void 0,p=0;p<S.length;p++)aa(S[p]);return aa})({1:[function(x){(function(F,k){function S(a){a=qa(a)?
ld(a):a;return fi.Cg(a)}function aa(){return!0}function I(){}function p(){}function Y(a){return null!==a&&a!==k}function Da(a){return"object"==typeof a}function pa(a){return a&&a.constructor==$a}function b(a,b,c){return"number"==typeof a&&!isNaN(a)&&isFinite(a)&&(b===k||a>=b)&&(c===k||a<=c)}function g(a,c,d){return b(a,c,d)&&0==a%1}function a(a){return a&&Yg.test(a)}function qa(a){return"string"==typeof a}function Za(a){return qa(a)&&a}function f(a){return"function"==typeof a}function c(a,b){for(var c in a)a.hasOwnProperty(c)&&
b(c,a[c])}function n(a,b,d){if(b)if(d){var f=d.nh,g=d.prefix,k=d.ff;c(b,function(b,c){if(!k||Y(c))a[(g||"")+(f?b.toLowerCase():b)]=c})}else c(b,function(b,c){a[b]=c});return a}function vb(a,b,c,d){if(a){var g=a[b];f(g)&&(c=g.apply(a,Zg.call(arguments,3)))}}function xc(a){var b={};c(a,function(a,z){b[a]=z});return b}function ib(a){for(var b=0,c=arguments.length;b<c;){var d=arguments[b++];if(Y(d))return d}}function Wb(a){for(var b,c=!0,d;c;)for(c=!1,b=a.length;--b;)d=a[b],d.startTime<a[b-1].startTime&&
(a[b]=a[b-1],a[b-1]=d,c=!0)}function Fb(a){for(var b={},c=a.length;c--;)b[a[c]]=!0;return b}function y(a){return Jc(a,10)}function zb(a,b){return jb(a+cf()*(b-a))}function L(a){if(a){var b=a.stack,c=a.number;a=""+a;b?(b=""+b,0!=b.indexOf(a)&&(b=a+"\n"+b)):b=a;c&&(b+="\nnumber:"+c);return b}}function O(a){return b(a)?a.toFixed(0):""}function Oa(a){return b(a)?(a/1E3).toFixed(0):""}function be(a){return b(a)?a.toFixed():""}function ce(a,b){try{var c=Yb.plugins,d=c.length,f;for(f=0;f<d;f++)if(b.test(c[f][a]))return c[f];
return!1}catch(g){}}function na(){var a=ce("filename",/widevinecdm/i);if(a){try{var b=a.description.match(/version: ([0-9.]+)/);if(b&&b[1])return b[1]}catch(c){}return"true"}return"false"}function Ha(){try{var a=Qb.defineProperty({},"videoCapabilities",{value:[{contentType:'video/mp4; codecs="avc1.640028"'}]});Yb.requestMediaKeySystemAccess("com.widevine.alpha",[a]).then(function(){Uc.cpth264wv=!0}).catch(function(){Uc.cpth264wv=!1})}catch(b){}}function ad(a,b){if(a===b)return!0;if(!a||!b)return!1;
for(var c in a)if(a.hasOwnProperty(c)&&(!b.hasOwnProperty(c)||a[c]!==b[c]))return!1;return!0}function Hd(a,b){if(a.length==b.length){for(var c=a.length;c--;)if(a[c]!=b[c])return!1;return!0}return!1}function ud(a){if(a){var b=a.length;if(b)return b=zb(0,b-1),a[b]}}function Af(a,b){function c(){a.removeEventListener("loadedmetadata",c);b.apply(this,arguments)}a.addEventListener("loadedmetadata",c)}function Qc(){var a=tb.cookie.split("; "),b=a.length,c,d,f,g={};for(c=0;c<b;c++)if(d=gi(a[c]))f=d.indexOf("="),
0<f&&(g[d.substr(0,f)]=d.substr(f+1));return g}function Id(){var a,b;if(a=Id.Kn)return a;a=df.search.substr(1);b=a.indexOf("#");0<=b&&(a=a.substr(0,b));a=d(a);return Id.Kn=a}function d(a){for(var b=/[+]/g,c=(a||"").split("&"),d={},f,g=0;g<c.length;g++)a=gi(c[g]),f=a.indexOf("="),0<=f?d[hi(a.substr(0,f).replace(b,"%20")).toLowerCase()]=hi(a.substr(f+1).replace(b,"%20")):d[a.toLowerCase()]=null;return d}function ea(a){var b="";c(a,function(a,z){b&&(b+="&");b+=Vd(a)+"="+Vd(z)});return b}function Ga(a,
b,d,f){var g=tb.createElement(a);b&&(g.style.cssText=b);d&&(g.innerHTML=d);f&&c(f,function(a,b){g.setAttribute(a,b)});return g}function de(a){var b="";c(a,function(a,z){b+=(b?";":"")+a+":"+z});return b}function Fc(a,b){var c=a[0];if(b<=c[0])return c.slice(1);for(var d=1,f;f=a[d++];){if(b<=f[0]){var d=(b-c[0])/(f[0]-c[0]),g=[];Ca(c.length,f.length);for(var k=1;k<c.length;k++)g.push((c[k]||0)+d*((f[k]||0)-(c[k]||0)));return g}c=f}return c.slice(1)}function B(a){return Qj.call(a,function(a,b){return a-
b})}function T(a){for(var b=0,c=a.length;c--;)b+=a[c];return b}function Z(a,b){var c=-1,d=a.length,f,g;if(1===arguments.length){for(;++c<d&&!(null!=(f=a[c])&&f<=f);)f=k;for(;++c<d;)null!=(g=a[c])&&g>f&&(f=g)}else{for(;++c<d&&!(null!=(f=b.call(a,a[c],c))&&f<=f);)f=k;for(;++c<d;)null!=(g=b.call(a,a[c],c))&&g>f&&(f=g)}return f}function yc(a,b){var c=-1,d=a.length,f,g;if(1===arguments.length){for(;++c<d&&!(null!=(f=a[c])&&f<=f);)f=k;for(;++c<d;)null!=(g=a[c])&&f>g&&(f=g)}else{for(;++c<d&&!(null!=(f=b.call(a,
a[c],c))&&f<=f);)f=k;for(;++c<d;)null!=(g=b.call(a,a[c],c))&&f>g&&(f=g)}return f}function Bb(a){return f(a.then)?a:new Wd(function(b,c){a.oncomplete=function(){b(a.result)};a.onerror=function(){c(a.error)}})}function ob(a,c){function d(a){0>f.indexOf(a)&&b(a)&&f.push(a)}a=a.slice();B(a);var f=[];if(!c||!c.length)return a;if(!a.length)return[];var g=c.length,k,D;try{for(;g--;){var h=""+c[g],l=y(h);switch(h[h.length-1]){case "-":for(k=a.length;k--;)if(D=a[k],D<l){d(D);break}break;case "+":for(k=0;k<
a.length;k++)if(D=a[k],D>l){d(D);break}break;default:0<=a.indexOf(l)&&d(l)}}}catch(u){}f.length||f.push(a[0]);B(f);return f}function W(a,b,c){var d;a/b>c?(d=jb(b*c),a=b):(d=a,a=jb(a/c));return{width:d,height:a}}function sb(a,b){var c=a.length,d=(c-1)*b+1;if(1===d)return a[0];if(d==c)return a[c-1];c=xa(d);return a[c-1]+(d-c)*(a[c]-a[c-1])}function Ra(a){try{return d($g(a)).bt}catch(b){}}function oc(a,b){b=md.isArray(b)?b:[b];for(var c=a.length,d=0;d<c;d++)for(var f=0;f<b.length;f++)if(a[d].type==b[f])return a[d];
throw new Ta("Box not found "+b);}function Aa(a){return a.ub("trak/mdia/minf/stbl/stsd/enca|encv").children.filter(function(a){return"sinf"==a.type&&"cenc"==a.Jg.schm.Ns})[0].ub("schi/tenc").kh}function Pa(a){function b(a,z){var d=c[a];c[a]=c[z];c[z]=d}var c=new $a(a);b(0,3);b(1,2);b(4,5);b(6,7);return c}function Fa(){try{var a=/playercore.*js/,b=Xd.getEntries("resource").filter(function(b){return null!==a.exec(b.name)});if(b&&0<b.length){var c=jb(b[0].duration);return lb.stringify(c)}}catch(d){}}
function Ka(a,b,c){return a>=b?a<=c?a:c:b}function Sa(a){if(b(a))return(a/1E3).toFixed(3)}function ec(a,b){var c=Zg.call(arguments,1);return a.replace(/{(\d+)}/g,function(a,b){return"undefined"!=typeof c[b]?c[b]:a})}function pc(a){for(var b=a.length,c=new Uint16Array(b),d=0;d<b;d++)c[d]=a.charCodeAt(d);return c.buffer}function Mb(a){function b(){if(g)for(var a;a=d.pop();)a(k)}function c(a){g=!0;k=a;b()}var d=[],f,g,k;return function(g){d.push(g);f||(f=!0,a(c));b()}}function Ba(a){return F.setTimeout(a,
0)}function Ya(a,b){return F.setTimeout(a,b)}function pb(a){F.clearTimeout(a)}function qb(a,b){return F.setInterval(a,b)}function wb(a){F.clearInterval(a)}function ga(){var a=ef()-nd;if(a<ah){var b=ah+1,c=b-a;Ba(function(){ua.warn("Clock roll-back detected, adjusting time",{Delta:""+-c})});nd-=c;a=b}return ah=a}function Nb(){return xa(ef()/1E3)}function Oc(){}function Cb(a){function b(d){k=null;c(d||a)}function c(a){var z=ga();if(g){var d=a-(z-f);0>=d?(a=g,g=null,f=z,a()):k=k||Ya(b.bind(this,a),d)}}
var d=this,f=-a,g,k;this.Np=function(){return a};this.Qh=function(b){a=b};this.ob=function(a){g=a;k=k||Ba(b)};this.Ms=function(a){d.Nc();Ba(a)};this.Nc=function(){k&&pb(k)}}function ee(a){var b=0,c;this.get=function(){var d=ga();if(!c||1E3<d-b)b=d,c=a();return c};this.clear=function(){c=k}}function Pc(a){this.Ka={index:a.index,qa:a.qa,Zc:a.Zc,sa:a.sa,$c:a.$c,Hb:Tc.prototype.Hb};this.r=function(a){this.fj=a};this.r.prototype=this}function Gc(a){var b=a.length,c,d=1;if(b>d){c=He(a[d]);if(b==d+1)return c;
for(var f={};d<b;)n(f,c),c=He(a[++d]);return f}}function He(a){return a&&Da(a)?a.Ja?a.Ja:f(a.Ke)?a.Ke():Rj.test(a.name)?{Exception:a.message||""+a,StackTrace:a.stack||"nostack"}:a:Y(a)?{Details:""+a}:{}}function $c(a,b,d){var f=a.fields||{},g=""+a.message;c(f,function(a,b){Sj.hasOwnProperty(a)||(g+=", "+a+": "+b)});g=g.replace(Tj," ");a=(a.time/1E3).toFixed(3)+"|"+(a.Ka&&a.Ka.index||0)+"|"+(Uj[a.level]||a.level)+"|"+a.category+"| "+g;f.Exception&&(a+="\r\n"+f.Exception);b&&f.StackTrace&&(a+="\r\n"+
f.StackTrace);d&&f.Details&&(a+="\r\n"+f.Details);return a}function Hb(){function a(z,d,f){var g="$netflix$player$order"+c+"$"+z;if(b){var k=b[z]?b[z].slice():[];f&&(d[g]=f);0>k.indexOf(d)&&(k.push(d),k.sort(function(a,b){return(a[g]||0)-(b[g]||0)}));b[z]=k}}var b={},c="$es$"+Vj++;n(this,{addListener:a,removeListener:function(a,c){if(b&&b[a]){for(var z=b[a].slice(),d;0<=(d=z.indexOf(c));)z.splice(d,1);b[a]=z}},Gw:function(a){return b&&!!(b[a]||(b[a]=[])).length},B:function(a,c,z){if(b)for(var d=b[a]||
(b[a]=[]),f=0;f<d.length;f++)if(z)(function(){var a=d[f];Ba(function(){a(c)})})();else d[f](c)},Th:function(a,c){if(b){var z=b[a]||(b[a]=[]);c=c||{};for(var d=0;d<z.length&&!c.$j;d++)z[d](c)}},Nc:function(){b=k},on:a})}function Ie(){function a(z){var f=c.indexOf(z);0<=f?c.splice(f,1):z==d&&(d=k);Ba(b)}function b(){for(var V=0,k,h;!d&&(k=f[V]);){if(0>=c.length||!k.qk)f.splice(V,1),h=g++,k.qk?d=h:c.push(h),k.xo({c:!0,ax:h,qf:function(){a(h)}});V++}}var c=[],d,f=[],g=1;n(this,{Pn:function(a,c){f.push({qk:a,
xo:c});b()},qf:a})}function Wa(a,b){function c(a,b){return(a["$netflix$player$order"+g]||0)-(b["$netflix$player$order"+g]||0)}var d=this,f=b?[b]:[],g="$op$"+Wj++;n(d,{value:a,addListener:function(a,b){f.indexOf(a);a["$netflix$player$order"+g]=b;f=f.slice();f.push(a);f.sort(c)},removeListener:function(a){f=f.slice();var b;0<=(b=f.indexOf(a))&&f.splice(b,1)},set:function(a,b){if(d.value!==a){var c={oldValue:d.value,newValue:a};b&&n(c,b);d.value=a;for(var z=f,q=z.length,g=0;g<q;g++)z[g](c)}}})}function fe(){}
function Ob(a,b){var c;n(this,{qc:function(){c||(c=Ya(b,a))},yb:function(){c&&(pb(c),c=k)}})}function ge(a){var b,c="";for(b=8;b--;)c=(Xj[a&15]||"0")+c,a>>>=4;return c}function Ib(a,b,c){this.errorCode=a||R.jc;b&&Da(b)?(this.g=b.g,this.R=b.R,this.C=b.C,this.we=b.wp,this.Rc=b.Rc,this.Eg=b.Eg,this.Sc=b.Sc,this.xd=b.xd,this.Ga=b.Ga,this.df=b.method):(this.g=b,this.R=c);a=this.stack=[this.errorCode];this.g?a.push(this.g):this.R&&a.push(P.jc);this.R&&a.push(this.R);this.Mc=hg+a.join("-")}function he(a){return 1100<=
a&&1199>=a}function wd(a){return 1300<=a&&1399>=a}function Hc(a){return 1900<=a&&1999>=a}function zc(a,b){y(a);return 1<=a&&9>=a?b+a:b}function dd(a){return zc(a,P.mm)}function ed(a){return zc(a,P.Il)}function cb(a){var b={};b.ErrorSubCode=a.g||P.jc;a.R&&(b.ErrorExternalCode=a.R);a.C&&(b.ErrorDetails=a.C);return b}function fc(a){ii[a]=ga()}function Jb(a){if(qa(a)&&Yj.test(a)){var b=a.split(".");if(4===b.length){for(var c=0;c<b.length;c++){var d=y(b[c]);if(0>d||!g(d,0,255)||1!==b[c].length&&0===b[c].indexOf("0"))return}return a}}}
function Je(a){var b=0;if(Jb(a)===a)return a=a.split("."),b+=y(a[0])<<24,b+=y(a[1])<<16,b+=y(a[2])<<8,b+y(a[3])}function Na(a){if(qa(a)&&a.match(Zj)){var b=a.split(":");if(-1!==b[b.length-1].indexOf(".")){a=Je(b[b.length-1])>>>0;var c=[];c.push((a>>>16&65535).toString(16));c.push((a&65535).toString(16));b.pop();b.push(c[0]);b.push(c[1]);a=b.join(":")}a=a.split("::");if(!(2<a.length||1===a.length&&8!==b.length)){if(1<a.length)if(b=a[0].split(":"),a=a[1].split(":"),1===b.length&&""===b[0]&&(b=[]),1===
a.length&&""===a[0]&&(a=[]),c=8-(b.length+a.length),1>c)b=[];else{var d;for(d=0;d<c;d++)b.push("0");for(d=0;d<a.length;d++)b.push(a[d])}a=b.length;if(8===a){for(;a--;)if(c=Jc(b[a],16),!g(c,0,65535))return;return b.join(":")}}}}function bd(a,b,c){var d=Jb(a),f=Na(a),g=Jb(b),k=Na(b);if(!d&&!f||!g&&!k||d&&!g||f&&!k)return!1;if(a===d)return c=-1<<32-c,(Je(a)&c)!==(Je(b)&c)?!1:!0;if(a===f){a=a.split(":");b=b.split(":");for(d=xa(c/16);d--;)if(a[d]!==b[d])return!1;c%=16;if(0!==c)for(a=Jc(a[d],16).toString(2),
b=Jc(b[d],16).toString(2),a="0000000000000000".substring(0,16-a.length)+a,b="0000000000000000".substring(0,16-b.length)+b,d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}return!1}function ie(a,b){var c;this.Sh=function(){c||(c=qb(b,a))};this.ud=function(){c&&(wb(c),c=k)}}function Jd(a,b,c,d,f){Fd(a,function(a){a.c?ak(a.object,b,c,d,function(a){a.c?f({c:!0,entries:a.entries}):f(a)}):f(a)})}function qc(){function a(c){var z=d.Sg();if(f!=z){var q,g;z<Db&&(g=l||u[xa(z*U)]||u[0]);if(g){for(;g&&g.endTime<
z;)g=g.next;for(;g&&g.previous&&g.previous.endTime>=z;)g=g.previous}g&&(g.startTime<=z&&z<=g.endTime?(q=g,b(g.endTime-z)):b(g.startTime-z));l=g;f=z;h!=q&&(h=q,!c&&d.xh&&d.xh())}}function b(a){eb&&(pb(eb),eb=k);g&&0<a&&(eb=Ya(c,a+bk))}function c(){eb=k;a()}var d=this,f,g,h,l,eb,u,Db,U;n(d,{fl:function(b){var c=b&&b.length;l=h=f=k;u=b;Db=c&&Ca.apply(null,b.map(function(a){return a.endTime}));U=c&&c/Db;a()},Sg:k,start:function(){g=!0;a()},stop:function(){g=!1;eb&&(pb(eb),eb=k)},Ep:function(){a(!0);return h},
xh:k})}function Ke(a,b,c,d,f){var g="";a.textNodes.forEach(function(a){var z=g,h=a.style,l=ji(a.text);for(a=a.lineBreaks;a--;)l="<br />"+l;var n=h.characterStyle;a=d[n];var U;0<=n.indexOf("MONOSPACE")?(n=h.cellResolution,U=a&&n&&(40===n.x&&19===n.y?U=4/3/(40/19):52===n.x&&19===n.y&&(U=16/9/(52/19)),U)?a.width/a.fontSize/U:void 0,U=U||a.lineHeight):U=a.lineHeight;U=h.characterSize*b.height/(U||1);U=0<f?xa(U*f):jb(U);U={"font-size":U+"px","line-height":"normal","font-weight":"normal"};h.characterItalic&&
(U["font-style"]="italic");h.characterUnderline&&(U["text-decoration"]="underline");h.characterColor&&(U.color=h.characterColor);h.backgroundColor&&0!==h.backgroundOpacity&&(n=h.backgroundColor,a=h.backgroundOpacity,a=a!==k?a:1,n=n.substring(1),n=Jc(n,16),U["background-color"]="rgba("+(n>>16&255)+","+(n>>8&255)+","+(n&255)+","+a+")");a=h.characterEdgeColor||"#000000";switch(h.characterEdgeAttributes){case bh:U["text-shadow"]=a+" 0px 0px 13px";break;case ki:U["text-shadow"]="-1px 0px "+a+",0px 1px "+
a+",1px 0px "+a+",0px -1px "+a;break;case ck:U["text-shadow"]="-1px -1px white, 0px -1px white, -1px 0px white, 1px 1px black, 0px 1px black, 1px 0px black";break;case dk:U["text-shadow"]="1px 1px white, 0px 1px white, 1px 0px white, -1px -1px black, 0px -1px black, -1px 0px black"}U=de(U);(a=c[h.characterStyle||"PROPORTIONAL_SANS_SERIF"])&&(U+=";"+a);h=h.characterOpacity;0<h&&1>h&&(l='<span style="opacity:'+h+'">'+l+"</span>");g=z+('<span style="'+U+'">'+l+"</span>")});return g}function Mg(a,b,d,
f,g){var k="",h=g.width;g=g.height;for(var l=b.length;l--;){var eb=b[l],u=a[l],u=u&&u.region,n="position:absolute;background:"+f+";width:"+jb(eb.width+2*d)+"px;height:"+jb(eb.height+2*d)+"px;";c(rc(u,eb,h,g,d),function(a,b){n+=a+":"+b+";"});k+='<div style="'+n+'"></div>'}return k}function rc(a,b,c,d,f){var g={};"right"==a.horizontalAlignment?g.right=100*(c-b.left-b.width-f)/c+"%":g.left=100*(b.left-f)/c+"%";"bottom"==a.verticalAlignment?g.bottom=100*(d-b.top-b.height-f)/d+"%":g.top=100*(b.top-f)/
d+"%";return g}function Bf(a){function b(){var c=f.parentNode,k=c&&c.clientWidth,V=c&&c.clientHeight,U=c=0,m={width:k,height:V},v,H;if(0<k&&0<V&&g){h&&(m=W(k,V,h),c=jb((k-m.width)/2),U=jb((V-m.height)/2));var N=g.blocks;v=N&&N.map(function(b){var c=Ke(b,m,a,D),d={display:"block","white-space":"nowrap"};switch(b.region.horizontalAlignment){case "left":d["text-align"]="left";break;case "right":d["text-align"]="right";break;default:d["text-align"]="center"}b=de(d)+";position:absolute";return Ga("div",
b,c,ch)})}n(d,{left:c+"px",right:c+"px",top:U+"px",bottom:U+"px"});f.style.display="none";f.innerHTML="";if(v&&v.length){k=m.width;c=m.height;v.forEach(function(a){f.appendChild(a)});var p=de(d);f.style.cssText=p+";visibility:hidden;z-index:-1";var G=[],M,ca,ia;for(H=v.length;H--;)ca=v[H],ia=N[H],M=Le(ca,ia,k,c),M.width>k&&(ca.innerHTML=Ke(ia,m,a,D,k/M.width),M=Le(ca,ia,k,c)),G[H]=M;H=m;l&&(H=je(m,l,V,U));G=Cf(G,H);if(U=N&&N[0]&&N[0].textNodes&&N[0].textNodes[0]&&N[0].textNodes[0].style)V=U.windowColor,
U=U.windowOpacity,V&&0<U&&(H=jb(c/50),V=Mg(N,G,H,V,m),V=Ga("div","position:absolute;left:0;top:0;right:0;bottom:0;opacity:"+U,V,ch),f.insertBefore(V,f.firstChild));f.style.display="none";for(H=G.length;H--;)M=G[H],n(v[H].style,rc(N[H].region,M,k,c,0));f.style.cssText=p}}var d={position:"absolute",left:"0",top:"0",right:"0",bottom:"0",display:"block"},f=Ga("DIV",k,k,{"class":"player-timedtext"}),g,h,D=function(a){var b={};c(a,function(a,c){var z=Ga("DIV","display:block;position:fixed;z-index:-1;visibility:hidden;font-size:1000px;"+
c+";","ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",ch);tb.body.appendChild(z);var d={fontSize:1E3,height:z.clientHeight,width:z.clientWidth/52,lineHeight:z.clientHeight/1E3};tb.body.removeChild(z);b[a]=d});return b}(a),l;f.onselectstart=function(){return!1};n(this,{Oj:function(){return f},ct:function(a){h=a},et:function(a){g=a;b()},ys:b,Rh:function(a){l=a;b()}})}function Le(a,b,c,d){var f=b.region,g=(f.marginTop||0)*d,k=(f.marginBottom||0)*d,h=(f.marginLeft||0)*c,l=(f.marginRight||0)*c;
b=a.clientWidth||1;a=a.clientHeight||1;switch(f.verticalAlignment){case "top":d=g;break;case "center":d=(g+d-k-a)/2;break;default:d=d-k-a}switch(f.horizontalAlignment){case "left":c=h;break;case "right":c=c-l-b;break;default:c=(h+c-l-b)/2}return{top:d,left:c,width:b,height:a}}function je(a,b,c,d){return{height:c-Ca(d,b.bottom|0)-Ca(d,b.top|0),width:a.width}}function Cf(a,b){function c(a,b,z){if(a&&1<a.length){for(var f=[],q=[],g=0;g<a.length;g++)f[g]=0,q[g]=0;for(var k=!1,g=0;g<a.length;g++)for(var V=
g+1;V<a.length;V++){var h,ba=a[g],l=a[V];if(0>ba.width||0>l.width||l.left>ba.left+ba.width||l.left+l.width<ba.left||l.top>ba.top+ba.height?0:l.top+l.height>=ba.top){h=Ca(ba.left,l.left);var Ma=Ca(ba.top,l.top);h={width:Ca(ya(ba.left+ba.width,l.left+l.width)-h,0),height:Ca(ya(ba.top+ba.height,l.top+l.height)-Ma,0),x:h,y:Ma}}else h=void 0;if(h&&1<h.width&&1<h.height)if(Ma=h.width<=h.height,ba=d(a[g]),l=d(a[V]),Ma&&b||!Ma&&!b)h=Ca(h.width/2,.25),ba.x<=l.x?(q[g]-=h,q[V]+=h):(q[V]-=h,q[g]+=h);else if(Ma&&
!b||!Ma&&b)ba=Ca(h.height/2,.25),f[g]-=ba,f[V]+=ba}for(g=0;g<a.length;g++){if(-.25>q[g]&&0<=a[g].left+q[g]||.25<q[g]&&a[g].left+a[g].width+q[g]<=z.width)a[g].left+=q[g],k=!0;if(-.25>f[g]&&0<=a[g].top+f[g]||.25<f[g]&&a[g].top+a[g].height+f[g]<=z.height)a[g].top+=f[g],k=!0}return k}}function d(a){return{x:a.left+a.width/2,y:a.top+a.height/2}}var f=a.map(function(a){return{top:a.top,left:a.left,width:a.width,height:a.height}});(function(a,b){a.forEach(function(a){0>a.left&&a.left+a.width<b.width?a.left+=
ya(-a.left,b.width-(a.left+a.width)):a.left+a.width>b.width&&0<a.left&&(a.left-=ya(a.left+a.width-b.width,a.left));0>a.top&&a.top+a.height<b.height?a.top+=ya(-a.top,b.height-(a.top+a.height)):a.top+a.height>b.height&&0<a.top&&(a.top-=ya(a.top+a.height-b.height,a.top))})})(f,b);for(var g=0;50>g&&c(f,!0,b);g++);for(g=0;50>g&&c(f,!1,b);g++);return f}function Ng(a){li.root.getDirectory("netflix.player.namedatapair",mi,function(b){a({c:!0,ap:b})},function(){a({g:P.Cn})})}function Gd(a,b,c){function d(){c({g:P.zn})}
a.getFile(b,ni,function(a){a.file(function(b){var z=new oi;z.onloadend=function(){c({c:!0,text:z.result,Hg:a})};z.onerror=d;z.readAsText(b)},d)},d)}function Df(a,b,c,d,f){function g(){f&&f({g:P.Bn})}function k(a){a.createWriter(function(b){try{b.onwriteend=function(){b.onwriteend=null;b.onerror=null;b.truncate(b.position);f&&f({c:!0,Hg:a})},b.onerror=g,b.write(new ek([c]))}catch(z){g()}},g)}b.createWriter?k(b):a.getFile(b,d?fk:mi,k,g)}function Lg(a,b,c){function d(){c&&c({g:P.An})}function f(a){a.remove(function(){c&&
c(va)},d)}b.remove?f(b):a.getFile(b,ni,f,d)}function Og(a){var b={};a({c:!0,Xh:{load:function(a,c){b.hasOwnProperty(a)?c({c:!0,data:b[a],Xd:a}):c({g:P.Cc})},save:function(a,c,z,d){z&&b.hasOwnProperty(a)?d({c:!1}):(b[a]=c,d&&d({c:!0,Xd:a}))},remove:function(a,c){delete b[a];c&&c(va)}}})}function Me(a){function b(){b=p;a({c:!0,Xh:{load:function(a,b){c(a,function(c){Gd(d,a,function(a){Ba(c.qf);if(a.c){var z=a.text,d;try{z&&(d=lb.parse(z))}catch(f){b({g:P.Dn});return}d?b({c:!0,data:d,Xd:a.Hg}):b({g:P.Cc})}else b(a)})})},
save:function(a,b,z,f){var g=a.name||a,k=lb.stringify(b);c(g,function(b){Df(d,a,k,z,function(a){Ba(b.qf);a.c?f&&f({c:!0,Xd:a.Hg}):f&&f(a)})})},remove:function(a,b){c(a.name||a,function(c){Lg(d,a,function(a){Ba(c.qf);b&&b(a)})})}}})}function c(a,b){(f[a]||(f[a]=new Ie)).Pn(!0,b)}var d,f={};Ng(function(c){c.c?(d=c.ap,b()):a(c)})}function ke(a){function b(d,f){b=p;k&&k.yb();if(d){var g={g:d};f&&(g.C=f);a(g)}else a({c:!0,Xh:{load:function(a,b){c("get",!1,a,function(c){var z;try{var d=c.target.result;
z=d?{c:!0,data:d.data,Xd:a}:{g:P.Cc}}catch(f){z={g:P.Ki,C:L(f)}}b(z)},function(a){b({g:P.Ki,C:a})},function(){b({g:P.Li})})},save:function(a,b,z,d){c(z?"add":"put",!0,{name:a,data:b},function(){d&&d({c:!0,Xd:a})},function(a){d&&d({g:P.Gn,C:a})},function(){d&&d({g:P.Oi})})},remove:function(a,b){c("delete",!0,a,function(){b&&b(va)},function(a){b&&b({g:P.Ii,C:a})},function(){b&&b({g:P.Uf})})}}})}function c(a,b,z,f,q,k){function V(){ba&&ba.yb();h&&(h.onsuccess=null,h.onerror=null)}try{var h=g.transaction("namedatapairs",
b?"readwrite":"readonly").objectStore("namedatapairs")[a](z);h.onsuccess=function(a){V();f(a)};h.onerror=function(){V();q(d(h))};var ba=new Ob(v.ll,function(){V();k()});ba.qc()}catch(D){V(),q(L(D))}}function d(a){a=a&&a.error;return"onerror: "+(a&&(a.name||""+a))}var f=new ua.r("Storage"),g;if(dh){var k=new Ob(v.ll,function(){b(P.oi)});k.qc();fc("idbo");var h=dh.open("netflix.player",1);h?(h.onblocked=function(){b(P.Ol)},h.onupgradeneeded=function(){fc("idbun");g=h.result;g.createObjectStore("namedatapairs",
{keyPath:"name"})},h.onsuccess=function(){fc("idbs");g=h.result;b()},h.onerror=function(){fc("idbe");var a=d(h);f.error("IndexedDB open error",a);b(P.Pl,a)}):b(P.ni)}else eh?b(P.Nl,L(eh)):b(P.mi)}function Pg(a){function d(a,b){c(a,function(a,c){f(c)?b[a]=c.call(k,b[a]):Da(c)&&(b[a]=b[a]||{},d(c,b[a]))})}function q(a,b){var c=Zg.call(arguments,1);return function(b){Y(b)&&(c[1]=b);return a.apply(k,c)}}function h(a){a=a.toLowerCase();Ua.hasOwnProperty(a)&&(ha[a]=Ua[a]);return a}function ba(a,b,c){a=
a.toLowerCase();if(ha.hasOwnProperty(a)){var z=ha[a];try{z=c?c(z):z}catch(d){z=k}if(z!==k)return z;ua.error("Invalid configuration value. Name: "+a)}return b}function l(a,b,c,z){return ba(a,b,function(a){qa(a)&&(a=y(a));if(g(a,c,z))return a})}function D(a,b,c,z){return ba(a,b,function(a){qa(a)&&(a=y(a));if(g(a,c||0,z))return a})}function db(a,c,z,d){return ba(a,c,function(a){qa(a)&&(a=uc(a));if(b(a,z,d))return a})}function m(a,b,c){return ba(a,b,function(a){if(c?c.test(a):qa(a))return a})}function u(a,
b){return ba(a,b,function(a){if("true"==a||!0===a)return!0;if("false"==a||!1===a)return!1})}function Db(a,b,c,z){a=a.split("|");for(var d=a.length;d--;)if(a[d]=y(a[d]),!g(a[d],b||0,c))return;if(z===k||a.length>=z)return a}function U(a,b,c,z,d){return ba(a,b,function(a){return Db(a,c,z,d)})}function p(a,b,c,z,d,f){return ba(a,b,function(a){a=a.split(";");for(var b=a.length;b--;)if(a[b]=Db(a[b],c,z),a[b]===k||a[b].length!=d)return;if(f===k||a.length>=f)return a})}function ra(a,b){a=a.toLowerCase();
if(ha.hasOwnProperty(a)){for(var c=ha[a],c=md.isArray(c)?c:c.split("|"),z=c.length;z--;)if(qa(c[z]))c[z]=lb.parse($g(c[z]));else return ua.error("Invalid configuration value."),b;return c}return b}function H(a,b,c,z){return ba(a,b,function(a){a=md.isArray(a)?a:a.split("|");for(var b=a.length;b--;)if(c?!c.test(a[b]):!Za(a[b]))return;if(z===k||a.length>=z)return a})}function N(a,b,c){return ba(a,b,function(a){var z={};n(z,b);if(qa(a)){a=a.split(";");for(var d=a.length;d--;){var f=a[d],g=f.indexOf(":");
if(0>=g)return;var q=f.substring(0,g);if(f=f.substring(g+1)){if(c&&!c.test(f))return;z[q]=f}else delete z[q]}}else n(z,a);return z})}function Zb(a){var b=[];c(a,function(a,c){var z;try{z=lb.stringify(c)}catch(d){z="cantparse"}b.push(a+"="+z)});return b.join("\n")}var G=/^[0-9-+]+$/,M=/^(2\.14)|(2\.15)|(2\.16)|(3\.0)$/,ca=/^[0-9]+[%]?$/,ia=/^[0-9]*$/,ha,Ua,ja,Kb=!0,pi=!1,Ia=!0,r=!1,oa=!0;(function(){function b(a){a.split(",").forEach(function(a){var b=a.indexOf("=");0<b&&(ha[a.substring(0,b).toLowerCase()]=
a.substring(b+1))})}ha={};n(ha,qi);a&&a.length&&gk.call(a,function(a){qa(a)?b(a):Da(a)&&n(ha,a,{nh:!0})});Ua=n({},Id(),{nh:!0});var c=Qc().cadmiumconfig;c&&(ua.info("Config cookie loaded",c),b(c));hk&&n(ha,Ua)})();ja=/^test/i.test(m(h("environment")))||/^test|int$/i.test(m(h("env")));v={};var t={gw:function(a){return Kb=u(h("enableDDPlus20"),ib(a,!0))},fw:function(a){return Kb=u(h("enableDDPlus"),ib(a,!0))},kw:function(a){return Ia=u(h("enableLSSDH"),ib(a,!0))},iw:function(a){return pi=u(h("enableHEVC"),
ib(a,!1))},jw:function(a){return oa=u(h("enableImageSubs"),ib(a,!0))},dg:function(a){return H("audioProfiles",ib(a,ri)).filter(function(a){return"ddplus-2.0-dash"===a?si&&!0:"ddplus-5.1-dash"===a?si&&Kb:!0})},Yv:function(a){return r=u("disableHD",ib(a,!1))},fi:function(a){a=H("videoProfiles",ib(a,fh)).filter(function(a){return"playready-h264mpl31-dash"===a?!r:"playready-h264mpl40-dash"===a?!r&&ik:/^hevc-/.test(a)?pi:!0});return ti(a)},cu:q(m,h("videoCodecs"),Jg()),Qb:function(a){return H("timedTextProfiles",
ib(a,ui)).filter(function(a){return"dfxp-ls-sdh"===a?Ia:"nflx-cmisc"===a?oa:!0})},hk:q(D,h("imageSubsResolution"),0),Ve:q(H,h("keySystemIdList"),vi,k,1),aj:q(m,h("canHDCP"),jk||"constrict",/^(constrict|ifpresent|never)$/),Al:q(m,"widevineRASC","CAUSwwUKvQIIAxIQ5US6QAvBDzfTtjb4tU/7QxiH8c+TBSKOAjCCAQoCggEBAObzvlu2hZRsapAPx4Aa4GUZj4/GjxgXUtBH4THSkM40x63wQeyVxlEEo1D/T1FkVM/S+tiKbJiIGaT0Yb5LTAHcJEhODB40TXlwPfcxBjJLfOkF3jP6wIlqbb6OPVkDi6KMTZ3EYL6BEFGfD1ag/LDsPxG6EZIn3k4S3ODcej6YSzG4TnGD0szj5m6uj/2azPZsWAlSNBRUejmP6Tiota7g5u6AWZz0MsgCiEvnxRHmTRee+LO6U4dswzF3Odr2XBPD/hIAtp0RX8JlcGazBS0GABMMo2qNfCiSiGdyl2xZJq4fq99LoVfCLNChkn1N2NIYLrStQHa35pgObvhwi7ECAwEAAToQdGVzdC5uZXRmbGl4LmNvbRKAA4TTLzJbDZaKfozb9vDv5qpW5A/DNL9gbnJJi/AIZB3QOW2veGmKT3xaKNQ4NSvo/EyfVlhc4ujd4QPrFgYztGLNrxeyRF0J8XzGOPsvv9Mc9uLHKfiZQuy21KZYWF7HNedJ4qpAe6gqZ6uq7Se7f2JbelzENX8rsTpppKvkgPRIKLspFwv0EJQLPWD1zjew2PjoGEwJYlKbSbHVcUNygplaGmPkUCBThDh7p/5Lx5ff2d/oPpIlFvhqntmfOfumt4i+ZL3fFaObvkjpQFVAajqmfipY0KAtiUYYJAJSbm2DnrqP7+DmO9hmRMm9uJkXC2MxbmeNtJHAHdbgKsqjLHDiqwk1JplFMoC9KNMp2pUNdX9TkcrtJoEDqIn3zX9p+itdt3a9mVFc7/ZL4xpraYdQvOwP5LmXj9galK3s+eQJ7bkX6cCi+2X+iBmCMx4R0XJ3/1gxiM5LiStibCnfInub1nNgJDojxFA3jH/IuUcblEf/5Y0s1SzokBnR8V0KbA=="),
cx:function(){return-1},Qq:q(l,h("logDisplayMaxEntryCount"),1E3,-1),Tq:q(l,h("logToConsoleLevel"),-1),De:function(){return ja},Bs:q(u,"requireNetflixId",!1),Cs:q(u,"requireSecureNetflixId",!1),Vt:q(u,"upgradeNetflixId",!0),sr:q(m,"netflixIdEsnPrefix"),tp:q(u,"enforceSinglePlayback",!0),up:q(u,"enforceSingleSession",!1),mg:q(u,"closeOtherPlaybacks",!0),$:q(u,h("useASE"),!1),$n:q(D,"asyncLoadTimeout",15E3,1),Vq:q(D,"mainThreadMonitorPollRate",0),Me:q(m,"groupName",""),xl:q(D,h("verbosePlaybackInfoDenominator"),
100),Xn:q(u,h("allowPleaseCallMessage"),!1),zs:q(u,"renderTimedText",!0),rl:q(N,"timedTextStyleDefaults",{}),sl:q(N,"timedTextStyleOverrides",{}),Kt:q(N,"timedTextFontFamilyMapping",wi||{"default":"font-family:Arial,Helvetica;font-weight:bolder"}),Lt:q(D,h("timedTextTimeOverride"),0),Bf:q(D,"timedTextSimpleFallbackThreshold",kk),rg:q(m,h("customDfxpUrl")),ij:q(H,"cdnIdWhiteList",[]),hj:q(H,"cdnIdBlackList",[]),ao:q(u,h("asynchronousCDNSelection"),!0),Lg:q(m,h("forceAudioTrack")),pr:q(u,"muteVolumeOnPlaybackClose",
!0),Ge:q(m,h("forceTimedTextTrack")),Bt:q(D,"storageMinimumSize",0,0),ml:q(m,"storageType","idb",/^(none|fs|idb)$/),ll:q(D,"storageTimeout",8E3,1),Oq:q(D,"lockExpiration",1E4),Pq:q(D,"lockRefresh",3E3),ds:q(u,"preserveLastFrame",!1),kr:q(D,"minBufferingTimeInMilliseconds",4E3),oh:q(D,"maxBufferingTimeInMilliseconds",0),fs:q(D,"progressBackwardsGraceTimeMilliseconds",4E3),gs:q(D,"progressBackwardsMinPercent",10),no:q(m,h("bookmarkIgnoreBeginning"),"30000",ca),oo:q(m,h("bookmarkIgnoreEnd"),"5%",ca),
og:q(m,"connectionStrategy","parallel",/^(parallel|single)$/),Zi:q(m,h("bandwidthMeterType"),"sliding_window",/^(historical|sliding_window)$/),wk:q(D,"maxParallelConnections",3),Mr:q(m,"parallelDownloadManagerType","chunk",/^(subchunk|chunk)$/),Nr:q(D,"parallelDownloaderUpdateFrequencyMs",500),Or:q(D,"parallelDownloaderUpdateThrottleFrequencyMs",200),Yq:q(D,"maxChunksInProgressForSubchunking",3),Et:q(D,"subchunkLength",gh(2,17)),Pr:q(db,"parallelSafeBufferThreshhold",40/240),Nn:q(db,"abortDownloadBufferThreshhold",
40/240),Wh:q(D,"slidingWindowWidthMilliseconds",3E4),Tr:q(u,"pingOnConnectTimeout",!0),Sr:q(D,"pingCDNTimeoutMilliseconds",8E3),Md:q(D,"maxBufferSizeMilliseconds",232E3,1E4,145152E5),Jb:q(D,"maxBufferSizeBytes",0),Vi:q(D,"backBufferSizeMilliseconds",1E4,0,145152E5),lo:q(D,"backToFrontBufferRatioPercent",25,0,1E3),cg:q(D,"audioChunkSizeMilliseconds",16E3),bu:q(D,"videoChunkSizeMilliseconds",4004),gp:q(u,"droppedFrameRateFilterEnabled",!1),hp:q(D,"droppedFrameRateFilterMaxObservation",60,10,1E3),jp:q(p,
"droppedFrameRateFilterPolicy",[[4,15],[8,9],[12,2],[20,1]],k,k,2,0),kp:q(u,"droppedFrameRateFilterWithoutRebufferEnabled",!1),Be:q(D,"droppedFrameRateFilterBasedOnPreviousSession"),Aj:q(U,"droppedFrameRateFilterBasedOnPreviousSessionPolicy"),ip:q(D,"droppedFrameRateFilterMinHeight",384),np:q(D,"droppedFramesStorageSessionLimit",10),mp:q(D,"droppedFramesStorageInterval",6E4),lp:q(U,"droppedFramesPercentilesList",[]),Yo:q(D,h("defaultVolume"),100,0,100),tj:q(u,"disableVideoRightClickMenu",!0),Xa:q(D,
"minDecoderBufferMilliseconds",1E3,0,145152E5),Jr:q(D,"optimalDecoderBufferMilliseconds",5E3,0,145152E5),$q:q(D,"maxDecoderBufferMilliseconds",7E3,0,145152E5),pj:q(D,"decoderTimeoutMilliseconds",1E4,1),uj:q(u,"disgardMediaOnAppend",!1),Zn:q(u,"appendMediaBeforeInit",!1),Rr:q(D,"pauseTimeoutLimitMilliseconds",18E5),ik:q(D,"inactivityMonitorInterval",3E4,0),On:q(U,"abrdelLogPointsSeconds",[15,30,60,120],0,k,4),iq:q(m,h("heuristicsAlgorithm"),""),Bp:q(p,h("fixedVideoBitrates"),[],k,k,2,0),lk:q(H,h("initialVideoBitrates"),
["0+","400+","900+"],G,1),vq:q(H,h("initialVideoBitratesForCarreraFallback"),["0+","400+","900+"],G,1),tq:q(H,h("initialAudioBitrates"),["0+","90+","150+"],G,1),bo:q(D,"audioBandwidthDenominator",15,1),jl:q(D,"simulationLimitMilliseconds",12E5,1E4),jq:q(D,"highStreamSimulationMilliseconds",12E4,1),$r:q(p,"prebufferBitrate",[[500,235],[1E3,560],[5E3,1050],[1E4,1050],[3E4,3E3]],k,k,2,1),ol:q(p,"switchUpToBitrate",[[235,560],[375,750],[560,1050],[750,1400],[1050,1750],[1750,3E3],[2350,1E5]],k,k,2,1),
Ah:q(D,"prebufferMinAudioMilliseconds",6E3),Bh:q(D,"prebufferMinVideoMilliseconds",6E3),as:q(D,"prebufferMaxMilliseconds",3E4),ts:q(D,"rebufferMaxMilliseconds",232E3),rp:q(u,"enableTrickPlay",!1),le:q(U,"additionalDownloadSimulationParams",[2E3,2E3,100],0,k,3),St:q(D,"trickPlayHighResolutionBitrateThreshold",1E3),Tt:q(D,"trickPlayHighResolutionThresholdMilliseconds",1E4),Ut:q(db,"trickplayBufferFactor",.5),Rt:q(D,"trickPlayDownloadRetryCount",1),Ok:q(U,"prebufferSimulationParams",[2E3,2E3,60],0,k,
3),$i:q(p,"bufferingSimulationParams",[[6E4,1E3,1E3,100],[12E4,1E3,1E3,20],[18E4,0,0,0]],k,k,4,1),fg:q(p,"bufferingSwitchUpSimulationParams",[[6E4,3E3,3E3,140],[12E4,3E3,3E3,60],[18E4,0,0,0]],k,k,4,1),wj:q(D,"doNotSwitchDownIfBufferIsAboveMilliseconds",18E4),pp:q(u,"enableHistorical",!0),eh:q(D,"histAggregationTimeSpanInSeconds",300),kq:q(D,"histCompareBitsIPv4",24),lq:q(D,"histCompareBitsIPv6",32),bk:q(m,"histFilterType","none",/^(none|timeofDay|dayOfWeekAndTimeOfDay)$/),ek:q(D,"histSizeLimit",1E3),
dk:q(D,"histMinSampleSize",1),ck:q(D,"histMaxSampleSize",1E3),fk:q(D,"histTimeOfDayRangeInSeconds",3600),yo:q(N,"carreraParameters",{1750:7,1050:5,750:4.5,560:4.5,375:4.5}),dj:q(l,"carreraMediaSecondsToDownload",8E3),bj:q(l,"carreraChunksToAverage",10),Cv:q(db,"carreraConfidenceThreshold",.7),cj:q(l,"carreraHistoricalPercentileToUse",50),hh:q(m,"initialBitrateSelectionAlgorithm","default",/^(default|carrera)$/),po:{dr:q(D,"maxReservoirSizeMilliseconds",12E4),cr:q(D,"maxOutageProtectionMilliseconds",
6E4),Zq:q(D,"maxCushionSizeInBufferPercentage",90),Es:q(D,"reservoirLookAheadChunks",60),vt:q(D,"startupPhaseInChunks",30),xt:q(u,"startupQualityOptimization",!0),op:q(u,"dynamicReservoir",!0),Eq:q(u,"isUsingStrictMaxChunkSize",!0),Qt:q(u,"transitFromInitialPhase",!0),yt:q(u,"startupSafeRateCalculationEnabled",!0),zt:q(u,"startupThresholdFunctionOfBufferEnabled",!0),tt:q(u,"startupLookAheadCalculationEnabled",!1),ut:q(D,"startupLookAheadChunks",120),Aq:q(u,"isReservoirManualSet",!1),Xq:q(D,"manualReservoirMilliseconds",
9E4),wq:q(u,"isCushionManualSet",!1),Wq:q(D,"manualCushionMilliseconds",126E3),zq:q(u,"isLookingAhead",!1),Dq:q(u,"isUsingRateMap",!1)},gb:q(U,"failedDownloadRetryWaits",[10,200,500,1E3,2E3,4E3,8E3,16E3]),pw:q(U,"failedDownloadRetryWaitsASE",[500,1E3,2E3,4E3]),Xt:q(u,"useCDNExponentialBackoff",!0),bl:q(D,"selectCdnDownloadRetryCountBeforeCdnSwitch",2),Zs:q(D,"selectCdnTimeoutMilliseconds",1E3),Ys:q(D,"selectCdnSignificantLatency",300),uf:q(D,"selectCdnBandwidthThresholdKbps",2E3),cl:q(m,"selectCdnType",
"bandwidth",/^(latency|bandwidth)$/),oe:q(D,"bandwidthTestBytesPerCdn",204800),$t:q(u,"useVariableConnectTimeout",!1),lr:q(D,"minConnectTimeoutMilliseconds",4E3),Vb:q(D,"connectTimeoutMilliseconds",8E3,500),Ko:q(D,"connectTimeoutBufferDiscount",2),Lo:q(D,"connectTimeoutoutUpperLimitMultiplier",1E4),Pd:q(D,"noProgressTimeoutMilliseconds",8E3,500),Zt:q(u,"useOnLineApi",!1),hq:q(D,"headerDownloadRetryCountBeforeCdnSwitch",1),ql:q(D,"timedTextDownloadRetryCountBeforeCdnSwitch",1),jk:q(D,"initialHeaderDownloadTimeout",
2E3),ak:q(D,"headerDownloadTimeout",3E3),Dp:q(u,"forcePresentingStateToPlaying",!1),Xs:q(D,"seekBackOnAudioTrackChangeMilliseconds",8E3),yf:q(H,h("supportedAudioTrackTypes"),[],k,1),Gt:q(H,h("supportedAudioBitrates"),[],G),Ht:q(H,h("supportedVideoBitrates"),[],G),kk:q(D,"initialLogFlushTimeout",5E3),bd:q(m,"playdataPersistKey",ja?"unsentplaydatatest":"unsentplaydata"),vf:q(u,"sendPersistedPlaydata",!0),yh:q(D,"playdataPersistIntervalMilliseconds",4E3),Yr:q(u,"playdataPrepareRequest",!1),bh:q(D,"heartbeatCooldown",
1E4,1E3),Sq:q(H,"logPerformanceTiming","navigationStart redirectStart fetchStart secureConnectionStart requestStart domLoading".split(" ")),ir:q(u,"midplayEnabled",!0),yk:q(D,"midplayIntervalMilliseconds",3E5),jr:q(U,"midplayKeyPoints",[15E3,3E4,6E4,12E4]),vj:q(D,h("dlprestartCount"),0),zg:q(D,"downloadReportDenominator",0),ep:q(D,"downloadReportInterval",3E5),xe:q(H,"downloadReportTcpInfo",[]),$v:q(D,"downloadReportTraceInterval",1E3),mo:q(N,h("bookmarkByMovieId"),{}),bc:q(u,h("limitedDurationLicense"),
!1),Xe:q(D,h("licenseRenewalRequestDelay"),0),tk:q(u,h("limitedDurationFlagOverride"),k),Wd:q(u,h("secureStopEnabled"),!1),$k:q(u,h("secureStopFromPersistedKeySession"),!1),Ss:q(D,"secureStopKeyMessageTimeoutMilliseconds",2E3,1),Rs:q(D,"secureStopKeyAddedTimeoutMilliseconds",1E3,1),Vs:q(D,h("secureStopPersistedKeyMessageTimeoutMilliseconds"),2500,1),Ws:q(D,h("secureStopPersistedKeySessionRetries"),17,1),Us:q(D,"secureStopPersistedKeyAddedTimeoutUnmatchedSession",1E3,1),Ps:q(u,h("secureStopDisplayLogWindowOnError"),
!1),Qs:q(u,h("secureStopIgnoreVideoError"),!1),Yt:q(u,h("useCdmId"),!1),sq:q(H,"initSegmentBoxTypeList",["ftyp","moov"]),nq:q(H,"ignorePsshList",lk||[]),gu:q(u,"workaroundSaio",!0),hu:q(u,"workaroundTenc",!0),Bl:q(u,h("workaroundAudioKeyFrame"),!1),wo:q(u,h("callEndOfStream"),xi),Ho:q(u,h("clipLongVideo"),yi),jt:q(u,h("setVideoElementSize"),mk),Eo:q(u,h("clearVideoSrc"),!0),rj:q(D,h("delayPlayPause"),0),ko:q(u,h("avoidSBRemove"),!1),cs:q(u,h("preferOldEme"),!0),js:q(u,h("promiseBasedEme"),!1),Cr:q(u,
h("nudgeSourceBuffer"),!1),al:q(l,h("seekDelta"),1),bs:q(u,h("preciseSeeking"),!1),qj:q(N,h("delayErrorHandling")),Nt:q(u,"trackingLogEnabled",!0),Pt:q(m,"trackingLogUrl",ja?"https://customerevents.test.netflix.com/track/debug":"https://customerevents.netflix.com/track/debug",Yg),Ot:q(U,"trackingLogStallKeyPoints",[1E4,3E4,6E4,12E4]),Fg:q(m,"esnUrl"),Gj:q(D,"esnUrlTimeout",6E3),Cj:q(u,h("enableEmeVerboseLogging"),!1),qp:q(u,"enableLastChunkLogging",!1),qr:q(m,"nccpAppId","",ia),rr:q(m,"nccpSessionId",
"",ia),zo:q(m,"cdnProxyUrl"),cc:{xw:q(u,"nccpForceRegister",!1),ww:q(u,"nccpForceAuthenticationRenewal",!1),Fe:q(m,h("nccpForceDebugLogLevel"),k,/^(ERROR|WARN|INFO|TRACE)$/),Dh:q(m,"nccpProtocolVersion","3.1",M),ks:q(N,"protocolVersionOverrides",{mdxregister:"2.16"},M),Tj:function(){return function(a){return this.ks()[a]||this.Dh()}.bind(t.cc)},oc:q(m,"nccpControllerUrl",ja?"https://cbp.nccp.test.netflix.com/nccp/controller":"https://cbp.nccp.netflix.com/nccp/controller",Yg),nt:function(){return"2.0000.400.011"},
ul:q(m,"nccpUIVersion"),Ao:function(){return"0"},Qk:q(H,"preferredLanguages",Tg,/^[a-zA-Z-]{2,5}$/,1),Hs:q(u,"nccpRetryOnNetworkFailures",!0),Yn:q(u,"nccpAlwaysIncludeIdsInPlaydata",!0)},eg:q(m,"authenticationType","JWK_RSA"),co:q(N,"authenticationKeyNames",n({e:"DKE",h:"DKH",w:"DKW",s:"DKS"},nk)),It:q(m,"systemKeyWrapFormat",ok),nr:q(u,"mslDeleteStore",!1),or:q(u,"mslPersistStore",!0),Dz:q(U,"streamingFailureRetryWaits",[4E3,8E3]),Mx:q(D,"minInitVideoBitrate",560),tx:q(D,"maxInitVideoBitrate",1050),
Jx:q(D,"minAcceptableVideoBitrate",235),hw:q(u,"enableGoodQualityBuffering",!1),Px:q(D,"minRequiredBuffer",3E4),Ox:q(D,"minPrebufSize",6E3),Tz:q(u,"useMaxPrebufSize",!1),zx:q(D,"maxPrebufSize",3E4),qx:q(D,"maxBufferingTime",2E3),Ow:q(ra,"initialBitrateSelectionCurve",null),Mz:q(D,"throughputPercentForAudio",15),uv:q(D,"bandwidthMargin",10),vv:q(ra,"bandwidthMarginCurve",[{m:38,b:8E3},{m:50,b:6E4},{m:17,b:12E4},{m:0,b:24E4}]),Lw:q(D,"highWatermarkLevel",3E4),Pz:q(D,"toStableThreshold",3E4),Qz:q(D,
"toUnstableThreshold",15E3),Bz:q(u,"skipBitrateInUpswitch",!0),Xz:q(D,"watermarkLevelForSkipStart",8E3),Jw:q(D,"highStreamRetentionWindow",9E4),Kw:q(D,"highStreamTransitionWindow",3E5),jx:q(D,"lowestBufForUpswitch",9E3),bx:q(D,"lockPeriodAfterDownswitch",15E3),ix:q(D,"lowWatermarkLevel",15E3),Bx:q(D,"maxSimuLength",6E5),kx:q(D,"lowestWaterMarkLevel",6E3),Ix:q(db,"mediaRate",1.5),rw:q(db,"fastUpswitchFactor",3),ux:q(D,"maxMediaBufferAllowed",24E4),fx:q(D,"lowGradeModeEnterThreshold",12E4),gx:q(D,"lowGradeModeExitThreshold",
9E4),sx:q(D,"maxDomainFailureWaitDuration",3E4),px:q(D,"maxAttemptsOnFailure",18),nw:q(u,"exhaustAllLocationsForFailure",!0),vx:q(D,"maxNetworkErrorsDuringBuffering",20),rx:q(D,"maxBufferingTimeAllowedWithNetworkError",6E4),qw:q(D,"fastDomainSelectionBwThreshold",2E3),Nz:q(D,"throughputProbingEnterThreshold",4E4),Oz:q(D,"throughputProbingExitThreshold",34E3),$w:q(D,"locationProbingTimeout",1E4),uw:q(D,"finalLocationSelectionBwThreshold",1E4),Kz:q(db,"throughputHighConfidenceLevel",.75),Lz:q(db,"throughputLowConfidenceLevel",
.4),wx:q(D,"maxPartialBuffersAtBufferingStart",2),Nx:q(D,"minPendingBufferLen",6E3),xx:q(D,"maxPendingBufferLen",12E3),Cx:q(D,"maxStreamingSkew",4E3),yx:q(D,"maxPendingBufferPercentage",10),Ax:q(D,"maxRequestsInBuffer",60),Iw:q(D,"headerRequestSize",4096),Kx:q(D,"minBufferLenForHeaderDownloading",1E4),ez:q(D,"reserveForSkipbackBufferMs",1E4),Qy:q(u,"pipelineEnabled",!1),Sz:q(D,"updatePtsIntervalMs",ya(4004,16E3)/2),yv:q(D,"bufferLevelNotifyIntervalMs",ya(4004,16E3)/2),Sv:q(D,"defaultHeaderCacheSize",
4),Rv:q(D,"defaultHeaderCacheDataCount",3),dw:q(u,"enableAbandonTesting",!1),kv:q(D,"abandonRequestFrequency",4),Ez:q(D,"streamingStatusIntervalMs",2E3),Sy:q(D,"prebufferTimeLimit",24E4),Lx:q(D,"minBufferLevelForTrackSwitch",2E3),Ny:q(D,"penaltyFactorForLongConnectTime",2),ex:q(D,"longConnectTimeThreshold",200),mv:q(D,"additionalBufferingLongConnectTime",2E3),nv:q(D,"additionalBufferingPerFailure",8E3),Vx:q(D,"networkFailureResetWaitMs",2E3),Ux:q(D,"networkFailureAbandonMs",6E4),Dx:q(D,"maxThrottledNetworkFailures",
3),Jz:q(D,"throttledNetworkFailureThresholdMs",200),ew:q(u,"enableAbortBlock",!1),hx:q(D,"lowThroughputThreshold",400),Rx:q(u,"mp4ParsingInNative",!0),Cz:q(u,"sourceBufferInOrderAppend",!1),Vy:q(u,"pruneRequestsFromNative",!0),Av:q(D,"bufferThresholdToSwitchToSingleConnMs",18E4),zv:q(D,"bufferThresholdToSwitchToParallelConnMs",12E4)},X=!0;ig=function(a){a&&(ha=n({},a,{nh:!0}),d(t,v),ua.trace("Config applied for",Zb(X?ha:a)),X=!1)};ig(ha)}function Ef(a,b){return qa(a)&&"%"==a[a.length-1]?jb(uc(a)*
b/100):a}function Ed(){return 3<=y(v.cc.Dh)}function Qg(a,b,c,d){n(this,{Ej:b,sc:a,Os:pk||"cadmium",aw:c,Fj:d})}function Ge(){for(var a="",b=xa(nd/1E3),c=6;c--;)a="0123456789ACDEFGHJKLMNPQRTUVWXYZ"[b%32]+a,b=xa(b/32);for(;30>a.length;)a+="0123456789ACDEFGHJKLMNPQRTUVWXYZ"[zb(0,31)];return a}function Ff(){try{var a=v.De?"NetflixIdTest":"NetflixId",b=Qc()[a],c=Ra(b);return"dbl"==c||"dev"==c}catch(d){}}function gc(a){od.N({url:v.Fg,Vb:v.Gj,Pd:v.Gj,type:hh,withCredentials:!0,dc:function(a){a=lb.parse(a).data.esn;
if(!zi.test(a))throw new Ta("bad esn");var b=a.match(zi)[2];if(!Za(b))throw new Ta("bad deviceId");jg=a;return b}},a)}function Kd(a){a=new Vc(Ac(a));a.ba();return{Hq:a.Tk(),sp:a.Tk()}}function Gf(a,b){var c=a.url.split("?"),d=c[0],f;f=a.offset;(f=f!==k?a.length!==k?f+"-"+(a.offset+a.length-1):f+"-":void 0)&&(b.Nb=f,d="/"==d[d.length-1]?d+"range/":d+"/range/",d+=f);f=a.Hc?"random="+(1E17*cf()).toFixed(0):"";d=c[1]?d+("?"+c[1]+(f?"&"+f:"")):d+(f?"?"+f:"");!a.i||d&&0==d.toLowerCase().indexOf("https")||
(c=v&&v.zo)&&(d=c.replace("{URL}",d).replace("{EURL}",Vd(d)));b.url=d}function Ld(){return!1!==Yb.onLine}function Ne(a,b,d,f){var g=f.zh,h=f.headers;a.open(g?"POST":"GET",b,!d);switch(f.responseType){case Bc:a.responseType="arraybuffer";break;case Ai:vb(a,"overrideMimeType",k,"text/xml")}g&&(b={"Content-Type":qa(g)?"text/plain":"application/x-octet-stream"},h=h?n(b,h):b);h&&c(h,function(b,c){a.setRequestHeader(b,c)});f.withCredentials&&(a.withCredentials=!0);a.msCaching!==k&&(a.msCaching="disabled");
g?a.send(g):a.send()}function hc(a,b){switch(b.type){case Bc:return a.response||new ArrayBuffer(0);case Ai:return a.responseXML;default:return a.responseText}}function Hf(a){function b(a){b=p;f.onload=null;f.onabort=null;f.onerror=null;var c=f.status;!a&&200<=c&&299>=c?(g.content=hc(f,g),g.c=!0):(g.g=a?P.bb:P.gd,g.Ga=g.R=c,g.c=!1)}var c=/^[a-z]*:\/\/.*/i,d=a.url,f=new Bi,g={L:a,type:a.responseType};Oc(qa(d)&&!c.test(d));f.onload=function(){b()};f.onerror=function(){b()};f.onabort=function(){b(!0)};
Ne(f,d,!0,a);return g}function Oe(a){function b(c){a.fireEvent(ye,c)}return{N:function(c,d){c.Ka=a;var f=od.N(c,d);a.fireEvent(ff,f);f.Ti(b);return f}}}function If(a){return{N:function(b,c){b.Ka=a;var d;a.i.value&&v.Tr&&(d={Ur:new Qe(a.xa),ar:v.wk,Ik:0,i:a.i.value});d=od.N(b,c,d);a.fireEvent(ff,d);d.Ti(function(b){a.fireEvent(ye,b)});return d}}}function Qe(a){function b(a,c,d){if(c.Ta[a.id])return{responseType:Bc,url:c.Ta[a.id],dc:wf,offset:c.j.t[d?d.index:0].offset,length:8,i:a,track:c.track,stream:c,
Db:d.type+"-"+d.index+"-ping",Hc:!0}}this.xa=a;this.ping=function(a){function c(a){pb(h);d(a)}function d(b){(b=b&&b.c)&&a.Ft();!b&&a.Ij()}var z=this.xa,f=a.stream,g=a.H,k;if(a.Ik>a.ar)a.Ij();else if(g&&!g.media){(f=b(a.i,f,g))&&(k=z.N(f,c));var h=Ya(function(){d();k&&k.abort()},v.Sr)}}}function Pb(a,b){for(var c=1;(b=arguments[c++])&&(a=a[b]););return a}function Ea(a,b){var c;a?c=y(a[xb]):b!==k&&(c=b);return c}function ta(a,b){var c;a?c=a[xb]:b!==k&&(c=b);return c}function zf(a){if(Za(a)){var b=(new qk).parseFromString(a,
"text/xml"),c=b.getElementsByTagName("parsererror");if(c&&c[0]){try{ua.error("parser error details",{errornode:(new rk).serializeToString(c[0]),xmlData:a.slice(0,300),fileSize:a.length})}catch(d){}throw new Ta("xml parser error");}return b}throw new Ta("bad xml text");}function Md(a){var b,c,d={};d[kg]=a.localName;var f={};d[$b]=f;var g=[];d[ih]=g;var k=a.attributes;b=k.length;for(c=0;c<b;c++){var h=k[c];f[h.localName]=h.value}a=a.childNodes;b=a.length;f={};for(c=0;c<b;c++)switch(k=a[c],k.nodeType){case sk:k=
Md(k);h=k[kg];k[tk]=d;g.push(k);d[h]?f[h][Rb]=k:d[h]=k;f[h]=k;break;case uk:case vk:k=k.text||k.nodeValue,g.push(k),d[xb]||(d[xb]=k)}return d}function Fd(a,b){var c,d;try{c=zf(a)}catch(f){ua.error("xml2xmlDoc exception",f)}Ba(function(){if(c&&c.documentElement)try{d=Md(c.nodeType==wk?c.documentElement:c)}catch(a){ua.error("xmlDoc2js exception",a)}Ba(function(){d?b({c:!0,object:d}):b({c:!1,g:P.Ll})})})}function Nd(a,b,d,f){Oc(Da(a)&&!md.isArray(a));f=f||"";var g="",k=a.hasOwnProperty($b)&&a[$b];k&&
c(k,function(a,b){g&&(g+=" ");g+=a+'="'+me(b)+'"'});d=(b?b+":":"")+d;var k=f+"<"+d+(g?" "+g:""),h=a.hasOwnProperty(xb)&&a[xb].trim&&""!==a[xb].trim()&&a[xb];if(h)return k+">"+me(h)+"</"+d+">";a=Rg(a,b,f+"  ");return k+(a?">\n"+a+"\n"+f+"</"+d+">":"/>")}function Rg(a,b,d){Oc(Da(a)&&!md.isArray(a));d=d||"";var f="";c(a,function(a,c){if("$"!=a[0]){var z;z=c;z=md.isArray(z)?z:[z];for(var g=0;g<z.length;g++)if(c=z[g],f&&(f+="\n"),Da(c))f+=Nd(c,b,a,d);else{var k=(b?b+":":"")+a;f+=d+"<"+k+">"+me(c)+"</"+
k+">"}}});return f}function me(a){return qa(a)?ji(a):b(a)?""+a:""}function Re(a,b,d,g){function h(a,b){m("netflixid",k,k,a,function(a){if(a.c){var c=Pb(a.yc,"netflixiddata","netflixidpair");a=ta(c.netflixid);var c=ta(c.securenetflixid),d=/^[^=]*=([^;]*)/;b({c:!0,ia:a.match(d)[1],$a:c.match(d)[1],uh:a,Hh:c})}else b(a)})}function l(a,b,c){m("mdxpair",{targetuuid:a.Hz,controllerrequest:{cticket:a.Qo,pairdata:{nonce:a.ur,controlleruuid:a.Mv},pairdatahmac:a.My}},k,b,function(a){if(a.c){a=a.Gs.mdxpairgrant;
var b=a.controllererror,d=a.targetsharedsecret,z=a.grantdata,f,g;z&&(g={nonce:Ea(z.nonce),controlleruuid:ta(z.controlleruuid),controlleruserid:ta(z.controlleruserid),controllersharedsecret:ta(z.controllersharedsecret),targetuuid:ta(z.targetuuid),targetuserid:ta(z.targetuserid)},f=ta(a.grantdatahmac));d&&(g=g||{},g.targetsharedsecret=ta(d.sharedsecret));c({c:!0,Jv:b&&{Kv:Ea(b.controllererrorcode)},Ew:g,Fw:f})}else c(a)})}function D(c,d,q,k,h,l,ba){function D(){var b=0;G={softwareversion:a.nt,sdkversion:g.Os,
certificationversion:a.Ao,preferredlanguages:{appselectedlanguages:{language:a.Qk.map(function(a){return{index:b++,bcp47:a}})}},clientservertimes:{servertime:u(),clienttime:h}};a.ul&&(G.uiversion=a.ul);U()}function U(){var a='<?xml version="1.0" encoding="utf-8"?>\n<nccp:request xmlns:nccp="http://www.netflix.com/eds/nccp/'+n+'">\n'+Nd(G,"nccp","header")+"\n"+Nd(M,"nccp",d)+"\n</nccp:request>";ba({c:!0,Bk:{Od:l,df:d,url:c+"/"+n+"/"+d,body:a,timeout:1E3*b.cf,wl:l.W,wf:k&&k.mslServiceTokens,cz:!ca[d],
Hk:!!ca[d],Dj:!0}})}q=q||{};var n=a.Tj(d),M,G;f(q)?q(l,function(a){a.c?(M=a.dz,D()):ba(a)}):(M=q,D())}function db(c,f,g,h,l){function ba(a){n.trace("Sending NCCP request",{Method:c});d.send(a,function(a){if(a.c){n.trace("Received NCCP response",{Method:c});var b=a.body;G={mslServiceTokens:a.wf};wa(b)}else u(a)})}function wa(a){Fd(a,function(a){var d;if(a.c&&"response"==(d=a.object)[kg]){a=d;var z,f;try{var g=a.responseheader.clientservertimes;z=Ea(g.clienttime);f=Ea(g.servertime)}catch(q){n.error("Exception while checking clienttime in NCCP response",
q)}if(U==z||U+1==z){b.Mh=f-Nb();var h;n.trace("Processing NCCP response",{Method:c});try{var l=a.result,ba=l.status,D=a.parameters;b.sf=Ea(D.retrycontrol);b.cf=Ea(D.mintimeout);b.mh=Ea(D.loginterval);b.ph=Ea(D.maxlogsize);b.$e=ta(D.loglevel);var wa=ta(D.playbackparameters.sendheartbeats);b.Lh=/^true$/i.test(wa);b.Dd=Ea(D.playbackparameters.heartbeatinterval);(b.vh||p)();if("true"!=ba.success[xb]){var ja=ba.error||{},M=Ea(ja.code),db=Ea(ja.reasoncode,0),m=Ea(ja.actionid),ia=ta(ja.description),Ma=ja.usertext,
ca=Ma?ta(Ma.text):k,Ua=Ma?ta(Ma.bcp47):k;n.warn("NCCP responded with error",{Method:c,ActionId:m,Code:M,Description:ia});var v=P.Dm;8==m&&(v=P.zi);h={Ck:ja,Rc:m,g:v,R:M,xd:M,Eg:db,C:ia,wp:ca,mw:Ua}}else h={c:!0,Gs:l,yc:l[c],La:G}}catch(Ia){n.error("Exception while processing NCCP response",Ia),h={g:P.Of,C:L(Ia)}}u(h)}else{f=a.result.status;var eb,N;"true"!=f.success[xb]&&(eb=f.error||{},N=Ea(eb.code),eb=ta(eb.description));u({g:z?P.vm:P.wm,R:N,C:eb})}}else n.error("Unable to parse NCCP response as xml",
{Method:c}),u({g:P.Cm})})}function u(a){n.trace("Executed NCCP method",{Method:c,Success:!!a.c},a.c?k:cb(a));l=l||p;a.method=c;a.oc=M;l(a)}var n=h.log,U=Nb(),M=Zb(a.oc),G;n.trace("Executing NCCP method",{Method:c});D(M,c,f,g,U,h,function(a){a.c?ba(a.Bk):u(a)})}function m(c,d,f,g,q){function k(){db(c,d,f,g,function(d){var f=d.Rc,ba;if(!d.c){var D;if(wd(d.g))switch(f){case 7:ia[d.oc]=!0;if(d.Ck){var wa=ta(d.Ck.nccpendpoint);ba=function(a,b){h.info("ActionId redirect",{Method:c,From:d.oc,To:wa});var z=
Zb(wa);ia[z]?b({g:P.Ai,C:"Loop detected: "+d.oc+", "+z}):(ig({nccpControllerUrl:z}),b(va))}}break;case 2:D=!0}else he(d.g)?a.Hs&&(D=!0):Hc(d.g)&&2==d.Sc&&(D=!0);if(!ba)if(D)if(D=b.sf,l<D){l++;var u=G(l);h.warn("Method failed, retrying",{Method:c,Attempt:l,WaitTime:u,RetryControl:D},cb(d));ba=function(a,b){Ya(function(){b(va)},u)}}else h.error("Method failed, retry limit exceeded, giving up",{Method:c,Attempt:l,RetryControl:D},cb(d));else h.error("Method failed, not retrying",{Method:c},cb(d))}if(ba){var n=
{Method:c,ActionId:""+f,MslCode:""+d.Sc};h.info("Handling failed method",n);ba(g,function(a){a.c?(h.info("Handle success, retrying method",n),k()):(h.error("Handle error",n,cb(a)),q(a))})}else q(d)})}var h=g.log,l=0;q=q||p;k()}function u(){return v(Nb())}function v(a){return a+b.Mh}function U(b,c,d){var f={},g={movieid:b.movieId,sessionstart:b.sessionStartEpoch};c?(g.heartbeattype=d,f={heartbeatdata:g}):(g.sessionend=b.sessionEpoch,f={},b.isLicensed&&!a.Yn||n(f,{appid:b.appId,sessionid:b.sessionId,
trackid:b.trackingId,xid:b.xid},{ff:!0}),f.sessiondata=g,b.securestop&&(f.securestop=b.securestop));(d=b.playback)?(c=d.playTimes,g.firstpts={pts:Oa(d.startPosition),timestamp:d.startEpoch},g.lastpts={pts:Oa(b.position),timestamp:b.sessionEpoch},b=g.playbacktime={total:Oa(c.total)},ra(b,"videostreamplaytimes",c.video),ra(b,"audiostreamplaytimes",c.audio),ra(b,"timedtextstreamplaytimes",c.timedtext)):b.errorDisplayCode?g.error={}:(g.lastpts=g.firstpts={pts:Oa(b.position),timestamp:b.sessionEpoch},
g.playbacktime={total:"0"});return f}function bb(c,f,g,k){function h(c){d.so(c,function(c){if(c.c){var d=1E3*b.cf;l({c:!0,mq:{responseType:hh,url:wa+"/"+a.Tj("playdata")+"/playdata",zh:c.body,withCredentials:!0,Vb:d,Pd:d,Db:"nccp-playdata"}})}else l(c)})}function l(a){k&&(a.method="playdata",k(a))}var ba=Nb(),wa=Zb(a.oc);D(wa,"playdata",c,g.playbackTokens,ba,f,function(a){a.c?h(a.Bk):l(a)})}function ra(a,b,c){c&&c.length&&(a[b]={streamplaytime:c.map(H)})}function H(a){return{downloadableid:a.downloadableId,
playtime:Oa(a.duration)}}function N(a,b){var d=[];c(b,function(a,b){var c=qa(b)?b:lb.stringify(b);d.push({name:a,value:c})});if(d.length){var z={};z[a]=d;return z}}function Zb(a){return"/"==a[a.length-1]?a.substr(0,a.length-1):a}function G(a){a=1E3*gh(2,ya(a-1,b.sf));return zb(1E3,a)}var M=0,ca=Fb(["license"]),ia={};n(this,{ping:function(a,b){m("ping",k,k,a,b)},Xv:function(a,b){var c=n({},a);c.W=k;h(c,b)},ia:h,az:function(a,b,c,d){h(n({ia:b,$a:c},a),d)},$y:function(a,b,c,d){h(n({Bj:b,Qr:c},a),d)},
rd:function(a,b,c){var d={movieid:a.sa,appid:a.ag,sessionid:a.Oh},z=N("authparam",a.me);z&&(d.authparams=z);d.contentprofiles={videoprofiles:{videoprofile:a.fi},audioprofiles:{audioprofile:a.dg},timedtextprofiles:{timedtextprofile:a.Qb}};m("authorization",d,a.La,b,function(a){if(a.c){var b=a.yc;c({c:!0,eo:b.authorizationdata||b,La:a.La})}else c(a)})},lh:function(a,b,c){var d=b.log,z;z=a.Bo;var f=a.os,g;switch(a.pc){case "playready":g="soapresponse";z={drmtype:"PlayReady",pssh:f,soaprequest:z};break;
case "widevine":g="widevineceflicense";z={drmtype:"WidevineCEF",pssh:f,widevinecefchallenge:z};break;case "fps":g="fpslicense";z={drmtype:"FPS",pssh:f,fpschallenge:z};break;default:c({g:P.zm});return}var f={playbacktype:a.Xr},q=N("sessionparam",a.dd);q&&(f.sessionparams=q);n(f,{downloadableid:a.J,appid:a.ag,sessionid:a.Oh,trackid:a.Ca,xid:a.qa,drmdata:z});m("license",f,a.La,b,function(a){if(a.c){var b=ta(a.yc.licensedata[g]);Za(b)?c({c:!0,Lq:b,La:a.La}):(d.error("no license response"),c({g:P.Am}))}else c(a)})},
kf:function(a,b,c){var d=U(a,!1);m("playdata",d,a.playbackTokens,b,c)},pg:function(a,b,c){var d=U(a,!1);bb(d,b,a,c)},ah:function(a,b,c,d){b=U(a,!0,b);m("heartbeat",b,a.playbackTokens,c,d)},Uq:function(a,b,c){M++;for(var d=",esn="+g.sc+",snum="+M+",lnum=",z,f=0;f<a.length;f++){var q=a[f],q=v(q.Fo)+" "+q.Mj()+d+(f+1);z=z?z+("\n"+q):q}a=z?S(z):"";m("logblob",{sequencenumber:M,logdata:a},k,b,c)},Fx:l,Gx:function(a,b,c){var d={xk:a.Qo,gr:a.Py,fr:a.ur,er:a.Lv,hr:Ac(a.bz)};n(d,b);h(d,function(d){d.c?l(a,
b,function(a){a.c?(a.ia=d.ia,a.$a=d.$a,a.uh=d.uh,a.Hh=d.Hh,c(a)):c(d)}):c(d)})},Mg:function(a,b){m("fpsappdata",k,k,a,function(a){if(a.c){var c=a.yc;a=ta(c.appcert);c=Ea(c.expiration);b({c:!0,se:a,xp:c})}else b(a)})},Ad:u,No:v})}function Kf(a,b,c){var d;return d={W:a,Tc:!0,Gh:!1,We:ga(),load:function(a){(a||p)(va)},save:function(){d.Tc=!0},remove:function(a){d.Tc=!1;(a||p)(va)},je:v.cc.Qk,Wc:function(){var a=Qc();return{ia:a[b],$a:a[c]}},gl:function(a,d){(new RegExp("^"+b+"=.*")).test(a);(new RegExp("^"+
c+"=.*")).test(d);tb.cookie=a;tb.cookie=d;Qc()[b]!=a.match(/[^=]*=([^;]*)/)[1]||"s"==df.href[5]&&(Qc(),d.match(/[^=]*=([^;]*)/))},Do:function(){var a="=;Expires=Thu, 01 Jan 1970 00:00:00 GMT";tb.cookie=b+a;tb.cookie=c+a;a+=";Domain=.netflix.com;Path=/";tb.cookie=b+a;tb.cookie=c+a+";Secure";Qc()[b]||Qc()},mk:!0}}function Se(a){if(a=lg[a])return gf=a;throw new Ta("invalid accountKey");}function Lf(a,b){var c=Ci[a];c||(Ci[a]=c=Mb(function(b){var c=lg[a];c?b({c:!0,kc:c}):(c=new ne(a),lg[a]=c,c.load(function(a){a.c?
b({c:!0,kc:c}):b(a)}))}));c(b)}function ne(a){this.W=a}function Zc(a){var b={},d=ga(),f={};a.forEach(function(a){var b=a.url;f[b]||(f[b]=[]);f[b].push(a)});var g=[];c(f,function(a,b){g.push(Nf(b,d))});b.urls=lb.stringify(g);return b}function Nf(a,b){var d=a[0],f={url:d.url,bitrate:d.f,cdnid:d.i&&d.i.id,dltype:d.cp,id:d.J},g={};a.forEach(function(a){var b=a.c||a.c===k||a.g===P.bb||a.g===P.jd?"success":"fail";g[b]||(g[b]=[]);g[b].push(a)});c(g,function(a,c){"fail"===a?f.failures=Qf(c):"success"===a&&
(f.downloads=Mf(c,b))});return f}function Mf(a,b){var d={};a.forEach(function(a){var b=a.Go;d[b]||(d[b]=[]);d[b].push(a)});var f=[];c(d,function(a,c){var d=[];c.forEach(function(a){d.push(a);(a=a.g===P.bb||a.g===P.jd?!0:void 0)&&(f.push(Of(d,b)),d=[])});0<d.length&&f.push(Of(d,b))});return f}function Of(a,b){var c=a[0],d=a[a.length-1],f=c.D,g=Pf(a),c={time:f.requestTime,tresp:(f.O||b)-(f.requestTime||b),first:g,ranges:Ue(a,g),dur:(d.D.M||b)-(c.D.O||b),trace:Pd(a,b),status:d.c?"complete":d.c===k?"open":
d.g===P.bb?"abort":d.g===P.jd?"stall":"other"};v.xe.length&&(c.servertcp=Od(a));return c}function Od(a){var b=v.xe;return a.reduce(function(a,c){var d=[];if(c.pl){var z={};c.pl.split(";").forEach(function(a){a=a.split("=");2==a.length&&(z[a[0]]=a[1])});b.forEach(function(a){d.push(z[a])})}a.push(d);return a},[])}function Pf(a){var b=0;a.forEach(function(a){a.Nb&&(b=ya(b,a.Nb[0]))});return b}function Ue(a,b){var c=[];a.forEach(function(a){a.Nb?c.push([a.Nb[0]-b,a.Nb[1]-b]):c.push([0,-1])});return c}
function Pd(a,b){var c=[],d;a.forEach(function(a){a=a.D;d&&(c.push([a.requestTime-d.M,-2]),c.push([(a.O||b)-a.requestTime,-3]));c.push([(a.M||b)-(a.O||b),a.aa||0]);d=a});return c}function Qf(a){var b=[];a.forEach(function(a){var c=a.D;b.push({time:c.requestTime,tresp:c.O-c.requestTime,dur:c.M-c.O,range:a.Nb||[0,-1],reason:a.Ga||a.g===P.gd?"http":a.g===P.Mf?"timeout":"network",httpcode:a.Ga,nwerr:te(a.g)})});return b}function Te(a){var b=a.L,c=b.stream,d=b.track,f=b.url,g=Sf(d,f),h=k;switch(g){case rb:case Xa:h=
b.stream.J;break;case jh:case Di:h=d.J}c={f:c&&c.f,cp:g,J:h,D:a.D,i:b.i,url:f};b.offset!==k&&b.length!=k&&(c.Nb=[b.offset,b.offset+b.length-1]);return a.dp=c}function Rf(a){var b=a.dp;b&&(b.R=a.R,b.Ga=a.Ga,b.g=a.g,b.c=a.c,b.pl=a.headers&&a.headers["X-TCP-Info"],b.Go=Ve(a))}function Sf(a,b){if(a)return a.type;if(0<=b.indexOf("netflix.com")){if(0<=b.indexOf("nccp"))return"nccp";if(0<=b.indexOf("api"))return"api"}return"other"}function Ve(a){if(a.headers&&(a=a.headers["X-Session-Info"]))return a=(a?
a.split(";"):[]).filter(function(a){return 0==a.indexOf("port=")}).map(function(a){return a.split("=")[1]})[0],y(a)}function Wf(a,b){function c(a,z,f){for(var g,q,k,h,l,D=[];f;)k=a==Xa?f.videoprofile[xb]:f.audioprofile[xb],g=Ea(f.bitrate),q=d(f.downloadurls.downloadurl,!0),g=new re(b,z,a,ta(f.downloadableid),g,Ea(f.size),q,k),f.resolution&&(q=Ea(f.resolution.width),k=Ea(f.resolution.height),f.pixelaspect&&(h=Ea(f.pixelaspect.width),l=Ea(f.pixelaspect.height),h>l?q=q*h/l:k=k*l/h),0<q&&0<k&&(g.width=
xa(q),g.height=xa(k))),a==Xa&&(g.pk=!!f.superhd,g.jh=g.pk||!!f.hd,q=Pb(f,"hdcpversions","version"),g.Wk=!(!q||"none"==ta(q))),g.Wk&&"never"==v.aj||D.push(g),f=f[Rb];D.sort(function(a,b){return a.f-b.f});n(D,Ad);a=ic(a,v.Gt,v.Ht);if(hf&&hf.length)var ba=D.Yd(a),D=hf.call(D,function(a){return 0<=ba.indexOf(a.f)});D.sort(function(a,b){return a.f-b.f});n(D,Ad);return D}function d(a,b){for(var c={},z;a;)c[a.cdnid[xb]]=a.url[xb],b&&(z=Ea(a.expiration),0<z&&(p=p?ya(p,z):z)),a=a[Rb];return c}var f=new b.log.r("NccpParseAuth"),
g,h,l,m,u,p,U=[],bb,ra;for(l=Pb(a,"locations","location");l;){if(bb=ta(l.locationid))ra={id:bb,ma:Ea(l.rank),sk:Ea(l.level),weight:Ea(l.weight)},U.push(ra);l=l[Rb]}var H=v.ij,N=v.hj,Zb=[],G=[];for(l=Pb(a,"cdns","cdn");l;)bb=Ea(l.cdnid),U.some(function(a){if(a.id===ta(l.locationid,""))return ra=a,!0}),ra||(ra={id:bb,ma:Ea(l.rank),sk:1,weight:Ea(l.weight)}),(!H.length||0<=H.indexOf(bb))&&0>N.indexOf(bb)&&(l.lowgrade?G:Zb).push({id:bb,location:ra,type:ta(l.type,"unknown"),ma:Ea(l.rank),name:l.name[xb],
xq:!!l.exclusive}),l=l[Rb];Zb.sort(function(a,b){return a.ma-b.ma});U.forEach(function(a){var b=Zb.filter(function(b){return b.location.id===a.id});a.F=b});U.sort(function(a,b){return a.ma-b.ma});f.trace("Parsed cdns",{Count:Zb.length,LowGradeCount:G.length});if(!Zb.length)throw new Ta("no valid cdns");bb=[];for(l=Pb(a,"trickplay");l;){for(;l;)H=l.resolution,N=l.pixelaspect,H=new di(b,ta(l.trickplayid),Ea(H.height),Ea(H.width),Ea(N.height),Ea(N.width),Ea(l.size),d(l.downloadurls.downloadurl,!1)),
bb.push(H),l=l[Rb];bb.sort(function(a,b){return a.size-b.size})}H=[null];N={none:null};l=Pb(a,"timedtexttracks","timedtexttrack");for(var M;l;){g=[];for(G=l.timedtextdownloadables.timedtextdownloadable;G;)g.push(G),G=G[Rb];g.sort(function(a,b){return We(a)-We(b)});G=g[0];M=ta(G.timedtextprofile);"nflx-cmisc"==M&&(G=xd(g));g=ta(l.timedtexttrackid);u=ta(l.timedtexttype);M=ta(G.timedtextprofile);m={};if("nflx-cmisc"==M){var ca=Pb(G,"imagebasedtext");m.offset=ta(ca.masterindexoffset)|0;m.length=ta(ca.masterindexsize)|
0;ca=Pb(ca,"resolution");m.Fs={width:ta(ca.width),height:ta(ca.height)}}m=new Jf(b,g,ta(G.downloadableid),d(G.downloadurls.downloadurl,!1),ta(l.language.bcp47),ta(l.language.displayname.text),jf[u]||pd,u,M,m);H.push(m);N[g]=m;f.trace("Parsed timed text track",m);l=l[Rb]}H.sort(Qd);G=[];M={};for(ca=Pb(a,"audiogroups","audiogroup");ca;){u=ca.audiotype.audiotypeid[xb];if(0==v.yf.length||0<=v.yf.indexOf(u))for(l=ca.audiotracks.audiotrack;l;){g=l.audiotrackid[xb];m={type:rb,V:g,Cf:jf[u]||pd,th:u,Qa:ta(l.language.bcp47),
displayName:ta(l.language.displayname.text),isNative:!!l.isnative,jg:ta(l.channels)};m.U=c("audio",m,l.audiodownloadables.audiodownloadable);var ia=H,ha=[];if(l.disallowedtimedtexttracks){h={};for(var Ua=l.disallowedtimedtexttracks.timedtexttrackid;Ua;)h[Ua[xb]]=!0,ha.push(Ua[xb]),Ua=Ua[Rb];ia=ia.filter(function(a){return!(a?h[a.V]:h.none)})}m.Zv=ha;m.pa=ia;m.Ja={Bcp47:m.Qa,TrackId:m.V};f.trace("Parsed audio track",m,{StreamCount:m.U.length,AllowedTimedTextTracks:m.pa.length});m.U.length?(M[g]=m,
G.push(m)):f.warn("Audio track has no streams",m);l=l[Rb]}ca=ca[Rb]}if(!G.length)throw new Ta("no valid audio tracks");G.sort(Qd);g=[];for(l=Pb(a,"videotracks","videotrack");l;)m={type:Xa},m.U=c("video",m,l.videodownloadables.videodownloadable),f.trace("Parsed video track",{StreamCount:m.U.length}),m.U.length?g.push(m):f.warn("Video track has no streams"),l=l[Rb];if(!g.length)throw new Ta("no valid video tracks");u=[];for(l=Pb(a,"preferredtrackcombinations","preferredtrackcombination")||Pb(a,"defaulttrackcombinations",
"defaulttrackcombination");l;)m=ta(l.audiotrackid),ia=M[m],ca=ta(l.timedtexttrackid),ha=N[ca],ia&&0<=ia.pa.indexOf(ha)?u.push({P:ia,Q:ha,Ch:Ea(l.preferenceorder)}):f.warn("Invalid default track combination",{AudioTrackId:m,TimedTextTrackId:ca}),l=l[Rb];u.sort(function(a,b){return a.Ch-b.Ch});m=u[0]||{};N=g[0];M=m.P||G[0];m=m.Q||M.pa[0];var ja;(l=a.bookmark)&&(ja={time:1E3*Ea(l)});f.trace("Parsed bookmark",{Value:ja?ja.time:"None"});var Kb;(l=a.runtime)&&(Kb=1E3*Ea(l));Kb||(Kb=M.U[0],ca=N.U[0],Kb=
qd(Ca(8192*Kb.size/(1E3*Kb.f),8192*ca.size/(1E3*ca.f))),f.trace("Estimating runtime",{EstimatedRuntime:Sa(Kb)}));var r;(l=a.clientipaddr)&&(r=ta(l));f.trace("Parsed client IP address",{IP:r});b.F=Zb;b.jj=U;b.rb=G;b.If=g;b.eb===k&&(b.eb=ja?ja.time:0);b.pa=H;b.Rb=bb;b.Ee=Kb;b.Nh=r;b.Pk=u;b.Sb.set(N);b.P.set(M);b.Q.set(m);U=1E3*(p-Sb.Ad());1E4<U?b.qd=ga()+U:f.error("Invalid url expiration, ignoring")}function We(a){var b=ta(a.timedtextprofile),c=v.Qb.indexOf(b);return 0<v.Bf&&"dfxp-ls-sdh"===b&&Ea(a.size)>
v.Bf?v.Qb.length+1:0<=c?c:v.Qb.length}function Qd(a,b){if(!a)return-1;if(!b)return 1;var c=a.displayName,d=b.displayName;return c?d?c.localeCompare?c.localeCompare(d):c.charCodeAt(0)-d.charCodeAt(0):1:-1}function hd(){var a=ze&&ze.height;if(b(a))return 1080<=a?1080:720;ua.error("screen height not available",jc)}function xd(a){var b;a=a.filter(function(a){return"nflx-cmisc"===ta(a.timedtextprofile)});var c=v.hk?v.hk:hd();c&&(b=a.filter(function(a){return c===Ea(a.imagebasedtext.resolution.height)})[0]);
b||(b=a[0]);return b}function id(a,b){function c(a,d){var z=[];a.forEach(function(a){var c;c=new re(b,d,d.type,a.downloadableId,a.bitrate,a.size,a.urls,a.contentProfile);a.width&&(c.width=a.width);a.height&&(c.height=a.height);d.Ag&&(c.Ag=d.Ag);if(d.type===Xa||d.type===rb)N=N?ya(N,a.validFor):a.validFor;d.zj&&(c.zj=d.zj.map(function(a){var b={};b.Gz=a.systemType;a.bytes&&(b.Bv=a.bytes);a.checksum&&(b.Fv=a.checksum);a.keyId&&(b.kh=a.keyId);return b}));a.contentProfile&&(c.nj=a.contentProfile);c.Ds=
!(!a.hdcpVersions||"none"==a.hdcpVersions[0]);c.Ds&&"never"==v.aj||z.push(c)});z.sort(function(a,b){return a.f-b.f});n(z,Ad);z.sort(function(a,b){return a.f-b.f});n(z,Ad);return z}function d(a,b){if(!a)return-1;if(!b)return 1;var c=a.displayName,z=b.displayName;return c?z?c.localeCompare?c.localeCompare(z):c.charCodeAt(0)-z.charCodeAt(0):1:-1}var f=new b.log.r("BladeRunnerParseManifest"),g,h,l,m,u,p,U,bb,ra,H,N;g=function(){var b=a.locations.map(function(a){return{id:a.id,ma:a.rank,sk:a.level,weight:a.weight}});
f.trace("Transformed locations",{Count:b.length});return b}();h=function(b){function c(a,b){var d;b.some(function(b){if(b.id===a)return d=b,!0});return d}var d=v.ij,g=v.hj,q=[];a.cdns.forEach(function(a){var z=a.id,f=c(a.locationId,b);(!d.length||0<=d.indexOf(z))&&0>g.indexOf(z)&&(a.location=f,q.push(a))});q.sort(function(a,b){return a.ma-b.ma});b.forEach(function(a){var b=q.filter(function(b){return b.location.id===a.id});a.F=b});b.sort(function(a,b){return a.ma-b.ma});f.trace("Transformed cdns",
{Count:q.length});if(!q.length)throw new Ta("no valid cdns");return q}(g);l=function(){var c,d=[];a.trickPlayTracks&&a.trickPlayTracks.length?(c=a.trickPlayTracks[0].downloadables)?d=c.map(function(a){return new di(b,a.id,a.resHeight,a.resWidth,a.pixHeight,a.pixWidth,a.size,a.urls)}):f.warn("Trickplay track has no downloadables"):f.warn("There are no trickplay tracks");d.sort(function(a,b){return a.size-b.size});f.trace("Transformed trick play tracks",{Count:d.length});return d}();m=function(){function c(a){function b(a){var c=
a.contentProfile,d=v.Qb.indexOf(c);a=a.size;return 0<v.Bf&&"dfxp-ls-sdh"===c&&a>v.Bf?v.Qb.length+1:0<=d?d:v.Qb.length}a=a.downloadables;var d=[];if(!a||0===a.length)return d;a.forEach(function(a){d.push({id:a.id,J:a.downloadableId,profile:a.contentProfile,size:a.size|0,Rk:b(a),offset:a.offset|0,Wr:a.pixWidth,Vr:a.pixHeight,Wt:a.urls,type:a.type})});d.sort(function(a,b){return a.Rk-b.Rk});return d}var g=[];a.textTracks.forEach(function(a){var d=[],d=c(a);if(0<d.length){var d=d[0],z={};"nflx-cmisc"===
d.profile&&(z.offset=d.offset,z.length=d.size,z.Fs={width:d.Wr,height:d.Vr});a=new Jf(b,a.id,d.J,d.Wt,a.bcp47,a.language,jf[a.trackType.toLowerCase()]||pd,a.trackType,d.profile,z)}else a=new Jf(b,a.id,k,{},a.bcp47,a.language,pd,a.trackType,k,{});g.push(a);f.trace("Transformed timed text track",a)});g.sort(d);f.trace("Transformed timed text tracks",{Count:g.length});return g}();u=function(b,g){function h(a,b,c){return b.filter(function(b){return 0<b.tracks.filter(function(b){return"AUDIO"===b.type&&
b.id===a}).length}).map(function(a){var b;b=a.tracks.filter(function(a){return"TEXT"===a.type})[0];a=c.filter(function(a){return a.V===b.id});return 0<a.length?a[0]:k}).filter(Boolean)}var l=[];a.audioTracks.forEach(function(a){var d=a.trackType;if(0===v.yf.length||0<=v.yf.indexOf(d))d={type:rb,V:a.id,Cf:jf[d.toLowerCase()]||pd,th:d,Qa:a.bcp47,displayName:a.language,jg:a.channels,pa:h(a.id,b,g),dx:{Bcp47:a.language,TrackId:a.id}},d.U=c(a.downloadables,d),f.trace("Transformed audio track",d,{StreamCount:d.U.length,
AllowedTimedTextTracks:d.pa.length}),d.U.length?l.push(d):f.warn("Audio track has no streams",d)});if(!l.length)throw new Ta("no valid audio tracks");l.sort(d);f.trace("Transformed audio tracks",{Count:l.length});return l}(a.media,m);p=function(){var b=[];a.videoTracks.forEach(function(a){var d=a.trackType,d={type:Xa,V:a.id,Cf:jf[d.toLowerCase()]||pd,th:d};d.U=c(a.downloadables,d);f.trace("Transformed video track",{StreamCount:d.U.length});d.U.length?b.push(d):f.warn("Video track has no streams")});
if(!b.length)throw new Ta("No valid video tracks");f.trace("Transformed video tracks",{Count:b.length});return b}();U=function(b,c){function d(a,b){a[b.type]=b.id;return a}function f(a,b){var c;for(c=0;c<a.length;c++){var d=a[c];if(d.V==b)return d}return null}var g=[],q=a.defaultMedia,k,h;for(h=0;h<a.media.length;h++){var l=a.media[h];if(l.mediaId==q){k=l.tracks.reduce(d,{});break}}g.push({P:f(b,k.AUDIO),Q:f(c,k.TEXT),Ch:0});return g}(u,m);H=U[0]||{};ra=p[0];bb=H.P||u[0];H=H.Q||bb.pa[0];b.Ry=a.playbackContextId;
b.Hx=a.media;b.Dv=a.cert;b.Ag=a.drmContextId;b.Wy=a.psshb64;b.F=h;b.jj=g;b.rb=u;b.If=p;b.eb=a.bookmark.position;b.pa=m;b.Rb=l;b.Ee=a.runtime;b.Nh=a.clientIpAddress;b.nx=function(){function b(a){var c=[],d;for(d in a)a.hasOwnProperty(d)&&c.push({cdn_id:d,url:a[d]});return c}var c={};c.movieId=a.movieId;c.duration=a.runtime;c.locations=function(){return a.locations.map(function(a){return{key:a.id,rank:a.rank,level:a.level,weight:a.weight}})}();c.servers=function(){return a.cdns.map(function(a){return{name:a.name,
type:a.type,id:a.id,key:a.locationId,rank:a.rank,lowgrade:a.isLowgrade}})}();c.audioTrackList=function(){return a.audioTracks.map(function(a){return{id:a.id,channels:a.channels,language:a.bcp47,languageDescription:a.language,trackType:a.trackType}})}();c.audio_tracks=function(){function c(a,d){return a.map(function(a){return{type:0,trackType:d.trackType,content_profile:a.contentProfile,downloadable_id:a.downloadableId,bitrate:a.bitrate,channels:d.channels,language:d.bcp47,urls:b(a.urls)}})}return a.audioTracks.map(function(a){return{type:0,
id:a.id,channels:a.channels,language:a.bcp47,languageDescription:a.language,trackType:a.trackType,streams:c(a.downloadables,a)}})}();c.video_tracks=function(){function c(a,d){return a.map(function(a){return{type:1,trackType:d,content_profile:a.contentProfile,downloadable_id:a.downloadableId,bitrate:a.bitrate,urls:b(a.urls)}})}return a.videoTracks.map(function(a){return{type:1,streams:c(a.downloadables,a.trackType)}})}();c.tracks=c.video_tracks.concat(c.audio_tracks);return c}();b.Pk=U;b.Sb.set(ra);
b.P.set(bb);b.Q.set(H);g=1E3*N;1E4<g?b.ox=ga()+g:f.error("Invalid url expiration, ignoring")}function Xf(a){function c(){var d={accountKey:k,playbackTokens:l,isLicensed:!!n,appId:N,sessionId:r,trackingId:a.Ca,xid:a.qa,movieId:a.sa,sessionStartEpoch:Sb.No(a.uk),sessionEpoch:Sb.Ad()};b(a.v.value)&&(d.position=a.v.value);u&&(d.playback={startPosition:m,startEpoch:U,playTimes:a.Mb.cq()});H&&v.Wd&&(d.keySessionId=H);var f=a.la;f&&Za(f.Mc)&&(d.errorDisplayCode=f.Mc);return d}function d(){d=p;Xe(a,h,g);
a.fireEvent(Ei)}function f(){f=p;a.fireEvent(mg)}var g=new a.log.r("NccpPlayback"),k=a.kc.W,h={gh:a.xa,log:new a.log.r("Nccp"),W:k},l,n,u,m,U,bb,ra,H,N=v.qr||Ae,r=v.rr||Ae;a.addEventListener(Wc,function(){u=!0;m=a.v.value;U=Sb.Ad()});a.addEventListener(Fi,function(a){H=a.Ue});return{Od:h,rd:function(b){function c(d){try{k(d,a),b(va),f()}catch(q){g.error(V,q),b({g:P.Of})}}var d=ga(),q={ag:N,Oh:r,dd:a.Rd.dd,me:a.Rd.me,sa:a.sa,Ca:a.Ca,fi:v.fi,dg:v.dg,Qb:v.Qb},k=a.af?id:Wf,V="Exception processing "+a.af?
"manifest":"authorization response";a.af?Ba(c.bind(null,a.af)):Sb.rd(q,h,function(a){bb=ga()-d;a.c?(l=a.La,c(a.eo)):b(a)})},lh:function(b,c){var f=ga(),k=S(b.ms),V=S(b.data),u=l,wa=a.Rd.dd;if(v.bc){var U=b.Mq;Y(v.tk)&&(U=v.tk);u=xc(u);wa=xc(wa);U&&(wa.limitedDuration=U);u.mslServiceTokens=l.mslServiceTokens.filter(function(a){return a.name.match("movie")})}Sb.lh({La:u,ag:N,Oh:r,dd:wa,qa:a.qa,J:a.Y.J,Ca:a.Ca,Xr:"standard",pc:b.pc,os:k,Bo:V},h,function(a){ra=ga()-f;if(a.c)try{l=a.La,n=!0,c({c:!0,Kq:{data:Ac(a.Lq)}}),
d()}catch(b){g.error("Exception processing license response",b),c({g:P.Of})}else c(a)})},ah:function(a,b){Sb.ah(c(),a,h,function(a){a.c&&a.La&&(l=a.La);b&&b(a)})},kf:function(a,b){Sb.kf(a,h,function(a){a.c&&a.La&&(l=a.La);b&&b(a)})},pg:function(a,b){Sb.pg(a,h,b)},oj:c,Mg:function(a){Sb.Mg(h,a)},Hp:function(){return bb},$p:function(){return ra}}}function Xe(a,b,c){Xe=p;if(Sb.ia&&v.Vt){var f=a.kc;a=f.Wc().ia;a=Ra(a);var g=v.sr;if("usr"==a||Za(jg)&&ac.sc!=jg||Za(g)&&ac.Ej!=g)c.info("Upgrading NetflixId",
{bt:a,prefix:g,downloadedEsn:jg}),Sb.ia(b,function(a){a.c?(c.trace("Setting upgraded NetflixId"),f.gl(a.uh,a.Hh),d($g(f.Wc().ia))):c.error("NetflixId upgrade failed",cb(a))})}}function Rd(a,b,c,d){d=d||{};v.Me&&(d.groupname=v.Me);var f=Nb();c={type:b,sev:c,devmod:kh};Gi&&(c.nettype=Gi);n(c,d);n(c,{jssid:Ae,jsoffms:ga(),client_utc:f,lver:xk||"2012.2-CAD"});a?n(c,{xid:a.qa,soffms:a.Hb(),mid:a.sa,lvpi:a.$c}):c.xid=Hi;this.data=c;this.type=b;this.Fo=f}function Yf(a){function c(d){var f=df.href,g=O(a.Hb()),
q=a.Ca,h="parallel"===v.og?"multi":"single",k=O(a.eb||0),l=a.index,V=new ArrayBuffer(4),D=new $a(V),V=new Uint32Array(V);D[0]=161;D[1]=178;D[2]=195;D[3]=212;f={browserua:jc,browserhref:f,playdelay:g,trackid:q,connection_type:h,bookmark:k,pbnum:l,endianness:3569595041==V[0]?"LE":2712847316==V[0]?"BE":"undefined"};a.Mo&&(f.controllerESN=a.Mo);a.fd&&(f.tmode=!0);b(a.sd)&&(f.bookmarkact=O(a.sd));b(a.sd)&&(f.bookmarkact=O(a.sd));(g=r.Hp())&&(f.nccpat=g);(g=r.$p())&&(f.nccplt=g);(g=m())&&(f.downloadables=
g);ac&&Y(ac.Fj)&&(f.esnSource=ac.Fj);Uc&&n(f,Uc,{prefix:"pi_"});f.usejsase=v.$;if(a.state.value>=ab)try{var u=a.Da();if(u){var ba=yf(u);C=Z(ba);f.maxbitrate=C}}catch(wa){H.error("Exception computing max bitrate",wa)}try{var U=Fa();U&&(f.pdltime=U)}catch(ja){}try{n(f,a.kb,{prefix:"sm_"}),n(f,a.Zg(),{prefix:"vd_"})}catch(G){}ra("startplay",d,kc|ng|Tb|og|kf|lh|mh,f)}function d(){var b={waittime:O(a.Hb()),abortedevent:"startplay"},c=a.k;c&&c.value&&(b.vbitrate=c.value.f);try{var f=Fa();f&&(b.pdltime=
f)}catch(g){}ra("playbackaborted",!1,kc|Tb,b)}function f(){if(a.F){var b;(b=N%v.zg?X.filter(function(a){return a.Eg}):X)&&0<b.length&&(X=X.filter(function(a){return!a.D.M}),b=Zc(b),v.xe.length&&(b.tcpinfo=v.xe.join(",")),ra("dlreport",!1,Tb,b))}}function g(b){var c=b.L,d=c.track;if(d){var f=!b.c&&b.g!=P.bb,q=d.type,h=b.D;if(f||a.$c){h={dltype:q,url1:c.url,url2:b.url||"",cdnid:c.i.id,tresp:O(h.O-h.requestTime),brecv:be(h.aa),trecv:O(h.M-h.O)};b.Nb&&(h.range=b.Nb);switch(q){case rb:h.adlid=c.stream.J;
break;case Xa:h.vdlid=c.stream.J;break;case jh:h.ttdlid=d.J}(c=te(b.g))&&(h.nwerr=c);b.Ga&&(h.httperr=b.Ga);ra("dlreq",f,Tb,h)}}}function h(){try{var b=Xd.timing.navigationStart-(nd+(a.Zc||ga())),c=Xd.getEntries("resource"),d=c.length-v.vj;0<d&&(c=c.slice(d));var f=c.map(function(a){return{u:a.name,s:jb(a.startTime+b),d:jb(a.duration)}}),g={dlinfos:lb.stringify(f)};ra("dlprestart",!1,kc|Tb,g)}catch(q){}}function l(){if(a.state.value==ab){var b=u();b.midplayseq=oa++;var c=a.A.value;b.prstate=c==Xc?
"playing":c==lf?"paused":c==Kc?"ended":"waiting";ra("midplay",!1,kc|Tb|kf|og,b)}}function m(){if(a.If&&a.rb){var b=[];a.If.concat(a.rb).forEach(function(a){a.U.forEach(function(a){b.push({dlid:a.J,type:a.type,bitrate:a.f})})});return lb.stringify(b)}}function eb(){function b(a,c){var z=a.cdnId,g=f[z];g||(g={cdnid:z,dls:[]},f[z]=g,d.push(g));z={bitrate:a.bitrate,tm:O(a.duration)};z[c]=a.downloadableId;g.dls.push(z)}var c=a.Mb.Fp(),d=[],f={};c.audio.forEach(function(a){b(a,"adlid")});c.video.forEach(function(a){b(a,
"dlid")});return lb.stringify(d)}function u(){var c=a.Mb,d={totaltime:Oa(c.Xg()),cdndldist:eb(),reposcount:Ia,intrplaycount:w};try{var f={numskip:0,numlowqual:0},g=a.ha,q;q=g.Ie();b(q)&&(d.totfr=q,f.numren=q);q=g.uc();b(q)&&(d.totdfr=q,f.numrendrop=q);q=g.yd();b(q)&&(d.totcfr=q,f.numrenerr=q);q=g.Je();b(q)&&(d.totfdl=q);d.playqualvideo=lb.stringify(f);d.videofr=a.k.value.j.Ng.toFixed(3);d.abrdel=c.Lj();var h=c.Ip();h&&n(d,h);d.rbfrs=w;d.maxbitrate=C;var k=a.Aa(),l,V,D,u;for(u=0;u<k.length;u++){l=
k[u];if(D=a.bf.Ac(l)){d.maxbitrate=V?V.f:0;d.bitratefilters=D.join("|");break}V=l}if(a&&a.qb&&a.ej&&a.ca){var ba=a.ej,wa={ab:xa(ba.Ui),actual60:a.ca.Xj(),b20:xa(ba.Wi),b50:xa(ba.Xi),b90:xa(ba.Yi),std:xa(ba.ot),ns:ba.Mt,ss:ba.tf,filt:ba.filter};d.expectedbw=lb.stringify(wa)}a.zb&&(d.trickplay=a.zb.Wj());null!==a.hc.ne&&(d.avg_subt_delay=a.hc.ne)}catch(U){H.error("Exception reading some of the endplay fields",U)}n(d,a.Zg(),{prefix:"vd_"});return d}function Db(a,b){a.browserua=jc;ra("securestop",!a.success,
kc|kf,a);b||(ra=p)}function U(){var b,c=[];v.ir&&(vc.addListener(nh,l),v.jr.forEach(function(a){c.push(Ya(l,a))}),v.yk&&(b=qb(bb,v.yk)),a.addEventListener(yb,function(){vc.removeListener(nh,l);c.forEach(function(a){pb(a)});b&&wb(b)}))}function bb(){rd.flush(!0)}function ra(b,c,d,f,g){Zf(f,a,c,d);b=new Rd(a,b,g||(c?"error":"info"),f);rd.Sk(b)}var H=new a.log.r("NccpLogging"),N=a.qa,r=a.lb,G,M=a.paused.value,ca,ia,ha,Ua,ja,Kb,t=[],Ia=0,w=0,oa=0,y=0,X=[],A,C,L,B;(function(){function b(c){ja="rebuffer";
ra("intrplay",!1,kc|Tb,{vdlid:a.k.value.J,cdnid:a.i.value.id,playingms:t[Xc]||0,pausedms:t[lf]||0,cause:c.Ic,intrplayseq:w++});ca=ga();Ba(l)}function l(){if(ca&&a.A.value!=Ub){var b=ga()-ca;ra("resumeplay",!1,kc|ng|Tb,{playdelay:O(b),reason:ja,intrplayseq:w-1});"rebuffer"==ja&&a.Mb.Qn(O(b));ia&&ia!=a.P.value&&ra("audioswitch",!1,kc|Tb,{switchdelay:O(ga()-ha),newtrackinfo:a.P.value.V,oldtrackinfo:ia.V});ja=ca=k}}function D(){a.Oc.value&&a.Fa.value&&(a.Oc.removeListener(D),a.Fa.removeListener(D),h())}
a.addEventListener(ye,g,1);v.zg&&(a.addEventListener(ff,function(a){X.push(Te(a))}),a.addEventListener(ye,Rf),y=qb(f,v.ep));a.paused.addListener(function(a){var b=a.newValue;a.Yx&&b||b==M||(ra("statechanged",!1,kc|Tb,{newstate:b?"Paused":"Playing",oldstate:M?"Paused":"Playing"}),M=b)});a.addEventListener(mf,b);a.addEventListener(yk,b);a.A.addListener(function(a){a=a.oldValue;var b=ga();a==Ub?t=[]:t[a]=(t[a]||0)+(b-Kb);Kb=b});a.addEventListener(Yd,function(b){switch(b.Ic){case Ii:case Ji:if(ja&&ca){var c=
ga()-ca,c={waittime:O(c),abortedevent:"resumeplay",resumeplayreason:ja},f=a.k;f&&f.value&&(c.vbitrate=f.value.f);ra("playbackaborted",!1,kc|Tb,c)}else G||d();ja="repos";ra("repos",!1,kc|Tb,{moffold:Oa(b.wh),reposseq:Ia++});ca=ga();Ba(l)}});a.A.addListener(l);a.P.addListener(function(a){ha=ga();ia=a.oldValue});a.addEventListener(Wc,function(){G=!0;c(!1);U();v.kk&&(A=Ya(function(){rd&&rd.flush(!1);A=k},v.kk))});a.addEventListener(yb,function(){A&&pb(A);if(G){v.zg&&(y&&wb(y),f());var b=!!a.la,g=u();
g.browserua=jc;a.fd&&(g.tmode=!0);g.usejsase=v.$;a.zb&&"downloaded"===a.zb.Wj()&&(g.trickplay_ms=a.$d.offset,g.trickplay_res=a.$d.Xk);if(v.$&&a.gc&&a.gc.Ri){var h=a.gc.Ri[a.nl.im],k=a.gc.Ri[a.nl.hm];h&&k&&(g.ASEvstreamingPts=h.Dt,g.ASEastreamingPts=k.Dt,g.ASEvbuflevelBytes=h.qo,g.ASEabuflevelBytes=k.qo,g.ASEvbuflevelMs=h.ro,g.ASEabuflevelMs=k.ro)}g.endreason=b?"error":a.A.value==Kc?"ended":"stopped";Uc&&n(g,Uc,{prefix:"pi_"});var h=a.la,l;if(k=b&&h)h=h.errorCode,k=h==R.ie||h==R.ee;k&&(l="info");ra("endplay",
b,kc|ng|Tb|kf|og|mh,g,l)}else a.la?c(!0):d();B||(ra=p)});a.pe&&a.pe.addListener(function(a){ra("bitraterestriction",!1,kc|Tb,a.newValue)});a.k.addListener(function(b){if(b.oldValue&&b.kj){var c=b.oldValue,d=b.newValue,f=b.kj;b=v.$?a.zf:a.ca.re();c={moff:Oa(f),vbitrate:d.f,vbitrateold:c.f,vdlid:d.J,vdlidold:c.J,lbw:b};(d=a.Fa.value)?(b=kd(d.yj),c.bw=xa(896E3/(b.Ld+896E3/b.zf)*7.8125)):c.bw=b;ra("chgstrm",!1,Tb,c)}});var m;a.Ya.addListener(function(a){if(a.newValue){var b=a.newValue.stream;m!=b&&(m&&
ra("renderstrmswitch",!1,Tb,{moff:Oa(a.newValue.H.startTime),vbitrate:b.f,vdlidold:m.J,vdlid:b.J,vbitrateold:m.f}),m=b)}});a.i.addListener(function(b){if((b=b.newValue)&&Ua!=b){var c=Ua,d=a.Fa&&a.Fa.value&&a.Fa.value.yj,f=b.id,g={selcdnid:f};if(d){var q=kd(d),d=q.Ld,q=xa(896E3/(q.Ld+896E3/q.zf)*7.8125);g.selcdnrtt=d;g.selcdnbw=q;g.cdnbwdata=lb.stringify([{id:f,rtt:d,bw:q}])}c&&(g.oldcdnid=c.id);n(g,b.mc);ra("cdnsel",!1,lh,g);Ua=b}});v.vj&&(a.Oc.addListener(D),a.Fa.addListener(D));v.Wd&&a.state.addListener(function(){a.state.value==
ab&&(L=a.zc,L.addEventListener(Ki,function(){B=!0;L.ce().then(Db)}))})})();this.Ts=Db}function te(a){switch(a){case P.gd:return"http";case P.Mf:return"connectiontimeout";case P.jd:return"readtimeout";case P.Lf:return"corruptcontent";case P.bb:return"abort";case P.ki:case P.li:return"unknown"}}function Zf(a,b,d,f){f&kc&&0<=b.v.value&&(a.moff=Oa(b.v.value));if(f&ng){var g=b.i.value,h=b.ec.value||b.Oc.value,k=b.Ya.value||b.Fa.value;g&&(a.cdnid=g.id,a.cdnname=g.name);h&&(a.adlid=h.stream.J,a.abitrate=
h.stream.f);k&&(a.vdlid=k.stream.J,a.vbitrate=k.stream.f)}f&Tb&&((g=b.n)&&0<=b.v.value&&(a.abuflmsec=O(g.tb()),a.vbuflmsec=O(g.Ia()),a.abuflbytes=be(g.Kj()),a.vbuflbytes=be(g.Zj())),(g=b.T&&b.T.Rg&&b.T.Rg())&&(a.curdlstatename=g));if(f&og){$f(a);try{var l=b.Za.getBoundingClientRect();a.rendersize=l.width+"x"+l.height;a.renderpos=l.left+"x"+l.top}catch(n){}}f&kf&&(l=Yb.hardwareConcurrency,0<=l&&(a.numcores=l),0<=b.te&&(a.cpuspeed=b.te),(l=b.wd&&b.wd.Jp())&&(a.droppedFrames=lb.stringify(l)),l=b.wd&&
b.wd.bq(v.lp),c(l,function(b,c){a["droppedFramesP"+b]=lb.stringify(c)}));if(f&lh)try{a.pricdnid=b.Sd.id,a.cdninfo=lb.stringify(b.F.map(function(a){return{id:a.id,nm:a.name,rk:a.ma,wt:a.location.weight}}))}catch(u){}d&&f&mh&&((b=b.la)?Sd(a,b):a.errorcode=R.jc)}function Sd(a,b){a.errorcode=hg+(b.errorCode||R.jc);b.g&&(a.errorsubcode=b.g);b.R&&(a.errorextcode=b.R);b.C&&(a.errordetails=b.C);b.Ga&&(a.httperr=b.Ga);b.xd&&(a.nccperr=b.xd);var c=te(b.g);c&&(a.nwerr=c)}function $f(a){a.screensize=ze.width+
"x"+ze.height;a.screenavailsize=ze.availWidth+"x"+ze.availHeight;a.clientsize=F.innerWidth+"x"+F.innerHeight}function ag(a){function b(){return Lb.Lh&&a.state.value==ab&&G&&!N&&(0<Lb.Dd||U!=Bd)}function c(a,d){var z=a||Bd;z!=Bd&&(U=z);b()&&(z=U!=Bd?v.bh:Ca(v.bh,1E3*Lb.Dd),z=Ca(z-(ga()-bb),d||0),!d&&(!bb||500>=z||ra==Bd&&U!=Bd)?g():f(z))}function d(){H&&(pb(H),H=k)}function f(a){d();H=Ya(c,a)}function g(){if(b()){d();N=!0;var f=U;U=Bd;a.lb.ah(f,function(b){b.c||m.error("Heartbeat failed",{Type:f},
cb(b));ra=f;bb=ga();N=!1;11==b.Rc?a.Sa(new Ib(R.ym,b)):c()})}}function h(){if(G){var b=a.lb.oj();l(b);v.Yr&&(ca=b,a.lb.pg(b,function(a){ca==b&&(M=a.c?a.mq:k)}))}}function l(a,b){0<v.yh&&v.bd?fb.save(v.bd,lb.stringify(a),!1,b):b&&b(va)}function n(b){Ye(a,function(a){a.c&&(jd(),h());b&&b(a)})}function u(){M&&(m.info("Sending last playdata synchronously",{Url:M.url}),Hf(M).c?jd():(m.info("Sending last playdata asynchronously"),a.xa.N(M,p),h()))}var m=new a.log.r("PlayDataManager"),U=Bd,bb=0,ra,H,N,r,
G,M,ca;a.addEventListener(mg,function(){Be&&n()});a.addEventListener(Ei,function(){G=!0;0<v.yh&&(r=qb(h,v.yh));h()});a.addEventListener(yb,function(){function b(){c&&f&&g&&(b=p,a.wr())}gb.removeListener(Lc,u);d();r&&(wb(r),r=k);var c,f,g,h;if(G){a.zl();var q=a.lb.oj();l(q,function(){function d(){a.lb.kf(q,function(d){d.c?jd(function(b){b=b.c?d:b;h&&a.zc.di(b)}):(m.error("Unable to send playdata"),h&&a.zc.di(d));c=!0;b()})}v.Wd?(a.zc.ce().then(function(){g=!0;b()}),a.zc.yl().then(function(a){a.c?(q.securestop=
a.data,h=!0):g=!0;d()})):(g=!0,d())})}else g=c=!0;rd?(a.zl(),rd.flush(!1,function(a){a.c||m.error("Unable to send logblob");f=!0;b()})):f=!0});a.addEventListener(Yd,h);a.addEventListener(Wc,function(){a.A.addListener(function(){c(a.A.value==Xc?zk:Ak,a.A.value==Kc?500:0)});b()&&f(Ca(v.bh,1E3*Lb.Dd));h()},1);gb.addListener(Lc,u);return{$s:function(b){oh?oh.then(function(){b(va)}):Be&&Be.movieId==a.sa?n(b):b(va)}}}function Ye(a,b){b=b||p;var c=Be;if(c){var d=c.accountKey;Be=null;if(d){var f;oh=new Wd(function(a){f=
a});Lf(d,function(g){var h=g.kc;if(g.c&&h){g=function(g){k=a?xc(a.lb.Od):{gh:od,log:new ua.r("Nccp")};k.W=d;k.log.info("Sending persisted playdata",{PersistedXid:c.xid,SessionEpoch:c.sessionEpoch,MediaTime:c.position});g&&(c.securestop=g.data);Sb.kf(c,k,function(a){g?g.c&&(ua.info("SecureStop Ack For Persisted Playback "),u.di(a)):(f(),b(a))})};var k,h=c.keySessionId,l=c.xid;if(a&&v.$k)if(h){var u=new ci(a,h);u.Hd();u.yl().then(g);u.ce().then(function(c){f();b(va);c.persisted=!0;c.previousXid=l;a.Dk.Ts(c,
!0)})}else ua.error("SSManager: prev keysession not available",{ErrorCode:R.hn}),g();else g()}else f(),b(va)})}else b(va)}else b(va)}function jd(a){fb&&v&&v.bd&&fb.remove(v.bd,function(b){b.c||ua.error("Error deleting playdata",b);a&&a(b)})}function Ze(a,b,c,d){this.Z=a;this.rf=b;this.Ef=c;this.Df=d;this.totalTime=this.rf+this.Ef}function Xb(a){function b(){var a=1E3*xa(nd/1E3),c=H.Qj(),d=H.Rj(),f=H.zd(),z=H.Yg(),g=H.Bd();c&&g&&(a=new Ze(a+d,f,z,g),ra&&(c in G||(G[c]=[]),G[c].push(a)))}function d(){ra in
M||(M[ra]={});var a=M[ra],b=0;c(G,function(c,d){var f;f=c in a?a[c]:[];for(var z=g(d,v.eh),h=z.length;h--;)z[h].Z>ia&&f.push(z[h]),b<z[h].Z&&(b=z[h].Z);a[c]=f;ia=b})}function f(){r||(r=!0);for(var a in G)G[a]=g(G[a],v.eh);u()}function g(a,b){var c=[],d=[],f=1E3*b,z;if(0<a.length){for(var q=a[0].Z,k=0;k<a.length;k++)z=a[k],wc(q-z.Z)<=f?d.push(z):(c.push(h(d)),q=z.Z,d=[z]);0<d.length&&c.push(h(d))}return c}function h(a){for(var b=0,c=0,d=0,f=a.length,z=0;z<f;z++)b+=a[z].rf,c+=a[z].Ef,d+=a[z].Df;return new Ze(a[0].Z,
b,c,d)}function k(){if(l()>v.ek){var a=[],b,d;c(M,function(f,z){z&&c(z,function(c,f){b=f.length;for(d=0;d<b;d++)a.push(f[d])})});a.sort(function(a,b){return b.Z-a.Z});var f=a[v.ek-1].Z;c(M,function(a,z){z&&(c(z,function(a,c){b=c.length;for(d=0;d<b;d++)c[d].Z<f&&(c.splice(d,1),--d,--b);0===c.length&&delete z[a]}),0===Qb.keys(z).length&&delete M[a])})}}function l(){var a=0,b;for(b in M){var c=M[b],d;for(d in c)a+=c[d].length}return a}function n(){ra&&fb.load(Li,function(a){if(a.c&&(a=a.data))a:{M=U(a);
a=ra;var b=Bk(M),c=[],d;if(Jb(a))d=v.kq;else if(Na(a))d=v.lq;else{ca=c;break a}for(var f=0;f<b.length;f++)bd(a,b[f],d)&&c.push(b[f]);ca=c}})}function u(){ra&&(d(),k(),fb.save(Li,m(M)))}function m(a){var b={};Qb.keys(a).forEach(function(c){b[c]={};Qb.keys(a[c]).forEach(function(d){for(var f=a[c][d],z=f.length,g=[],h=0;h<z;h++)g.push({sT:f[h].Z,rT:f[h].rf,trT:f[h].Ef,tB:f[h].Df,toT:f[h].totalTime});b[c][d]=g})});return b}function U(a){var b={};Qb.keys(a).forEach(function(c){b[c]={};Qb.keys(a[c]).forEach(function(d){for(var f=
a[c][d],z=f.length,g,h=[],q=0;q<z;q++)g={},"undefined"!==typeof f[q].sT&&"undefined"!==typeof f[q].rT&&"undefined"!==typeof f[q].trT&&"undefined"!==typeof f[q].tB&&"undefined"!==typeof f[q].toT&&(g.Z=f[q].sT,g.rf=f[q].rT,g.Ef=f[q].trT,g.Df=f[q].tB,g.totalTime=f[q].toT,h.push(g));0<h.length&&(b[c][d]=h)});0===Qb.keys(b[c]).length&&delete b[c]});return b}var p=this,ra,H,N,r=!1;a.addEventListener(mg,function(){a.fh=p;H=a.ca;ra=a.Nh;N=new ie(1E3*v.eh,f);N.Sh();a.addEventListener(pg,b);a.addEventListener(yb,
function(){u();N.ud()});a.A.addListener(function(){a.A.value===Kc&&N.ud()});n()});var G={},M={},ca=[],ia=0;this.Sp=function(a,b){var c;if(ra){c=[];if(a in G&&r)return c=G[a],new Rc(c,b,v.bk,v.fk,v.dk,v.ck,l());for(var d=ca.length,f,z;d--;)if(f=ca[d],a in M[f])for(f=M[f],z=f[a],f=z.length;f--;)c.push(z[f]);if(0!==c.length)return new Rc(c,b,v.bk,v.fk,v.dk,v.ck,l())}}}function Rc(a,b,c,d,f,g,h){this.mr=f;this.br=g;a=vd(a,b,c,d,this.mr,this.br);b=[];for(c=0;c<a.length;c++)b.push(7.8125*Ka(a[c].Df/a[c].totalTime,
ph,qh));this.gf=B(b);this.tf=this.gf.length;this.Ui=T(this.gf)/this.gf.length;a=this.gf;c=this.tf;d=this.Ui;f=[];for(g=0;g<c;g++)f.push(gh(a[g]-d,2));this.ot=Ck(T(f)/f.length);this.Wi=sb(b,.2);this.Xi=sb(b,.5);this.Yi=sb(b,.9);this.filter=qg;this.Mt=h}function vd(a,b,c,d,f,g){var h=[],k=c,l=qd(b%604800/86400);b%=86400;var u,n,m;qg=c;if(k===Dk){for(m=0;m<a.length;m++)c=a[m],u=c.Z%86400,n=qd(c.Z%604800/86400),l===n&&wc(u-b)<=d&&h.push(c);h.length<f&&(qg=k=Mi,h=[])}if(k===Mi){for(m=0;m<a.length;m++)c=
a[m],u=c.Z%86400,n=qd(c.Z%604800/86400),wc(u-b)<=d&&h.push(c);h.length<f&&(qg=Ni,h=[])}k===Ni&&(h=a,h.length<f&&(h=[]));h.length>g&&(h=h.sort(function(a,b){return a.Z<b.Z?-1:a.Z>b.Z?1:0}).slice(0,g));a=[];for(d=0;d<h.length;d++)0<h[d].totalTime&&a.push(h[d]);return a}function gd(){n(this,{W:"b",sa:0,Rd:{Ca:0,dd:{},me:{}},Ca:0,index:1,qa:0xceb86ce78ed,Za:{align:"",cy:null,by:null,contextMenu:null,Pw:{},Hy:null,Gy:null,Fy:null,Ey:null,Dy:null,onsubmit:null,Cy:null,onshow:null,onselect:null,By:null,
Ay:null,onscroll:null,onresize:null,onreset:null,yy:null,onprogress:null,xy:null,wy:null,vy:null,onmousewheel:null,onmouseup:null,onmouseover:null,onmouseout:null,onmousemove:null,onmouseleave:null,onmouseenter:null,onmousedown:null,onloadstart:null,uy:null,ty:null,onload:null,onkeyup:null,onkeypress:null,onkeydown:null,sy:null,oninput:null,onfocus:null,onerror:null,onended:null,ry:null,qy:null,py:null,oy:null,ny:null,my:null,ly:null,ky:null,jy:null,ondblclick:null,iy:null,oncontextmenu:null,onclose:null,
onclick:null,onchange:null,oncanplaythrough:null,hy:null,gy:null,onblur:null,onabort:null,spellcheck:!0,isContentEditable:!1,contentEditable:"",Ky:"",innerText:"",accessKey:"",hidden:!1,Yz:"",draggable:!1,tabIndex:-1,dir:"",translate:!0,lang:"",title:"",ontouchstart:null,ontouchmove:null,ontouchend:null,ontouchcancel:null,childElementCount:2,lastElementChild:{},firstElementChild:{},children:{},Jy:null,Iy:null,nextElementSibling:null,previousElementSibling:null,onwheel:null,onselectstart:null,zy:null,
onpaste:null,oncut:null,oncopy:null,fy:null,ey:null,dy:null,shadowRoot:null,dataset:{},classList:{},className:"",outerHTML:"",innerHTML:"",scrollHeight:545,scrollWidth:2560,scrollTop:0,scrollLeft:0,clientHeight:545,clientWidth:2560,clientTop:0,clientLeft:0,offsetParent:{},offsetHeight:545,offsetWidth:2560,offsetTop:0,offsetLeft:0,localName:"",prefix:null,namespaceURI:"",id:"",style:{},attributes:{},tagName:"",parentElement:{},textContent:"",baseURI:"",ownerDocument:{},nextSibling:null,previousSibling:null,
lastChild:{},firstChild:{},childNodes:{},parentNode:{},nodeType:1,nodeValue:null,nodeName:""},$c:!1,Ja:{Iu:0,gv:0,hv:0},kb:{Nw:0,rv:0,at:0,yz:0,xz:0,Yw:0,Ex:0,Vw:0,lx:0,Ww:0,Vz:0},log:{Ka:{}},state:{value:2},v:{value:0},paused:{value:!1},muted:{value:!1},volume:{value:1},A:{value:1},o:{value:2},P:{value:{}},Sb:{value:{}},Q:{value:{}},lc:{value:null},Zh:{value:null},k:{value:{}},G:{value:{}},i:{value:{}},ec:{value:null},Ya:{value:null},ze:{value:{}},Ae:{value:{}},Oc:{value:{}},Fa:{value:{}},qe:{value:{}},
xa:{},qh:{},ca:{},wg:{},jf:{},Nk:{},Lk:{},wd:{},bf:{},fh:{},Zc:0,uk:0,kc:{W:"",Tc:!0,Gh:!1,We:0,je:{},mk:!0},wa:{},lb:{Od:{}},Dk:{},F:[{},{},{},{},{}],jj:[{},{},{},{},{}],rb:[{}],If:[{}],eb:0,pa:[null,{}],Rb:[{},{}],Ee:0,Nh:0,Pk:[{}],qd:0,Sd:{id:0,location:{},type:0,ma:1,name:"",xq:!1,Jq:0,mc:{}},Ct:[{},{},{}],Yh:[{},{},{}],Jt:0,te:0,cd:{track:{},type:"",J:0,f:0,size:0,Ta:{},j:{},Ja:{},Pe:!0},Y:{track:{},type:"",J:0,f:0,size:0,Ta:{},j:{},Ja:{},width:0,height:0,pk:!1,jh:!1,Wk:!1,Pe:!0,Ed:{}},n:{cb:{},
Ab:{}},duration:0,ic:{width:0,height:0},sd:0,ha:{},fb:{T:{},da:{},Xb:{},gb:{},Eb:0,sb:{},qb:!1},T:{},hc:{ne:null},$h:{},Mb:{},oq:{},zc:{},nl:{hm:0,im:1},gc:{ls:p,Cw:p,zw:p,lv:p,ft:p}})}function Sc(a){function b(){a.n.ve()}var c=[];this.Ac=function(a){for(var b=[],d=c.length;d--;){var f=c[d];f.Ac(a)&&b.push(f.Ig)}if(b.length)return b};Oi.forEach(function(b){(b=b(a))&&c.push(b)});0<c.length&&a.addEventListener(Wc,b)}function sc(a){Oi.push(a)}function oe(a,b){var c=a.length,d,f=b.length,g,h,k;for(d=
0;d<c;d++)for(g=a[d],k=g[0],h=g[1],g=0;g<f;g++)if(b[g]>=h&&0>=--k)return!0}function tc(a){function b(f){a.removeEventListener(rh,b);try{var g=f.data,h=g.length,k;f=0;for(var l,u,m,n={};f<0+h;){k=g[f];l=k&7;u=k>>3;var v=g,p=f,H=p+1,N=v.length,r=H,G=0,M={},ca=[],ia=void 0,ha=void 0,t=0;if(H>=N)throw new Ta("Invalid Range for Protobuf - start: "+H+" , len: "+N);for(;r<N;){G++;ia=v[r];ha=ia&127;ca.push(ha);if(!(ia&128))break;r++}for(var ja=ca.length-1;0<=ja;ja--)t<<=7,t|=ca[ja];M.count=G;M.value=t;M.start=
p+G+1;m=M;if(!m.count)throw new Ta("Parsing error. bytes length is 0 for the tag "+k);f+=m.count+1;2==l&&(f+=m.value);n[u]={sw:u,Zz:l,value:m.value,count:m.count,start:m.start}}var w;var y;w=n&&(y=n[1])?y.value:void 0;1==w&&n[5]&&n[5].value&&(d=!0,a.ht());c.trace("RA check",{HasRA:d})}catch(Ia){c.error("RA check exception",Ia)}}var c=new a.log.r("RAF"),d;a.addEventListener(rh,b);return{Ig:"ra",Ac:function(a){if(!d)return a.jh}}}function cd(a,b){var c,d,f,g,h=a.cb,k=a.Ab,h=h.S.Ma||h.S;d=xa(h.endTime/
(h.index+1));h=k.S.Ma||k.S;f=xa(h.endTime/(h.index+1));c=d*f;g=.128*d*b.f;this.Ub=function(a,b){return xa(((c-f*(b+g/a))/d-b)*a/f*7.8125)}}function Tf(a){var b,c=[],d=100,f=128,g=0,h=0,k=0,l,u;a.addEventListener(ye,function(b){var g=b.D,V=b.L;V.i&&(l=V.i.location.id);u=g.requestTime;if(b.c&&g.aa>Pi&&b.type==Bc){for(c.push(g);c.length>Ek;)c.shift();var m=0,n,v=c.length;h=k=0;if(0<v){var G,M;for(b=v;b--;)n=c[b],g=ue(n),V=n.requestTime+g,m+=g,k+=n.aa,n.M>G||(h+=M-G||0,M=n.M),G=V;h+=M-G||0;d=qd(m/v);
f=Ka(k/h,ph,qh);a.fireEvent(pg)}}});a.addEventListener(yb,function(){m&&m.yb()});var m=new Ob(6E4,function(){g=f;m.yb()});m.qc();this.zd=function(){return d};this.Wg=function(){return f};this.Xj=function(){return g};this.Bd=function(){return k};this.Yg=function(){return h};this.Qj=function(){return l};this.Rj=function(){return u};this.ka=function(a){return d+a/f};this.Ub=function(){b=b||new cd(a.n,a.cd);return b.Ub(f,d)};this.re=function(){return xa(896E3/(d+896E3/f)*7.8125)}}function ue(a){a=ya(a.O-
a.requestTime,(a.M-a.requestTime)*Fk);a=xa(a);return Ka(a,Gk,Hk)}function kd(a){var b=ue(a);a=Ka(xa(a.aa/(a.M-(a.requestTime+b))),ph,qh);return{Ld:b,zf:a}}function $e(a){function b(){d();var a=u.ea(0,!0);m=h(l,0,a);return 0>m.Ib||0>m.wb}function c(a){for(a=f(a);a&&a.j;)a=a.lower;return a}function d(b){var c=a.Da();if(b){b=a.Aa().Yd(v.vq);for(var f=c.length,g=[],h=0;h<f;h++)-1!==b.indexOf(c[h].f)&&g.push(c[h]);c=g}b=c.length;n(c,Ad);for(f=0;f<b;f++)c[f].lower=c[f-1],c[f].Ed=c[f+1];u=c}function f(b){var c=
u.ea(b.f);if(!c.Ed)return c;var d=a.n.Yb(),d=Fc(v.fg,d);b=Fc(v.ol,b.f)[0];b=ya(b,l.Ub()/(1+d[2]/100));b=u.fa(b+1);return b.f<=c.f?c:b}function g(){for(var b,c=a.Fa.value.stream,d=f(c),k,q=a.n.Yb(),V=Fc(v.$i,q),u=Fc(v.fg,q),m,n;d;){if(d.j)if(b=d.f>c.f?u:V,m=v.Xa+(b[0]||0),n=v.Xa+(b[1]||0),k=d,b=h(l,b[2],d),b.Ib<m||b.wb<n){if(d.f<=c.f&&v.wj&&q>v.wj)break}else break;d=d.lower}d||(d=k);return{k:d,Ib:b.Ib-m,wb:b.wb-n}}function h(b,c,d){function f(){for(;wa&&wa.media&&Ma<ba;)Ma+=wa.duration,wa=wa.next;
for(;db&&db.media&&r<ba;)r+=db.duration,db=db.next}function g(){if(q>=eb){for(var a=d.lower;a&&!a.j;a=a.lower);a&&(d=a,n=a.j.t);g=p}}var k=(c||0)/100+1,q=a.v.value,l=a.n,V=a.G.value,u=l.cb,m=l.Ab,l=V.j.t,n=d.j.t,D=[];D.reduction=c;c=v.Md;v.Jb&&(c=ya(c,xa(v.Jb/(.192*(V.f+d.f)))));var ba=c-v.Vi,wa=u.hb(q),Ma=Ca(wa.startTime-q,0),db=m.hb(q),r=Ca(db.startTime-q,0);f();var eb=q+r+v.jq,V=v.jl?q+ya(r,Ma)+v.jl:145152E5,u=Ma;c=r;for(var X,t,Db;q<V;)if(f(),Db=m=t=0,X=ya(Ma-ba,r-ba),0<X&&(q+=X,Ma-=X,r-=X),wa&&
(Ma<r||!db)?(X=l[wa.index],t=X.length,m=X.duration,wa=wa.next):db&&(g(),X=n[db.index])&&(t=X.length,Db=X.duration,db=db.next),0<t)t=b.ka(t)*k,q+=t,Ma-=t,r-=t,u>Ma&&(u=Ma),c>r&&(c=r),Ma+=m,r+=Db;else break;return{Ib:u,wb:c,zz:D}}var l=a.ca,m,u,r=v.as;n(this,{Uc:function(b){var c=l.re()/v.bo;return a.Fb().fa(c,b)},ib:function(b){d(b);b=l.Ub();var f=jb(Fc(v.$r,b)[0]);b=(b=u.fa(f+1,!0))||a.Y;var g=a.n,k=v.Ok,V=h(l,k[2],b),m=g.Gb(),n=g.$b(),m=m?g.cb.S.endTime-m.startTime:0,n=n?g.Ab.S.endTime-n.startTime:
0,ba=g.tb(),p=g.Ia(),g=-V.Ib+v.Xa+(k[0]||0),k=-V.wb+v.Xa+(k[1]||0),g=Ca(g,v.Ah-ba),g=ya(g,Ca(r-ba,0),m),k=Ca(k,v.Bh-p),k=ya(k,Ca(r-p,0),n),f=u.fa(f+1,!1);f==b&&f.j&&(f=c(b));return{k:b,Wa:f,mb:g,nb:k}},Vc:function(){d();var a=g(),b=a.k,f=c(b);f&&(a=ya(a.Ib,a.wb),l.ka(f.Hj())<=a||(f=u[0],f=f.j?null:f));return{k:b,Wa:f}},Jd:b,Uh:function(){var c=a.k.value.f,d=u.ea(0,!1).f;return a.n.Sj()<v.Nn&&c!==d&&b()},Vj:function(a){var b=g(),b={Ib:b.Ib-v.le[0],wb:b.wb-v.le[1]},b=ya(b.Ib,b.wb);a=l.ka(a);a*=1+.01*
v.le[2];return a<b},Tg:function(){d();var b=h(l,v.$i[2],u[u.length-1]);return a.n.Ia()-b.wb}});a.addEventListener(Zd,function(){m=k});a.addEventListener(Wc,function(){r=v.ts})}function Ug(a){function b(){var c=v.Md,d=a.G,f=a.k;v.Jb&&(c=ya(c,xa(v.Jb/(.192*(d.f+f.f)))));return c}function c(a,b,d){var f=0;b=b||0;a=a.j.t;var g=a.length-b;d=Qa.min(d||g,g);A&&(b=0,d=a.length);0<d&&(b=a.slice(b,b+d),0<b.length&&(f=b.reduce(function(a,b){return{length:a.length+b.length}},{length:0}),f=f.length/d));return f}
function d(a){a=a.j.t.slice(0,a.j.t.length);return 0===a.length?0:a.reduce(function(a,b){return a.length>b.length?a:b}).length}function f(a,b,c){a=a.j.t.slice(b||0,c||a.j.t.length);return 0===a.length?0:a.reduce(function(a,b){return a.length<b.length?a:b}).length}function g(){var a=S.ea(0,!0),b=S.fa(Number.POSITIVE_INFINITY,!0);return 8*d(b)/a.f}function h(){return x*G/100-E-R}function l(){return Qa.min(v.Xa,2*F)}function m(a){var b=S.ea(0,!0),c=b.j.t,d=l(),f=0;if(!c)return N;for(var g=Qa.min(c.length,
a+M),z=0;a<g;a++){var h=c[a],z=z+(8*h.length/b.f-h.duration);f<z&&(f=z)}f<d?f=d:f>Qa.min(x,N)&&(f=Qa.min(x,N));return f}function u(a,b){P.push(a);10<P.length&&(P=P.slice(-10));J.push(b);10<J.length&&(J=J.slice(-10))}function p(a,b,g){var z,h,k,l,V,u=S.ea(b.f,!0),m=S.ea(0,!0);if(1>=J.length||1>=g){if(1===O||C)h="historical"===v.Zi?xe.Bd()/(xe.zd()+xe.Yg()):xe.Wg(),z=h>u.f*W?u:h<b.f*W?S.fa(b.f,!0):b;return z}h=2>J.length?0:a-J[J.length-2];k=c(b,0,b.j.t.length);l=d(b);V=b.j.t[g-1].length;if(X)if(z=l/
k,B&&(l=Qa.min(b.j.t.length-g-1,I),g+l+1<b.j.t.length&&(z=f(b,g,g+l)/k)),L?1>=z?a=1:(g=R+E+K,a=a>g?1:(z-1)*(g-a)/g+1):a=z,g=F-8*V/(u.f*a),h>g)z=u;else if(0<=h)z=b;else for(z=u,b=F-8*V/(z.f*a);h<b;){z=S.fa(z.f,!0);if(z===m)break;b=F-8*V/(z.f*a)}return z}function U(a,b,d,f){var g=S.fa(b.f,!0),z=S.ea(b.f,!0),h=S.ea(0,!0),k,V;V=S.ea(0,!0).f*F/8;var u=S.fa(Number.POSITIVE_INFINITY,!0).f*F/8;V=(a-E-R)/K*(u-V)+V;V=Qa.max(0,V);var u=S.ea(0,!0),m=S.fa(Number.POSITIVE_INFINITY,!0),m=W*F*m.f/8;oa&&(m=ia?(a-
E)*u.f/8:(a-l())*u.ju/8);a=m;var n=m=0,D=g.j.t,ba=z.j.t,wa=b.j.t[d].length,u=b;V=Qa.min(V,a);D&&(m=c(g,d,f),1<f&&(m=Qa.max(m,D[d].length)));ba&&(n=c(z,d,f),1<f&&(n=Qa.max(n,ba[d].length)));if(oa&&wa>a){for(;;){u=S.fa(u.f,!0);if(u.f===h.f){k=h;break}b=u.j.t[d].length;if(b<a){k=u;break}}return k}if(0<n&&V>n)k=z;else if(0<m&&V<m)for(u=g,b=m;b>V;){k=u;u=S.fa(u.f,!0);if(u.f===h.f)break;b=c(u,d,f);1<f&&(b=Qa.max(b,u.j.t[d]))}else k=b;return k}function r(){var f=a.Fa.value.stream,n,ba=S.ea(0,!0),v=a.n.Yb(),
G=a.n.vb();n=G.duration;var M=0,H=2>J.length?0:v-J[J.length-2],t,X=1;F===k&&(F=n);W===k&&(W=d(f)/c(f));x===k&&(x=b());1===O&&(aa=ha,Q=0===P.length?f.f:P.reduce(function(a,b){return a+b},0),0<Q&&(Q/=P.length,Q=Qa.min(Q,P[P.length-1]),Y=S.fa(Q,!0)),J=[],P=[]);u(f.f,v);aa=ca?aa-1:-1;0===aa&&0<H?aa+=1:ca&&-1===aa&&(0<H?aa=1:t=!0);ia?(M=m(G.index),E<M&&(E=M)):Ua?(E=ja,E<l()&&(E=l())):E=l();if(0>R||2===O||1===O)R=v-E,R=Qa.max(0,R),R+E>N&&(R=N-E),R>w&&(R=w),T=!1,v>=h()+E+R&&(T=!0);!Kb&&ia?K=h():Kb?(K=y,
K<g()()?K=g():K>h()&&(K=h())):K=g();Ia&&(X=(v-E-R)/n,X=1>X?1:X);v<E+R?(n=ba,T=!1):v>E+R+K-n?(n=S.fa(Number.POSITIVE_INFINITY,!0),T?n=0<H?S.ea(f.f,!0):f:aa=-1):(n=U(v,f,G.index,X),T&&(n=0<=H?f:S.fa(f.f,!0)));ca&&0<=aa?(v=p(v,f,G.index),Y&&v.f<Y.f&&(0<H?v=S.ea(f.f,!0):0>H&&(Y=k)),Y&&v.f>=Y.f&&(Y=k),v.f>n.f&&(n=v)):t&&(0<H?n=f:n.f<=f.f/2?n=S.fa(f.f/2,!0):t=!1);O=0;n||(n=ba);return n}var t=new $e(a),H=v.po,N=H.dr,w=H.cr,G=H.Zq,M=H.Es,ca=H.xt,ia=H.op,ha=H.vt,Ua=H.Aq,ja=H.Xq,Kb=H.wq,y=H.Wq,Ia=H.zq,A=H.Dq,
oa=H.Eq,C=H.Qt,X=H.yt,L=H.zt,B=H.tt,I=H.ut,O=0,xe=a.ca,x,S,E=0,K=0,J=[],P=[],aa=ha,R=0,F,Q,Y,T,W;a.addEventListener(Yd,function(){O=1});a.addEventListener(mf,function(){O=2});return{Uc:t.Uc,ib:t.ib,Vc:function(){var b=a.Da(),c=b.length;n(b,Ad);for(var d=0;d<c;d++)b[d].lower=b[d-1],b[d].Ed=b[d+1];S=b;b=r();c=a.n;d=S.ea(b.f);if(d.Ed)var f=a.n.Yb(),f=Fc(v.fg,f),g=Fc(v.ol,b.f)[0],g=ya(g,xe.Ub()/(1+f[2]/100)),f=S.fa(g+1),d=f.f<=d.f?d:f;for(;d&&d.j;)d=d.lower;d&&(c=ya(c.tb(),c.Yb())-F,xe.ka(d.Hj())<=c||
(c=S[0],d=c.j?null:c));return{k:b,Wa:d}},Jd:t.Jd}}function Td(a){function b(c){c=a.Aa().filter(c?yd:we);return ud(c)}return{Uc:function(b){b=a.Fb().filter(b?yd:we);return ud(b)},ib:function(){var c=a.n,d=c.tb(),f=c.Ia(),d=Ca(v.Ah+v.Xa-d,0),f=Ca(v.Bh+v.Xa-f,0),g=c.Gb(),h=c.$b(),h=h?c.Ab.S.endTime-h.startTime:0,d=ya(d,g?c.cb.S.endTime-g.startTime:0),f=ya(f,h);return{k:b(!0),Wa:b(!1),mb:d,nb:f}},Vc:function(){return{k:b(!0),Wa:b(!1)}},Jd:function(){return!1},Uh:function(){return!1},Vj:function(){return!0},
Tg:function(){return 4E3}}}function bg(a){function b(){var c=v.Bp,d=a.n.$b();if(d)for(var d=d.startTime,f,g=c.length,h,k=0,k=0;k<g;k++)if(h=c[k],d>=h[0])f=h[1];else break;c=a.Da();f=Ad.nc.call(c,f||0);c=c.filter(we)[0];return{k:f,Wa:c}}n(this,{Uc:function(b){b=a.Fb().filter(b?yd:we);return ud(b)},ib:function(){var c=b(),d=a.n,f=d.tb(),g=d.Ia(),f=Ca(v.Ah+v.Xa-f,0),g=Ca(v.Bh+v.Xa-g,0),h=d.Gb(),k=d.$b(),k=k?d.Ab.S.endTime-k.startTime:0,f=ya(f,h?d.cb.S.endTime-h.startTime:0),g=ya(g,k);c.mb=f;c.nb=g;return c},
Vc:b,Jd:function(){return!1},Uh:function(){return!1},Vj:function(){return!0},Tg:function(){return 0}})}function Vg(a){function b(){for(var a,c,d,f,g=n.length,z=m.length,h=0;h<g;h++){var k=n[h];if(-1===m.indexOf(k)&&k<Z(m))for(a=0;a<z-1;a++)if(c=m[a],f=m[a+1],k>=f&&k<=c){a=l[c];d=l[f];l[k]=(k-c)/((f-c)/(d-a))+a;break}}}function d(){var b=[],f=a.Fb(),g=a.Aa(),h=a.n.Gb().index,k=a.n.$b().index,q=a.n.cb,u=a.n.Ab;c(l,function(a,c){var d,z=f.nc(a,!0),l=g.nc(a,!0),m=0,V=0,n;d=ya(qd(v.bj)/4,q.S.index-h+1);
for(n=0;n<d;n++)m+=z.j.t[h+n].length;d=ya(v.bj,u.S.index-k+1);for(n=0;n<d;n++)V+=l.j.t[k+n].length;d=Ca((m+V)/d*2/128/c,a);z={};z.f=a;z.As=d;z.Wv=c;b.push(z)});return b=b.sort(function(a,b){return Jc(a.f)<Jc(b.f)?-1:Jc(a.f)>Jc(b.f)?1:0})}function f(){for(var a,b=u.length;b--;)if(a=u[b],a.As<=k)return a.f}var g,h,k,l={},m=[],u=[],n;this.Pj=function(U){n=a.Aa().Yd(v.lk);if((g=a.fh)&&U&&(h=g.Sp(U,xa(nd/1E3)+ga()))&&0!==h.tf)return c(v.yo,function(a,b){l[a]=uc(b);m.push(y(a))}),m=B(m).reverse(),b(),u=
d(),k=(20===v.cj?h.Wi:90===v.cj?h.Yi:h.Xi)*(1-.01*(v.Ok[2]||0)),f()};this.Rp=function(){return h}}function Tc(a,c,d){function f(a){if(u.state.value==nf||u.state.value==bc||u.state.value==ab)N.info("Playback closing",u,a?{ErrorCode:a.Mc}:k),gb.removeListener(Lc,l),u.la=a,t.B(sh,{du:H}),t.B(yb),u.state.set(th),Zb||Ba(g)}function g(){var a=u.Ye;u.Ye=k;a?$d.ws(a,function(){h()}):h()}function h(){h=p;var a=sd.indexOf(u);sd.splice(a,1);u.state.set(rg);t.B(sg,{},!0);t.Nc()}function l(){f()}function m(){var a=
u.v.value;G!=a&&(N.trace("MediaTime changed",{MediaTime:Sa(a)}),G=a,t.B(of))}function n(a){a.newValue!=Ub&&(u.A.removeListener(n),t.B(Wc),u.Mk=O(u.Hb()),u.uq=(u.Ya.value||u.Fa.value).stream.f)}var u=this,r,U=new Cb(1E3),t=new Hb,w={},H={};tg?(r=tg,tg=k):r=1E4*Nb()+xa(1E4*cf());Hi=r;u.addEventListener=t.addListener;u.removeEventListener=t.removeListener;u.fireEvent=t.B;u.W=a;u.sa=c;u.Rd=d||{};u.Ca=u.Rd.Ca||0;u.index=++Ik;u.qa=r;u.Za=Ga("DIV","position:relative;width:100%;height:100%;overflow:hidden");
u.$c=v.xl&&!(r%v.xl);u.Ja={MovieId:u.sa,TrackingId:u.Ca,Xid:u.qa,AccountKey:u.W};u.kb=w;a=new Pc(u);u.log=a;ug||(ug=a);var N=new u.log.r("Playback");N.info("Playback created",u.Ja);u.$c?N.info("Playback selected for trace playback info logging"):N.trace("Playback not selected for trace playback info logging");u.state=new Wa(nf);u.state.addListener(function(a){N.info("Playback state changed",{From:a.oldValue,To:a.newValue})});u.Ar=function(){u.log.Ka.Zc=u.Zc=ga();u.uk=Nb();u.state.set(bc)};u.zr=function(){u.state.value==
bc&&u.state.set(ab)};u.ta=function(a){N.trace("Milestone",{Id:a});w[a]=u.Hb()};u.Gp=function(){if(b(u.kb.ats)&&b(u.kb.at))return u.kb.at-u.kb.ats};u.Kp=function(){return u.n&&u.n.Yb()};u.Xp=function(){if(b(u.kb.shs)&&b(u.kb.sh))return u.kb.sh-u.kb.shs};u.close=function(a){a&&(u.state.value==rg?a():u.addEventListener(sg,function(){a()}));f()};u.Sa=function(a){function b(){f(a)}if(u.state.value==nf)u.la||(u.la=a,u.load());else{var c=v.qj&&a&&v.qj[a.errorCode];Za(c)&&(c=y(c));N.error("Fatal playback error",
{Error:""+a,HandleDelay:""+c});0<=c?Ya(b,c):b()}};u.zl=function(){Zb=!0};u.wr=function(){g()};u.ae=function(){t.B(Qi)};var Zb;gb.addListener(Lc,l,1);u.v=new Wa;var G;u.v.addListener(function(){U.ob(m)});u.Cp=function(){m()};u.paused=new Wa(!1);u.paused.addListener(function(a){N.info("Paused changed",{From:a.oldValue,To:a.newValue,MediaTime:Sa(u.v.value)})});u.muted=new Wa(!1);u.volume=new Wa(v.Yo/100);u.A=new Wa(Ub);u.A.addListener(function(a){N.info("PresentingState changed",{From:a.oldValue,To:a.newValue,
MediaTime:Sa(u.v.value)},u.n.Ke())});u.o=new Wa(cc);u.o.addListener(function(a){N.info("BufferingState changed",{From:a.oldValue,To:a.newValue,MediaTime:Sa(u.v.value)},u.n.Ke())});u.P=new Wa(null);u.P.addListener(function(a){N.info("AudioTrack changed",a.newValue&&{ToBcp47:a.newValue.Qa,To:a.newValue.V},a.oldValue&&{FromBcp47:a.oldValue.Qa,From:a.oldValue.V},{MediaTime:Sa(u.v.value)});u.G.set(u.wa.Uc())});u.Sb=new Wa(null);u.Sb.addListener(function(){u.k.set(u.Aa()[0])});u.Q=new Wa(null);u.Q.addListener(function(a){N.info("TimedTextTrack changed",
a.newValue?{ToBcp47:a.newValue.Qa,To:a.newValue.V}:{To:"none"},a.oldValue?{FromBcp47:a.oldValue.Qa,From:a.oldValue.V}:{From:"none"},{MediaTime:Sa(u.v.value)})});u.lc=new Wa(null);u.Zh=new Wa(null);u.k=new Wa(null);u.G=new Wa(null);u.i=new Wa(null);u.i.addListener(function(a){a=a.newValue;var b=u.F;b.splice(b.indexOf(a),1);b.unshift(a)});u.ec=new Wa(null);u.Ya=new Wa(null);u.ze=new Wa(null);u.Ae=new Wa(null);u.Oc=new Wa(null);u.Fa=new Wa(null);u.pe=new Wa(null);u.A.addListener(n);u.qe=new Wa;ve(u);
u.Zg=function(){t.B(sh,{du:H});return H};u.ht=function(){H.HasRA=!0};sd.push(u);u.xa=new Oe(u);u.qh=new If(u);u.ca="sliding_window"===v.Zi?new nb(u):new Tf(u);u.wg=new eg;u.jf=new dg(u);u.Nk=new Wg(u);u.Lk=new ag(u);u.bf=new Sc(u);v.pp&&(u.fh=new Xb(u));Ri.forEach(function(a){a(u)});cg(this)}function cg(b){function d(a){return"parallel"===v.og?new Q(a):new Ig(a)}function f(a,c){k||(k=!0,b.Sa(new Ib(a,c)))}var h=new b.log.r("Playback"),k,l,m,n,r,u;b.load=function(a){this.load=I;r=a;b.state.value==
nf&&(h.info("Playback loading",b),b.Ar(),vg(function(a){a.c?b.Oo():f(a.errorCode||R.fe,a)}))};b.Oo=function(){try{var a=b.W,c=a?Se(a):gf;b.W=c.W;b.kc=c;switch(v.iq){case "random":b.wa=new Td(b);break;case "fixed":b.wa=new bg(b);break;case "bb":b.wa=new Ug(b);break;default:b.wa=new $e(b)}b.lb=new Xf(b);b.Dk=new Yf(b);b.au()}catch(d){f(R.cm,{g:P.Tb,C:L(d)})}};b.au=function(){if(b.la)b.Sa(b.la);else if(g(b.sa,1)){var a=b.kc.Wc();if(v.Bs){var c=a.ia;if(!Za(c)){f(R.ri);return}c=Ra(c);if("usr"!=c&&"dbl"!=
c){h.error("Invalid NetflixId",{bt:c});f(R.qi);return}}v.Cs&&!Za(a.$a)?f(R.ti):b.Co()}else f(R.Ql)};b.Co=function(){var a=$d.dl;a?a.c?b.mg():f(R.ui,a):b.Zf()};b.mg=function(){v.mg?Ud(function(){b.Zf()},b):b.Zf()};b.Zf=function(){b.state.value==bc&&(v.tp&&!b.fd?$d.Si(Jk,function(a){a.c?(b.Ye=a.Ye,b.vf()):f(R.si)}):b.vf())};b.vf=function(){b.state.value==bc&&(b.ta("ic"),b.Lk.$s(function(a){a.error&&h.error("Error sending persisted playdata",cb(a));b.rd()}))};b.rd=function(){b.state.value==bc&&(h.info("Authorizing",
b),b.ta("ats"),b.lb.rd(function(d){if(b.state.value==bc){b.ta("at");if(!d.c)switch(d.method){case "register":f(R.sm,d);return;case "authenticationrenewal":f(R.rm,d);return;default:f(R.qm,d);return}var g;try{l=b.Fb().Yd(v.tq);m=b.Aa().Yd(v.lk);n=b.Fb().nc(l[0]||0);u=b.Aa().nc(m[0]||0);g=hf.call(b.F,function(b){return a(n.Ta[b.id])&&a(u.Ta[b.id])});b.Sd=g[0];b.Ct=g;var k={};g.forEach(function(a){var b=a.location.id;k[b]||(k[b]=[]);k[b].push(a)});var V=[];c(k,function(a,b){var c=b[0].location;c.F=b;
V.push(c)});b.Yh=V.sort(function(a,b){return a.ma-b.ma});b.Sd!=b.F[0]&&h.error("Primary CDN does not have downloadUrls for a/v streams",{CdnId:b.F[0].id})}catch(ba){h.error("Exception while picking initial streams",ba)}n&&u&&g.length?b.es():f(R.um)}}))};b.es=function(){r?(h.info("Processing post-authorize",b),r(b,function(a){a.c?b.xj():f(R.gm,a)})):b.xj()};b.xj=function(){function a(){if(b.fd||!(0<V)||ba){var c=d.ea(0,!0),h=g.ea(0,!0);c&&h?(n=c,u=h,a=p,b.Zr()):0>=V&&(a=p,f(R.fm,G))}}if(b.state.value==
bc){h.info("Downloading initial stream headers",b,{Audio:l.join("|"),Video:m.join("|")});b.ta("shs");var c;v.Lg&&(c=b.rb.filter(function(a){return a.Qa==v.Lg||a.V==v.Lg}))&&c.length&&b.P.set(c[0]);v.Ge&&(c=b.pa.filter(function(a){return a?a.Qa==v.Ge||a.V==v.Ge:"none"==v.Ge.toLowerCase()}))&&c.length&&b.Q.set(c[0]);var d=b.Fb(),g=b.Aa(),k=[d[0],g[0]],V=0,ba=!1,G;b.fd||l.forEach(function(a){a=d.nc(a);0<=k.indexOf(a)||k.push(a)});m.forEach(function(a){a=g.nc(a);0<=k.indexOf(a)||k.push(a)});c=V=k.length;
for(var r=0;r<c;r++)h.trace("Downloading header",{Type:k[r].type,Bitrate:k[r].f}),k[r].Ea(function(b){b.c||(G=b);V--;a()});Ya(function(){0<V&&h.debug("Not all initial headers downloaded within the deadline ("+v.jk+" ms)");ba=!0;a()},v.jk)}};b.Zr=function(){try{if(b.state.value==bc){b.ta("sh");h.trace("Initializing primary streams and MediaBuffer");v.$||(b.G.set(b.cd=b.wa.Uc(!0)),b.k.set(b.Y=u));b.n=new zd(b);var a=b.n.cb,c=b.n.Ab,d=a.S.endTime,k=c.S.endTime;b.duration=Ca(d,k);wc(d-k)>ya(a[0].duration,
c[0].duration)&&h.error("Large audio and video duration gap",{AudioMS:d,VideoMS:k,MovieId:b.sa,AudioDlId:b.cd.J,VideoDlId:b.Y.J});var l={width:1,height:1};b.Aa().forEach(function(a){l.width*l.height<a.width*a.height&&(l.width=a.width,l.height=a.height)});b.ic=l;var m=y(v.mo[b.sa]);g(m)?(h.info("Overriding bookmark",{From:b.eb,To:m}),b.eb=m):((m=b.eb)&&m<Ef(v.no,b.duration)&&(h.trace("Ignoring bookmark because it's to close to beginning"),b.eb=0),m&&m>b.duration-Ef(v.oo,b.duration)&&(h.trace("Ignoring bookmark because it's to close to end"),
b.eb=0));b.Po()}}catch(n){f(R.dm,{g:P.Tb,C:L(n)})}};b.Po=function(){try{b.ha=new Pe(b),b.T=d(b),b.hc=new Gj(b),v.zs&&(b.$h=new Hj(b)),b.Mb=new Ij(b),b.oq=new Kj(b),Si.forEach(function(a){a(b)}),b.zr()}catch(a){f(R.em,{g:P.Tb,C:L(a)})}}}function ve(a){function c(){return a.state.value==bc||a.state.value==ab&&a.A.value==Ub}function d(){c()?u||(u=qb(f,100)):u&&(wb(u),u=k,Ba(f))}function f(){var d=ga(),q=g.value,q=q?q.fc:0,u,wa=a.state.value==bc||c()&&199<d-h,p,r,t;wa&&a.state.value==ab?(a.o.value==lc?
(r=q,p=!0):(u=d+(a.T.vc()||0),l=l||d,m=m||l+v.kr+1,b(u)&&(u=Ca(u,m),r=a.T.Le(),r=jb(1E3*Ka((d-l)/(u-l),0,r))/1E3)),r<q&&(q-r<v.gs/100?(r=q,n=k):n?d-n>v.fs?(t=!0,n=k):r=q:(n=d,r=q))):n=m=l=k;d=wa?{kl:p,fc:r,hs:t}:null;(!d||!g||!g.value||b(d.fc)&&!b(g.value.fc)||b(d.fc)&&b(g.value.fc)&&.01<wc(d.fc-g.value.fc))&&g.set(d)}var g=a.qe,h=0,l,m,n,u;a.state.addListener(function(){d();f()},1);a.A.addListener(function(a){if(a.oldValue!=Ub||a.newValue!=Ub)h=ga();d()});a.o.addListener(function(){d()});u||(u=qb(f,
100))}function Ud(a,b){var c=sd[0];c==b&&(c=sd[1]);c?c.close(function(){Ud(a,b)}):a&&a(va)}function Ic(a,b){switch(a){case uh:Ri.push(b);break;case wg:Si.push(b)}}function af(a,b,c){return v.$?new gd:new Tc(a,b,c)}function dg(a){function d(){if(!ra){G=qb(m,1E3);a.Za.appendChild(t);for(var b=H.length;b--;)H[b].addListener(p);for(b=N.length;b--;)a.addEventListener(N[b],p);ra=!0}l()}function f(){if(ra){wb(G);ca=M=k;a.Za.removeChild(t);for(var b=H.length;b--;)H[b].removeListener(p);for(b=N.length;b--;)a.removeEventListener(N[b],
p);u.ob();ra=!1}}function g(){ra?f():d()}function h(){var d=a.n,f=[],g;f.push({Version:"2.0000.400.011",Esn:ac?ac.sc:"UNKNOWN",UserAgent:Yb.userAgent});try{f.push({MovieId:a.sa,TrackingId:a.Ca,Xid:a.qa+" ("+sd.map(function(a){return a.qa}).join(", ")+")",Position:Sa(a.v.value),Duration:Sa(a.duration),Volume:jb(100*a.volume.value)+"%"+(a.muted.value?" (Muted)":"")})}catch(q){}try{var l=a.T?a.T.vc():k;f.push({"Player state":ia[a.state.value],"Buffering state":ha[a.o.value]+(b(l)?", ETA:"+Sa(l):""),
"Rendering state":Ua[a.A.value]})}catch(m){}try{var u=d.Bd(),n=v.Jb,V=a.ec.value,D=V&&V.stream,ba=a.Ya.value,wa=ba&&ba.stream,G=a.i.value;f.push({"Playing bitrate (a/v)":D&&wa?D.f+" / "+wa.f+" ( "+wa.j.$o+" )":"?","Buffering bitrate (a/v)":a.G.value.f+" / "+a.k.value.f,"Buffer size in Bytes (a/v)":d.Kj()+" / "+d.Zj(),"Buffer size in Bytes":u+(n?" ("+(100*u/n).toFixed(0)+"% of max)":""),"Buffer size in Seconds (a/v)":Sa(d.tb())+" / "+Sa(d.Ia()),"Will Rebuffer":a.wa.Jd(),"Current CDN":G.name+", Id: "+
G.id})}catch(p){}try{var U=a.ec.value.stream,r=U.j,ja=U.track,t=a.Ya.value.stream.j,Ma=a.lc.value;f.push({"Audio Track":ja.Qa+", Id: "+ja.V+", Channels: "+ja.jg+", Codec: "+(r&&r.ng),"Video Track":"Codec: "+(t&&t.ng),"Timed Text Track":Ma?Ma.Qa+", Profile: "+Ma.Ek+", Id: "+Ma.V:"none"})}catch(N){}try{f.push({Framerate:a.k.value.j.Ng.toFixed(3),"Current Dropped Frames":b(M)?M:"","Total Frames":a.ha.Ie(),"Total Dropped Frames":a.ha.uc(),"Total Corrupted Frames":a.ha.yd(),"Total Frame Delay":a.ha.Je(),
"Main Thread stall/sec":vh?vh.Vp().join(" "):"DISABLED",VideoDiag:xg(a.Zg())})}catch(ca){}try{a.n&&(v.$?f.push({Throughput:a.zf+" kbps"}):f.push({Latency:a.ca.zd()+" ms",Throughput:(7.8125*a.ca.Wg()).toFixed(0)+" KBPS","Bandwidth (normalized)":a.ca.re()+" KBPS","Max Sustainable Video Bitrate":a.ca.Ub()+" KBPS"}))}catch(H){}try{c(y,function(a,b){g=g||{};g[a]=lb.stringify(b)}),g&&f.push(g)}catch(db){}return f}function l(){if(U.selectionStart==U.selectionEnd){var a="";h().forEach(function(b){a=a?a+"\n":
"";c(b,function(c){a+=c+": "+b[c]+"\n"})});U.style.fontSize=Ka(xa(t.clientHeight/60),8,18)+"px";U.value=a}}function m(){var b=a.ha.uc();M=b-ca;ca=b;p()}function p(){u.ob(l)}function r(a){a.ctrlKey&&a.altKey&&a.shiftKey&&(68==a.keyCode||81==a.keyCode)&&g()}var u=new Cb(1E3),t=Ga("DIV","position:absolute;left:10px;top:10px;right:10px;bottom:10px",k,{"class":"player-info"}),U=Ga("TEXTAREA","position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;padding:10px;background-color:rgba(0,0,0,0.4);color:#fff;font-size:12px;font-family:Arial;overflow:auto"),
w=Ga("DIV","position:absolute;top:2px;right:2px"),ra,H=[a.v,a.i,a.ec,a.Ya,a.G,a.k,a.lc,a.state,a.o,a.A,a.volume,a.muted],N=[Zd,pg],y={},G,M,ca;this.dt=function(a){y.DFR=a};var ia={};ia[nf]="Not Loaded";ia[bc]="Loading";ia[ab]="Normal";ia[th]="Closing";ia[rg]="Closed";var ha={};ha[mc]="Normal";ha[cc]="Pre-buffering";ha[lc]="Network stalled";var Ua={};Ua[Ub]="Waiting for decoder";Ua[Xc]="Playing";Ua[lf]="Paused";Ua[Kc]="Media ended";U.setAttribute("readonly","readonly");t.appendChild(U);t.appendChild(w);
var ja=Ga("BUTTON",null,"X");ja.addEventListener("click",f,!1);w.appendChild(ja);gb.addListener(Cd,r);a.addEventListener(yb,function(){gb.removeListener(Cd,r);f()});n(this,{toggle:g,show:d,dh:f,Up:h})}function Wg(a){function b(){G||(h(),a.Za.appendChild(U),G=!0)}function c(){G&&(a.Za.removeChild(U),G=!1)}function d(){G?c():b()}function f(){var b=[],c={ranges:[]};a.Da().forEach(function(a){c.profile||(c.profile=a.nj);c.ranges.push({min:a.f,max:a.f})});b.push(c);a.gc.ft(b);a.n.reset();a.gc.seek(a.v.value)}
function g(){var b=a.Aa().filter(function(a){return M[a.f]});b.length||b.push(a.Y);return b}function h(){var b=a.P.value,c=a.Sb.value,d=a.F;b&&(d=d.slice(),d.sort(function(a,b){return a.ma-b.ma}),u(H,b.U.map(function(b){return{value:b.f,caption:b.f,selected:b==a.G.value}})));c&&(u(N,c.U.map(function(b){var c=a.bf.Ac(b),d=b=b.f;c&&(d+=" ("+c.join("|")+")");return{value:b,caption:d,selected:a.Da!=g?!c:M[b]}})),N.removeAttribute("disabled"));d&&(u(w,d.map(function(b){return{value:b.id,caption:"["+b.id+
"] "+b.name,selected:b==a.i.value}})),w.removeAttribute("disabled"))}function l(){G&&h()}function m(a){var b=Ga("DIV","display:inline-block;vertical-align:top;margin:5px;");a=Ga("DIV",k,a);var c=Ga("select","width:120px;height:180px",k,{disabled:"disabled",multiple:"multiple"});b.appendChild(a);b.appendChild(c);r.appendChild(b);return c}function u(a,b){a.innerHTML="";b.forEach(function(b){var c={title:b.caption};b.selected&&(c.selected="selected");c=Ga("option",k,b.caption,c);c.value=b.value;a.appendChild(c)})}
function p(a){a.ctrlKey&&a.altKey&&a.shiftKey&&83==a.keyCode&&d()}var U=Ga("DIV","position:absolute;left:0;top:50%;right:0;bottom:0;text-align:center;color:#040;font-size:11px;font-family:monospace",k,{"class":"player-streams"}),r=Ga("DIV","display:inline-block;background-color:rgba(255,255,255,0.86);border:3px solid #fff;padding:5px;margin-top:-90px"),t=Ga("DIV","width:100%;text-align:center"),H=m("Audio Bitrate"),N=m("Video Bitrate"),w=m("CDN"),G,M={};U.appendChild(r);r.appendChild(t);var ca=Ga("BUTTON",
k,"Override");ca.addEventListener("click",function(){M={};for(var b=N.options,d=b.length;d--;){var h=b[d];h.selected&&(M[h.value]=1)}a.Da=g;a.n.ve();v.$&&(a.T.lg(),f());if(b=a.F){var k=w.value;(b=b.filter(function(a){return a.id==k})[0])&&b!=a.i.value&&(b.mc={testreason:"streammanager",selreason:"userselection"},a.i.set(b))}c()},!1);t.appendChild(ca);ca=Ga("BUTTON",k,"Reset");ca.addEventListener("click",function(){delete a.Da;a.n.ve();v.$&&(a.T.lg(),f());c()},!1);t.appendChild(ca);gb.addListener(Cd,
p);a.addEventListener(yb,function(){gb.removeListener(Cd,p)});a.i.addListener(l);a.P.addListener(l);a.Sb.addListener(l);n(this,{toggle:d,show:b,dh:c})}function eg(){function a(){h=!1;for(var b=c.length,z;b--;)z=c[b],g[z]&&(g[z]=!1,f.B(z+"changed",{getModel:d[z]}))}function b(c){g[c]=!0;h||(h=!0,Ba(a))}var c=[],d={},f=new Hb,g={},h=!1;return{register:function(a,b){c.indexOf(a);d[a]=b;c.push(a)},vh:b,aq:function(a){return(a=d[a])?a():k},addEventListener:function(a,c){f.addListener(a,c);d[a]&&b(a)},
removeEventListener:function(a,b){f.removeListener(a,b)}}}function re(c,d,f,g,h,k,l,m){function r(a){if(!(0<=oc(a,"ftyp").mj.indexOf("dash")))throw new Ta("ftyp is not dash compatable");for(var c=fg(a),d=oc(wh(c),"moov"),f=[],g=d.children.filter(function(a){return"trak"===a.type}),z=0;z<g.length;z++){var h=g[z].ub("mdia/minf/stbl/stsd/mp4a|enca|ec-3|avc1|encv|hvcC");U(d,h);f.push(h)}h=f[0];a=oc(a,"sidx");f=h.type;c={stream:w,ng:f,Bg:"encv"==f||"enca"==f,rq:c,Nd:d};d=0;switch(w.type){case rb:d=v.cg;
break;case Xa:d=v.bu;try{var k=h.ub("4E657466-6C69-7846-7261-6D6552617465"),q=k.Er/k.Zo;b(q,1)&&(c.Ng=q)}catch(l){}k=h.ub("pasp");q=h.width;f=h.height;k.Hf<k.Ne?q=xa(q*k.Ne/k.Hf):f=xa(f*k.Hf/k.Ne);q==w.width&&f==w.height||y.error("Stream resolution does not match",{Nccp:w.width+"x"+w.height,Header:q+"x"+f},N);c.$o="res: "+h.width+"x"+h.height+", par: "+k.Ne+"x"+k.Hf}c.t=Kg(w,d,a);return c}function u(a,b){y.trace("Downloading header",{Cdn:b.id},N);a=a||p;var g={responseType:Bc,dc:se,url:w.Ta[b.id],
i:b,track:d,stream:w,offset:0,length:H||t(m),Db:f+"-"+h+"-hdr",Hc:!0};c.xa.N(g,function(c){var d;if(c.c){try{var f=c.content;if(!H){var g=oc(f,Kk);H=g.Hr+g.Ap;if(0<H&&!(H<=f.byteLength)){y.warn("Header size underestimated, retrying",{Estimated:f.byteLength,Actual:H},N);u(a,b);return}}var z=r(f);z&&(y.trace("Header parsed",{Chunks:z.t.length},N),w.j=z);v.$&&(va.Na=c.parsed?c.Na:c.content,va.Na=va.Na.slice(0,H));d=va}catch(h){y.error("Exception while parsing header",h,N),d={c:!1,g:P.Lf}}a(d)}else y.warn("Unable to download header",
cb(c),N),a(c)})}function t(a){var b;if(b=a)b=a?-1<Lk.indexOf(a):void 0;return b?qd(Mk+c.Ee*Nk):qd(Ok+c.Ee*Pk)}function U(a,b){var d=v.nq;d.length&&a.children.forEach(function(a){"pssh"==a.type&&0<=d.indexOf(a.vd)&&a.Na&&a.Na.set([102,114,101,101],4)});if(v.Bl&&f==rb){var g=a.ub("mvex/trex");g.vg.Zk&&(y.trace("Applying sampleIsDifferenceSample workaround",N,{Box:"trex"}),fa(g))}if(v.hu&&"playready"==da()&&"encv"==b.type){var h=function(){var a=c.Y.j.Nd.children.filter(function(a){return"pssh"==a.type&&
"9A04F079-9840-4286-AB92-E65BE0885F95"==a.vd})[0],d;try{d=Ac(Sg(a.data.subarray(10,a.data.length-10),"KID"))}catch(f){y.error("Exception parsing KID in PSSH",f)}d&&16==d.length&&b.children.map(function(a){try{if("sinf"==a.type)return a.ub("schi/tenc|8974DBCE-7BE7-4C51-84F9-7148F9882554")}catch(b){y.error("Exception finding TENC box",b)}}).filter(Y).forEach(function(a){var b=a.kh;if(b&&Hd(d,b)){var c=function(a,c){var d=b[a];b[a]=b[c];b[c]=d};y.trace("Applying KID byte order workaround",N,{Box:a.type});
c(0,3);c(1,2);c(4,5);c(6,7)}})};if(c.Y)h();else{var k=function(a){a.newValue==ab&&(c.state.removeListener(k),h())};c.state.addListener(k)}}}var w=this,y=new c.log.r("CadmiumMediaStream"),H,N={Type:f,Bitrate:h,DownloadableId:g};n(w,{track:d,type:f,J:g,f:h,nj:m,size:k,Ta:l,j:null,Hj:t,Ea:Mb(function(b){function d(a){if(a.c)b(a);else{var c,z;for(z=0;z<g.length;z++)if(c=g[z],f[c.id]>v.hq)c=null;else break;c?(f[c.id]=(f[c.id]||0)+1,u(d,c)):b(a)}}w.Pe=!0;var f={},g=hf.call(c.F,function(b){return a(l[b.id])});
d({c:!1})}),Ja:N,toJSON:function(){return N},Cq:function(){var a=!1,b;f===Xa?b=c.Da():f===rb&&(b=c.Fb());-1!==b.indexOf(this)&&(a=!0);return a}})}function se(a){var b=new $a(a),b=wh(b);b.byteLength=a.byteLength;return b}function fg(a){var b,c,d=v.sq,f=[],g=d.length,h=0,k=0;d.indexOf("moov");for(b=0;b<g;b++)c=oc(a,d[b]).Na,f.push(c),h+=c.length;a=new $a(h);for(b=0;b<g;b++)c=f[b],a.set(c,k,c.length),k+=c.length;return a}function Kg(a,b,c){var d,f,g=[],h=c.Af,k=c.vs,l=k.length;b=jb(b*h/1E3);var m,n=
c.Na,v=n.byteOffset+n.byteLength+c.zp,p=0;c=0;d=v;for(var r=p,n=0;n<l;n++)m=k[n],p+=m.duration,m=v+m.size,v=p-r,n<l-1&&wc(v-b)>wc(v+k[n+1].duration-b)||(d={index:c++,stream:a,offset:d,length:m-d,startTime:xa(1E3*r/h),duration:xa(1E3*(p-r)/h),all:g,next:null,Ma:null},d.Ja={Type:d.stream.type,Bitrate:d.stream.f,ChunkNum:d.index,StartTime:Sa(d.startTime),Duration:Sa(d.duration)},f&&(d.Ma=f,f.next=d,wc(f.duration-(d.startTime-f.startTime)),f.duration=d.startTime-f.startTime),g.push(d),f=d,r=p,d=m),v=
m;return g}function ic(a,b,c){if(a==rb)return b;if(a==Xa)return c}function yd(a){return!!a.j}function we(a){return!a.j}function yf(a){return a.map(function(a){return a.f})}function zd(a){function b(d,f){var g=d.length,h=X-r(f);if(h>g)return!0;var l=a.v.value,m,n,u;u=l-oa;m=ja.first;for(n=Ia.first;m||n;)if(m&&m.endTime>=u&&(m=k),n&&n.endTime>=u&&(n=k),m&&(!n||m.endTime<n.endTime)?(h+=c(m),m=m.next):n&&(h+=c(n),n=n.next),h>g)return!0;m=ja.S;for(n=Ia.S;m||n;)if(m&&m.startTime<=d.startTime&&(m=k),n&&
n.startTime<=d.startTime&&(n=k),m&&(!n||m.startTime>n.startTime)?(h+=c(m),m=m.Ma):n&&(h+=c(n),n=n.Ma),h>g)return!0;u=l-S*(d.startTime-l);m=ja.first;for(n=Ia.first;m||n;)if(m&&m.endTime>=u&&(m=k),n&&n.endTime>=u&&(n=k),m&&(!n||m.endTime<n.endTime)?(h+=c(m),m=m.next):n&&(h+=c(n),n=n.next),h>g)return!0}function c(a){var b=a.media;a.media=null;a.Kb=k;a.ya(Yc);return b?b.length:0}function d(){return ya(l(),u())}function f(){return X?v.Jb?Ka((m()+p())/v.Jb,0,1):0:Ka(d()/v.Md,0,1)}function g(){return E?
G(ja):M(ja)}function h(){return E?G(Ia):M(Ia)}function l(){var b=a.v.value,c=Nc(b,ja);return c?Ca(0,c.endTime-b):0}function m(){return gg(a.v.value,ja)}function u(){var b=a.v.value,c=Nc(b,Ia);return c?Ca(0,c.endTime-b):0}function p(){return gg(a.v.value,Ia)}function r(b){for(var c=L.length,d,f,g=0,h=a.k.value.j.t,k=a.G.value.j.t;c--;)d=L[c],(f=d.media)?g+=f.length:b&&d.ye&Qk&&(d.type===Xa?g+=h[d.index].length:d.type==rb&&(g+=k[d.index].length));return g}function t(a){a=a.first;for(var b=[];a;)a.media&&
a.Kb&&b.push(a.Kb.Dw()),a=a.next;return b}function w(){return{AudioBufferLength:Sa(l()),VideoBufferLength:Sa(u())}}function H(b){var d=a.v.value,f,g,h=b.first,k=0,l;for(v.$&&(l=[]);h;)h.media&&(f=f||h,g=h,k+=h.duration),h=h.next;d=Ca(d-oa,0);for(d=b.hb(d).index;k>B&&f&&f.index<d;)f.media&&(v.$&&l.push(f.Kb),c(f),k-=f.duration),f=f.next;for(b=b.hb((f?f.endTime:a.v.value)+B).index;k>B&&g&&g.index>b;)g.media&&(v.$&&l.push(g.Kb),c(g),k-=g.duration),g=g.Ma;if(v.$)return l}function N(){var b=H(ja),c=H(Ia);
v.$&&a.gc&&(0<b.length||0<c.length)&&y()}function y(){var b={};b[Rk]=t(ja);b[Sk]=t(Ia);a.gc.ls(b,a.v.value)}function G(b){for(b=b.hb(a.v.value);b&&(b.media||b.ye!==Yc);b=b.next);return b}function M(b){for(b=b.hb(a.v.value);b&&b.media;b=b.next);return b}function ca(){a.fireEvent(Zd);Ua.vh("buffer")}function ia(b,d){ha.trace("Disgarding media due to a track change");for(var f=d.first;f;)f.media&&f.media.stream.track!=b&&c(f),f=f.next;a.fireEvent(Ti);ca()}var ha=new a.log.r("MediaBuffer"),Ua=a.wg,ja=
Fe(a.cd,145152E5),A=a.Y,C=a.wa,Ia=Fe(a.Y,v.Ho?ja.S.endTime+xa(1E3/(A.j.Ng||60)):k),L=ja.concat(Ia),oa=v.Vi,B=v.Md,X=v.Jb,S=v.lo/100,I=B-oa,E="parallel"===v.og,A=new ee(function(){var a;if(!(a=.9<=f())){a=g();var b=h();a=!(a||b)}return a}),O=a.Y.j.t;O.length!=Ia.length&&(O=O[O.length-1],ha.error("Clipping video chunks to be less than audio",{FromEndTime:Sa(O.startTime+O.duration),ToEndTime:Sa(Ia.S.endTime),AudioEndTime:Sa(ja.S.endTime)}));if(!(0<=oa&&B>ja.first.duration&&B>=2*oa))throw new Ta("bad buffer size");
a.P.addListener(function(a){ia(a.newValue,ja)});a.Sb.addListener(function(a){ia(a.newValue,Ia)});a.addEventListener(sg,function(){var a;for(a=ja.first;a;)a.media=null,a.Kb=null,a=a.next;for(a=Ia.first;a;)a.media=null,a.Kb=null,a=a.next});n(this,{cb:ja,Ab:Ia,Gb:g,$b:h,vb:function(){var b=a.v.value,c=g(),d=h();c&&c.startTime-b>I&&(c=null);d&&d.startTime-b>I&&(d=null);if(d)if(c){if(d.startTime<=c.startTime&&c.startTime>b)return d}else return d;return c},Ff:X?b:aa,Qd:function(b,c,d,f,g,h,l){for(var q=
0,m=0;m<b.length;m++){var n=b[m],u=c[m];if(d.type==rb&&d.track!=a.P.value||d.type==Xa&&d.track!=a.Sb.value){ha.trace("Rejecting received chunk because it doesn't match most recent track",n,d);return}if(n.media&&n.media.stream.f>=d.f){if(n.media.stream.Cq()){n.ya(Ui);ha.warn("Rejecting received chunk because it is lower bitrate than existing chunk",n,d);return}n.media=null;v.$&&(n.Kb=k)}var V=1<b.length?new $a(new $a(f.buffer,q,u.length)):f,q=q+u.length;n.media={stream:d,bg:V,length:V.length,i:g};
n.ya(Ui);v.$&&l&&(n.Kb=l,l.qv=!0);N();ic(d.type,a.Oc,a.Fa).set({H:n,stream:d,i:g,yj:h});ha.trace("Received chunk",n,{CdnId:g.id},w())}ca()},vr:function(a){a.Gd=!0;v.uj&&(a=a.media)&&(a.bg=null)},yr:function(a){a.Gd=k;v.uj&&c(a)},xr:function(){for(var a=L.length,b,d;a--;)b=L[a],b.Gd=k,(d=b.media)&&!d.bg&&c(b)},ve:function(){for(var b=a.Da(),d=Ia.first,f;d;)d.media&&!d.Gd&&0>b.indexOf(d.media.stream)&&(c(d),f=!0),d=d.next;f&&(ha.trace("Disgarding media based on stream filters"),ca())},bp:function(){for(var b=
a.Da(),d=Ia.first,f,g,h,k=C.Tg(),k=Ca(k,8008);d;)d.media&&(d.Gd&&(g=d.index,h=g+k/d.duration),!(d.index>=g&&d.index<=h)&&0>b.indexOf(d.media.stream)&&(c(d),f=!0)),d=d.next;f&&(ha.trace("Discarding media based on stream filters"),ca())},Mp:function(){var b=a.v.value,c=Nc(b,ja),d=Nc(b,Ia),f;c&&d&&(f=ya(c.endTime,d.endTime));return ib(f,b)},Yb:d,Sj:f,tb:l,Kj:m,Ia:u,Zj:p,Aw:t,Bd:r,Bw:function(){var b=a.v.value,c=Nc(b,Ia);return c?c.endTime:b},Ke:w,ih:A.get,compact:N,Uy:y,reset:function(){var a;for(a=
ja.first;a;)a.media&&(c(a),a.ya(Yc),a.Gd=k,a.Kb=k),a=a.next;for(a=Ia.first;a;)a.media&&c(a),a=a.next},Hw:function(b){var c=a.v.value;return(b=b.H)&&b.startTime-c>I?!1:!0}})}function Nc(a,b){var c=b.hb(a);if(c.media){for(;c.next&&c.next.media;)c=c.next;return c}}function gg(a,b){var c=b.hb(a),d=0;for(c&&c.media&&(d+=xa(Ka((c.endTime-a)/c.duration,0,1)*c.media.length),c=c.next);c&&c.media;)d+=c.media.length,c=c.next;return d}function Fe(a,b){var c=a.j.t,d,f=[],g,h,k=c.length;if(0>=k)throw new Ta("few chunks");
for(var l=0;l<k;l++){d=c[l];g=d.startTime;d=d.duration;var m=g+d;if(m>b)break;g={type:a.type,index:l,startTime:g,duration:d,endTime:m,ye:Yc,media:null,all:f,Ma:null,next:null,ya:function(a){this.ye=a}};g.Ja={Type:g.type,"Chunk index":g.index,StartTime:Sa(g.startTime),EndTime:Sa(g.endTime)};h&&(h.next=g,g.Ma=h);h=g;f.push(g)}f.hb=Xg;f.first=f[0];f.S=h;f.Mn=2<=f.length?(f.length-1)/(f.S.startTime-f.first.startTime):1;return f}function Xg(a){for(var b=this[Ka(xa(a*this.Mn),0,this.length-1)];b.startTime>
a&&b.Ma;b=b.Ma);for(;b.endTime<a&&b.next;b=b.next);return b}function bf(a,b,c){function d(a){if(a.c){var b=a.L;t[b.stream.type+"$"+b.i.id]=a.D}w--;f()}function f(){if(!(0<w)||H){var a,b,c,d,h=[],z;for(z=0;z<l.length;z++)a=l[z],c=t[rb+"$"+a.id],d=t[Xa+"$"+a.id],c&&d&&(c=Ca(c.O-c.requestTime,d.O-d.requestTime),h.push({i:a,Ld:c}),b=b===k?c:ya(c,b));if(z=h.length){for(;z--&&1<h.length;)a=h[z],a.Ld>b+v.Ys&&h.splice(z,1);g(h[0].i)}else 0>=w&&g()}}function g(a){a&&(a.mc={testreason:b,selreason:"relativelatency"});
g=f=p;c({c:!!a,pb:a})}var h=a.xa,l=a.F,m=a.G.value,n=a.k.value,r=a.n;a=r.Gb();for(var r=r.Gb(),U,t={},w=0,H,N,y=0;y<l.length;y++)U=l[y],N=vf(U,m,a),U=vf(U,n,r),N&&U&&(w+=2,h.N(N,d),h.N(U,d));Ya(function(){H=!0;f()},v.Zs)}function vf(a,b,c){if(b.Ta[a.id])return{responseType:Bc,url:b.Ta[a.id],dc:wf,offset:b.j.t[c?c.index:0].offset,length:8,i:a,track:b.track,stream:b,Db:b.type+"-"+b.f+"-ping",Hc:!0}}function wf(a){a=new $a(a);a=new Vc(a);var b=a.l();if(8>b||b>Tk)throw new Ta("cdnping-badsize");if("moof"!=
a.Ob(4))throw new Ta("cdnping-badtype");return!0}function xf(a,b,d){function f(b,c){var d=N[b.ga].F,k;c.type==Xa?(k=(a.o.value==mc?w.Vc():w.ib()).k,k.j||(k=a.Y)):k=a.G.value;for(var l=0;l<d.length;l++){var q=d[l];if(b.va===l){var m=a.n.Ia(),m=Ee(c,k,q,v.oe,m);p.trace("CDN Selection: Downloading",{CdnId:q.id},c,k,{Count:m.za.length,Offset:m.offset,Length:m.length});t.N(m,g)}else m=vf(q,k,c),p.trace("CDN Selection: Pinging",{CdnId:q.id},c,k),t.N(m,h)}}function g(a){var b=a.L;a.c?y.Qd(b.za,b.Xc,b.stream,
a.content,b.i,a.D):b.za&&b.za.forEach(function(a){a.media=null;a.ya(Yc)});k(a);l()}function h(a){k(a)}function k(a){var b=a.L.i,c=b.id,d=b.location.id;a.c?(G[d]||(G[d]={}),G[d][c]={i:b,D:a.D}):G[d]&&G[d][c]&&delete G[d][c]}function l(){var a,c=N[M.ga];a=c.id;c=c.F[M.va].id;a=G[a]&&G[a][c]?n(G[a][c].D):void 0;if(a>v.uf)a=N[M.ga].F[M.va],a.mc={testreason:b,selreason:"fastselection",fastselthreshold:v.uf},d({c:!0,pb:a});else{if(c=a=y.vb()){var c=M,g=N[c.ga].id,h=N[c.ga].F[c.va].id;G[g]&&G[g][h]?c=m(c):
(c.va<N[c.ga].F.length-1?(c.va++,g=!0):g=void 0,c=g||m(c))}c?f(M,a):(a=r(G),d({c:!!a,pb:a}))}}function m(a){if(a.ga<N.length-1)return a.ga++,a.va=0,!0}function n(a){if(a)return 7.8125*a.aa/(a.M-a.requestTime)}function r(a){var d,f=0;c(a,function(a,b){b&&c(b,function(a,b){var c=n(b.D)*b.i.location.weight;c>f&&(f=c,d=b.i)})});d&&(d.mc={testreason:b,selreason:"maxweightedbw"});return d}var p=new a.log.r("CdnSelBw"),t=a.xa,w=a.wa,H=a.ca,N=a.Yh,y=a.n,G={},M={ga:0,va:0},ca=y.vb();ca?f(M,ca):d({c:!0,pb:a.i.value||
a.Sd});return{jb:function(){return H.ka(v.oe)*(N.length-M.ga)}}}function Hg(a,b,d,f,g){function h(b,c){var g=G[b.ga].F,m;c.type==rb&&(m=a.G.value);for(var n=0;n<g.length;n++){var u=g[n];c.type==Xa&&((m=d.Pj(u.location.id))?(m=f.fa(m+1,!0),ca.push(u.location.id)):(m=N.ib(!0),m=m.k,m.j||(m=a.Y)));if(b.va===n){var V=a.n.Ia(),V=Ee(c,m,u,v.oe,V);w.trace("Downloading",{CdnId:u.id},c,m,{Count:V.za.length,Offset:V.offset,Length:V.length});H.N(V,k)}else V=vf(u,m,c),w.trace("Pinging",{CdnId:u.id},c,m),H.N(V,
l)}}function k(a){var b=a.L;a.c?M.Qd(b.za,b.Xc,b.stream,a.content,b.i,a.D):b.za&&b.za.forEach(function(a){a.media=null;a.ya(Yc)});m(a);n()}function l(a){m(a)}function m(a){var b=a.L.i,c=b.id,d=b.location.id;a.c?(ia[d]||(ia[d]={}),ia[d][c]={i:b,D:a.D}):ia[d]&&ia[d][c]&&delete ia[d][c]}function n(){var c,d=G[ha.ga];c=d.id;d=d.F[ha.va].id;c=ia[c]&&ia[c][d]?p(ia[c][d].D):void 0;if(c>v.uf)c=G[ha.ga].F[ha.va],c.mc={testreason:b,selreason:"fastselection",fastselthreshold:v.uf},g({c:!0,pb:c,qb:-1<ca.indexOf(a.i.value)});
else{if(d=c=M.vb()){var d=ha,f=G[d.ga].id,k=G[d.ga].F[d.va].id;ia[f]&&ia[f][k]?d=r(d):(d.va<G[d.ga].F.length-1?(d.va++,f=!0):f=void 0,d=f||r(d))}d?h(ha,c):(c=t(ia),g({c:!!c,pb:c,qb:-1<ca.indexOf(a.i.value)}))}}function r(a){if(a.ga<G.length-1)return a.ga++,a.va=0,!0}function p(a){if(a)return 7.8125*a.aa/(a.M-a.requestTime)}function t(a){var d,f=0;c(a,function(a,b){b&&c(b,function(a,b){var c=p(b.D)*b.i.location.weight;c>f&&(f=c,d=b.i)})});d&&(d.mc={testreason:b,selreason:"maxweightedbw"});return d}
var w=new a.log.r("CdnSelCarrera"),H=a.xa,N=a.wa,y=a.ca,G=a.Yh,M=a.n,ca=[],ia={},ha={ga:0,va:0},A=M.vb();A?h(ha,A):g({c:!0,pb:a.i.value||a.Sd,qb:-1<ca.indexOf(a.i.value)});return{jb:function(){return y.ka(v.oe)*(G.length-ha.ga)}}}function Ig(a){function c(){od.removeEventListener(Ce,f);H&&H.response&&H.response.abort()}function d(){var a=w.vb();H&&H.response&&a!=H.H&&H.response.abort();f()}function f(){if(a.state.value==ab&&a.A.value!=Kc)if(a.qd&&a.qd<=ga())a.o.value!=mc&&a.Sa(new Ib(R.Jf));else if(a.o.value==
cc&&(td()||a.o.set(lc)),a.o.value==lc&&td()&&a.o.set(cc),a.G.value.j)if(a.k.value.j)if(Ua)h(Ua),Ua=k;else{var b=w.vb(),c;a.o.value!=mc&&(c=r.ib(),0>=c.mb&&0>=c.nb&&g("Heuristics"),b||g("Full"));if(!(H||N&&N.stream.type==Xa&&N.stream.f>a.k.value.f)){if(b){a.o.value==mc&&(c=r.Vc());var d=b.index,q;if(b.type==Xa)q=c.k,q.j&&q.j.t[d]||(n.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:q.f,BitrateNew:a.Y.f}),q=a.Y),q!=a.k.value&&(n.trace("Stream switch",
{BitraetOld:a.k.value.f,BitrateNew:q.f}),a.k.set(q));else if(b.type==rb)q=a.G.value;else return;var V=q.j.t[d];w.Ff(V)||(q.type==rb&&w.tb()<v.Xa?n.trace("Ignoring max buffer bytes",b,q):q.type==Xa&&w.Ia()<v.Xa?(q=a.Aa().ea(0,!0),V=q.j.t[d],n.trace("Ignoring max buffer bytes, and reverting to lowest video stream",b,q)):(g("NoRoom"),V=k));if(V){if(a.o.value==cc&&c){for(var d=c.mb,p=c.nb,wa=w.Gb(),X=w.$b(),y=a.G.value.j.t,ha=a.k.value.j.t,A=0;0<d&&wa;)wa.media||wa==b||(A+=t.ka(y[wa.index].length)),d-=
wa.duration,wa=wa.next;for(;0<p&&X;)X.media||X==b||(A+=t.ka(ha[X.index].length)),p-=X.duration,X=X.next;ia=A;M=t.zd();ca=Ca(t.ka(V.length)-M,1)}else ca=M=ia=k;if(G>v.bl){h("dlfail");return}V=a.i.value;d=a.n.Ia();d=Ee(b,q,V,k,d);n.trace("Downloading chunk",b,q,{Offset:d.offset,Length:d.length});b.ya(pf);ic(q.type,a.ze,a.Ae).set({H:b,stream:q,i:V});H={type:xh,stream:q,H:b,response:u.N(d,m)}}}!N&&c&&c.Wa&&l(c.Wa)}}else l(a.k.value);else l(a.G.value)}function g(b){a.o.value!=mc&&(n.trace("Buffering complete",
{Cause:b},w),a.o.set(mc),ha||(ha=!0,a.ta("pb")))}function h(b){n.trace("Selecting a CDN");H={type:Vi};switch(v.cl){case "bandwidth":b=xf(a,b,m);H.jb=b&&b.jb;break;default:bf(a,b,m)}}function l(a){function b(){N==c&&(N=null);c=null;f()}if(!(N&&N.stream==a||a.Pe)){n.trace("Downloading header",a);var c={stream:a,st:ga()};N=c;a.Ea(b);Ya(b,v.ak)}}function m(b){var c=H;H=null;a.state.value==ab&&(c.type!=Wi&&(b.c?(G=0,c.type==xh?(c=b.L,a.o.value==lc&&a.o.set(cc),w.Qd(c.za,c.Xc,c.stream,b.content,c.i,b.D)):
a.i.set(b.pb)):b.g!=P.bb&&(H={type:Wi},Ya(m,A[G]),++G>=A.length&&(a.o.value==cc&&a.o.set(lc),G=A.length-1))),f())}var n=new a.log.r("MediaDownloader"),u=a.xa,r=a.wa,t=a.ca,w=a.n,y=new Cb(500),H,N,A=v.gb,G=0,M,ca,ia,ha,Ua="startup";(function(){Ba(f);a.addEventListener(of,function(){Ba(f)});a.addEventListener(mf,function(b){b.Ic==yh&&a.o.set(cc);Ba(f)});a.addEventListener(Yd,function(){var b;a.G.value.j&&a.k.value.j&&(b=r.ib());b&&0>=b.mb&&0>=b.nb?n.trace("Repositioned without rebuffer",w):(n.trace("Repositioned, buffering",
w),a.o.set(cc));y.ob(d)});od.addEventListener(Ce,f);a.addEventListener(yb,c)})();this.vc=function(){var c;if(a.o.value==cc&&H){var d;try{if(H.type==xh){var f=H.response,g=f.D;if(b(g.O))d=(1-(g.aa||0)/f.L.length)*ca;else{var h=ga()-g.requestTime;d=Ca(M-h,0)+ca}}}catch(k){}c=(d||0)+(ia||0);(d=H.jb&&H.jb())&&(c=Ca(d,c))}return c};this.Rg=p;this.Le=function(){return.99}}function Ee(a,b,c,d,f){var g=b.j.t,h=g[a.index].offset,k=0,l=[],m=[];do{var n=g[a.index],k=k+n.length;l.push(a);m.push(n);a=a.next}while(k<
d&&a);a=v.Vb;Y(f)&&v.$t&&!v.Jb&&(a=Qa.max(v.lr,Qa.min(f/v.Ko,v.Vb+f/v.Md*v.Lo)));return{responseType:Bc,dc:Gb,url:b.Ta[c.id],offset:h,length:k,i:c,track:b.track,stream:b,za:l,Xc:m,Db:b.type+"-"+b.f+"-"+l.map(function(a){return a.index}).join("+"),Hc:!0,Vb:a}}function Jg(){var a;a=["avc1.640028","hev1.2.6.L153.B0","dvhe.01000000"].filter(function(a){a=ec('{0}/mp4;codecs="{1}"',"video",a);return Dd.isTypeSupported(a)});return ec('{0}/mp4;codecs="{1}"',"video",a.join(", "))}function Q(a){function b(){td()&&
r&&r.ae()}function c(a,b){try{h.trace(ec("transitioning from {0} to {1}, reason: {2}",r&&r.getName()||"null",a.getName(),b)),r&&r.Gg(),r=a,r.Qc(),d()}catch(f){h.error("There was an error changing downloader state, e: ",f)}}function d(){y.ob(f)}function f(){a.state.value==ab&&(N(),r.update())}function g(){var a=v.Pr;k.Sj()>a&&(H.da.Ph(m),N=p)}var h=new a.log.r("ParallelMediaDownloader"),k=a.n,m=v.wk,n,r,t=v.Nr,w,y=new Cb(v.Or),H={T:this,da:{},Xb:new nc(v.bl)},N=g;a.fb=H;H.da="subchunk"===v.Mr?new K(m,
m,a):new J(m,a);H.Jc="startup";(function(){function f(){d()}n=new l(a,H);"carrera"==v.hh?c(n.qq,"using carrera for initial playback."):c(n.ig,"select first CDN before playback.");w=qb(d,t);H.da.addEventListener(yg,f);a.addEventListener(yb,function(){wb(w);y.Nc();od.removeEventListener(Ce,b);H.da.removeEventListener(yg,f);H.da.Gc()});d();a.addEventListener(of,function(){d()});a.addEventListener(mf,function(a){a.Ic==yh&&(H.da.Ph(1),N=g,r.Ir(),d())});a.addEventListener(Yd,function(){r.Kk();d()});a.addEventListener(Qi,
function(){r.ae()});od.addEventListener(Ce,b)})();this.Ra=c;this.vc=function(){return r.vc()};this.lg=function(a){H.da.td();H.da.Gc(a)};this.Rg=function(){return r&&r.getName()||"null"};this.Le=function(){return r.Le()}}function Eb(a){var b=a.fb,c,d=b.da,f=b.T,g=b.sb;this.getName=function(){return"BaseState"};this.Hd=function(){this.log=new a.log.r(this.getName())};this.Hd();this.Le=function(){return.99};this.ae=this.update=this.Gg=this.Qc=p;this.Ir=function(){a.o.set(cc);f.Ra(g.us,"buffer underrun")};
this.Kk=function(){f.Ra(g.Jh,"user seek")};this.Jj=function(){return c};this.vc=function(){return 0};this.Kh=function(){return b.Xb.hl(a.i.value)?(b.Jc="dlfail",b.Eb=0,f.Ra(g.ig,"download failures"),!0):!1};this.yg=function(a,b){d.Pc({H:a,pf:b})};this.Ea=function(a){function b(){c==d&&(c=null);d=null}if(!(c&&c.stream==a||a.Pe)){this.log.trace("Downloading header",a);var d={stream:a,st:ga()};c=d;a.Ea(b);Ya(b,v.ak)}};this.Og=function(b,c){if(b.type===Xa)var d=c.k;else if(b.type==rb)d=a.G.value;else return k;
return d.j.t[b.index]};this.gg=function(){var a=ga()-b.pt;return v.oh-a};this.Yk=function(){b.pt=ga()}}function Va(a){function b(){f.Uh()&&(h.td(),h.Gc())}var c=new Eb(a),d=a.fb,f=a.wa,g=a.n,h=d.da,k=new Cb(1E3);n(this,c);d.Jc="startup";this.getName=function(){return"PlayingState"};this.Qc=function(){d.Xb.lj();a.o.set(mc);v.Dp&&a.A.set(Xc);d.da.xb(!0)};this.update=function(){if(a.state.value==ab&&a.A.value!=Kc)if(k.ob(b),a.qd&&a.qd<=ga())a.o.value!=mc&&a.Sa(new Ib(R.Jf));else if(!a.G.value.j)this.Ea(a.G.value);
else if(!a.k.value.j)this.Ea(a.k.value);else if(!this.Kh()){var c=g.vb(),h=this.Jj();if(!(h&&h.stream.type==Xa&&h.stream.f>a.k.value.f)&&c&&d.da.ef()){var l=f.Vc(),q=this.Og(c,l);g.Ff(q,!0)&&a.o.value==mc&&this.yg(c,l);!h&&l&&l.Wa&&this.Ea(l.Wa)}}}}function hb(a){function b(c){t.log.trace("in _exitBufferingState()");a.o.value!=mc&&(t.log.trace("Buffering complete",{Cause:c},g),l||(l=!0,a.ta("pb")));f.Ra(m.lf,"exiting buffering: "+c)}var c=new Eb(a),d=a.fb,f=d.T,g=a.n,h=a.ha,k=a.ca,l,m=d.sb,r=a.wa,
p=145152E5,t=this;n(this,c);this.vc=function(){return v.oh?this.gg():p};this.getName=function(){return"BufferingState"};this.Qc=function(){a.o.set(cc);d.da.xb(!0)};this.update=function(){td()?a.o.value==lc&&a.o.set(cc):a.o.set(lc);if(!a.G.value.j)this.Ea(a.G.value);else if(!a.k.value.j)this.Ea(a.k.value);else if(!this.Kh()){var c=g.vb(),f=r.ib();if(h.tg()){if(0>=f.mb&&0>=f.nb){b("Heuristics");return}if(v.oh&&0>=this.gg()){b("maxBufferingTime");return}if(!c&&g.ih()){b("Full");return}}for(var l=f.mb,
q=f.nb,m=g.Gb(!0),n=g.$b(!0),u=a.G.value.j.t,ba=a.k.value.j.t,w=0;0<l&&m;)m.media||m==c||(w+=k.ka(u[m.index].length)),l-=m.duration,m=m.next;for(;0<q&&n;)n.media||n==c||(w+=k.ka(ba[n.index].length)),q-=n.duration,n=n.next;p=w;l=this.Jj();if(!(l&&l.stream.type==Xa&&l.stream.f>a.k.value.f)){if(c&&d.da.ef()){if(!f.k.j){this.Ea(f.k);return}q=this.Og(c,f);g.Ff(q,!0)&&this.yg(c,f)}!l&&f&&f.Wa&&t.Ea(f.Wa)}}}}function C(a){var b=new Eb(a),c=this,d=a.fb,f=d.T,g=d.da,h=a.wa,k=a.n,l=d.sb;n(this,b);this.getName=
function(){return"SeekingState"};this.Qc=function(){g.td();g.Gc()};this.update=function(){var b;a.G.value.j&&a.k.value.j&&(b=h.ib());b&&0>=b.mb&&0>=b.nb&&a.o.value!==lc?(this.log.trace("Repositioned without rebuffer",k),f.Ra(l.lf,"no buffering required during seek.")):(this.log.trace("Repositioned, buffering",k),c.Yk(),f.Ra(l.o,"buffering required during seek."))}}function w(a){var b=new Eb(a),c=a.fb,d=c.T,f=c.da,g=c.sb;n(this,b);this.getName=function(){return"RebufferingState"};this.Qc=function(){f.td();
f.Gc()};this.update=function(){c.Jc="buffer underrun";d.Ra(g.ig,"CDN selection due to rebuffer.")}}function m(a){function b(){td()?v.ao||1<w.Np()?w.ob(c):c():this.kg()}function c(){if(!u){u={type:Vi};var b=l.Jc;H.log.trace("Selecting a CDN");if("startup"===b&&"carrera"===v.hh)b=Hg(a,b,H.hg,H.U,f),u&&(u.jb=b&&b.jb);else switch(v.cl){case "bandwidth":b=xf(a,b,d);u&&(u.jb=b&&b.jb);break;default:bf(a,b,d)}}}function d(b){b.c?(a.i.set(b.pb),H.log.trace("cdn selected: ",{name:b.pb.name}),l.Jc=k,r||(a.o.value==
cc||a.o.value==lc?l.T.Ra(l.sb.o,"underrun, buffer media before resume."):l.T.Ra(l.sb.lf,"buffer has media, resume playback"))):(H.log.trace("cdn selection failed!"),H.kg(),a.o.value==lc&&(w.Qh(p[t]),t=t<p.length-1?t+1:p.length-1),u=null);r&&l.T.Ra(l.sb.Jh,"user seek")}function f(b){b.c?(a.i.set(b.pb),H.log.trace("cdn selected: ",{name:b.pb.name}),l.Jc=k,l.qb=b.qb):(H.kg(),a.o.value==lc&&(w.Qh(p[t]),t=t<p.length-1?t+1:p.length-1),u=null);r&&l.T.Ra(l.sb.Jh,"user seek")}function g(){var b=a.Da(),c=b.length;
n(b,Ad);for(var d=0;d<c;d++)b[d].lower=b[d-1],b[d].Ed=b[d+1];return b}var h=new Eb(a),l=a.fb,m=l.da,u,r,p=v.gb,t=0,w=new Cb(1),H=this;"carrera"===v.hh&&(H.hg=new Vg(a),H.U=g());n(this,h);this.getName=function(){return"CDNSelectionState"};this.vc=function(){var a=m.Yj()||0;if(u){var b=u.jb&&u.jb();b&&(a=Ca(b,a))}return Ca(a,this.gg())};this.Qc=function(){w.Qh(1);t=0;l.Xb.lj();r=!1;H.Yk()};this.Gg=function(){w.Nc();u=null};this.ae=function(){a.o.value==lc&&td()&&w.Ms(c)};this.update=v.Xt?b:c;this.Kk=
function(){r=!0};this.kg=function(){a.o.value==cc&&a.o.set(lc)}}function h(a){function b(c){w.log.trace("in _exitBufferingState()");a.o.value!=mc&&(w.log.trace("Buffering complete",{Cause:c},g),r||(r=!0,a.ta("pb")));f.Ra(u.lf,"exiting buffering: "+c)}var c=new m(a),d=a.fb,f=d.T,g=a.n,h=a.ha,k=a.ca,l=a.wa,u=d.sb,r,p=!1,t,w=this;d.qb=!1;n(this,c);this.getName=function(){return"InitBitrateSelectionState"};this.Gg=function(){a.qb=d.qb;a.ej=w.hg.Rp()};this.update=function(){if(a.i.value)a:if(!a.G.value.j)w.Ea(a.G.value);
else if(!a.k.value.j)w.Ea(a.k.value);else{if(!w.Kh()){var f=g.tb()>=v.cg?0:v.cg-g.tb(),m=g.Ia()>=v.dj?0:v.dj-g.Ia();if(d.qb&&0===m&&0===f&&h.tg())b("Carrera");else{t||p||(t=w.hg.Pj(a.i.value.location.id));p=!t;var n=g.vb();if(p){if(f=l.ib(!0),0>=f.nb&&0>=f.mb&&h.tg()){b("Heuristics");break a}}else{d.qb=!0;var u=w.U.fa(t+1,!0),r=w.U.ea(t+1,!1),f={k:u,Wa:r,mb:f,nb:m}}for(var m=f.mb,u=f.nb,r=g.Gb(!0),ba=g.$b(!0),y=a.G.value.j.t,ha=a.k.value.j.t,A=0;0<m&&r;)r.media||r==n||(A+=k.ka(y[r.index].length)),
m-=r.duration,r=r.next;for(;0<u&&ba;)ba.media||ba==n||(A+=k.ka(ha[ba.index].length)),u-=ba.duration,ba=ba.next;n&&d.da.ef()&&(m=w.Og(n,f),g.Ff(m,!0)&&w.yg(n,f))}}}else c.update.apply(w)}}function l(a,b){function c(b){b=new b(a);b.Hd.call(b);return b}b.sb=this;this.lf=c(Va);this.Jh=c(C);this.us=c(w);this.ig=c(m);this.o=c(hb);this.qq=c(h)}function t(a,b,c){function d(){!n&&l&&(m=a.Lc())&&f(m)}function f(a){function c(a){var f;b.state.value==ab&&(a&&a.c?(p.Eb=0,f=a.L,h.Qd(f.za,f.Xc,f.stream,a.content,
f.i,a.D)):(m&&(f=m.H)&&(f.media=null,f.ya(Yc)),a&&a.g==P.bb||(a&&(f=a.L,p.Xb.bi(f.i,f.za[0],f.stream)),++p.Eb>=p.gb.length&&(p.Eb=p.gb.length-1))),Ba(d));t.B(Xi);m=null;n&&(n=null)}var l=a.H,z=a.pf,q=l.index;if(l.type===Xa)z=z.k,z.j&&z.j.t[q]||(g.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:z.f,BitrateNew:b.Y.f}),z=b.Y),z!=b.k.value&&(g.trace("Stream switch",{BitrateOld:b.k.value.f,BitrateNew:z.f,"Chunk Index":q}),b.k.set(z,{kj:z.j.t[q].startTime}));
else if(l.type==rb)z=b.G.value;else return;if(z.j.t[q]){var v=b.i.value,q=r(l,z,v);l.ya(pf);ic(z.type,b.ze,b.Ae).set({H:l,stream:z,i:v});n=l={type:Uk,stream:z,H:l};l.response=k.N(q,c);a.response=l.response}}var g=new b.log.r("MediaDownloadWorker"),h=b.n,k=b.qh,l=c,m,n,p=b.fb,t=new Hb;this.addEventListener=t.addListener;p.gb=v.gb;p.Eb=0;a.addEventListener(Yi,function(a){!n&&l&&(a.$j=!0,d())});this.isEnabled=function(){return l};this.xb=function(a){l=a};this.Qg=function(){return m};this.Yf=function(a){n&&
n.response&&m&&(a?a(m):1)&&(m.H.media=null,m.H.ya(Yc),g.trace("Aborted download of chunk:",m.H.index),n.response.abort(),m=n=null)}}function r(a,b,c){var d=b.j.t,f=d[a.index].offset,g=0,h=[],k=[];do{var l=d[a.index],g=g+l.length;h.push(a);k.push(l);a=a.next}while(void 0>g&&a);return{responseType:Bc,dc:Gb,url:b.Ta[c.id],offset:f,length:g,i:c,track:b.track,stream:b,za:h,Xc:k,Db:b.type+"-"+b.f+"-"+h.map(function(a){return a.index}).join("+"),Hc:!0}}function J(a,c){var d=[],f=c.ca,g=new za.Bb,h=new Hb;
this.addEventListener=h.addListener;this.removeEventListener=h.removeListener;this.Pc=function(a){var b=g.Pc(a);a.H.ya(zh);h.Th(Yi);return b};this.Lc=function(){return g.Lc()};this.hf=function(){return g.hf()};this.size=function(){return g.size()};this.contains=function(a,b){return g.contains(a,b)};this.forEach=function(a){return g.forEach(a)};this.xb=function(a){d.forEach(function(b){b.xb(a)})};this.Yj=function(){var a=0;d.forEach(function(d){var f=d.Qg();if(f&&f.H.ye===pf){d=f.H;var g=f.pf,g=d.type===
Xa?g.k:c.G.value,h=f.response;h&&(f=f.response.D,a=b(f.O)?a+Ca(h.L.length-(f.aa||0),0):a+g.j.t[d.index].length)}});a=a||0;return f.ka(a)};this.Gc=function(a){d.forEach(function(b){b.Yf(a)})};this.Ph=function(a){var b=d.length;a=Ka(a,0,b);for(var c=0;c<b;c++)d[c].xb(c<a)};this.td=function(){g.forEach(function(a){a.H.ya(Yc)});g.clear()};this.ef=function(){return 2>g.size()};for(var k=0;k<a;k++){var l=new t(this,c,1>k);l.addEventListener(Xi,function(){h.B(yg)});d.push(l)}}function ka(a){var b=this;this.Qe=
a||65536;this.Jo=function(a,c,d){var f=[],g,h;if(1===d||a.length<=b.Qe)f.push({offset:a.offset,length:a.length,Ce:a.offset+a.length,Lb:c});else{var k=Qa.floor(Qa.floor(a.length/b.Qe)/d)*b.Qe||b.Qe,l=Qa.floor(a.length/k),l=0<l?l-1:0,z=a.length-k*l;for(d=0;d<l;d++)g=a.offset+d*k,h=g+k-1,f.push({offset:g,length:k,Ce:h,Lb:c});0<z?(g=a.offset+l*k,f.push({offset:g,length:z,Ce:g+z,Lb:c})):f[f.length-1].Ce+=1}a=f.length;for(d=0;d<a;d++)c=f[d].Lb,f[d].index=d+1,f[d].Ja={name:ec("{0}_{1} - {2}/{3}",c.type,
c.index,d+1,a)};return f}}function K(a,c,d){function f(a){if(a){var b=a.H;a=a.pf;var c=b.type===Xa?a.k:b.type===rb?d.G.value:void 0;a=c.j.t[b.index];b.content=new $a(a.length);b.Pb=y.Jo(a,b,w);b.Pb.forEach(function(a){a.i=d.i.value;a.stream=c;N.Pc(a);G.Th(Ah)})}}function g(a){a&&(a.media=null,a.ya(Yc),a.Pb=null)}function h(a){function b(a){if(a.Pb){for(var c=a.Pb.length,d=0;d<c;d++){var f=a.Pb[d];if(!f.response||!f.response.c)return!1}return!0}return!1}if(a){var c=a.Lb,z,m=d.fb;if(a.response.c){if(b(c)){c.Pb.forEach(function(a){c.content.set(a.response.content,
a.offset-c.L.offset)});try{c.content=la(c.content),z=!0}catch(n){g(c),m.Xb.bi(a.i,c,a.stream),l.warn("Exception parsing response",n,c)}delete H[c.type+"_"+c.index];z&&t.Qd([c],c.L.Xc,a.stream,c.content,a.i,k(c));c.Pb=null;c.content=null;a=L;L=null;f(a);G.B(yg)}}else a.response=null,m.Xb.hl(a.i)&&p.xb(!1),N.Pc(a),G.Th(Ah)}}function k(a){var b={},c=a.Pb;a.Pb&&(b.requestTime=yc(c,function(a){return a.response.D.requestTime}),b.O=yc(c,function(a){return a.response.D.O}),b.M=Z(c,function(a){return a.response.D.M}),
b.aa=a.content.length);return b}var l=new d.log.r("SubChunkDownloadJobManager"),m=[],n=d.ca,p=this,t=d.n,w=c,y=new ka(v.Et),H={},N=new za.Bb,L,G=new Hb;this.addEventListener=G.addListener;this.removeEventListener=G.removeListener;this.Pc=function(a){a.H.ya(zh);f(a)};this.ef=function(){return Qb.keys(H).length<v.Yq&&N.size()<=w};this.Lc=function(){var a=N.Lc();if(!a)return null;a.i=d.i.value;var b=a.Lb;if(!H[b.type+"_"+b.index]){b.L=r(b,a.stream,a.i);ic(a.stream.type,d.ze,d.Ae).set({H:b,stream:a.stream,
i:a.i});H[b.type+"_"+b.index]=b;b.ya(pf);var c=b.index;if(b.type===Xa)b=a.stream,b.j&&b.j.t[c]||(l.warn("Stream is missing header or has less chunks than primary, falling back to primary",{BitrateOld:b.f,BitrateNew:d.Y.f}),b=d.Y),b!=d.k.value&&(l.trace("Stream switch",{BitrateOld:d.k.value.f,BitrateNew:b.f}),d.k.set(b));else if(b.type!==rb)throw new Ta("unexpected chunk type.");}return a};this.hf=function(){return N.hf()};this.size=function(){return N.size()};this.contains=function(a,b){return N.contains(a,
b)};this.forEach=function(a){return N.forEach(a)};this.xb=function(a){m.forEach(function(b){b.xb(a)})};this.Yj=function(){var a=0;m.forEach(function(c){if(c=c.Qg()){var d=c.response;if(d){var f=d.D;a=b(f.O)?a+Ca(d.L.length-(f.aa||0),0):a+c.length}}});a=a||0;return n.ka(a)};this.Gc=function(){Qb.keys(H).forEach(function(a){g(H[a]);delete H[a]});m.forEach(function(a){a.Yf()})};this.Ph=function(a){var b=m.length;a=Ka(a,0,b);for(var c=0;c<b;c++)m[c].xb(c<a)};this.td=function(){L&&(g(L.H),L=null);N.forEach(function(a){a&&
g(a.Lb)});N.clear()};for(c=0;c<a;c++){var M=new A(p,d,c<w);M.addEventListener(Zi,function(a){h(a)});m.push(M)}}function A(a,b,c){function d(){!l&&k&&(l=a.Lc())&&f(l)}function f(a){var c=E(a),g={type:Vk,stream:a.stream,Fz:a};m=g;g.response=h.N(c,function(c){Ba(d);var f=m;f&&b.state.value==ab&&f.type!=$i&&(c&&c.c?n.Eb=0:c&&c.g==P.bb||(n.Xb.bi(a.i,a.Lb,a.stream),++n.Eb>=n.gb.length&&(n.Eb=n.gb.length-1)));r.B(Zi,l);l=null;m&&m.type!=$i&&(m=null)});a.response=g.response}var g=new b.log.r("SubChunkDownloadWorker"),
h=b.qh,k=c,l,m,n=b.fb,r=new Hb;this.addEventListener=r.addListener;n.gb=v.gb;n.Eb=0;a.addEventListener(Ah,function(a){!l&&k&&(a.$j=!0,d())});this.isEnabled=function(){return k};this.xb=function(a){k!=a&&(k=a)&&d()};this.Qg=function(){return l};this.Yf=function(){m&&m.response&&(g.trace("Aborted download of chunk:",l),m.response.abort(),l=m=null)}}function E(a){var b=a.stream;return{responseType:Bc,dc:ma,url:b.Ta[a.i.id],offset:a.offset,length:a.length,za:[a.Lb],i:a.i,track:b.track,stream:b,Db:b.type+
"-"+b.f+"-"+a.Lb.index+"- sub."+a.index,Hc:!0}}function ma(a){return new $a(a)}function nb(a){function b(){10>=l.length?c():b=p}function c(){a.state.value!=ab&&a.state.value!=bc||d()}function d(){var b=w,c;w=ga();c=w-b;b=(h=h||a.n)&&h.ih();if(!b||y){if(++A>=G&&(A=0,a.fireEvent(pg)),0<l.length){var b=ya(t,l[l.length-1].M-l[0].requestTime),g=0,k=ga(),q=b>=t?k-t:l[0].requestTime,q=k-q<=v.Wh?q:k-v.Wh;r=0;l.forEach(function(a){var b=a.M-a.requestTime,c=0;if(!(0>=b||a.M<q||a.requestTime>k)){if(a.requestTime>=
q&&a.M<=k)c=1;else{var d=a.M;d>=q&&d<=k?c=(a.M-q)/b:(d=a.requestTime,d>=q&&d<=k&&(c=(k-a.requestTime)/b))}g++;r+=a.aa*c}});r=xa(r);m=xa(Ca(8,r/b));ia=b;y=!1}}else b&&f(c)}function f(a){l.forEach(function(b){b.requestTime+=a;b.O+=a;b.M+=a})}function g(a){return xa(a/m)}var h,k,l=[],m=128,n=0,r=0,t=v.Wh,w=ga(),y,N,A=0,G=jb(4),M,L,ia,ha=0;a.addEventListener(ye,function(a){var c=a.D,d=a.L;d.i&&(N=d.i.location.id);M=c.requestTime;if(a.c&&c.aa>Pi&&a.type==Bc){g(c.aa);for(l.push(c);100<l.length;)l.shift();
y=h&&h.ih();b()}});this.Wg=function(){return m};this.gq=function(){return xa(7.8125*m)};this.Xj=function(){return xa(7.8125*n)};this.Bd=function(){return r};this.Qj=function(){return N};this.Rj=function(){return M};this.ka=g;this.Ub=function(){k=k||new cd(a.n,a.cd);return k.Ub(m,0)};this.re=function(){return this.gq()};this.Yg=function(){return ia};this.zd=function(){return 0};a.addEventListener(yb,function(){L&&wb(L)});L=qb(c,250);var C=new ie(1E3,function(){60<ha?C.ud():(n=(n*ha+m)/(ha+1),ha+=1)});
C.Sh()}function nc(a){var b={};this.bi=function(a,c,d){a=a.name+"_"+(d.type+"_"+c.index);b[a]=b[a]?b[a]+1:1};this.lj=function(){b={}};this.hl=function(c){return Qb.keys(b).some(function(d){var f=b[d];return-1<d.indexOf(c.name)&&f>a})}}function Gb(a){return la(new $a(a))}function la(a){for(var b=wh(a),c,d,f,g=0;g<b.length;g+=2){c=b[g];if("moof"!=c.type||"mdat"!=b[g+1].type)throw new Ta("data is not moof-mdat box pairs");if(v.gu&&"moof"==c.type&&(d=c.ub("traf/saio"),f=c.ub("traf/A2394F52-5A9B-4F14-A244-6C427C648DF4"),
d&&f&&(f=f.ho.byteOffset-c.Na.byteOffset,d.Ks[0]!=f))){var h=d;d=f;f=new Vc(h.Na);f.seek(h.size-h.aa);h=f.I(1);f.I(3)&1&&(f.l(),f.l());h=1<=h?8:4;f.l();f.Dl(d,h)}v.Bl&&"moof"==c.type&&(c=c.ub("traf/tfhd"),(d=c.vg)&&d.Zk&&fa(c))}return a}function fa(a){var b=new Vc(a.Na);b.seek(a.size-a.aa);b.I(1);var c=b.I(3);b.l();var d;switch(a.type){case "tfhd":c&1&&b.oa();c&2&&b.l();c&8&&b.l();c&16&&b.l();c&32&&(d=b.na(2));break;case "trex":b.l(),b.l(),b.l(),d=b.na(2)}d&&(d[1]&=254)}function Ec(a,b,c,d){var f=
b.type;b=ic(f,"ec-3"==b.j.ng?'audio/mp4; codecs="mp4a.a6"':'audio/mp4; codecs="mp4a.40.5"',v.cu);var g={Type:f},h,k=!1,l,m=this,r,p={data:[],state:"",operation:""};v.bc&&v.Xe&&(r=!0,m.Kg=new Wa);d.trace("Adding source buffer",g,{TypeId:b});h=c.addSourceBuffer(b);sa(h);zg&&(h.addEventListener("updatestart",function(){p.state="updatestart"}),h.addEventListener("update",function(){p.state="update"}),h.addEventListener("updateend",function(){k=!1;l&&l();p.state="updateend";r&&h.buffered.length&&(r=!1,
m.Kg.set(!0))}),h.addEventListener("error",function(){d.error("SourceBuffer event: error",g,{updating:h.updating});a.Sa(new Ib(R.Um,ic(f,P.ge,P.he)))}),h.addEventListener("abort",function(){}));a.addEventListener(sg,function(){h=null});n(m,{type:f,appendBuffer:function(a){p.data=a||[];p.state="init";p.operation="append";h[aj](a);zg&&(k=!0)},remove:function(a,b){try{qf&&(p.data=[],p.state="init",p.operation="remove",h.remove(a,b),zg&&(k=!0))}catch(c){d.error("SourceBuffer remove exception",c,g)}},
Zb:function(){return k},el:function(a){l=a},Lp:function(){try{var a=h.buffered,b,c,d,f=0;if(a)for(b=[],c=0,d=a.length,c=0;c<d;c++){var g=a.start(c),k=a.end(c),f=f+(k-g);b.push(g+"-"+k)}if(b)return{Buffered:f.toFixed(3),Ranges:b.join("|")}}catch(l){}},Qp:function(){return p}})}function sa(a){sa=p;aj=a.appendBuffer?"appendBuffer":"append";qf=!v.ko&&!!a.remove;zg=!!a.addEventListener}function Ja(a){function c(b){var d=!1,f;if(f=v.ds)f=(f=(f=a.la)&&f.errorCode)&&0<=[R.ie,R.ee].indexOf(f);f&&(d=!0);v.Eo&&
(d||(X.removeAttribute("src"),X.load&&X.load()),X.webkitDeleteKey&&X.webkitDeleteKey(W,Z));rf.revokeObjectURL(Y);if(qa&&!b)try{qa.close()}catch(g){oa.error("Exception on keysession close ",R.Pf,g)}v.tj&&X.removeEventListener("contextmenu",Ab);d||a.Za.removeChild(X);X=F=null;Y=""}function d(a){try{X&&(fa=X.currentTime)}catch(b){oa.error("Exception while getting VIDEO.currentTime",b),a&&M(R.Om,b)}return jb(1E3*fa)}function g(){T&&T.Fr&&T.Gr&&(T=k,K.B(bj))}function h(a,b,c){v.Cj&&oa.trace("KeySession update",
a&&S(a));try{if(qa){var d=qa.update(a);d&&d.then&&d.then(A).catch(function(a){oa.error("keySession update promise rejected",a);a=le(a);G(R.Rf,a)})}else X.webkitAddKey(W,a,b,c)}catch(f){oa.error("Exception calling keySession.update or addKey",f),M(R.Pm,f)}}function l(){oa.trace("Video element event: seeking");T?T.Zx=!0:G(R.Xm)}function m(){oa.trace("Video element event: seeked");T?(T.Fr=!0,g()):G(R.Wm)}function r(){T&&(T.Gr=!0,g());K.B(cj)}function t(a){oa.trace("Received event: sourceopen");vb||(vb=
!0,K.B(dj,a))}function u(a){a=fd(a,dd);oa.error("Video element event: error",a.Ze);if(na&&na.Te()&&!v.Qs){var b={ErrorCode:R.vn};n(b,cb(a.rc));na.terminate(b)}else G(R.Nm,a.rc)}function w(a){var b=fd(a,ed);oa.error("Received event: keyerror",b.Ze);na&&na.Te(a)?((a=/Chrome/.test(jc)&&1==a.systemCode&&a.errorCode&&1==a.errorCode.code)&&ua.error("SSManager , ignoring keyerror"),a||(a={ErrorCode:R.cn},n(a,cb(b.rc)),na.terminate(a))):G(R.Rf,b.rc)}function U(b){oa.trace("Received event: "+b.type);if(X){var c;
if(!ka){ka=!0;a.ta("lg");try{var d=Wk[da()];c=b.initData;c instanceof ArrayBuffer&&(c=new $a(c));d&&(c=d(c,a.Y.j.Nd));pa||!Mc||v.cs&&X.webkitGenerateKeyRequest||(X.msSetMediaKeys?(Q=new Mc(W),X.msSetMediaKeys(Q)):X.setMediaKeys?(Q=new Mc(W),X.setMediaKeys(Q)):X.webkitSetMediaKeys&&(Q=new Mc(W),X.webkitSetMediaKeys(Q)));pa&&Yb.requestMediaKeySystemAccess(W,[{initDataTypes:["cenc"],persistentState:"required",videoCapabilities:[{contentType:'video/mp4; codecs="avc1.640028"',robustness:"HW_SECURE_DECODE"},
{contentType:'video/mp4; codecs="avc1.640028"',robustness:"SW_SECURE_DECODE"}]},{initDataTypes:["cenc"],persistentState:"required"}]).then(function(a){oa.trace("supportedconfig",lb.stringify(a.getConfiguration()));return a.createMediaKeys()}).then(function(a){ta=a;return X.setMediaKeys(a)}).then(function(){var a=ta.createSession();a.addEventListener("message",y);a.addEventListener("keystatuseschange",function(a){oa.trace("Received event: "+a.type);try{a.target.keyStatuses.forEach(function(a){oa.trace("key status: "+
a);"expired"==a&&G(R.Ci);"internal-error"==a&&G(R.Mm);"output-not-allowed"==a&&G(R.Di);"output-downscaled"!=a||Ha||(Ha=!0,oa.error("output-downscaled"))})}catch(b){oa.error("Exception in iterating keystatuses",b)}});a.generateRequest(b.initDataType,c);qa=a}).catch(function(a){oa.error("Exception creating keySession",a);a=le(a);var b=R.Lm;a.g==P.Jl&&(b=R.Sf);G(b,a)})}catch(f){oa.error("Exception creating MediaKeys",f);M(R.Bi,f);return}if(!pa)try{var g;Q?g=qa=Q.createSession("video/mp4",c,null):(X.webkitGenerateKeyRequest(W,
c),g=X);g.addEventListener(E+"keyerror",w);g.addEventListener(E+"keymessage",y);g.addEventListener(E+"keyadded",A)}catch(h){oa.error("Exception generating key request",h),M(R.Sf,h)}}}}function y(b){var c=b.messageType;oa.trace("Received event: "+b.type+(c?" , "+c:""));var d=b.sessionId||qa&&qa.sessionId,f=b.message;b=da();f instanceof ArrayBuffer&&(f=new $a(f));v.Cj&&oa.trace("KeySession message",f&&S(f));if(!ma&&v.Yt){ma=!0;var g=[99,100,109,95,105,100,58],k=new $a(g.length+f.length);k.set(g,0);
k.set(f,g.length);h(k,f,d)}else if(v.Al&&Hd([8,4],f))g=Ac(v.Al),h(g,f,d);else if("fps"==b&&Hd([99,101,114,116,105,102,105,99,97,116,101],f))a.ta("scs"),kb(a,function(b){b.c?(a.ta("scr"),h(b.se,f,d)):G(R.xm,b)});else if(na&&na.Gq()&&(na.ci({c:!0,Cb:f,pc:da(),Ue:Z}),na.gi().then(function(a){a.c&&h(a.pd,a.Cb,Z)})),!Oa||v.bc&&la!==Xk){Oa=!0;try{Z=d;var l;a.Y.j.Nd.children.forEach(function(a){"pssh"==a.type&&"29701FE4-3CC7-4A34-8C5B-AE90C7439A47"==a.vd&&(l=a.data)});ea="playready"==da()?(g=Sg(f,"PlayReadyKeyMessage",
"Challenge"))?Ac(g):f:f;k={pc:da(),data:ea,ms:l};v.bc&&(la++,k.Mq=la==ej,la==Yk&&(k.Vk=!0));K.B(fj,k)}catch(q){oa.error("Exception creating license challenge",q),M(R.Qm,q)}}}function A(a){oa.trace(a?"Received event: keyadded":"addKey promised resolved");if(Za){Da||(Da=!0,K.B(gj,{Ue:Z}));var b;a:{if(v.bc&&v.Xe&&(la==ej||la==Zk))switch(da()){case "fps":b=N;break a;case "playready":b=C;break a}b=void 0}b&&ib.then(function(){ga=Ya(b,v.Xe)})}na&&na.Fq()&&na.vl()}function H(){!0===tb.hidden?zb.forEach(function(a){a.refresh();
a.qt()}):zb.forEach(function(a){a.refresh();a.At()})}function N(){h(ld("renew"));ga=k}function C(){O(qa,"removeEventListener");var b=Aa(a.Y.j.Nd),b=Pa(b),b=function(a){var b="";a.forEach(function(a){b+="<KeyID>"+a+"</KeyID>"});return new $a(pc('<PlayReadyCDMData type="LicenseAcquisition"><LicenseAcquisition version="1.0" Proactive="true"><KeyIDs>'+b+"</KeyIDs><CustomData></CustomData></LicenseAcquisition></PlayReadyCDMData>"))}([S(b)]);qa=Q.createSession("video/mp4",new $a,b);O(qa,"addEventListener");
ga=k}function G(b,c){a.Sa(new Ib(b,c,void 0))}function M(b,c){var d={g:P.Tb,C:L(c)},f;try{(f=c.message.match(/(?:[x\W\s]|^)([0-9a-f]{8})(?:[x\W\s]|$)/i)[1].toUpperCase())&&8==f.length&&(d.R=f)}catch(g){}a.Sa(new Ib(b,d))}function B(a){function c(){var f=a();b(f)&&d.Sn(f)}var d=new fe;zb.push(d);d.refresh=c;return function(){c();return d.Op()}}function ia(){zb.forEach(function(a){a.refresh()})}function ha(){if(X&&2<=X.readyState){var a=X.webkitDecodedFrameCount;if(0<a||a===k)return x.sj=ha=aa,!0}return!1}
function Ua(b){if(X){b=b.du;var c=X&&X.msGraphicsTrustStatus;c&&(b.ConstrictionActive=c.constrictionActive,b.Status=c.status);try{X&&(b.readyState=""+X.readyState,b.currentTime=""+X.currentTime)}catch(d){}for(var c=J.length,f;c--;)if(f=J[c],n(b,f.Lp(),{prefix:f.type}),v.qp&&a.la&&Xa==f.type){var g=xc(f.Qp());if(3E3>(g.data&&g.data.length)){for(var h=g.data,k=[],l=0;l<h.length;l++)k[l]=h[l];g.data=k.join();n(b,g,{prefix:f.type})}}}}function ja(){if(X)return X.getVideoPlaybackQuality&&X.getVideoPlaybackQuality()||
X.videoPlaybackQuality||X.playbackQuality}function I(b){function c(a){c=p;d.yb();b(a)}var d=new Ob(500,function(){c()});d.qc();try{var f=a.k.value.j.Nd.children.filter(function(a){return"pssh"==a.type&&"9A04F079-9840-4286-AB92-E65BE0885F95"==a.vd})[0];(new Mc(W)).createSession("video/mp4",f.Na,null).addEventListener(E+"keyerror",function(a){a=fd(a,ed);c(a.rc)})}catch(g){c()}}function O(a,b){a[b](E+"keyerror",w);a[b](E+"keymessage",y);a[b](E+"keyadded",A)}var E=La(),x=this,oa=new a.log.r("MediaPresenter"),
K=new Hb,X=mb(a.ic),J=[],F,Q,Y,T,W=v.Ve[0],qa,Z,ea,fa=0,zb=[],ga,pa,vb,ka,Oa,ma,Za,Da,la=v.bc?$k:al,na,sa=p,ib=Wd.resolve(),Ha,ta;v.bc&&v.Xe&&(ib=new Wd(function(b){sa=b;a.addEventListener(yb,b)}));v.Wd&&a.state.addListener(function(){a.state.value==ab&&(na=a.zc)});v.js&&(f(Yb.requestMediaKeySystemAccess)?pa=!0:oa.error("Promise based eme requested but platform does not support it",{browserua:jc}));n(x,{addEventListener:K.addListener,removeEventListener:K.removeListener,eu:X,Nj:d,seek:function(a){ia();
var b=d(!0);if(!(wc(b-a)<=Bh))try{oa.trace("Setting video elements currentTime",{From:Sa(b),To:Sa(a)}),T={},X.currentTime=a/1E3}catch(c){oa.error("Exception while setting VIDEO.currentTime",c),M(R.Rm,c)}},fq:function(){return!!T},addSourceBuffer:function(b){var c=new Ec(a,b,F,oa);J.push(c);b.type==Xa&&c.Kg&&c.Kg.addListener(sa);return c},endOfStream:function(){oa.trace("Calling endOfStream on mediaSource");v.wo&&F.endOfStream()},Rn:function(a){a=a.data;Za=!0;h(a,ea,Z);v.bc&&la++},sj:ha,Pg:function(){var a=
X&&X.msGraphicsTrustStatus;return!(!a||1!=a.constrictionActive)},open:function(){a.addEventListener(sh,Ua);if(hj){if(a.k.value.j.Bg){if(!bl){G(R.Ei);return}if(Mc&&Mc.isTypeSupported)try{if(!Mc.isTypeSupported(W,"video/mp4")){I(function(a){G(R.Qf,a)});return}}catch(b){M(R.Qf,b);return}}try{F=new Dd}catch(c){M(R.Hm,c);return}try{Y=rf.createObjectURL(F)}catch(d){M(R.Im,d);return}try{F.addEventListener("sourceopen",t);F.addEventListener(E+"sourceopen",t);X.addEventListener("error",u);X.addEventListener("seeking",
l);X.addEventListener("seeked",m);X.addEventListener("timeupdate",r);X.addEventListener(pa?"encrypted":E+"needkey",U);var f=a.Za,g=f.lastChild;g?f.insertBefore(X,g):f.appendChild(X);v.tj&&X.addEventListener("contextmenu",Ab);X.src=Y;gb.addListener(Ch,H);H()}catch(h){M(R.Jm,h)}}else G(R.Fi)},close:function(){if(Y)if(ia(),gb.removeListener(Ch,H),na&&Za){na.Hd();try{qa?qa.close():X.webkitCancelKeyRequest(W,Z)}catch(b){oa.error("Exception on keysession close ",R.Pf,b),na.terminate({ErrorCode:R.Pf})}"playready"==
da()&&new ei(a,Z,na);na.ce().then(c)}else c();ga&&pb(ga)},Ie:B(function(){if(X){var a=ja();return a?a.totalVideoFrames:X.webkitDecodedFrameCount}}),uc:B(function(){if(X){var a=ja();return a?a.droppedVideoFrames:X.webkitDroppedFrameCount}}),yd:B(function(){if(X){var a=ja();return a&&a.corruptedVideoFrames}}),Je:B(function(){if(X){var a=ja();return a&&jb(1E3*a.totalFrameDelay)}})})}function da(){return/widevine/i.test(v.Ve[0])?"widevine":/fps/i.test(v.Ve[0])?"fps":"playready"}function La(){return F.WebKitMediaKeys||
sf.prototype.webkitGenerateKeyRequest?"webkit":sf.prototype.msSetMediaKeys?"ms":""}function mb(a){var b;b=F.devicePixelRatio||1;b={width:cl||F.screen.width*b,height:dl||F.screen.height*b};a=a.width/a.height*b.height;var c=(b.width-a)/2;return v.jt?Ga("VIDEO","position:absolute;width:"+a+"px;height:"+b.height+"px;left:"+c+"px;top:0px"):Ga("VIDEO","position:absolute;width:100%;height:100%")}function Ab(a){a.preventDefault();return!1}function Sg(a,b){var c="",d,f=a.length,g;for(d=0;d<f;d++)g=a[d],0<
g&&(c+=el(g));f="\\s*(.*)\\s*";for(d=arguments.length-1;0<d;d--){g=arguments[d];if(0>c.search(g))return;g="(?:[^:].*:|)"+g;f="[\\s\\S]*<"+g+"[^>]*>"+f+"</"+g+">[\\s\\S]*"}if(c=c.match(new RegExp(f)))return c[1]}function kb(a,b){function c(a){var d;try{var f=a.match(/-----BEGIN CERTIFICATE-----([\s\S]*)-----END CERTIFICATE-----/)[1];if(!Za(f))throw new Ta("bad PEM");d={c:!0,se:Ac(f)}}catch(g){d={g:P.Tb,C:L(g)}}b(d)}var d=a.lb;fb.load("fpsappdata",function(a){if(a.c){a=a.data;var f=a.certificate;if(a.expiration>
Sb.Ad()){c(f);return}}d.Mg(function(a){if(a.c){var d=a.se;fb.save("fpsappdata",{certificate:d,expiration:a.xp});c(d)}else b(a)})})}function fd(a,c){var d=a.target,f=d&&d.error,g=a.errorCode,d=f&&f.code;Y(d)||(d=g&&g.code);g=f&&f.msExtendedCode;Y(g)||(g=f&&f.systemCode);Y(g)||(g=a.systemCode);f=n({},{code:d,systemCode:g},{ff:!0});d={g:c(d),C:xg(f)};g=y(g);b(g)&&(d.R=ge(g));return{rc:d,Ze:f}}function le(a){var b={};b.g=Y(a.code)?ed(a.code):P.Tb;try{var c=a.message.match(/\((\d*)\)/)[1];b.R=ge(c)}catch(d){}b.C=
L(a);return b}function Pe(a){function b(){function g(){!M&&V&&t&&(g=I,x.addEventListener(bj,f),x.addEventListener(cj,function(){f();a.fireEvent(Dh)}),oa.addEventListener("ended",function(){G.trace("Video element event: ended");f()}),oa.addEventListener("play",function(){G.trace("Video element event: play");f()}),oa.addEventListener("pause",function(){G.trace("Video element event: pause");f();a.fireEvent(Eh)}),oa.addEventListener("playing",function(){G.trace("Video element event: playing")}),C=!0,
m(),G.trace("Video element initialization complete"),a.ta("vi"),v.rj?Ya(function(){ia=!0;f()},v.rj):ia=!0,h(),Ba(f))}function h(){if(v.pj){var b=function(){a.A.value==Ub&&a.state.value==ab&&a.o.value==mc?W.qc():W.yb()};W=new Ob(v.pj,function(){N(R.Km)});a.A.addListener(b);a.o.addListener(b);a.state.addListener(b);b()}}G.trace("Video element initializing");var k=a.cd,n=a.k.value,u=k.j,p=n.j.Bg||u.Bg,V,t;oa=x.eu;x.addEventListener(dj,function(){try{X.Oa=x.addSourceBuffer(k)}catch(b){N(R.Tf,{g:P.ge,
C:L(b)});return}try{J.Oa=x.addSourceBuffer(n)}catch(c){N(R.Tf,{g:P.he,C:L(c)});return}r(k)&&r(n)&&(p?G.trace("Waiting for needkey"):G.warn("Movie is not DRM protected",{MovieId:a.sa,DownloadableId:n.J}),G.trace("Waiting for loadedmetadata"))});p?(x.addEventListener(fj,function(b){M||(G.info("Requesting license"),b.Vk||a.ta("lc"),a.lb.lh(b,function(c){G.info("Received license");if(!M)if(b.Vk||a.ta("lr"),c.c){c=c.Kq;try{x.Rn(c),G.trace("Added license")}catch(d){G.error("Exception adding license",d),
N(R.Gm)}}else N(R.Bm,c)}),a.fireEvent(rh,b))}),x.addEventListener(gj,function(b){V=!0;a.ta("ld");Ba(function(){g()});a.fireEvent(Fi,b)})):V=!0;Af(oa,function(){G.trace("Video element event: loadedmetadata");t=!0;a.ta("md");a.addEventListener(Zd,c);X.Oa.el(c);J.Oa.el(c);c();Ba(function(){g()})});gb.addListener(Lc,A,-1);a.addEventListener(yb,A,-1);a.addEventListener(Ti,d);a.paused.addListener(f);a.muted.addListener(l);a.volume.addListener(l);a.o.addListener(f);x.open();w(a.eb||0,Fh);l()}function c(){C?
f():v.Zn&&m()}function d(){var b=a.v.value-v.Xs,b=Ca(b,E);w(b,Ji)}function f(){if(!M&&C){var b=x.fq();b||m();qf||m();var c=a.o.value==mc,d=a.A.value,l=d==Ub?Q:F,q;q=h(X,l)&&h(J,l);a.paused.value||!q||!c||b||O?p():oa.ended||!ia||!K&&K!==k||(G.trace("Calling play on element"),oa.play(),K=!1);if(!b)if(O&&c&&q)x.seek(B),O=!1,qf||y(),Ba(f);else{var n=x.Nj(!0);O||b?d=Ub:oa.ended?d==Xc&&(B=a.duration,d=Kc,p()):c&&q?x.sj()?d=oa.paused?lf:Xc:qa.ob(g):d=Ub;d!=Ub&&d!=Kc&&(n<B?(b=B-n,n&&b>Bh&&(n={ElementTime:Sa(n),
MediaTime:Sa(B)},b>fl?(G.error("VIDEO.currentTime became much smaller",n),N(R.Vm)):G.warn("VIDEO.currentTime became smaller",n))):B=Ka(n,0,a.duration));a.v.set(B);t();n=d==Ub&&a.A.value==Xc;a.A.set(d,{Qw:!0});n&&(a.fireEvent(mf,{Ic:ha.Yb()>l?gl:yh}),ha.Yb()>l?ja++:S++)}}}function g(){v.Cr&&!X.Oa.Zb()&&X.Oa.appendBuffer(new $a([0,0,0,8,102,114,101,101]));f()}function h(a,b){if(!a.ad)return!0;var c=a.ue;return(c=c&&c.H)&&c.endTime-B>=b}function l(){M||(oa.volume=a.volume.value,oa.muted=a.muted.value)}
function m(){u(X);u(J);M||X.ad||J.ad||X.Oa.Zb()||J.Oa.Zb()||Y||(Y=!0,x.endOfStream())}function u(a){if(!M){var b=a.Oa,c=a.Kc;b.Zb()||(a.ue=c[c.length-1],a.Vh&&(a.Vh=!1,b.remove(0,ic(a.type,ha.cb,ha.Ab).S.endTime/1E3)));for(var d=a.ad;d&&d.media&&d.startTime-B<=T;){Y=!1;var f;a:{f=d;var g=f.media,h=f.type,k=aa[h];if(!r(g.stream)||M||k.Oa.Zb())f=void 0;else{try{var l=g.bg;G.trace("Feeding media segment to decoder",f,{Bytes:g.length});k.Oa.appendBuffer(l);k.Kc.push({H:f,stream:g.stream,i:g.i});O&&!qf||
ha.vr(f)}catch(z){G.error("Exception while appending media",f,z);N(R.Sm,ic(h,P.ge,P.he));f=void 0;break a}f=!0}}if(!f)break;d=d.next}a.ad=d;b.Zb()||(a.ue=c[c.length-1])}}function r(a){if(!a||!a.j)return!1;var b=a.type,c=aa[b];if(c.Ro!=a)try{if(c.Oa.Zb())return;var d=a.j.rq;G.trace("Feeding init segment to decoder",a,{Bytes:d.length});c.Oa.appendBuffer(d);c.Ro=a}catch(f){G.error("Exception while appending initialization segment",f,{Type:b});N(R.Tm,ic(b,P.ge,P.he));return}return!0}function p(){oa.ended||
!ia||K&&K!==k||(G.trace("Calling pause on element"),oa.pause(),K=!0)}function t(b){if(b){for(var c=aa[b],d=c.Kc,f,g;(f=d[0])&&f.H.startTime<=B;)if(B<f.H.endTime){b=ic(b,a.ec,a.Ya);ad(f,b.value)||(g=!0,b.set(f));break}else d.shift(),ha.yr(f.H);g&&!Y&&(f=(f=f.H.Ma)&&f.startTime-1,0<f&&(c=c.Oa,c.Zb()||c.remove(0,f/1E3)))}else t(rb),t(Xa)}function w(b,c){if(!M){var d=ha.Ab.hb(Ka(b,0,145152E5)),g=d.startTime;v.bs&&(g=b);var h=ha.cb.hb(g);!d.next&&d.Ma&&(d=d.Ma,g=d.startTime,h=ha.cb.hb(g));v.al&&(g+=v.al);
c==Fh&&(a.sd=g);t();var k=B;G.info("Seeking",{Requested:Sa(b),Actual:Sa(g),Cause:c});a.fireEvent(ij,{wh:k,Fk:g,Ic:c});a.A.set(Ub);X.Ih=h;J.Ih=d;y();c!=Fh&&(X.Vh=!0,J.Vh=!0);E=B=g;a.ec.set(null);a.Ya.set(null);a.v.set(B);a.Cp();a.fireEvent(Yd,{wh:k,Fk:g,Ic:c});O=!0;f()}}function y(){X.ad=X.Ih;X.Kc=[];X.ue=k;J.ad=J.Ih;J.Kc=[];J.ue=k;ha.xr()}function N(b,c){M||a.Sa(new Ib(b,c,void 0))}function A(){if(!M){G.info("Closing.");gb.removeListener(Lc,A);M=!0;try{v.pr&&(oa.volume=0,oa.muted=!0),p(),x.close()}catch(a){}}}
var G=new a.log.r("MediaPresenter"),M,C,ia,ha=a.n,B=0,ja=0,S=0,E,O,x=new Ja(a),oa,K,X={type:rb,Kc:[]},J={type:Xa,Kc:[]},aa={},F=v.Xa,Q=v.Jr,T=v.$q,Y,W,qa=new Cb(Bh);aa[rb]=X;aa[Xa]=J;try{b()}catch(Z){G.error("Exception while initializing",Z),N(R.Fm)}n(this,{seek:function(a){w(a,Ii)},He:function(){return x.Nj(!1)},Ie:x.Ie,uc:x.uc,yd:x.yd,Je:x.Je,Pg:x.Pg,tg:function(){var b=a.A.value==Ub?Q:F;return h(X,b)&&h(J,b)},Yp:function(){return{Uo:ja,tr:S}}})}function Jf(a,b,c,d,f,g,h,l,m,n){function r(b){function c(){a.state.removeListener(c);
d()}function d(){a.state.value==ab?L?w(function(a){a.c?A.info("Loaded image subtitle manager"):(A.error("Unable to load image subtitles manager",a),G=Gh,B=Mb(r));b(a)}):p(function(a){a.c?(A.trace("Entries parsed",{Length:a.entries.length},M),ja.i=a.i,G=hl):(A.error("Unable to retreive timed text track",cb(a),M,{url:a.url}),G=Gh,B=Mb(r));b(a)}):b({})}G=jj;a.state.value!=bc?d():a.state.addListener(c)}function p(b){function c(g){if(g.c)b(g);else{var h,k,l;for(l=0;l<a.F.length;l++)if(h=a.F[l],k=d[h.id],
f[h.id]>v.ql||!k)h=null;else break;h&&k?(f[h.id]=(f[h.id]||0)+1,t(k,h,c)):b(g)}}if(qa(d))t(d,k,b);else if(md.isArray(d))b({c:!0,entries:d,track:ja});else{var f={};c({c:!1})}}function t(b,c,d){A.trace("Downloading",c&&{cdn:c.id},M);var g={responseType:hh,url:b,track:ja,i:c,Db:"tt-"+f};a.xa.N(g,function(b){if(b.c){var f=a.ic;L?d({c:!0,entries:[]}):Jd(b.content,f.width/f.height,v.rl,v.sl,function(a){if(a.c){a=a.entries;var b=v.Lt;if(b){var f=0;a.forEach(function(a){a.startTime=f;a.endTime=f+=b})}d({c:!0,
entries:a,i:c,track:ja})}else a.url=g.url,d(a)})}else d(b)})}function w(b){function c(a){if(Y(a)){n.url=d[x];f.url=n.url;l[a]=(l[a]||0)+1;var z=new il(g,f);z.on("ready",function(){C=z;b({c:!0,track:ja})});z.on("error",function(d){var f={c:!1},g;for(g in d)f[g]=d[g];f.url=n.url;A.error("ImageSubtitleManager error event",f);l[a]<=v.ql?c(x):(x=h[k++])?c(x):b({c:!1,msg:"all cdns failed for image subs"})})}else b({c:!1,msg:"cdnId is not defined for image subs downloadUrl"})}var f={type:"image",zk:n.offset,
Ak:n.length,mf:a.v.value||0},g={Uj:function(){return a.ha.He()},vk:A,L:y},h=Qb.keys(d),k=0,l={};x=h[k++];c(x)}function y(b,c){A.trace("Downloading",b);var d={url:b.url,offset:b.offset,length:b.size,responseType:Bc,headers:{},i:N(x)};a.xa.N(d,function(a){A.trace("imgsub: request status "+a.c);a.c?c(null,new $a(a.content)):c({errorSubCode:a.g,errorExternalCode:a.R})})}function N(b){if(a.F)return a.F.filter(function(a){return a.id==b})[0]}var A=new a.log.r("TimedTextTrack"),G=jl,M={Bcp47:f,TrackId:b,
DownloadableId:c},B=Mb(r),L=m&&"nflx-cmisc"==m,C,x,ja={type:jh,V:b,Cf:h,th:l,Ek:m,J:c,Qa:f,displayName:g,getEntries:function(a){B(function(b){a(b)})},Ug:function(){return G},Ja:M,nk:L,Wp:function(){return C}};return ja}function Gj(a){function b(){y.start();a.A.value!=Xc&&y.stop()}function c(){M&&v.info("Deactivating",M);a.lc.set(null);y.fl(w=k);g();var b=a.Q.value;b&&"NONE"==b.V&&(b=k);b&&(v.info("Activating",b),b.getEntries(d));M=b;f()}function d(b){var c=b.track;if(c==a.Q.value){if(c.nk)b.c?(L=
c.Wp(),r("addListener"),v.info("Activated",c),a.lc.set(c),Ba(function(){L.Bc(a.ha.He())})):v.error("Failed to activate img subtitle ",b,c);else{var g=b.entries;g?(y.fl(w=g),v.info("Activated",c),a.lc.set(c)):v.error("Failed to activate",cb(b),c)}f()}}function f(){var b;a.state.value==ab&&a.A.value!=Ub&&(w?b=y.Ep():a.Q.value&&(b=t[a.Q.value.Ug()]));b&&b.startTime&&(A++,G+=y.Sg()-b.startTime,p.ne=qd(G/(A+0)));a.Zh.set(b)}function g(){L&&(L.stop(),r("removeListener"));L=k}function h(a){p.fireEvent(kl,
a);v.debug("showsubtitle",a)}function l(a){p.fireEvent(ll,a);v.debug("removesubtitle",a)}function m(){L.Bc(a.ha.He())}function n(){L.pause()}function r(b){L[b]("showsubtitle",h);L[b]("removesubtitle",l);"addListener"==b?(a.addEventListener(Dh,m),a.addEventListener(Eh,n)):(a.removeEventListener(Dh,m),a.removeEventListener(Eh,n))}var v=new a.log.r("TimedTextManager"),p=this,t={},w,y=new qc,A=0,G=0,M,B=new Hb,L;this.ne=null;p.addEventListener=B.addListener;p.removeEventListener=B.removeListener;p.fireEvent=
B.B;this.$f=function(b,c){var d="custom"+ ++ml,f=new Jf(a,d,"1",b,"xx",c||d,pd,"primary","custom",{});a.pa.push(f);a.rb.forEach(function(a){a=a.pa;0>a.indexOf(f)&&a.push(f)});a.fireEvent(kj);return f};t[jj]={Zw:!0};t[Gh]={ow:!0};a.Q.addListener(c);a.addEventListener(Wc,c);a.A.addListener(b);a.addEventListener(of,b);a.addEventListener(yb,function(){w=k;g();y.stop();f()});y.Sg=a.ha.He;y.xh=f}function Hj(a){function b(){d.ys()}var c=a.Za,d=new Bf(v.Kt),f=a.ic;d.ct(f.width/f.height);c.appendChild(d.Oj());
a.Zh.addListener(function(a){d.et(a.newValue)});a.addEventListener(yb,function(){gb.removeListener(Hh,b);c.removeChild(d.Oj())});gb.addListener(Hh,b);this.Rh=d.Rh}function Ij(a){function b(){g(a.v.value);for(var c=0,d=t.length;d--;)c+=t[d].endTime-t[d].startTime;return c}function d(a){g(a.wh);y=a.Fk;r=m=k;u&&(u.startTime=y)}function f(b){l(u,w,a.v.value);u=b.newValue?{i:b.newValue.i,track:b.newValue,startTime:a.v.value,endTime:145152E5}:k}function g(a){m&&r&&(a=ya(a,m.endTime),a=ya(a,r.endTime),l(m,
p,a),m.startTime=a,l(r,t,a),r.startTime=a,u&&(l(u,w,a),u.startTime=a),y=a)}function h(b,c,d){b&&l(b,c,ya(b.endTime,a.v.value));if(d)return b=d.H,c=d.stream,{i:d.i,track:c.track,stream:c,startTime:Ca(b.startTime,y),endTime:b.endTime}}function l(a,b,c){a&&c>=a.startTime&&(a={i:a.i,track:a.track,stream:a.stream,startTime:a.startTime,endTime:c},(c=b[b.length-1])&&c.track==a.track&&c.stream==a.stream&&c.i==a.i&&c.endTime==a.startTime?c.endTime=a.endTime:b.push(a))}var m,r,u,p=[],t=[],w=[],y=a.v.value,
H={},A=!1,B={},G=0,M=v.On,L=M.length;(function(){a.addEventListener(ij,d);a.ec.addListener(function(a){m=h(m,p,a.newValue)});a.Ya.addListener(function(a){r=h(r,t,a.newValue)});a.lc.addListener(f)})();for(H.abrdel=0;L--;)B["abrdel"+M[L]]=0,H["abrdel"+M[L]]=0;n(this,{Xg:b,Fp:function(){g(a.v.value);return{audio:pe(p,bi),video:pe(t,bi)}},cq:function(){return{total:b(),audio:pe(p,Uf),video:pe(t,Uf),timedtext:pe(w,Uf)}},Lj:function(){g(a.v.value);var b=pe(t,Jj),c,d,f=0;for(d=b.length;d--;)c=b[d],f+=c.duration;
if(!f)return 0;var h=0;for(d=b.length;d--;)c=b[d],h+=c.f*c.duration/f;H.abrdel=jb(h);return H.abrdel},Ip:function(){if(!A){for(var a=M.length,d=b();a--;){var f=M[a];if(0==B["abrdel"+f]&&d>1E3*f){for(var g=0,h=t.length,k,l=0,m=0;m<h&&!(k=t[m],g+=k.stream.f*(k.endTime-k.startTime),l+=k.endTime-k.startTime,k=k.stream.f,l>1E3*f);m++);g&&(B["abrdel"+f]=jb((g-k*(l-1E3*f))/(1E3*f)))}}0!==B["abrdel"+M[M.length-1]]&&(A=!0);c(B,function(a,b){H[a]=0==b?H.abrdel:b})}return H},Qn:function(a){G+=a},Zp:function(){return G}})}
function pe(a,b){var c=[],d,f,g={},h,k,l=a.length,m;for(m=0;m<l;m++)h=a[m],k=b(h),f=k.key,d=g[f],h=h.endTime-h.startTime,d?d.duration+=h:(delete k.key,d=k,d.duration=h,c.push(d),g[f]=d);return c}function Uf(a){var b,c=a.stream;c?(a=c.J,b=c.f):a=a.track.J;return{key:a+"$"+(b||0),downloadableId:a,bitrate:b}}function bi(a){var b=Uf(a);a=a.i.id;b.key+="$"+a;b.cdnId=a;return b}function Jj(a){a=(a=a.stream)?a.f:0;return{key:a,f:a}}function Kj(a){var b=v.Rr;if(b&&!a.fd){var c=function(){a.state.value!=ab||
a.A.value!=lf&&a.A.value!=Kc?d.yb():d.qc()},d=new Ob(b,a.Sa.bind(a,new Ib(R.ie))),f;a.A.addListener(c);a.state.addListener(c);if(v.ik){var g=ga();f=new ie(v.ik,function(){var c=ga();c-g>b&&(a.Sa(new Ib(R.ee)),f.ud());g=c});f.Sh()}a.addEventListener(yb,function(){d.yb();Y(f)&&f.ud()})}}function di(a,b,d,f,g,h,k,l){function m(a){var b;c(a,function(a,c){if(!b){var d=A[c];d?d<v.Rt+1&&(A[c]++,b={url:c,gj:a}):(A[c]=1,b={url:c,gj:a})}});return b}function u(b){t.trace("Downloading",b.url,y);a.xa.N({responseType:Bc,
i:r(b.gj),url:b.url,track:p},function(b){if(b.c)try{G=Nj(b.content),w=Ih,t.trace("TrickPlay parsed",{Images:G.images.length},y),a.fireEvent(lj)}catch(c){w=mj,t.error("TrickPlay parse failed.",c)}else w=nj,t.error("TrickPlay download failed.",cb(b),y)})}function r(b){for(var c=0;c<a.F.length;c++){var d=a.F[c];if(d&&d.id==b)return d}}var p=this,t=new a.log.r("TrickPlay"),w=nj,y={},A={},B=!0,G;n(p,{type:Di,id:b,N:function(){var a=m(l);a?(w=Jh,u(a)):B=!1},Tp:function(a){if(G&&(a=xa(a/G.j.tl),0<=a&&a<
G.images.length))return{image:G.images[a],time:a*G.j.tl,height:d,width:f,pixelAspectHeight:g,pixelAspectWidth:h}},dq:function(){return B},Ug:function(){return w},Wj:function(){switch(w){case Ih:return"downloaded";case Jh:return"loading";case nl:return"downloadfailed";case mj:return"parsefailed";default:return"notstarted"}},Ja:y,size:k})}function Lj(a){function b(){var d=a.zb,f=d.Ug();f!=Jh&&(f!=Ih&&d.dq()?(d=!1,a.Mb.Xg()<v.Tt&&(d=a.k.value.f>v.St),d&&(d=a.Rb[a.Rb.length-1],c(d.size))?a.$d.Xk="h":
(d=a.Rb[0],c(d.size)?a.$d.Xk="l":d=void 0),d&&(a.$d.offset=ga(),a.zb=d,a.zb.N())):a.removeEventListener(Zd,b))}function c(b){var d=ya(a.n.Ia(),a.n.tb());b=a.ca.ka(b);b*=1+.01*v.le[2];return b<d*v.Ut}a.$d={};a.Rb&&0<a.Rb.length&&(a.zb=a.Rb[a.Rb.length-1],a.zb&&a.addEventListener(Wc,function(){a.addEventListener(Zd,b)}))}function ci(a,b){function c(){return h===Kh}function d(a){n(a,{success:!1,state:h});n(a,O);rd.flush();w&&pb(w);y&&pb(y);A.resolve(a);B.resolve(a);G.resolve(a);M.resolve(a);h=Lh;v.Ps&&
oj.show()}function f(a,b){return Ya(function(){d({ErrorCode:R.tn,ErrorDetails:a.name+" promise expired"})},b)}var g=this,h,l,m,u=new a.log.r("SSManager"),r=new Hb,p=v.Ss,t=v.Rs,w,y,A,B,G,M,C,x,E,O={};n(g,{Hd:function(){u.trace("initiaing");A=Vf("keymessage");B=Vf("server_response");G=Vf("keyadded");M=Vf("complete");h=Kh;b&&v.$k&&("playready"==da()&&(b=S("*")),new ei(a,b,g),p=v.Vs);w=f(A,p);M.Td.then(u.info.bind(u,"complete"));C=ga();r.B(Ki)},addEventListener:r.addListener,removeEventListener:r.removeListener,
Te:function(){return h>=Kh&&h<Lh},yl:function(){return A.Td},Gq:c,ci:function(a){x=ga();O.ss_km=x-C;if(c()){h=pj;l=a.Cb;m=a.pc;var b={},d,f;"widevine"==m?(d="widevinecef",f=S(a.Cb)):"fps"==m?(d="fps",f=S(a.Cb)):"playready"==m&&(d="playreadynative",f=a.Cb);b[d+"securestop"]=f;A.resolve({c:!0,data:b});pb(w);w=k}},gi:function(){return B.Td},di:function(a){E=ga();O.ss_sr=E-x;var b="",c=B;if(h===pj){if(a.c)if("widevine"==m)try{b=ta(a.yc.securestopack.widevinecefsecureack),c.resolve({c:!0,pd:Ac(b),Cb:l}),
h=Ag}catch(g){d({ErrorCode:R.Hi,ErrorDetails:L(g)})}else if("fps"==m)c.resolve({c:!0,pd:ld("acknowledged")}),h=Ag;else{if("playready"==m)try{b=ta(a.yc.securestopack.playreadysecureack),c.resolve({c:!0,pd:Ac(b),Cb:l})}catch(k){b="";try{b=S(Nd(a.yc,"nccp","playdata"))}catch(n){}d({ErrorCode:R.Hi,ErrorDetails:L(k),Response:b})}}else b=a.g&&0<=[P.Ii,P.Uf].indexOf(a.g)?R.un:R.dn,d({ErrorCode:b,ErrorDetails:a.C||"",ErrorNccpCode:a.xd||"",ErrorSubCode:a.g||""});h==Ag&&(y=f(G,t))}},Wz:function(){return G.Td},
Fq:function(){return h===Ag},vl:function(a){O.ss_ka=ga()-E;h=Lh;var b={success:!0};Y(a)&&(b.attempts=a);n(b,O);M.resolve(b);pb(y);y=k},ce:function(){return M.Td},terminate:d})}function Vf(a){var b={},c=new Wd(function(a,c){b.resolve=a;b.reject=c});b.name=a;b.Td=c;return b}function ei(a,b,c){function d(){try{if("fps"===O)C=new Mc(x),A.webkitSetMediaKeys(C),kb(a,function(a){a.c?(J=a.se,f()):(I.error("fps certificate failed"),p(R.ln,k,a))});else if("playready"===O){C=new Mc(x);var b=w(S("*"));E=C.createSession("video/mp4",
new $a,b);t(E,"addEventListener")}else I.error("Unsupported drm type ",O),p(R.fn)}catch(c){I.error("Exception on webkitSetMediaKeys",c),p(R.pn,c)}}function f(){K++;try{E=C.createSession("keyrelease",J),t(E,"addEventListener")}catch(a){I.error("create session error",a),p(R.en,a)}}function g(a){var b=a.message;"fps"==da()?Mj(b,M).then(function(a){a?h(b):(l(ld("acknowledged")),P=!0,aa=Ya(function(){p(R.nn)},v.Us))}).catch(function(a){I.error("exception on matching persisted keysessionId",a);p(R.rn,a)}):
"playready"==da()&&(a=Sg(b,"PlayReadyKeyMessage","Challenge"),(!a||4>a.length||a.length%4)&&I.error("SecureStop challenge is invalid: "+S(b)),c.ci({c:!0,Cb:a,pc:da(),Ue:M}),c.gi().then(function(a){a.c&&l(a.pd)}))}function h(a){c.ci({c:!0,Cb:a,pc:da(),Ue:M});c.gi().then(function(a){a.c&&l(a.pd)});P=!1}function l(a){try{E&&E.update(a)}catch(b){I.error("Exception calling keySession.update ",b),p(R.qn,b)}}function m(){P?(P=!1,pb(aa),t(E,"removeEventListener"),E.close(),K<oa?f():p(R.jn)):(c.vl(K),E.close())}
function u(a){var b=fd(a,ed);I.error("Received event: keyerror",b.Ze);var d;a:{try{var f=a.target.error,g=f.code,h=f.systemCode;if("fps"==da()){if(2==g&&"560820082"==h){d=!0;break a}}else if("playready"==da()&&1==g&&-2147024637==h){d=!0;break a}}catch(l){}d=void 0}d?p(R.mn):c.Te()&&p(R.gn,k,cb(b.rc))}function r(a){a=fd(a,dd);I.error("Video element event: error",a.Ze);c.Te()&&p(R.sn,k,cb(a.rc))}function p(a,b,d){a={ErrorCode:a};b&&(a.ErrorDetails=L(b));d&&n(a,d);a.attempts=K;c.terminate(a)}function t(a,
b){a[b](y+"keyerror",u);a[b](y+"keymessage",g);a[b](y+"keyadded",m)}function w(a){return new $a(pc('<PlayReadyCDMData type="SecureStop"><SecureStop version="1.0" ><SessionID encoding="base64encoded">'+a+'</SessionID><ServerCert encoding="base64encoded">Q0hBSQAAAAEAAAUMAAAAAAAAAAJDRVJUAAAAAQAAAfwAAAFsAAEAAQAAAFhr+y4Ydms5rTmj6bCCteW2AAAAAAAAAAAAAAAJzZtwNxHterM9CAoJYOM3CF9Tj0d9KND413a+UtNzRTb/////AAAAAAAAAAAAAAAAAAAAAAABAAoAAABU8vU0ozkqocBJMVIX2K4dugAAADZodHRwOi8vbnJkcC5uY2NwLm5ldGZsaXguY29tL3Jtc2RrL3JpZ2h0c21hbmFnZXIuYXNteAAAAAABAAUAAAAMAAAAAAABAAYAAABcAAAAAQABAgAAAAAAglDQ2GehCoNSsOaaB8zstNK0cCnf1+9gX8wM+2xwLlqJ1kyokCjt3F8P2NqXHM4mEU/G1T0HBBSI3j6XpKqzgAAAAAEAAAACAAAABwAAAEgAAAAAAAAACE5ldGZsaXgAAAAAH1BsYXlSZWFkeSBNZXRlcmluZyBDZXJ0aWZpY2F0ZQAAAAAABjIwMjQ4AAAAAAEACAAAAJAAAQBAU73up7T8eJYVK4UHuKYgMQIRbo0yf27Y5EPZRPmzkx1ZDMor7Prs77CAOU9S9k0RxpxPnqUwAKRPIVCe0aX2+AAAAgBb65FSx1oKG2r8AxQjio+UrYGLhvA7KMlxJBbPXosAV/CJufnIdUMSA0DhxD2W3eRLh2vHukIL4VH9guUcEBXsQ0VSVAAAAAEAAAL8AAACbAABAAEAAABYyTlnSi+jZfRvYL0rk9sVfwAAAAAAAAAAAAAABFNh3USSkWi88BlSM6PZ2gMuceJFJ9hzz0WzuCiwF9qv/////wAAAAAAAAAAAAAAAAAAAAAAAQAFAAAADAAAAAAAAQAGAAAAYAAAAAEAAQIAAAAAAFvrkVLHWgobavwDFCOKj5StgYuG8DsoyXEkFs9eiwBX8Im5+ch1QxIDQOHEPZbd5EuHa8e6QgvhUf2C5RwQFewAAAACAAAAAQAAAAwAAAAHAAABmAAAAAAAAACATWljcm9zb2Z0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAUGxheVJlYWR5IFNMMCBNZXRlcmluZyBSb290IENBAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAMS4wLjAuMQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAIAAAAkAABAECsAomwQgNY0bm6U6Au9JRvwjbNnRzmVkZi+kg7npnRQ2T+4LgyrePBdBRQ3qb/jxXkn++4sOFa7vjRpFBzV0MMAAACAIZNYc/yJW5CLFaLPCgAHPs+FSdlhYS6BSG3mxgo2TbeHYJqj8Pm5/p6kNXKKUbx9kou+59dz/5+Q060QpP6xas=</ServerCert></SecureStop></PlayReadyCDMData>'))}
var y=La(),A=Ga("VIDEO"),B,G,M=b,C,x=v.Ve[0],O=da(),E,I=new a.log.r("SSManagerPersisted"),J,K=0,P,aa,oa=v.Ws;(function(){var b=a.Za,c=b.lastChild;c?b.insertBefore(A,c):b.appendChild(A)})();try{G=new Dd,G.addEventListener("sourceopen",d),A.addEventListener("error",r),B=rf.createObjectURL(G),A.src=B}catch(F){I.error("Exception creating MediaSource",F),p(R.kn,F)}c.ce().then(function(){try{A.removeAttribute("src"),A.load&&A.load()}catch(b){I.error("Exception clearing element context",b)}Y(B)&&rf.revokeObjectURL(B);
E&&E.close();try{a.Za.removeChild(A)}catch(c){I.error("Exception removing temporary video element from Dom",c)}A=G=null;B=""})}function Mj(a,b){return new Wd(function(c){var d=Bg(a),f;Fd(d,function(a){f=a.object.dict.string[xb];c(f==b)})})}function Nj(a){if(!a)throw new Ta("invalid array buffer");var b=new $a(a);a=new Vc(b);var c=function(a){if(a.Ha()<qj.length+4+4+4+rj)throw new Ta("array buffer too short");qj.forEach(function(b){if(b!=a.ba())throw new Ta("BIF has invalid magic.");});var b=a.Vd();
if(b>ol)throw new Ta("BIF version in unsupported");var c=a.Vd();if(0==c)throw new Ta("BIF has no frames.");var d=a.Vd(),f=a.na(rj);return{version:b,Dr:c,tl:d,fz:f}}(a);a=function(a){for(var d=[],f=0;f<=c.Dr;f++){var g,h={timestamp:a.Vd(),offset:a.Vd()};g!=k&&d.push(b.subarray(g.offset,h.offset));g=h}return d}(a);return{j:c,images:a}}function Oj(c,d,f,g,h){function l(){y.hc.addEventListener("showsubtitle",function(a){m(pl,a,!0)});y.hc.addEventListener("removesubtitle",function(a){m(ql,a,!0)})}function m(a,
b,c){b=b||{};b.target=w;B.B(a,b,!c)}function r(){r=p;y.load(function(a,b){try{m(rl,k,!0),b(va)}catch(c){b({g:P.Tb,C:L(c)})}})}function t(){H.set(y.state.value==ab&&y.A.value==Kc)}function u(){if(y.state.value==ab){for(var a,b,c;b=C.shift();)a=y.hc.$f(b.url,b.name),b.fo&&(c=a);c&&y.Q.set(c)}}var w=this,y=af(c,d,f);c=y.wg;var A=new y.log.r("VideoPlayer"),B=new Hb,H=new Wa(!1,function(){m(Mh)}),N,C=[];y.fd=g;y.af=h;(function(){y.addEventListener(of,function(){m(sj)});y.addEventListener(Zd,function(){m(tj)});
y.addEventListener(Yd,function(){m(tj)});y.paused.addListener(function(){m(Nh)});y.muted.addListener(function(){m(sl)});y.volume.addListener(function(){m(tl)});y.A.addListener(t);y.state.addListener(t);y.qe.addListener(function(a){N||y.state.value!=ab||a.newValue||(N=!0,m(ul),Ba(A.debug.bind(A,"summary ",w.getSessionSummary())));m(vl)});y.P.addListener(function(a){m(wl);a.oldValue&&a.oldValue.pa==a.newValue.pa||m(uj);Ba(function(){var a=y.P.value.pa;0<=a.indexOf(y.Q.value)||(A.info("Changing timed text track to match audio track"),
y.Q.set(a[0]))})});y.Q.addListener(function(){m(uj)});y.addEventListener(kj,function(){m(vj)});y.addEventListener(lj,function(){m(xl)});y.state.addListener(function(a){switch(a.newValue){case ab:m(yl);m(zl);m(Al);m(vj);m(wj);u();l();break;case th:y.la&&m(Bl,y.la.ai());break;case rg:m(Cl),B.Nc()}})})();n(w,{addEventListener:B.addListener,removeEventListener:B.removeListener,getElement:function(){return y.Za},prepare:function(){},load:function(){r()},close:function(a){r=p;y.close(a)},play:function(){r();
y.paused.set(!1)},pause:function(){r();y.paused.set(!0)},getPaused:function(){return y.paused.value},getMuted:function(){return y.muted.value},setMuted:function(a){y.muted.set(!!a)},getVolume:function(){return y.volume.value},setVolume:function(a){y.volume.set(Ka(a,0,1))},getEnded:function(){return H.value},getBusy:function(){var a=y.qe.value;if(a)return{networkStalled:!!a.kl,stalled:!!a.kl,progress:a.fc,progressRollback:!!a.hs}},getError:function(){var a=y.la;return a&&a.ai()},getCurrentTime:function(){return y.v.value},
getBufferedTime:function(){var a=y.n;if(a)return a.Mp()},getDuration:function(){return y.duration},seek:function(a){y.ha?y.ha.seek(a):y.eb=a},getVideoSize:function(){return y.ic?{width:y.ic.width,height:y.ic.height}:null},getAudioTrackList:function(){for(var a=[],b=0;b<y.rb.length;b++)a.push(qe(y.rb[b]));return a},getAudioTrack:function(){return qe(y.P.value)},setAudioTrack:function(a){for(var b,c=0;c<y.rb.length;c++)if(b=y.rb[c],qe(b)==a){y.P.set(b);return}A.error("Invalid setAudioTrack call")},
getTimedTextTrackList:function(){for(var a=y.P.value.pa,b=[],c=0;c<a.length;c++)b.push(qe(a[c]));return b},tryRecoverFromStall:function(){y.ae()},getTimedTextTrack:function(){return qe(y.Q.value)},setTimedTextTrack:function(a){for(var b=y.P.value.pa,c,d=0;d<b.length;d++){c=b[d];if(!a&&null==c){y.Q.set(null);return}if(qe(c)==a){A.info("Setting Timed Text, profile:"+c.Ek);y.Q.set(c);return}}A.error("Invalid setTimedTextTrack call")},setTimedTextBounds:function(a){y.$h&&y.$h.Rh(a)},getTrickPlayFrame:function(a){if(y.zb)return y.zb.Tp(a)},
getXid:function(){return y.qa},getAdditionalLogInfo:function(){return n({playerver:"2.0000.400.011",jssid:Ae,groupName:v.Me,xid:y.qa,pbi:y.index},Uc,{prefix:"pi_"})},induceError:function(a){y.Sa(new Ib(R.Kl,P.jc,a))},loadCustomTimedTextTrack:function(b,c,d){if(!a(b))throw new Ta("invalid url");C.push({url:b,name:c,fo:d});u()},diagnostics:{addEventListener:c.addEventListener,removeEventListener:c.removeEventListener,getModel:c.aq,getTime:ga,getGroups:function(){return y.jf.Up()}},getSessionSummary:function(){var a=
{},c=y.Mk;try{if(y.la&&(a.errorCode=y.la.Mc,a.errorType=c?"endplay":"startplay"),a.playdelay=y.Mk,a.xid=y.qa,a.auth=y.Gp(),a.hdr=y.Xp(),c){a.totaltime=Oa(y.Mb.Xg());a.abrdel=y.Mb.Lj();var d=y.ha,f;f=d.uc();b(f)&&(a.totdfr=f);f=d.yd();b(f)&&(a.totcfr=f);var g=d.Yp();a.rbfrs_decoder=g.Uo;a.rbfrs_network=g.tr;a.rbfrs_delay=y.Mb.Zp();a.init_vbr=y.uq;var h=Fa();Y(h)&&(a.pdltime=Fa());var k=y.Ya.value,l=k&&k.stream;l&&(a.vbr=l.f);a.bufferedTime=y.Kp()}}catch(m){A.error("error capturing session summary",
m)}return a}})}function qe(a){return a?(a.Eh=a.Eh||{trackId:a.V,bcp47:a.Qa,displayName:a.displayName,trackType:a.Cf,channels:a.jg},a.nk&&(a.Eh.isImageBased=!0),a.Eh):null}function Pj(a,b,c){function d(){p.set(!1);h()<c-1&&a.play()}function f(){p.set(!0);a.pause()}function g(){var b=h()>=c||a.getEnded();b&&a.pause();p.value?f():d();v.set(b)}function h(){return Ka(a.getCurrentTime()-b,0,c)}function k(d){a.seek(Ka(b+d,b,b+c-2E3));g()}var l=Qb.create(a),m=new Hb,r=Fb([Nh,Mh]),p=new Wa(!1,function(){m.B(Nh)}),
v=new Wa(!1,function(){m.B(Mh)});k(b||0);a.addEventListener(wj,function(){var d=a.getDuration();b=ya(d-2E3,b||0);c=ya(d-b,c||d);k(0)});a.addEventListener(sj,g);n(l,{addEventListener:function(b){(r[b]?m.addListener:a.addEventListener).apply(null,arguments)},removeEventListener:function(b){(r[b]?m.removeListener:a.removeEventListener).apply(null,arguments)},play:d,pause:f,getPaused:function(){return p.value},getEnded:function(){return v.value},getCurrentTime:h,getDuration:function(){return c},seek:k});
return l}var va={c:!0},Tg=["en-US"],Lk="hevc-dv-main10-L30-dash-cenc hevc-dv-main10-L31-dash-cenc hevc-dv-main10-L40-dash-cenc hevc-dv-main10-L41-dash-cenc hevc-dv-main10-L50-dash-cenc hevc-dv-main10-L51-dash-cenc".split(" "),Kk=["4E657466-6C69-7850-6966-665374726D21","4E657466-6C69-7848-6165-6465722E7632"],Yb=F.navigator,jc=Yb.userAgent,df=F.location,ze=F.screen,Xd=F.performance,tb=F.document,md=F.Array,Cg=md.prototype,Qj=Cg.sort,Zg=Cg.slice,hf=Cg.filter,gk=Cg.forEach,Qb=F.Object,Dg=Qb.create,Bk=
Qb.keys,Oh=F.Date,ef=Oh.now,el=F.String.fromCharCode,Jc=F.parseInt,uc=F.parseFloat,Qa=F.Math,xa=Qa.floor,qd=Qa.ceil,jb=Qa.round,Ca=Qa.max,ya=Qa.min,cf=Qa.random,wc=Qa.abs,gh=Qa.pow,Ck=Qa.sqrt,Ta=F.Error,lb=F.JSON,Eg=F.escape,$g=F.unescape,Vd=F.encodeURIComponent,hi=F.decodeURIComponent,Bi=F.XMLHttpRequest,$a=F.Uint8Array,Wd=F.Promise,rf=F.URL||F.webkitURL,sf=F.HTMLVideoElement,Dd=F.MediaSource||F.WebKitMediaSource,Mc=F.WebKitMediaKeys||F.MSMediaKeys||F.MediaKeys,rk=F.XMLSerializer,qk=F.DOMParser,
tf=F.nfCrypto||F.webkitCrypto||F.msCrypto||F.crypto,Cc=tf&&(tf.webkitSubtle||tf.subtle),Dl=F.nfCryptokeys||F.webkitCryptokeys||F.msCryptokeys||F.cryptokeys,dh,eh,Dc,Ph,xj=F.PERSISTENT,El=F.requestFileSystem||F.webkitRequestFileSystem,ek=F.Blob,oi=F.FileReader,Qh=Yb.persistentStorage||Yb.webkitPersistentStorage,Fl=Qh?k:F.storageInfo||F.webkitStorageInfo;try{dh=F.indexedDB}catch(Gl){eh=Gl||"noex"}try{Dc=F.localStorage}catch(Hl){Ph=Hl||"noex"}var Yg=/^\S+$/,ji=function(){function a(c){return b[c]}var b=
{"&":"&amp;","'":"&#39;",'"':"&quot;","<":"&lt;",">":"&gt;"},c=/[&'"<>]/g;return function(b){return b.replace(c,a)}}(),gi=function(){var a=/^\s+|\s+$/gm;return function(b){return b.replace(a,"")}}(),hk,hg,Rh,kh,pk,xk,dl,cl,Gi,yj,Uc,qi,nk,ok,ri,fh,ui,vi,jk,lk,xi,yi,mk,wi,kk,ti,Sh=/CrOS/.test(jc),zj=/OPR/.test(jc);hg=Sh?"C":zj?"O":"M";Rh=/OPR/.test(jc)?"NFCDOP-01-":/Windows NT/.test(jc)?"NFCDCH-02-":/Intel Mac OS X/.test(jc)?"NFCDCH-MC-":/CrOS/.test(jc)?"NFCDCH-01-":"NFCDCH-LX-";kh=Sh?"chromeos-cadmium":
zj?"opera-cadmium":"chrome-cadmium";yj=/CrOS/.test(jc);ri=["heaac-2-dash"];fh=["playready-h264mpl30-dash","playready-h264mpl31-dash"];Sh&&fh.push("playready-h264mpl40-dash");ui=["dfxp-ls-sdh","simplesdh","nflx-cmisc"];vi=["com.widevine.alpha"];xi=!!F.MediaSource;yi=!F.MediaSource;ti=function(a){return a};wi={MONOSPACED_SERIF:"font-family:Courier New,Arial,Helvetica;font-weight:bolder",MONOSPACED_SANS_SERIF:"font-family:Consolas,Lucida Console,Menlo,Monaco,Arial,Helvetica;font-weight:bolder",PROPORTIONAL_SERIF:"font-family:Georgia,Times New Roman,Arial,Helvetica;font-weight:bolder",
PROPORTIONAL_SANS_SERIF:"font-family:Arial,Helvetica;font-weight:bolder",CASUAL:"font-family:Gabriola,Segoe Print,Comic Sans MS,Chalkboard,Arial,Helvetica;font-weight:bolder",CURSIVE:"font-family:Lucida Handwriting,Brush Script MT,Segoe Script,Arial,Helvetica;font-weight:bolder",SMALL_CAPITALS:"font-family:Copperplate Gothic,Copperplate Gothic Bold,Copperplate,Arial,Helvetica;font-variant:small-caps;font-weight:bolder"};qi={droppedFrameRateFilterEnabled:!0,promiseBasedEme:!0};var Aj=na(),Fg;if(!(Fg=
Aj))a:{try{Yb.plugins.refresh();Fg=na();break a}catch(Vl){}Fg=void 0}var Il=Fg,Jl=!!ce("name",/Chrome Remote Desktop Viewer/i),Kl=!!ce("name",/Chromoting Viewer/i),Th;a:{try{Th=Dd.isTypeSupported('video/mp4; codecs="avc1.640028"');break a}catch(Wl){}Th=void 0}var Ll=Th,Uh;a:{try{Uh=Ga("VIDEO").canPlayType('video/mp4; codecs="avc1.640028"');break a}catch(Xl){}Uh=void 0}var Ml=Uh,Vh;a:{try{if(f(Yb.requestMediaKeySystemAccess))Ha();else{Vh=Ga("VIDEO").canPlayType('video/mp4; codecs="avc1.640028"',"com.widevine.alpha");
break a}}catch(Yl){}Vh=void 0}Uc={wvp:Aj,wvp2:Il,crdvp:Jl,cvp:Kl,itsh264:Ll,cpth264:Ml,cpth264wv:Vh};var Bj=x(10),Bg=Bj.sg,ld=Bj.Cg,fi=x(3),Ac=fi.sg,Vc=x(4),wh=x(5).ps,il=x(7);f(ArrayBuffer.prototype.slice)||(ArrayBuffer.prototype.slice=function(a,b){void 0===a&&(a=0);void 0===b&&(b=this.byteLength);a=Qa.floor(a);b=Qa.floor(b);0>a&&(a+=this.byteLength);0>b&&(b+=this.byteLength);a=Qa.min(Qa.max(0,a),this.byteLength);b=Qa.min(Qa.max(0,b),this.byteLength);if(0>=b-a)return new ArrayBuffer(0);var c=new ArrayBuffer(b-
a),d=new $a(c),f=new $a(this,a,b-a);d.set(f);return c});var nd=ef()-1,ah=0,Ae=""+(1E4*Nb()+xa(1E4*cf())),ua={addSink:function(a){De.push(a)},removeSink:function(a){De.splice(De.indexOf(a),1)},write:function(a,b,c){a={Ka:this.Ka,level:a,message:b,fields:c||{},time:ga(),index:Nl++,category:this.fj||"General"};this.xg&&(a.xg=!0);for(b=0;b<De.length;b++)De[b](a)},yp:function(a,b){this.write(ub.FATAL,a,Gc(arguments))},error:function(a,b){this.write(ub.ERROR,a,Gc(arguments))},warn:function(a,b){this.write(ub.WARN,
a,Gc(arguments))},info:function(a,b){this.write(ub.INFO,a,Gc(arguments))},trace:function(a,b){this.write(ub.TRACE,a,Gc(arguments))},debug:function(a,b){this.write(ub.DEBUG,a,Gc(arguments))},log:function(a,b){this.write(ub.DEBUG,a,Gc(arguments))}};ua.fatal=ua.yp;ua.error=ua.error;ua.warn=ua.warn;ua.info=ua.info;ua.trace=ua.trace;ua.debug=ua.debug;ua.log=ua.log;(ua.r=function(a){this.fj=a}).prototype=ua;Pc.prototype=ua;var ub={MIN:0,FATAL:0,ERROR:1,WARN:2,INFO:3,TRACE:4,DEBUG:5,MAX:5},De=[],Nl=0,Rj=
/^\w*Error$/,Tj=/[\r\n]+ */g,Sj=Fb(["Details","Exception","StackTrace"]),Uj={0:"F",1:"E",2:"W",3:"I",4:"T",5:"D"},Vj=0,gb=new Hb,Lc=1,Cd=2,Hh=3,Ch=4;Ba(function(){function a(b,d){if(c)c.on(b,d);else F.addEventListener(b,d)}var b=F.jQuery,c=b&&b(F),b=(b=F.netflix)&&b.cadmium&&b.cadmium.addBeforeUnloadHandler,d=tb.hidden;b?b(function(a){gb.B(Lc,a)}):a("beforeunload",function(a){gb.B(Lc,a)});a("keydown",function(a){gb.B(Cd,a)});a("resize",function(){gb.B(Hh)});tb.addEventListener("visibilitychange",
function(){d!==tb.hidden&&(d=tb.hidden,gb.B(Ch))})});var oj=function(){function a(){tb.body&&!c()&&(tb.body.appendChild(h),f(!0))}function b(){c()&&tb.body.removeChild(h)}function c(){return h.parentNode==tb.body}function d(){g.ob(f)}function f(a){var b=y(t.value),c=A.value?new RegExp(A.value):null,d=w.checked,g="",k,m,q=n.length;for(m=0;m<q;m++)if(k=n[m],k.level<=b&&(k=$c(k,d,d),!c||c.test(k)))g+=k+"\n";l.value="Version: 2.0000.400.011\n"+(ac?"Esn: "+ac.sc+"\n":"")+"JsSid: "+Ae+", Epoch: "+Nb()+
", Start: "+xa(nd/1E3)+", TimeZone: "+(new Oh).getTimezoneOffset()+"\nHref: "+df.href+"\nUserAgent: "+Yb.userAgent+"\n--------------------------------------------------------------------------------\n"+g;h.style.cssText=r?"position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;height:30%":"position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;bottom:10px";a&&Ba(function(){l.scrollTop=l.scrollHeight})}var g=new Cb(1E3),h=Ga("DIV","position:fixed;left:10px;top:10px;right:10px;z-index:10000;color:#000;;bottom:10px",
k,{"class":"player-log"}),l=Ga("TEXTAREA","position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.6)"),m=Ga("DIV","position:absolute;top:2px;right:2px;opacity:0.8;background-color:white"),n=[],r=!0,p;l.setAttribute("wrap","off");l.setAttribute("readonly","readonly");l.addEventListener("focus",function(){p=!0;f(!1);l.style.cssText="position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.86)"});
l.addEventListener("blur",function(){p=!1;f(!1);l.style.cssText="position:absolute;resize:none;box-sizing:border-box;width:100%;height:100%;margin:0;color:#040;font-size:11px;font-family:monospace;overflow:scroll;background-color:rgba(255,255,255,0.6)"});h.appendChild(l);h.appendChild(m);var t=Ga("SELECT",null,'<option value="1">Error</option><option value="2">Warn</option><option value="3" selected>Info</option><option value="4">Trace</option><option value="5">Debug</option>');t.addEventListener("change",
f,!1);m.appendChild(t);var w=Ga("INPUT","display:inline-block;border:1px solid black;padding:3px;");w.setAttribute("type","checkbox");w.setAttribute("checked","true");w.setAttribute("title","Details");w.addEventListener("change",f,!1);m.appendChild(w);var A=Ga("INPUT","display:inline-block;border:1px solid black;padding:3px;;width:150px");A.addEventListener("keydown",d,!1);A.addEventListener("change",d,!1);A.setAttribute("title","Filter (RegEx)");m.appendChild(A);var B=Ga("BUTTON","display:inline-block;border:1px solid black;padding:3px;",
"Update");B.addEventListener("click",f,!1);m.appendChild(B);B=Ga("BUTTON","display:inline-block;border:1px solid black;padding:3px;","Clear");B.addEventListener("click",function(){n=[];f()},!1);m.appendChild(B);B=Ga("BUTTON","display:inline-block;border:1px solid black;padding:3px;","M");B.addEventListener("click",function(){r=!r;f()},!1);m.appendChild(B);B=Ga("BUTTON","display:inline-block;border:1px solid black;padding:3px;","X");B.addEventListener("click",b,!1);m.appendChild(B);gb.addListener(Cd,
function(d){d.ctrlKey&&d.altKey&&d.shiftKey&&76==d.keyCode&&(r=!1,c()?b():a())});ua.addSink(function(a){n.push(a);v&&(a=v.Qq,0<=a&&n.length>a&&n.shift());c()&&!p?d():g.ob()});return{show:function(){r=!1;a()},dh:b,toggle:function(){r=!1;c()?b():a()}}}();ua.addSink(function(a){var b=a.level;if(!v||b<=v.Tq){a=$c(a,!0,!0);var c=F.console;1>=b?c.error(a):2>=b?c.warn(a):c.log(a)}});var Wj=0;n(fe.prototype,{Oe:!1,ed:0,Zd:0,Re:0,Fd:!1,Se:0,Sn:function(a){b(a)&&(a<this.ed&&(this.Zd+=this.ed),this.ed=a,this.Oe=
!0)},Op:function(){if(this.Oe)return this.Fd?this.Se-this.Re:this.Zd+this.ed-this.Re},qt:function(){this.Fd||(this.Oe&&(this.Se=this.Zd+this.ed),this.Fd=!0)},At:function(){this.Fd&&(this.Oe&&(this.Re+=this.Zd+this.ed-this.Se),this.Se=0,this.Fd=!1)}});Vc.prototype.Cl=function(a){a=new Vc(a);for(var b,c;;)if(b=a.Ha(),c=b>>>14)c=ya(4,c),this.hi(192|c),this.de(a,16384*c);else{128>b?this.hi(b):this.Dl(b|32768,2);this.de(a,b);break}};Vc.prototype.Tk=function(){for(var a=[],b=new Vc(a),c;;){c=this.ba();
if(c&128)if(128==(c&192))c&=63,c=(c<<8)+this.ba(),b.de(this,c);else if(c&=63,0<c&&4>=c){b.de(this,16384*c);continue}else throw new Ta("bad asn1");else b.de(this,c);break}return new $a(a)};var Xj="0123456789ABCDEF",xg,Cj;(function(){function a(b){return d[b]}var d={'"':'""',"\r":"","\n":" "},f=/["\r\n]/g,g=/[", ]/;Cj=function(c){return b(c)?c:qa(c)?c.replace(f,a):!0===c||!1===c?c:""};xg=function(a){var b=Cj,d="";c(a,function(a,c){var f=b(a)+"="+b(c);g.test(f)&&(f='"'+f+'"');d=d?d+(","+f):f});return d}})();
Ib.prototype.toString=function(){var a="[PlayerError #"+this.Mc+"]";this.C&&(a+=" "+this.C);this.we&&(a+=" (CustomMessage: "+this.we+")");return a};Ib.prototype.ai=function(){var a;this.we&&(a=["streaming_error"]);a||"80080017"==this.R&&(a=["admin_mode_not_supported","platform_error"]);if(!a)switch(this.errorCode){case R.ie:case R.ee:case R.Jf:case R.Ci:a=["pause_timeout"];break;case R.si:case R.ui:a=this.g?["platform_error"]:["multiple_tabs"];break;case R.ri:case R.qi:case R.ti:a=["should_signout_and_signin"];
break;case R.pi:case R.Fi:case R.Ei:case R.Tf:case R.Bi:a=["platform_error","plugin_error"];break;case R.Sf:a=["no_cdm","platform_error","plugin_error"];break;case R.Qf:a=this.g?["platform_error","plugin_error"]:["no_cdm","platform_error","plugin_error"];break;case R.Rf:switch(this.R){case "FFFFD000":a=["device_needs_service","platform_error"];break;case "48444350":a=["unsupported_output","platform_error"];break;case "00000024":a=["private_mode"]}break;case R.Di:a=["unsupported_output"]}!a&&he(this.g)&&
(a=["internet_connection_problem"]);if(!a)switch(this.g){case P.Vf:a=["should_upgrade"];break;case P.zi:case P.Nf:a=["should_signout_and_signin"];break;case P.Ai:a=["internet_connection_problem"];break;case P.Mi:case P.Ni:case P.Ji:a=["storage_quota"];break;case P.$m:case P.Ym:case P.bn:case P.Zm:case P.ii:a=["platform_error","plugin_error"];break;case P.Hl:case P.mi:case P.ni:a=["private_mode"]}switch(this.g){case P.oi:case P.Li:case P.Oi:case P.Uf:v.Xn&&(a=["please_call"])}a=a||[];a.push(hg+this.errorCode);
this.g&&a.push(""+this.g);a={display:{code:this.Mc,text:this.we},messageIdList:a};this.Rc&&(a.nccpActionId=this.Rc);this.Sc&&(a.mslErrorCode=this.Sc);return a};var R={jc:7001,fe:7010,Ql:7014,ri:7016,qi:7017,ti:7018,si:7020,ui:7022,gm:7029,fm:7031,cm:7041,dm:7042,em:7043,Zl:7051,Sl:7052,$l:7053,am:7054,tu:7055,wu:7056,Au:7057,Tl:7058,pi:7059,vu:7060,uu:7061,zu:7062,Ul:7063,Wl:7064,Vl:7065,Xl:7066,Yl:7067,Bu:7068,Rl:7069,xu:7081,yu:7082,bm:7083,qm:7111,sm:7113,rm:7115,um:7117,Bm:7121,xm:7123,ym:7125,
Ju:7130,Qu:7131,Ou:7133,Fm:7202,Lm:7330,Zu:7331,Ci:7332,Mm:7333,Di:7334,Fi:7351,Ei:7352,Km:7353,Qf:7354,Tf:7355,Bi:7356,Sf:7357,Qm:7358,Gm:7359,av:7360,Nm:7361,Rf:7363,Pf:7364,Om:7365,Rm:7367,Sm:7371,Tm:7373,Xm:7375,Wm:7376,Vm:7377,$u:7379,Um:7381,Pm:7385,Hm:7391,Im:7392,Jm:7393,Kl:7400,ie:7500,ee:7502,Jf:7510,tn:7600,cn:7601,vn:7602,dn:7603,Hi:7604,un:7605,hn:7620,mn:7621,jn:7622,kn:7623,pn:7624,en:7625,ln:7626,rn:7627,nn:7628,gn:7631,sn:7632,qn:7633,fn:7634},P={jc:1001,Tb:1003,Fl:1011,Gl:1013,El:1015,
ki:1101,li:1102,gd:1103,ji:1104,Mf:1105,jd:1106,bb:1107,Lf:1108,Ml:1110,ge:1203,he:1204,mm:1250,Cu:1251,Fu:1252,Du:1253,Gu:1254,Eu:1255,Il:1260,pu:1261,ku:1262,ou:1263,nu:1264,mu:1265,lu:1266,Jl:1269,Nu:1303,Cm:1305,Of:1309,Pu:1311,Ru:1312,Mu:1313,Lu:1315,Ku:1317,wm:1321,vm:1323,Dm:1331,zi:1333,Ai:1337,Su:1341,zm:1343,Am:1344,Cc:1402,ev:1403,Mi:1405,Ni:1407,Ki:1411,Li:1412,Gn:1414,Oi:1415,Ii:1417,Uf:1418,Ji:1421,Cn:1423,fv:1425,zn:1427,Bn:1429,An:1431,Dn:1432,Fn:1451,En:1453,Yu:1501,Xu:1502,Tu:1504,
Vu:1506,Uu:1508,Wu:1515,ii:1553,Hl:1555,$m:1603,Ym:1605,bn:1607,Zm:1609,dv:1625,bv:1627,cv:1629,ru:1701,Ll:1713,su:1715,qu:1721,Kf:1723,mi:1802,Pl:1803,ni:1804,Ol:1805,oi:1807,Nl:1809,Hu:1901,om:1911,xi:1913,pm:1915,vi:1931,yi:1933,wi:1935,Nf:1957,Vf:2103,Hn:2105,In:2107},vg,Vb,Gg,Wh,ii={};(function(){var a=new ua.r("loadAsync"),b=[];Vb=function(a,c){b.push({Nq:c,Io:a})};vg=Mb(function(c){function d(){var c,k,l;if(c=b.shift())try{k=c.Nq,g=l=c.Io,h.yb(),h.qc(),k(function(a){a.c?d():(a.errorCode=a.errorCode||
l,f(a))})}catch(m){a.error("Exception while loading component",m),f({errorCode:l,g:P.Fl,C:""+m})}else f(va)}function f(a){Wh=ga();f=p;h.yb();c(a)}Gg=ga();var g=0,h=new Ob(v.$n,function(){a.error("Load timed out");f({errorCode:g,g:P.Gl})});d()})})();var Yj=/^[0-9.]*$/,Zj=/^([a-fA-F0-9]*:){2}[a-fA-F0-9:.]*$/,za={};(function(){za.Qv=function(a,b){return a<b?-1:a===b?0:1};za.ug=function(a,b){return a===b};za.Vv=function(a){return null===a?"BUCKETS_NULL":za.Kd(a)?"BUCKETS_UNDEFINED":za.Bq(a)?a:a.toString()};
za.yq=function(a){return"function"===typeof a};za.Kd=function(a){return a===k};za.Bq=function(a){return"[object String]"===Qb.prototype.toString.call(a)};za.gz=function(a){return za.yq(a)?function(b,c){return-1*a(b,c)}:function(a,b){return a<b?1:a===b?0:-1}};za.Gv=function(a){return function(b,c){return 0===a(b,c)}};za.ja=function(){this.ra=this.X=null;this.Ba=0};za.ja.prototype.add=function(a,b){za.Kd(b)&&(b=this.Ba);if(0>b||b>this.Ba||za.Kd(a))return!1;var c=this.createNode(a);if(0===this.Ba)this.ra=
this.X=c;else if(b===this.Ba)this.ra=this.ra.next=c;else if(0===b)c.next=this.X,this.X=c;else{var d=this.Gk(b-1);c.next=d.next;d.next=c}this.Ba++;return!0};za.ja.prototype.first=function(){return null!==this.X?this.X.element:k};za.ja.prototype.S=function(){return null!==this.ra?this.ra.element:k};za.ja.prototype.indexOf=function(a,b){var c=b||za.ug;if(za.Kd(a))return-1;for(var d=this.X,f=0;null!==d;){if(c(d.element,a))return f;f++;d=d.next}return-1};za.ja.prototype.contains=function(a,b){return 0<=
this.indexOf(a,b)};za.ja.prototype.remove=function(a,b){var c=b||za.ug;if(1>this.Ba||za.Kd(a))return!1;for(var d=null,f=this.X;null!==f;){if(c(f.element,a))return f===this.X?(this.X=this.X.next,f===this.ra&&(this.ra=null)):(f===this.ra&&(this.ra=d),d.next=f.next,f.next=null),this.Ba--,!0;d=f;f=f.next}return!1};za.ja.prototype.clear=function(){this.ra=this.X=null;this.Ba=0};za.ja.prototype.equals=function(a,b){var c=b||za.ug;return a instanceof za.ja&&this.size()===a.size()?this.vp(this.X,a.X,c):!1};
za.ja.prototype.vp=function(a,b,c){for(;null!==a;){if(!c(a.element,b.element))return!1;a=a.next;b=b.next}return!0};za.ja.prototype.xs=function(){if(!(0>=this.Ba)){if(1===this.Ba)this.ra=this.X=null;else{var a=this.Gk(-1);null===a?this.X=this.X.next:a.next===this.ra&&(this.ra=a);null!==a&&(a.next=a.next.next)}this.Ba--}};za.ja.prototype.forEach=function(a){for(var b=this.X;null!==b&&!1!==a(b.element);)b=b.next};za.ja.prototype.reverse=function(){for(var a=null,b=this.X,c=null;null!==b;)c=b.next,b.next=
a,a=b,b=c;c=this.X;this.X=this.ra;this.ra=c};za.ja.prototype.size=function(){return this.Ba};za.ja.prototype.Gk=function(a){if(0>a||a>=this.Ba)return null;if(a===this.Ba-1)return this.ra;for(var b=this.X,c=0;c<a;c++)b=b.next;return b};za.ja.prototype.createNode=function(a){return{element:a,next:null}};za.Bb=function(){this.list=new za.ja};za.Bb.prototype.Pc=function(a){return this.list.add(a)};za.Bb.prototype.Lc=function(){if(0!==this.list.size()){var a=this.list.first();this.list.xs();return a}return k};
za.Bb.prototype.hf=function(){return 0!==this.list.size()?this.list.first():k};za.Bb.prototype.size=function(){return this.list.size()};za.Bb.prototype.contains=function(a,b){return this.list.contains(a,b)};za.Bb.prototype.clear=function(){this.list.clear()};za.Bb.prototype.forEach=function(a){this.list.forEach(a)}})();var ak=function(){function a(b){if(Za(b)){b=b.toLowerCase();if("#"==b[0]){if(7==b.length)return b;if(4==b.length)return"#"+b[1]+b[1]+b[2]+b[2]+b[3]+b[3]}return Ol[b]}}function b(a,
c,d){c=c[a];0<=c||(c=uc(a));if(0<=c)return ya(c,d)}function d(a,b){var c=a.length,f=a[c-1];if("t"===f)return uc(a)*b|0;if("s"===f)return"m"===a[c-2]?uc(a)|0:1E3*uc(a)|0;if((c=a.match(K))&&4<=c.length)return 1E3*(3600*Jc(c[1],10)+60*Jc(c[2],10)+uc(c[3]))|0;throw new Ta("dfxp-badtime");}function f(a,b,c,d,g){var h;if(a){var l=a.style;c=l?c[l]:k;d=(l=a.region)?d[l]:k;for(var m=l=g.length,n,q,u,r,p,m=0;m<l;m++)if(n=g[m],q=a[n],q===k&&c&&(q=c[n]),q===k&&d&&(q=d[n]),q!==k&&q!==b[n]){if(!h)for(h={},u=0;u<
l;u++)r=g[u],p=b[r],p!==k&&(h[r]=p);h[n]=q}}return h||b}function h(a,b,c,d,g,l,m,q,u){function r(a,h,t){var w=a[$b],y=w.style||h.style||"",D=w.region||h.region||"",A,B;y||D?(A=y+"/"+D,B=c[A]):B=b;if(!B){B=b;var V;V=xc(d);n(V,g[y]);B=v(B,V,m,q,u);c[y+"/"]=B;D&&(n(V,l[D]),n(V,g[y]),B=v(B,V,m,q,u),c[A]=B)}if(!t)a:{for(t=I.length;t--;)if(w[I[t]]!==k){t=!0;break a}t=void 0}t&&(w=f(w,h,g,l,S),B=v(B,w,m,q,u));h=(a=a[ih])&&a.length;for(y=0;y<h;y++)D=a[y],Da(D)?aa.test(D[kg])?z++:r(D,w,t):(p.push({text:D,
lineBreaks:z,style:B}),z=0)}var p=[],z=0;r(a,d,!1);0<z&&p.push({text:"",lineBreaks:z,style:b});return p}function l(a,b,c,d,f,g,h,k){var m;c&&(c=G[c]||"top",a.verticalAlignment!==c&&(a.verticalAlignment=c));d&&(c=M[d]||"left",a.horizontalAlignment!==c&&(a.horizontalAlignment=c));var n;f?((n=k[f])?(d=n.marginLeft,c=n.marginTop):(m=f.split(" "),d=w(m[0],h.x)||0,c=w(m[1],h.y)||0,n={Ua:0,marginLeft:d,marginTop:c,Un:d*b.$g+b.Cd,Wn:c*b.ei+b.Gf},30>k.Ua&&(k.Ua++,k[f]=n)),a.marginLeft=n.Un,a.marginTop=n.Wn):
(c=d=0,(n=k["default"])||(k["default"]=n={Ua:0}));g&&(f=n[g],f||(m=g.split(" "),f={Vn:(1-(d+(w(m[0],h.x)||0)))*b.$g+b.Cd,Tn:(1-(c+(w(m[1],h.y)||0)))*b.ei+b.Gf},30>n.Ua&&(n.Ua++,n[g]=f)),a.marginRight=f.Vn,a.marginBottom=f.Tn)}function m(a,b,c,d,f){var g=a.displayAlign,h=a.textAlign,k=a.origin;a=a.extent;c=xc(c);l(c,b,g,h,k,a,d,f);c.id=x++;return c}function r(c,d,f,g){var h=b(f.characterSize||d.characterSize,Pl,2)||1,k;k=(k=c.fontSize)&&F.test(k)?Ka(y(k),25,200):void 0;h*=k/100||1;k=c.textOutline;
var l,m,n;if(k&&"none"!=k){m=k.split(" ");var q;Q.test(m)?(q=0,n=c.color):(q=1,n=a(m[0]));l=t(m[q]);m=t(m[q+1])}return{characterStyle:f.characterStyle||Ql[c.fontFamily]||d.characterStyle,characterSize:h*g,characterColor:a(f.characterColor||c.color||d.characterColor),characterOpacity:b(ib(f.characterOpacity,c.opacity,d.characterOpacity),Xh,1),characterEdgeAttributes:f.characterEdgeAttributes||k&&("none"===k?Rl:m?bh:ki)||d.characterEdgeAttributes,characterEdgeColor:a(f.characterEdgeColor||n||d.characterEdgeColor),
characterEdgeWidth:l,characterEdgeBlur:m,characterItalic:"italic"===c.fontStyle,characterUnderline:"underline"===c.textDecoration,backgroundColor:a(f.backgroundColor||c.backgroundColor||d.backgroundColor),backgroundOpacity:b(ib(f.backgroundOpacity,c.opacity,d.backgroundOpacity),Xh,1)}}function v(a,b,d,f,g){b=r(b,d,f,g);var h;c(b,function(b,c){c!==a[b]&&(h||(h=Dg(a)),h[b]=c)});return h||a}function u(a,b,c,d,g,h,k,m){var n=a[$b];c=f(a[$b],b,c,g,J);b=c.region;a=n.displayAlign;c=c.textAlign;g=n.origin;
n=n.extent;b||a||c||g||n?((d=d[b])?d=Dg(d):a||g||n?(d=Dg(O),d.id=x++):d=Dg(E),l(d,h,a,c,g,n,k,m)):d=E;return d}function t(a){a=y(a);return g(a,0,100)?a:0}function w(a,b){var c=a[a.length-1];if("%"===c)return Ka(.01*uc(a),0,1);if("c"===c)return Ka(y(a)/b,0,1)}function A(a){for(var b=a.length,c=a[--b].endTime;b--;)c=ya(a[b].endTime,c);return c}function B(b){c(b,function(c,d){0<=c.toLowerCase().indexOf("color")&&(b[c]=a(d))})}function H(a,b){var c=a.extent,d=a.pixelAspectRatio,f,g,h={Cd:0,$g:1,Gf:0,
ei:1};c&&(c=c.split(" "),2<=c.length&&(d=(d||"").split(" "),f=uc(c[0])*(uc(d[0])||1),g=uc(c[1])*(uc(d[1])||1)),f=0<f&&0<g?f/g:1280/720,d=b||1280/720,c=f/d,.01<wc(d-f)&&d>=f&&(h.Cd=(1-c)/2,h.$g=c));return h}function C(a,b){var c;if(c=a.cellResolution)if(c=c.split(" "),2<=c.length){var d=y(c[0]);c=y(c[1]);if(0<d&&0<c)return{x:d,y:c}}c=a.extent;var f,g;if(c&&(c=c.split(" "),2<=c.length)){var d=y(c[0]),h=y(c[1]);if(c=a.pixelAspectRatio)c=c.split(" "),f=y(c[0]),g=y(c[1]);if(d&&h)return 1.5<d*(f||1)/(h*
(g||1))?Dj:Ej}return 1.5<b?Dj:Ej}var x=1,G={before:"top",center:"center",after:"bottom"},M={left:"left",start:"left",center:"center",right:"right",end:"right"},E={id:x++,verticalAlignment:"bottom",horizontalAlignment:"center",marginTop:.1,marginLeft:.1,marginRight:.1,marginBottom:.1},O={id:x++,verticalAlignment:"top",horizontalAlignment:"left",marginTop:0,marginLeft:0,marginRight:0,marginBottom:0},I="fontFamily fontSize fontStyle textDecoration color opacity backgroundColor textOutline".split(" "),
S=I.concat(["style","region"]),J=["region","textAlign","displayAlign","extent","origin"],K=/^([0-9]+):([0-9]+):([0-9.]+)$/,aa=/^br$/i,F=/^[0-9]{1,3}%$/,Q=/^[0-9]/;return function(c,g,l,v,t){function w(){try{for(var a;pa;)if(R=pa[$b],na.push({id:x++,startTime:d(R.begin,K),endTime:d(R.end,K),region:u(pa,ka,F,Ma,Q,U,ca,da),textNodes:h(pa,Oa,la,vb,F,Q,Ia,Z,qa)}),pa=pa[Rb],a=ef(),100<a-ma){ma=Oh.now();Db=Ya(w,1);return}}catch(b){E({g:P.Kf,C:L(b)});return}Db=Ya(G,1)}function G(){try{var a=function(a,d){for(var f,
g=[],h={},k,l=c.length;l--;)f=c[l],k=f.region.id,h[k]||(h[k]=1,g.unshift(f));(f=b[b.length-1])&&f.endTime==a&&Hd(f.blocks,g)?f.endTime=d:b.push({id:x++,startTime:a,endTime:d,blocks:g})};if(!na.length){E({c:!0,entries:[]});return}Wb(na);var b=[],c=[],d=na[0],f,g=na[0].startTime,h,k;for(h=1;c.length||d;){for(;!c.length||d&&d.startTime==g;)c.push(d),g=d.startTime,d=na[h++];f=A(c);if(!d||f<=d.startTime)for(a(g,f),g=f,k=c.length;k--;)c[k].endTime<=g&&c.splice(k,1);else a(g,d.startTime),g=d.startTime,c.push(d),
d=na[h++]}for(h=b.length;h--;)b[h].index=h,b[h].previous=b[h-1],b[h].next=b[h+1]}catch(l){E({g:P.Kf,C:L(l)});return}E({c:!0,entries:b})}function E(a){Ya(function(){M.abort=p;t(a)},1)}var M={abort:function(){Db&&pb(Db)}};try{var I=c[$b],K=1E3/(y(I.tickRate)||1),U=H(I,g),aa=n(O,{marginLeft:U.Cd,marginTop:U.Gf,marginRight:U.Cd,marginBottom:U.Gf}),F={},Q={},Ma={},R,T,Y,ha=c.head,W=c.body,ca=C(I,g),qa=1/ca.y*U.ei,Ia=n({characterStyle:"PROPORTIONAL_SANS_SERIF",characterColor:"#EBEB64",characterEdgeAttributes:bh,
characterEdgeColor:"#000000",characterSize:1},l,{ff:!0}),Z=v||{},da={Ua:0};if(ha){var ea=ha.styling;if(ea)for(Y=ea.style;Y;)R=Y[$b],B(R),F[R.id]=R,Y=Y[Rb];var fa=ha.layout;if(fa)for(var zb=fa.region;zb;){R=zb[$b];var eb=R.id;T=xc(F[R.style]);T=n(T,R);for(Y=zb.style;Y;)n(T,Y[$b]),Y=Y[Rb];B(T);Q[eb]=T;Ma[eb]=m(T,U,aa,ca,da);zb=zb[Rb]}}var ga=W.div,pa=ga.p,na=[],vb={},vb=f(W[$b],vb,F,Q,S),vb=f(ga[$b],vb,F,Q,S),ka={},ka=f(W[$b],ka,F,Q,J),ka=f(ga[$b],ka,F,Q,J),Oa=r(vb,Ia,Z,qa);n(Oa,{windowColor:a(Z.windowColor||
Ia.windowColor),windowOpacity:b(ib(Z.windowOpacity,Ia.windowOpacity),Xh,1),cellResolution:ca},{ff:!0});var la={};ga.p=k;ga[ih]=[]}catch(Za){E({g:P.Kf,C:L(Za)});return}var ma=ef(),Db;Db=Ya(w,1);return M}}(),Ql={"default":"PROPORTIONAL_SANS_SERIF",monospaceSansSerif:"MONOSPACED_SANS_SERIF",monospaceSerif:"MONOSPACED_SERIF",proportionalSansSerif:"PROPORTIONAL_SANS_SERIF",proportionalSerif:"PROPORTIONAL_SERIF",casual:"CASUAL",cursive:"CURSIVE",smallCapitals:"SMALL_CAPITALS",monospace:"MONOSPACED_SANS_SERIF",
sansSerif:"PROPORTIONAL_SANS_SERIF",serif:"PROPORTIONAL_SERIF"},Pl={SMALL:.5,MEDIUM:1,LARGE:2},Xh={NONE:0,SEMI_TRANSPARENT:.5,OPAQUE:1},Ol={black:"#000000",silver:"#c0c0c0",gray:"#808080",white:"#ffffff",maroon:"#800000",red:"#ff0000",purple:"#800080",fuchsia:"#ff00ff",magenta:"#ff00ff",green:"#00ff00",lime:"#00ff00",olive:"#808000",yellow:"#ffff00",navy:"#000080",blue:"#0000ff",teal:"#008080",aqua:"#00ffff",cyan:"#00ffff",orange:"#ffa500",pink:"#ffc0cb"},Rl="NONE",ck="RAISED",dk="DEPRESSED",ki="UNIFORM",
bh="DROP_SHADOW",Ej={x:40,y:19},Dj={x:52,y:19},bk=10,ch={"class":"player-timedtext-text-container"},Yh;Vb(R.Zl,function(a){function b(){Qh?Qh.requestQuota(g,c,d):Fl.requestQuota(xj,g,c,d)}function c(d){d>=g?(Yh=d,a(va)):h?(f.error("Quota request granted insufficent bytes"),a({g:P.Ni})):(h=!0,b())}function d(){f.error("Request quota error");a({g:P.Mi})}var f=new ua.r("RequestQuota"),g=v.Bt,h;0<g?b():(Yh=0,a(va))});var li;Vb(R.Sl,function(a){var b=new ua.r("FileSystem");"fs"!=v.ml?a(va):El(xj,Yh,function(b){li=
b;a(va)},function(){b.error("Error calling requestFileSystem");a({g:P.Ji})})});var ni={},mi={create:!0},fk={create:!0,exclusive:!0},fb;Vb(R.$l,function(a){var b;switch(v.ml){case "fs":b=Me;break;case "idb":b=ke;break;case "none":b=Og}b(function(b){b.c?(fb=b.Xh,a(va)):a(b)})});var $d;Vb(R.am,function(a){function b(){b=p;var a=qb(d,v.Pq);gb.addListener(Lc,function(b){b&&b.isPopStateEvent?f.trace("popstate event, Lock timers can stay"):(c(h,function(a,b){Dc.removeItem(b.xc)}),wb(a))},-1)}function d(){var a=
Nb();c(h,function(b,c){Dc.setItem(c.xc,a)})}var f=new ua.r("StorageLock"),h={};$d={Si:function(a,c){function d(){Dc.setItem(l,k);var a={xc:l};h[l]=a;f.trace("Lock acquired",{Name:a.xc});c({c:!0,Ye:a})}if(Dc){b();var k=Nb(),l="lock-"+a;try{if(l in Dc){var m=y(Dc.getItem(l)),n;g(m,0,void 0)&&(n=m);1E3*wc(k-n)<v.Oq?c({c:!1}):(f.error("Lock was expired or invalid, ignoring",{Epoch:k,LockEpoch:n}),d())}else d()}catch(q){f.error("Error acquiring Lock",q),c({g:P.Tb,C:L(q)})}}else Ph?c({g:P.En,C:L(Ph)}):
c({g:P.Fn})},ws:function(a,b){if(Dc){try{Dc.removeItem(a.xc),delete h[a.xc],f.trace("Lock released",{Name:a.xc})}catch(c){f.error("Unable to release Lock",{Name:a.xc},c)}b&&b(va)}}};v.up?$d.Si("session",function(b){$d.dl=b;a(va)}):a(va)});Vb(R.bm,function(a){Ed()?Cc&&Cc.generateKey&&Cc.importKey&&Cc.unwrapKey?"PSK"!=v.eg&&"MGK"!=v.eg||Dl?(fc("wcs"),Bb(Cc.generateKey({name:"AES-CBC",length:128},!0,["encrypt","decrypt"])).then(function(){fc("wcdone");a(va)},function(b){b=""+b;var c;0<=b.indexOf("missing crypto.subtle")?
c=P.Vf:0<=b.indexOf("timeout waiting for iframe to load")&&(c=P.In);a({g:c,C:b})})):a({g:P.Hn}):a({g:P.Vf}):a(va)});var v,ig,vh;Vb(R.Tl,function(a){var b=v.Vq,c=-6/(b-2-2);if(g(b,1)){var d=[],f=xa(ga()/1E3);qb(function(){var a=xa(ga()/1E3);if(a!=f){for(var b=ya(a-f,30);b--;)d.push(0);(b=Ca(d.length-31,0))&&d.splice(0,b);f=a}d[d.length-1]++},1E3/b);vh={Vp:function(){for(var a=[],f=d.length-1;f--;){var g=d[f];a.unshift(0>=g?9:1>=g?8:g>=b-1?0:jb((g-2)*c+7))}return a}}}a(va)});var ac,zi=/^(SDK-|SLW32-|SLW64-|SLMAC-|.{10})([A-Z0-9-=]{4,})$/,
jg;Vb(R.pi,function(a){function b(g){Za(g)&&Za(c)?(ac=new Qg(g,c,d,f),fc("devdone"),a(va)):a({g:P.ii})}var c=Rh,d,f,g=new ua.r("Device");fc("devs");fb.load("deviceid",function(d){function h(){fb.save("deviceid",l,!1,function(d){d.c?b(c+l):a(d)})}var l;d.c&&(l=d.data);Za(l)?(f="storage",b(c+l)):d.g==P.Cc?v.Fg&&Ff()?gc(function(a){a.c?(l=a.content,f="downloaded from server"):(g.error("Error downloading esn",cb(a)),f="generated: error downloading",l=Ge());h()}):(f="generated: "+(v.Fg?"netflix id not device bound":
"no config esnurl"),l=Ge(),h()):(d.c=k,a(d))})});var od=function(){function b(){f.B(Sl);f.B(Ce)}function c(){f.B(Zh);f.B(Ce)}var d=new ua.r("Http"),f=new Hb,g=0;Vb(R.fe,function(a){v.Zt&&(F.addEventListener("online",b),F.addEventListener("offline",c),td=Ld);a(va)});return{addEventListener:f.addListener,removeEventListener:f.removeListener,N:function(b,c,h){function l(){J&&(pb(J),J=null);J=Ya(h?z:t,S?E:x)}function m(){m=p;J&&(pb(J),J=null);f.removeListener(Zh,r);O&&(O.onreadystatechange=null,O.onprogress=
null,O.onerror=null,O.onload=null,O.onabort=null);I.c?(b.i&&(b.i.Jq=ga()),y.trace("Download success",A)):(b.i&&(b.i.Tw=ga()),I.g!=P.bb?y.warn("Download failed",A,cb(I)):y.trace("Download aborted",A));var a=B;B=k;for(var c=a.length;c--;)(function(){var b=a[c];Ba(function(){b(I)})})();f.B(Tl,I,!0)}function n(a,b,c){I.c=!1;I.g=a;a=ga();I.D.O=I.D.O||a;I.D.M=I.D.M||a;0<b&&(I.Ga=I.R=b);c&&(I.C=c);m()}function r(){td()||(n(P.ji),O.abort())}function t(){n(S?P.jd:P.Mf);O.abort()}function z(){I.c===k&&(h.Ik++,
h.Ur.ping(h))}function w(a){n(P.bb);try{!a&&O&&O.abort()}catch(b){}}var y=b.Ka&&b.Ka.log&&new b.Ka.log.r("Http")||d,A={Num:g++},B=[c],C={requestTime:ga()},V,x=b.Vb||v.Vb,E=b.Pd||v.Pd,I=function(){var a=p,c=p;return{L:b,type:b.responseType,D:C,abort:w,timeout:t,Ti:function(a){m!==p&&B&&B.unshift(a)},Jk:function(b){a(b)},ay:function(a){c(a)},wz:function(b){a=b},vz:function(a){c=a}}}();h&&(h.stream=b.stream,h.H=b.za[0],h.Ft=l,h.Ij=t);var O,S,J;f.B(Ul,I,!0);Ba(function(){if(a(b.url))try{Gf(b,I),V=I.url,
A.Url=V,td()?(y.trace("Download starting",A),O=new Bi,O.onreadystatechange=function(){if(2==O.readyState){S=!0;C.O=ga();O.onreadystatechange=null;l();for(var a=I,c=O.getAllResponseHeaders().split("\n"),d=c.length,f,g,h={};d--;)if(f=c[d])g=f.indexOf(": "),1<=g&&g<f.length-1&&(h[f.substr(0,g)]=f.substr(g+2));a.headers=h;v.$&&I.Jk({timestamp:C.O,connect:!0,mediaRequest:b,start:C.requestTime,rt:[C.O-C.requestTime]})}},O.onprogress=function(a){S=!0;C.aa=a.loaded;l();v.$&&(a={mediaRequest:b,bytes:a.loaded,
tempstamp:ga()},I.Jk(a))},O.onload=function(){if(m!==p){var a;C.M=ga();C.O=C.O||C.M;if(200<=O.status&&299>=O.status)if(a=hc(O,I),b.dc)try{I.content=b.dc(a,I),I.c=!0,v.$&&(I.parsed=!0,I.Na=a)}catch(c){y.warn("Exception parsing response",c,A),n(P.Lf,k,L(c))}else v.$&&(I.parsed=!1),I.content=a,I.c=!0;else n(P.gd,O.status);m()}},O.onabort=w,O.onerror=function(){0<O.status?n(P.gd,O.status):n(P.ki)},Ne(O,V,!1,b),l(),f.addListener(Zh,r)):Ba(n.bind(k,P.ji))}catch(c){y.error("Exception starting download",
c,A),n(P.li)}else n(P.Ml)});return I}}}(),td=aa,Ul=1,Tl=2,Sl=3,Zh=4,Ce=5,hh=1,Ai=2,Bc=3,$b="$attributes",ih="$children",kg="$name",xb="$text",tk="$parent",Rb="$sibling",sk=1,uk=3,vk=4,wk=9,ae;Vb(R.Ul,function(a){function b(f){g({esn:ac.sc,esnPrefix:ac.Ej,authenticationType:v.eg,authenticationKeyNames:v.co,systemKeyWrapFormat:v.It,serverIdentityId:"MSL_TRUSTED_NETWORK_SERVER_KEY",serverIdentityKeyData:B,storeState:f,notifyMilestone:fc,log:u},{result:function(a){c(a)},timeout:function(){a({g:P.xi})},
error:function(b){a(d(P.xi,k,b))}})}function c(b){function f(){A&&fb.save(p,k,!1,function(a){a.c||u.error("Error persisting msl store",cb(a))})}var g=new Cb(100),k,m=h.extend({init:function(a){this.Qi=a},getResponse:function(a,b,c){b=this.Qi;var d=b.Od.gh||d;a=pa(a.body)?Bg(a.body):a.body;a={url:b.url,zh:a,withCredentials:!0,Db:"nccp-"+b.df};b=this.Qi.timeout;a.Vb=b;a.Pd=b;var f=d.N(a,function(a){try{if(a.c)c.result({body:a.content});else throw n(new l("HTTP error, SubCode: "+a.g+(a.Ga?", HttpCode: "+
a.Ga:"")),{cadmiumResponse:a});}catch(b){c.error(b)}});return{abort:function(){f.abort()}}}});r&&b.addEventHandler("shouldpersist",function(a){k=a.storeState;g.ob(f)});ae={send:function(a,c){var f=a.Od,g=f.W,h=g&&Se(g),k={nccpMethod:a.df,nonReplayable:a.Hk,encrypted:a.Dj,userId:a.wl,body:a.body,serviceTokens:a.wf,timeout:2*a.timeout,httpLocation:new m(a),allowTokenRefresh:A};f.Bj?(k.email=f.Bj,k.password=f.Qr||""):f.ia?(k.netflixId=f.ia,k.secureNetflixId=f.$a):f.xk?(k.mdxControllerToken=f.xk,k.mdxPin=
f.gr,k.mdxNonce=f.fr,k.mdxEncryptedPinB64=f.er,k.mdxSignature=f.hr):w&&h&&h.mk?(f=h.Wc(),k.netflixId=f.ia,k.secureNetflixId=f.$a):h&&(k.getIdCookies=function(){var a=h.Wc();return{netflixId:a.ia,secureNetflixId:a.$a}});b.send(k,{result:function(a){w&&k.netflixId&&(w=!1);c({c:!0,body:a.body,wf:a.serviceTokens})},timeout:function(){c({g:P.yi})},error:function(a){var f=b.isErrorReauth(a)?P.Nf:b.isErrorHeader(a)?P.wi:P.vi,g=b.getErrorCode(a);c(d(f,g,a))}})},so:function(a,c){b.buildPlayDataRequest({nccpMethod:a.df,
nonReplayable:a.Hk,encrypted:a.Dj,userId:a.wl,body:a.body,serviceTokens:a.wf,timeout:a.timeout,allowTokenRefresh:!1},{result:function(a){c({c:!0,body:a})},timeout:function(){c({g:P.yi})},error:function(a){var f=b.isErrorReauth(a)?P.Nf:b.isErrorHeader(a)?P.wi:P.vi,g=b.getErrorCode(a);c(d(f,g,a))}})},rh:b};a(va)}function d(a,b,c){var f,g;a={g:a,Sc:b};if(c){if(f=c.cadmiumResponse)return f;f=c.errorMessage||""+c;if(g=c.stack)g=""+g,f=0<=g.indexOf(f)?g:f+g;g=y(c.internalCode)||y(c.error&&c.error.internalCode)}f&&
(a.C=f);g&&(a.R=g);return a}if(Ed())if(tf&&Cc&&Cc.unwrapKey){try{var f=F.netflix.msl,g=f.createMslClient,h=f.IHttpLocation,l=f.MslIoException}catch(m){a({g:P.om});return}var u=new ua.r("Msl"),f=v.nr,r=v.or,p=v.De?"mslstoretest":"mslstore",t=$d.dl,w=!0,A=!t||t.c,B=Ac(v.De?"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAm84o+RfF7KdJgbE6lggYAdUxOArfgCsGCq33+kwAK/Jmf3VnNo1NOGlRpLQUFAqYRqG29u4wl8fH0YCn0v8JNjrxPWP83Hf5Xdnh7dHHwHSMc0LxA2MyYlGzn3jOF5dG/3EUmUKPEjK/SKnxeKfNRKBWnm0K1rzCmMUpiZz1pxgEB/cIJow6FrDAt2Djt4L1u6sJ/FOy/zA1Hf4mZhytgabDfapxAzsks+HF9rMr3wXW5lSP6y2lM+gjjX/bjqMLJQ6iqDi6++7ScBh0oNHmgUxsSFE3aBRBaCL1kz0HOYJe26UqJqMLQ71SwvjgM+KnxZvKa1ZHzQ+7vFTwE7+yxwIDAQAB":
"MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAlibeiUhffUDs6QqZiB+jXH/MNgITf7OOcMzuSv4G3JysWkc0aPbT3vkCVaxdjNtw50zo2Si8I24z3/ggS3wZaF//lJ/jgA70siIL6J8kBt8zy3x+tup4Dc0QZH0k1oxzQxM90FB5x+UP0hORqQEUYZCGZ9RbZ/WNV70TAmFkjmckutWN9DtR6WUdAQWr0HxsxI9R05nz5qU2530AfQ95h+WGZqnRoG0W6xO1X05scyscNQg0PNCy3nfKBG+E6uIl5JB4dpc9cgSNgkfAIeuPURhpD0jHkJ/+4ytpdsXAGmwYmoJcCSE1TJyYYoExuoaE8gLFeM01xXK5VINU7/eWjQIDAQAB");f?fb.remove(p,function(){b()}):r?fb.load(p,function(c){c.c?b(c.data):c.g==P.Cc?b():(u.error("Error loading msl store",
cb(c)),fb.remove(p,function(c){c.c?b():a(c)}))}):b()}else a({g:P.pm});else a(va)});Vb(R.Rl,function(a){var b=v.De,c;c=b?"browsertest":"browser";b=new Kf(c,b?"NetflixIdTest":"NetflixId",b?"SecureNetflixIdTest":"SecureNetflixId");gf=lg[c]=b;a(va)});ne.prototype={Tc:!1,Gh:!1,We:0,je:Tg,Vg:function(){return"acc-"+this.W},load:function(a){var b=this,c=b.W;fb.load(b.Vg(),function(d){var f;d.c&&(f=d.data);f&&(b.Tc=!0,b.We=f.lastAccessTime||0,b.je=f.UILanguages||Tg,b.ia=f.netflixId,b.$a=f.secureNetflixId,
b.uo=f.cTicket,b.vo=y(f.cTicketExpiration)||0,b.Iq=f.keyPairHash,b.Br=f.nrdpStorage,ae&&(b.Gh=!!ae.rh.hasUserIdToken(c)));a(va)})},save:function(){this.Tc=!0;fb.save(this.Vg(),{lastAccessTime:this.We,UILanguages:this.je,netflixId:this.ia,secureNetflixId:this.$a,cTicket:this.uo,cTicketExpiration:this.vo,keyPairHash:this.Iq,nrdpStorage:this.Br})},remove:function(a){var b=this,d=b.W;fb.remove(b.Vg(),function(){var f=[];c(b,function(a){f.push(a)});for(var g=f.length;g--;)delete b[f[g]];b.W=d;ae&&ae.rh.removeUserIdToken(d);
a(va)})},Wc:function(){return{ia:this.ia,$a:this.$a}},gl:p,Do:p};var lg={},Ci={},gf,Lb;Vb(R.Wl,function(a){fb.load("deviceparameters",function(b){function c(a,b,f,h){a=d[a];return g(a,f,h)?a:b}var d={};b.c&&(d=b.data);Lb={Mh:c("servertimeoffset",0,k,k),sf:c("retrycontrol",3,0,1E3),cf:c("mintimeout",59,0,1E3),mh:c("loginterval",60,0,1E3),ph:c("maxlogsize",2E6,100,1E9),$e:d.loglevel||"error",Lh:!!d.sendheartbeats,Dd:c("heartbeatinterval",60,1,1E3),vh:function(){vc.B(uf);fb.save("deviceparameters",{servertimeoffset:Lb.Mh,
retrycontrol:Lb.sf,mintimeout:Lb.cf,loginterval:Lb.mh,maxlogsize:Lb.ph,loglevel:Lb.$e,sendheartbeats:Lb.Lh,heartbeatinterval:Lb.Dd})}};a(va)})});var Sb;Vb(R.Vl,function(a){var b=v.cc;(new ua.r("Nccp")).info("Creating NCCP instance",{Url:b.oc,Version:b.Dh,Msl:Ed()});Ed()?(Sb=new Re(b,Lb,ae,ac),a(va)):a({g:P.El})});var vc=new Hb,zk="resume",Ak="suspend",Bd="interval",uf=1,nh=4,rd;Vb(R.Xl,function(a){function b(){var a={browserua:jc,browserhref:df.href,browserdm:""+tb.documentMode,initstart:Gg,initdelay:Wh-
Gg};$f(a);var d=Xd&&Xd.timing;d&&v.Sq.map(function(b){var c=d[b];c&&(a["pt_"+b]=c-nd)});var f=new Rd(ug&&ug.Ka,"startup","info",a);c(f)}function c(a){m.push(a);Ba(function(){vc.B(3,{Rq:a});for(var b=m,c=b.length,f=c*r;c--;)f+=b[c].Mj().length;f>Lb.ph?d():h()})}function d(a,b){b=b||p;if(m.length||a){g();vc.B(nh);var c=m;m=[];Sb.Uq(c,{gh:od,log:new ua.r("Nccp"),W:gf.W},b)}else b(va);h()}function f(){var a=Lb.mh;t!=a&&(t=a,g(),h())}function g(){n&&(pb(n),n=null)}function h(){n||(n=Ya(k,1E3*t))}function k(){g();
d()}var l=new ua.r("NccpLogBatcher"),m=[],n,r,t;l.xg=!0;r=33+ac.sc.length;vc.addListener(uf,f);f();vg(function(){Ba(b)});rd={Sk:c,flush:function(a,b){l.trace("Flushing");g();vc.B(2);Ba(function(){d(a,b)})}};a(va)});(function(){function a(b){l.push(b)}function b(){vc.removeListener(uf,b);vc.removeListener(2,c);ua.removeSink(a);ua.addSink(f);d()}function c(){g=v.cc.Fe?ub[v.cc.Fe]:h[Lb.$e];d()}function d(){var a=l;l=[];for(var b=a.length,c=0;c<b;c++)f(a[c])}function f(a){if(!a.xg&&a.level<=g){var b=
{debugMessage:a.message,debugCategory:a.category};n(b,a.fields,{prefix:"debug"});a=new Rd(a.Ka,"debug",k[a.level],b);rd.Sk(a)}}var g,h={fatal:ub.FATAL,error:ub.ERROR,warn:ub.WARN,info:ub.INFO,debug:ub.DEBUG},k={};k[ub.FATAL]="fatal";k[ub.ERROR]="error";k[ub.WARN]="warn";k[ub.INFO]="info";k[ub.TRACE]="debug";k[ub.DEBUG]="debug";var l=[];ua.addSink(a);vc.addListener(uf,function(){g=v.cc.Fe?ub[v.cc.Fe]:h[Lb.$e]});vc.addListener(uf,b);vc.addListener(2,c)})();var pd="PRIMARY",jf={assistive:"ASSISTIVE",
closedcaptions:"ASSISTIVE",directorscommentary:"COMMENTARY",comentary:"COMMENTARY",subtitles:pd,primary:pd};Rd.prototype.Mj=function(){this.Pi||(this.Pi=xg(this.data));return this.Pi};var kc=1,ng=2,Tb=4,og=8,kf=16,lh=32,mh=64,Be,oh;Vb(R.Yl,function(a){var b=new ua.r("PlayDataManager");v.vf&&v.bd?fb.load(v.bd,function(c){if(c.c){var d=c.data,f;try{f=lb.parse(d)}catch(g){}}f?(Be=f,sd.length||Ye(k,function(a){a.c&&jd()})):c.g!=P.Cc&&(b.error("Unable to parse persisted playdata"),jd());a(va)}):a(va)});
var Li="HistoricalBandwidth",Ni="none",Dk="dayOfWeekTimeOfDay",Mi="timeofDay",qg;gd.prototype={Fb:function(){},Aa:function(){},Da:function(){},Hb:function(){}};var Oi=[];sc(function(a){function b(a){if(a.lower&&a.height>O)return a.height>=l()}function d(){var b=a.A.value==Xc&&a.state.value==ab;S?b||(wb(S),I=S=k,J&&(wb(P),P=k)):b&&(S=qb(f,1E3),J&&(P=qb(g,K)))}function f(){var b=a.Ya.value,b=(b=b&&b.stream)&&b.height;if(0<b){var c=ga(),d=a.ha.uc();if(I&&2E3>c-I.time&&b==I.height){var g=d-I.fp,h=p[b];
h||(p[b]=h=[],b>O&&(C.push(b),B(C)));0<g&&!(E<b)&&(E=b);h.push(g);h.length>L&&h.shift();(h=w[b])||(w[b]=h={});var k=h[g];h[g]=k?k+1:1}I={time:c,fp:d,height:b};a.jf.dt(p)}}function g(){fb.save($h,{xid:a.qa,data:w})}function h(){a.addEventListener(yb,function(){g()});A=[];fb.load(Fj,function(a){a.c&&(A=a.data);var b={};fb.load($h,function(a){a.c&&(b=a.data);b&&b.data&&Qb.keys(b.data).length&&(A.push(b),A.length>J&&A.shift(),fb.save(Fj,A),fb.save($h,{}))})})}function l(){!F&&v.Aj&&v.Be&&a.te<v.Aj[aa]&&
(x=ya(x,v.Be),a.pe.set({reason:"droppedFramesPreviousSession",height:v.Be}));F=!0;if(E){var b=C.length,c,d,f;for(c=0;c<b;c++)if(d=C[c],d>=E&&d<x&&(f=p[d])&&oe(t,f)&&x!=d)return r.warn("Restricting resolution due to high number of dropped frames",{MaxHeight:d}),a.pe.set({reason:"droppedFrames",height:d}),v.kp?(a.T.lg(function(a){return a.pf.k.height>=d}),Ba(a.n.bp)):Ba(a.n.ve),v.Be=x=d;E=k}return x}function m(){var a={};w&&C.forEach(function(b){var d=w[b];if(d){var f=0,g=0;c(d,function(a,b){g+=y(a);
f+=b});a[b]=g/f}});return a}function n(a){var b={};a.forEach(function(a){b[a]={}});w&&(B(a),C.forEach(function(d){var f=w[d];if(f){var g=0,h=0;c(f,function(a,b){g+=b});var k=Qb.keys(f);B(k);for(var l=k.length-1,m=k[l],n=a.length-1;0<=n;n--){for(var q=a[n];m>=q&&0<=l;)(m=f[m])&&(h+=m),m=k[--l];b[q][d]=jb(h/g*100)}}}));return b}var r=new a.log.r("DFF"),p={},t=v.jp,w={},A=[],C=[],I,L=v.hp,O=v.ip,x=1E5,E,S,J=v.np,K=v.mp,P,aa=Yb.hardwareConcurrency||0,F;if(v.gp)return J&&a.addEventListener(mg,h),a.wd=
{Jp:m,bq:n},a.state.addListener(d),a.A.addListener(d),{Ig:"df",Ac:b}});var Fj="DroppedFramesHistory",$h="DroppedFramesSession";sc(function(a){return{Ig:"op",Ac:function(b){if(b=b.jh){var c=a.ha;if(c&&c.Pg())return b}}}});yj&&sc(tc);var ph=12.8,qh=5120,Gk=1,Hk=2E3,Fk=.8,Ek=10,Pi=1024;Tc.prototype={Fb:function(){return this.P.value.U},Aa:function(){return this.Sb.value.U},Da:function(){var a=this;return a.Aa().filter(function(b){return!a.bf.Ac(b)})},Hb:function(){var a=this.Zc;return a?ga()-a:0}};var Ik=
0,sd=[],Ri=[],Si=[],uh=1,wg=3,ug,tg=1E4*Nb()+xa(1E4*cf()),Hi=tg,of=1,yb=2,mf=3,ij=4,Yd=5,Wc=6,mg=7,Ei=8,sg=9,yk=10,kj=11,sh=12,Qi=13,lj=14,Fi=15,ff=21,ye=22,Zd=30,Ti=31,pg=41,rh=51,Eh=52,Dh=53,yh="network",gl="media",Fh=1,Ii=2,Ji=3,nf=0,bc=1,ab=2,th=3,rg=4,mc=1,cc=2,lc=3,Ub=1,Xc=2,lf=3,Kc=4,Jk="playback";Ic(uh,function(a){function b(c){if(c.newValue>=bc){a.state.removeListener(b);var d;try{var f=""+Nb();Dc.setItem("player$test",f);var h=Dc.getItem("player$test");Dc.removeItem("player$test");d=f==
h?"success":"mism"}catch(k){d="ex: "+k}c="type=openplay&sev=info&locstor="+Eg(d)+"&browserdm=";var m;try{m=""+tb.documentMode}catch(n){m="ex: "+n}l(c+Eg(m));w=ga();g()}}function d(){k("type=startplay&sev=info&outcome=success")}function f(){var b=a.la;if(b){var d="type=startplay&sev=error&outcome=error",g={};Sd(g,b);c(g,function(a,b){d+="&"+Eg(a)+"="+Eg(b||"")});k(d)}else k("type=startplay&sev=info&outcome=abort")}function g(){var a=y.shift();if(0<a){var b=Ca(a-(ga()-w),0);t=Ya(function(){l("type=startstall&sev=info&kt="+
a);g()},b)}}function h(){k("type=startplay&sev=info&outcome=unload")}function k(b){k=p;b+="&initstart="+Gg+"&initend="+Wh;l(b);pb(t);a.removeEventListener(Wc,d);a.removeEventListener(yb,f);gb.removeListener(Lc,h)}function l(b){b=A+"&jsoffms="+ga()+"&soffms="+a.Hb()+"&do="+Yb.onLine+"&"+b+"&"+ea(n({},ii,{prefix:"im_"}))+"&"+ea(n({},a.kb,{prefix:"sm_"}));m.N({url:r,zh:b,withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded"},Db:"track"},p)}var m=a.xa,r=v.Pt,t,w,y=v.Ot.slice(),
A;if(v.Nt&&r){A="cat=cadplayback&dev="+Vd(kh)+"&ep="+Vd(Rh)+"&ver="+Vd("2.0000.400.011")+"&jssid="+Ae+"&xid="+a.qa+"&pbi="+a.index+"&groupName="+Vd(v.Me);if(Uc){var B=n({},Uc,{prefix:"pi_"});A+="&"+ea(B)}a.state.addListener(b);a.addEventListener(Wc,d);a.addEventListener(yb,f);gb.addListener(Lc,h,-1)}});var rb="audio",Xa="video",jh="timedtext",Di="trickplay",Ok=2292,Pk=.006,Mk=2918,Nk=.0065,Ad={nc:function(a,b){var c=this;b&&(c=c.filter(yd));return c.reduce(function(b,c){return b&&wc(b.f-a)<wc(c.f-
a)?b:c})},ea:function(a,b){var c=this;b&&(c=c.filter(yd));return c.reduce(function(b,c){return c.f>a&&c.f<b.f?c:b},c[c.length-1])},fa:function(a,b){var c=this;b&&(c=c.filter(yd));return c.reduce(function(b,c){return c.f<a&&c.f>b.f?c:b},c[0])},Yd:function(a){var b=this.map(function(a){return a.f});md.isArray(a)&&(b=ob(b,a));return b}},Yc=1,zh=2,pf=4,Ui=8,Qk=zh|pf,Rk=0,Sk=1,Tk=1E6,xh=1,Wi=2,Vi=3;Ic(uh,function(a){function b(c){(c=c.L)&&4E3<c.length&&(a.removeEventListener(ff,b),Ba(function(){for(var b=
2E3,c=Xd.now(),d=c,f=[],g=0;g<b;g++){for(var h=10;h--;)a.Jt=Qa.atan2(h,h);h=Xd.now();f.push(h-d);d=h}c=d-c;h=c/b;d=[];for(g=0;g<f.length;g++)f[g]>5*h&&d.push(g);g=d.reduce(function(a,b){return a+f[b]},0);c-=g;b-=d.length;0!=c&&(a.te=Qa.round(b/c))}))}a.addEventListener(ff,b)});var Uk=1,$i=2,Xi=1,Yi=1,yg=2,Ah=1,Vk=1,Zi=1,aj,qf,zg,hj=Dd&&sf&&rf&&sf.prototype.play,bl=hj&&(sf.prototype.webkitGenerateKeyRequest||Mc),ik=!0,si=Dd&&Dd.isTypeSupported&&Dd.isTypeSupported('audio/mp4; codecs="mp4a.a6"'),al=
0,$k=1,ej=2,Zk=3,Yk=4,Xk=5,dj=1,cj=2,bj=3,fj=4,gj=5,Wk={clearkey:function(a,b){return Aa(b)},fps:function(a,b){var c;b.children.forEach(function(a){"pssh"==a.type&&"29701FE4-3CC7-4A34-8C5B-AE90C7439A47"==a.vd&&(c=a.data)});if(!c)throw new Ta("no-netflix-pssh");var d="skd://netflix/"+S(c);return ld(d)}},Bh=50,fl=1E3,jl=0,jj=1,hl=2,Gh=3,ml=0,kl="showsubtitle",ll="removesubtitle";Ic(wg,function(a){function b(d){if(d.ctrlKey&&d.altKey&&d.shiftKey&&84==d.keyCode){var f=Ga("INPUT",k,k,{type:"file"});f.addEventListener("change",
function(){var b=f.files[0];if(b){var d=b.name;c.info("Loading file",{FileName:d});var g=new oi;g.readAsText(b);g.addEventListener("load",function(){var b=a.ic;Jd(g.result,b.width/b.height,v.rl,v.sl,function(b){b.c?(b=b=a.hc.$f(b.entries,d),a.Q.set(b)):c.error("Inavlid custom DFXP")})})}});f.click()}}var c=new a.log.r("TimedTextCustomTrack");if(v.rg){c.info("Loading url",{Url:v.rg});var d=a.hc.$f(v.rg,"custom");a.Q.set(d)}gb.addListener(Cd,b);a.addEventListener(yb,function(){gb.removeListener(Cd,
b)})});var nj=0,Jh=1,Ih=2,nl=3,mj=4;Ic(wg,function(a){v.rp&&(a.Rz=new Lj(a))});Ic(wg,function(a){v.Wd&&(a.zc=new ci(a))});var Ki=1,Kh=1,pj=2,Ag=3,Lh=4,qj=[137,66,73,70,13,10,26,10],ol=0,rj=44,rl="loadedtracks",wj="loadedmetadata",ul="loaded",Bl="error",Cl="closed",sj="currenttimechanged",tj="bufferedtimechanged",yl="durationchanged",zl="videosizechanged",Nh="pausedchanged",Mh="endedchanged",vl="busychanged",Al="audiotracklistchanged",wl="audiotrackchanged",vj="timedtexttracklistchanged",uj="timedtexttrackchanged",
xl="trickplayframeschanged",sl="mutedchanged",tl="volumechanged",pl="showsubtitle",ql="removesubtitle",ai={};Vb(R.fe,function(a){function b(a,c){return{encrypt:function(b,c){var d=qa(b)?ld(b):b,f=tf.getRandomValues(new $a(16));Bb(Cc.encrypt({name:"AES-CBC",iv:f},a,d)).then(function(a){a=new $a(a);var b=[],d=new Vc(b);d.hi(2);d.Cl(f);d.Cl(a);a=S(b);c({success:!0,encryptedDataAsn1Base64:a})},function(){c({success:!1})})},decrypt:function(b,c){var d=Kd(b);Bb(Cc.decrypt({name:"AES-CBC",iv:d.Hq},a,d.sp)).then(function(a){a=
new $a(a);c({success:!0,text:Bg(a)})},function(){c({success:!1})})},hmac:function(a,b){var d=qa(a)?ld(a):a;Bb(Cc.sign({name:"HMAC",hash:{name:"SHA-256"}},c,d)).then(function(a){a=new $a(a);b({success:!0,hmacBase64:S(a)})},function(){b({success:!1})})}}}ai.mdx={getEsn:function(){return ac.sc},getServerEpoch:function(){return Sb.Ad()},createCryptoContext:function(a){var b=ae.rh.getStateForMdx(gf.W),c=b.cryptoContext,d=b.masterToken,b=b.userIdToken;d&&b?(d=["1",S(lb.stringify(d.toJSON())),S(lb.stringify(b.toJSON()))].join(),
a({success:!0,cryptoContext:{cTicket:d,encrypt:function(a,b){var d=qa(a)?ld(a):a;c.encrypt(d,{result:function(a){a=S(a);b({success:!0,mslEncryptionEnvelopeBase64:a})},timeout:function(){b({success:!1})},error:function(){b({success:!1})}})},decrypt:function(a,b){var d=Ac(a);c.decrypt(d,{result:function(a){b({success:!0,text:Bg(a)})},timeout:function(){b({success:!1})},error:function(){b({success:!1})}})},hmac:function(a,b){var d=qa(a)?ld(a):a;c.sign(d,{result:function(a){b({success:!0,hmacBase64:S(a)})},
timeout:function(){b({success:!1})},error:function(){b({success:!1})}})}}})):a({success:!1})},createCryptoContextFromSharedSecret:function(a,c){var d=Ac(a),f=d.subarray(32,48),d=d.subarray(0,32);if(16!=f.length||32!=d.length)throw new Ta("Bad shared secret");Wd.all([Bb(Cc.importKey("raw",f,{name:"AES-CBC"},!1,["encrypt","decrypt"])),Bb(Cc.importKey("raw",d,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign","verify"]))]).then(function(a){c({success:!0,cryptoContext:b(a[0],a[1])})},function(){c({success:!1})})}};
a(va)});F.netflix=F.netflix||{};F.netflix.player={VideoSession:function(){var a=this;Pg(arguments);a.createPlayer=function(a,b){var c,d,f;b&&(Da(b)?(c={Ca:b.trackingId,dd:b.sessionParams,me:b.authParams},d=b.trailerMode,f=b.manifest):c={Ca:b});c=new Oj(b.accountKey,a,c,d,f);d=b.clipStart;f=b.clipDuration;return 0<d||0<f?Pj(c,d,f):c};a.closeAllPlayers=function(a){Ud(function(){a&&a()})};a.init=function(b){vg(function(c){c.c?(n(a,ai),b&&b(n({success:!0},ai))):b&&(c=(new Ib(c.errorCode||R.fe,c,void 0)).ai(),
b({success:!1,error:c}))})};a.applyConfig=function(a){ig(a)}},diag:{togglePanel:function(a,b){var c;switch(a){case "info":c=sd.map(function(a){return a.jf});break;case "streams":c=sd.map(function(a){return a.Nk});break;case "log":c=[oj]}c&&c.forEach(function(a){Y(b)?b?a.show():a.dh():a.toggle()})},addNccpLogMessageSink:function(a){vc.addListener(3,function(b){a({data:b.Rq.data})})}},log:new ua.r("Ext"),LogLevel:ub,addLogSink:function(a){De.push(a)}}})(window)},{10:10,3:3,4:4,5:5,7:7}],2:[function(x,
F){function k(){this.q=this.q||{};this.kd=this.kd||void 0}function S(k){return"function"===typeof k}function aa(k){return"object"===typeof k&&null!==k}F.Va=k;k.EventEmitter=k;k.prototype.q=void 0;k.prototype.kd=void 0;k.Vo=10;k.prototype.setMaxListeners=function(k){if("number"!==typeof k||0>k||isNaN(k))throw TypeError("n must be a positive number");this.kd=k;return this};k.prototype.emit=function(k){var p,x,F,pa;this.q||(this.q={});if("error"===k&&(!this.q.error||aa(this.q.error)&&!this.q.error.length)){p=
arguments[1];if(p instanceof Error)throw p;throw TypeError('Uncaught, unspecified "error" event.');}x=this.q[k];if(void 0===x)return!1;if(S(x))switch(arguments.length){case 1:x.call(this);break;case 2:x.call(this,arguments[1]);break;case 3:x.call(this,arguments[1],arguments[2]);break;default:p=arguments.length;F=Array(p-1);for(pa=1;pa<p;pa++)F[pa-1]=arguments[pa];x.apply(this,F)}else if(aa(x)){p=arguments.length;F=Array(p-1);for(pa=1;pa<p;pa++)F[pa-1]=arguments[pa];x=x.slice();p=x.length;for(pa=0;pa<
p;pa++)x[pa].apply(this,F)}return!0};k.prototype.addListener=function(x,p){var F;if(!S(p))throw TypeError("listener must be a function");this.q||(this.q={});this.q.Wx&&this.emit("newListener",x,S(p.Yc)?p.Yc:p);this.q[x]?aa(this.q[x])?this.q[x].push(p):this.q[x]=[this.q[x],p]:this.q[x]=p;aa(this.q[x])&&!this.q[x].fu&&(F=void 0===this.kd?k.Vo:this.kd)&&0<F&&this.q[x].length>F&&(this.q[x].fu=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",
this.q[x].length),"function"===typeof console.trace&&console.trace());return this};k.prototype.on=k.prototype.addListener;k.prototype.once=function(k,p){function x(){this.removeListener(k,x);F||(F=!0,p.apply(this,arguments))}if(!S(p))throw TypeError("listener must be a function");var F=!1;x.Yc=p;this.on(k,x);return this};k.prototype.removeListener=function(k,p){var x,F,pa;if(!S(p))throw TypeError("listener must be a function");if(!this.q||!this.q[k])return this;x=this.q[k];pa=x.length;F=-1;if(x===
p||S(x.Yc)&&x.Yc===p)delete this.q[k],this.q.removeListener&&this.emit("removeListener",k,p);else if(aa(x)){for(;0<pa--;)if(x[pa]===p||x[pa].Yc&&x[pa].Yc===p){F=pa;break}if(0>F)return this;1===x.length?(x.length=0,delete this.q[k]):x.splice(F,1);this.q.removeListener&&this.emit("removeListener",k,p)}return this};k.prototype.removeAllListeners=function(k){var p;if(!this.q)return this;if(!this.q.removeListener)return 0===arguments.length?this.q={}:this.q[k]&&delete this.q[k],this;if(0===arguments.length){for(p in this.q)"removeListener"!==
p&&this.removeAllListeners(p);this.removeAllListeners("removeListener");this.q={};return this}p=this.q[k];if(S(p))this.removeListener(k,p);else for(;p.length;)this.removeListener(k,p[p.length-1]);delete this.q[k];return this};k.prototype.listeners=function(k){return this.q&&this.q[k]?S(this.q[k])?[this.q[k]]:this.q[k].slice():[]};k.listenerCount=function(k,p){return k.q&&k.q[p]?S(k.q[p])?1:k.q[p].length:0}},{}],3:[function(x,F){function k(b,a,k){for(var p="",f=0,c=b.length,n=c-2,x;f<n;){x=(b[f++]<<
16)+(b[f++]<<8)+b[f++];if(!(0<=x&&16777215>=x))throw Error("not bytes");p+=a[x>>>18]+a[x>>>12&63]+a[x>>>6&63]+a[x&63]}if(f==n){x=(b[f++]<<8)+b[f++];if(!(0<=x&&65535>=x))throw Error("not bytes");p+=a[x>>>10]+a[x>>>4&63]+a[x<<2&63]+k}else if(f==c-1){x=b[f++];if(!(0<=x&&255>=x))throw Error("not bytes");p+=a[x>>>2]+a[x<<4&63]+k+k}return p}var S=Array.prototype.slice,aa=S.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),I=S.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),
p={},Y={},Da={},pa={},b=/\s+/g;[aa,I].forEach(function(b){for(var a=b.length,k;a--;)k=b[a],p[k]=a<<18,Y[k]=a<<12,Da[k]=a<<6,pa[k]=a});F.Va={Cg:function(b){return k(b,aa,"=")},lw:function(b){return k(b,I,"")},sg:function(g){g=g.replace(b,"");var a=g.length,k;k=g.charAt(a-1);"="!==k&&"."!==k||a--;k=g.charAt(a-1);"="!==k&&"."!==k||a--;k=3*(a>>2);var x=0;switch(a%4){case 2:x=1;break;case 3:x=2;break;case 1:throw Error("bad base64");}for(var a=new Uint8Array(k+x),f=0,c=0,n;c<k;){n=p[g[f++]]+Y[g[f++]]+
Da[g[f++]]+pa[g[f++]];if(!(0<=n&&16777215>=n))throw Error("bad base64");a[c++]=n>>>16;a[c++]=n>>>8&255;a[c++]=n&255}if(0<x&&(n=p[g[f++]]+Y[g[f++]],a[c++]=n>>>16,1<x&&(n+=Da[g[f++]],a[c++]=n>>>8&255),!(0<=n&&16776960>=n&&0===(n&(1<x?255:65535)))))throw Error("bad base64");return a}}},{}],4:[function(x,F){function k(k){this.buffer=k;this.position=0}k.prototype={seek:function(k){this.position=k},skip:function(k){this.position+=k},Ha:function(){return this.buffer.length-this.position},ba:function(){return this.buffer[this.position++]},
na:function(k){var x=this.position;this.position+=k;k=this.buffer;return k.subarray?k.subarray(x,this.position):k.slice(x,this.position)},I:function(k){for(var x=0;k--;)x=256*x+this.buffer[this.position++];return x},Ob:function(k){for(var x="";k--;)x+=String.fromCharCode(this.buffer[this.position++]);return x},qs:function(){for(var k="",x;x=this.ba();)k+=String.fromCharCode(x);return k},K:function(){return this.I(2)},l:function(){return this.I(4)},oa:function(){return this.I(8)},Uk:function(){return this.I(2)/
256},Fh:function(){return this.I(4)/65536},Ud:function(k){for(var x,I="";k--;)x=this.ba(),I+="0123456789ABCDEF"[x>>>4]+"0123456789ABCDEF"[x&15];return I},nf:function(){return this.Ud(4)+"-"+this.Ud(2)+"-"+this.Ud(2)+"-"+this.Ud(2)+"-"+this.Ud(6)},rs:function(k){for(var x=0,I=0;I<k;I++)x+=this.ba()<<(I<<3);return x},Vd:function(){return this.rs(4)},hi:function(k){this.buffer[this.position++]=k},Dl:function(k,x){this.position+=x;for(var I=1;I<=x;I++)this.buffer[this.position-I]=k&255,k=Math.floor(k/
256)},iu:function(k){for(var x=k.length,I=0;I<x;I++)this.buffer[this.position++]=k[I]},de:function(k,x){this.iu(k.na(x))}};F.Va=k},{}],5:[function(x,F){function k(a,b,g){this.type=a;this.size=b;this.aa=g}function S(b){var c;a:{c=b.position;var g,p;if(8<=b.Ha()){g=b.l();p=b.Ob(4);if(!qa.test(p))throw b.seek(c),Error("mp4-badtype");if(1==g){if(8>b.Ha()){b.seek(c);c=void 0;break a}g=b.oa()}if(!(8<=g))throw b.seek(c),Error("mp4-badsize");if("uuid"==p){if(16>b.Ha()){b.seek(c);c=void 0;break a}p=b.nf()}c=
{type:p,offset:c,size:g,aa:c+g-b.position}}else c=void 0}if(c&&c.aa<=b.Ha()){var x=c.type;g=c.size;var I=c.aa;p=new k(x,g,I);x=Za[x];if(b.Ha()<I)throw Error("mp4-shortcontent");x?(I=new a(b.na(I)),x(p,I)):b.skip(I);b.seek(c.offset);p.Na=b.na(g);return p}}function aa(a,b){for(var g=[],k={},p,x;0<b.Ha();){p=S(b);if(!p)throw Error("mp4-badchildren");x=p.type;g.push(p);k[x]||(k[x]=p)}a.children=g;a.Jg=k}function I(a,b){a.version=b.I(1);a.tc=b.I(3)}function p(a,b){b.skip(6);a.So=b.K();b.skip(8);a.Ev=b.K();
a.tf=b.K();b.skip(4);a.pz=b.K();b.skip(2);aa(a,b)}function Y(a,b){b.skip(6);a.So=b.K();b.skip(16);a.width=b.K();a.height=b.K();a.Mw=b.l();a.Uz=b.l();b.skip(4);a.yw=b.K();var g=b.ba();a.Iv=b.Ob(g);b.skip(31-g);a.depth=b.K();b.skip(2);aa(a,b)}function Da(a,b){I(a,b);a.Pv=b.I(3);a.Tv=b.ba();a.kh=b.na(16)}function pa(a,b){for(var g=[],k;b--;)k=a.K(),g.push(a.na(k));return g}function b(a){var b=a.na(2);a={oz:b[1]>>1&7,Zk:!!(b[1]&1),iz:a.K()};g(a,(b[0]<<8|b[1])>>4);return a}function g(a,b){a.jz=b>>4&3;
a.nz=b>>2&3;a.lz=b&3;return a}var a=x(4),qa=/^[a-zA-Z0-9-]{4,4}$/;k.prototype.ub=function(a){var b=this;a=a.split("/");var g,k,p,x;for(p=0;p<a.length&&b;p++){k=a[p].split("|");g=void 0;for(x=0;x<k.length&&!g;x++)g=k[x],g=b.Jg&&b.Jg[g];b=g}return b};k.prototype.toString=function(){return"["+this.type+"]"};var Za={ftyp:function(a,b){a.mx=b.Ob(4);a.Qx=b.l();for(a.mj=[];4<=b.Ha();)a.mj.push(b.Ob(4))},moov:aa,sidx:function(a,b){I(a,b);a.Zy=b.l();a.Af=b.l();a.cw=1<=a.version?b.oa():b.l();a.zp=1<=a.version?
b.oa():b.l();b.skip(2);for(var g=b.K(),k=[],p,x;g--;){p=b.l();x=p>>31;if(0!==x)throw Error("mp4-badsdix");p&=2147483647;x=b.l();b.skip(4);k.push({size:p,duration:x})}a.vs=k},moof:aa,mvhd:function(a,b){I(a,b);var g=1<=a.version?8:4;a.qg=b.I(g);a.modificationTime=b.I(g);a.Af=b.l();a.duration=b.I(g);a.Xy=b.Fh();a.volume=b.Uk();b.skip(70);a.Xx=b.l()},pssh:function(a,b){I(a,b);a.vd=b.nf();var g=b.l();a.data=b.na(g)},trak:aa,mdia:aa,minf:aa,stbl:aa,stsd:function(a,b){I(a,b);b.l();aa(a,b)},encv:Y,avc1:Y,
mp4a:p,enca:p,"ec-3":p,avcC:function(a,b){a.version=b.ba();a.tv=b.ba();a.Ty=b.ba();a.sv=b.ba();a.Xw=(b.ba()&3)+1;a.uz=pa(b,b.ba()&31);a.Oy=pa(b,b.ba())},pasp:function(a,b){a.Ne=b.l();a.Hf=b.l()},sinf:aa,frma:function(a,b){a.Nv=b.Ob(4)},schm:function(a,b){I(a,b);a.Ns=b.Ob(4);a.rz=b.l();a.tc&1&&(a.qz=b.qs())},schi:aa,tenc:Da,mvex:aa,trex:function(a,c){I(a,c);a.V=c.l();a.Uv=c.l();a.Wo=c.l();a.Xo=c.l();a.vg=b(c)},traf:aa,tfhd:function(a,c){I(a,c);a.V=c.l();var g=a.tc;g&1&&(a.wv=c.oa());g&2&&(a.kz=c.l());
g&8&&(a.Wo=c.l());g&16&&(a.Xo=c.l());g&32&&(a.vg=b(c))},saio:function(a,b){I(a,b);a.tc&1&&(a.io=b.l(),a.jo=b.l());for(var g=1<=a.version?8:4,k=b.l(),p=[];k--;)p.push(b.I(g));a.Ks=p},mdat:function(a,b){a.data=b.na(b.Ha())},tkhd:function(a,b){I(a,b);var g=1<=a.version?8:4;a.qg=b.I(g);a.modificationTime=b.I(g);a.V=b.l();b.skip(4);a.duration=b.I(g);b.skip(8);a.Uw=b.K();a.pv=b.K();a.volume=b.Uk();b.skip(2);b.skip(36);a.width=b.Fh();a.height=b.Fh()},mdhd:function(a,b){I(a,b);var g=1<=a.version?8:4;a.qg=
b.I(g);a.modificationTime=b.I(g);a.Af=b.l();a.duration=b.I(g);g=b.K();a.language=String.fromCharCode((g>>10&31)+96)+String.fromCharCode((g>>5&31)+96)+String.fromCharCode((g&31)+96);b.skip(2)},mfhd:function(a,b){I(a,b);a.sz=b.l()},tfdt:function(a,b){I(a,b);a.xv=b.I(1<=a.version?8:4);8==b.Ha()&&b.skip(8)},saiz:function(a,b){I(a,b);a.tc&1&&(a.io=b.l(),a.jo=b.l());for(var g=b.ba(),k=b.l(),p=[];k--;)p.push(g||b.ba());a.mz=p},trun:function(a,c){I(a,c);var g=c.l(),k=a.tc;k&1&&(a.Ov=c.l());k&4&&(a.vw=b(c));
for(var p=[],x;g--;)x={},k&256&&(x.duration=c.l()),k&512&&(x.size=c.l()),k&1024&&(x.tc=c.l()),k&2048&&(x.Hv=c.l()),p.push(x);a.Ls=p},sdtp:function(a,b){I(a,b);for(var k=[];0<b.Ha();)k.push(g({},b.ba()));a.Ls=k},"4E657466-6C69-7850-6966-665374726D21":function(a,b){I(a,b);a.fileSize=b.oa();a.Af=b.oa();a.duration=b.oa();a.$x=b.oa();a.Az=b.oa();1<=a.version&&(a.Sx=b.oa(),a.Tx=b.l(),a.Hr=b.oa(),a.Ap=b.l(),a.tw=b.nf())},"A2394F52-5A9B-4F14-A244-6C427C648DF4":function(a,b){I(a,b);a.tc&1&&(a.ov=b.I(3),a.Rw=
b.ba(),a.Sw=b.nf());a.hz=b.l();a.ho=b.na(b.Ha())},"4E657466-6C69-7846-7261-6D6552617465":function(a,b){I(a,b);a.Er=b.l();a.Zo=b.K()},"8974DBCE-7BE7-4C51-84F9-7148F9882554":Da};F.Va={Yy:function(b,c){var g=new a(b);c&&g.seek(c);return S(g)},ps:function(b,c){if(!b)throw Error("mp4-badinput");var g=new a(b),k=[],p;for(c&&g.seek(c);p=S(g);)k.push(p);return k}}},{4:4}],6:[function(x,F){function k(a){xc.call(this);this.od=a.url;this.ld=a.L;this.Pp=Da;this.Xf=a.mf||0;this.Ln=this.md=this.Fc=null;this.ke=
{};this.Wf={};this.ld({url:this.od,offset:a.offset,size:a.size},aa.bind(this))}function S(a){if(!a)throw Error("Assertion Failed");}function aa(a,b){if(a)this.emit(Wb.ERROR,vb(a,Fb.jm));else try{var c=new ib(b),f=p(c);this.Fc=f;var g=f.startOffset,k=f.entries.reduce(function(a,b){return a+b.size},0);if(k){var n={url:this.od,offset:g,size:k};this.emit(Wb.lm,this.Fc);this.ld(n,I.bind(this))}else this.emit(Wb.ERROR,vb({},Fb.Em))}catch(x){this.emit(Wb.ERROR,vb(x,Fb.km))}}function I(a,b){var f=this;if(a)f.emit(Wb.ERROR,
vb(a,Fb.wn));else{var g=new ib(b),k=0,n=[],p=[],x=0;try{f.Fc.entries.forEach(function(a){var b={},c=0;g.position=k;b.identifier=g.Ob(4);S("sidx"===b.identifier);b.pq=g.na(36);b.duration=g.I(4);b.Ua=g.K();b.entries=[];for(b.ac=[];c<b.Ua;){var f={};f.Wb=g.I(4);f.duration=g.I(4);f.Kr=g.K();f.Lr=g.K();f.kt=g.K();f.mt=g.K();f.wc=g.oa();f.gk=g.I(4);c++;b.entries.push(f)}n.push(b);a.il=b;c=b.entries;c.length&&(b.startTime=c[0].Wb,b.endTime=c[c.length-1].Wb+c[c.length-1].duration);p.push.apply(p,b.entries);
k+=a.size;x++})}catch(I){f.emit(Wb.ERROR,vb(I,Fb.xn));return}f.md=n;f.Ln=p;f.emit(Wb.yn,this.md);var F=Y.call(f,f.Xf);F.length?c.call(f,F,function(){f.emit(Wb.Gi)}):f.emit(Wb.Gi)}}function p(a){var b={};a.position=0;b.identifier=a.Ob(4);S("midx"===b.identifier);b.version=a.I(4);S(0===b.version);b.pq=a.na(36);b.qg=a.oa();b.Ly=a.oa();b.sa=a.oa();b.Is=a.K();b.Js=a.K();b.language=a.na(16);b.Iz=a.na(16);b.startOffset=a.oa();b.Ua=a.K();for(var c=[],f=0;f<b.Ua;f++){var g={};g.duration=a.I(4);g.size=a.K();
c.push(g)}b.entries=c;return b}function Y(a){var b=[],c;S(n(a));var f=this.ke,g=f.xf,k=f.index,p;g&&(0===k&&a<=g.startTime?(p=!0,c=f):a>=g.startTime&&a<=g.endTime?(p=!0,c=f):(f=this.md[k+1])&&a>=g.endTime&&a<=f.endTime&&(p=!0,c={xf:f,index:k+1}));if(!p)for(g=this.Fc.entries,k=g.length,p=0;p<k;p++)if(f=g[p].il,a<=f.startTime||a>f.startTime&&a<=f.endTime){c={xf:g[p].il,index:p};break}c&&(this.ke=c);if(!c)return b;a=c.xf;c=this.md[c.index+1];a.ac.length||b.push(a);c&&!c.ac.length&&b.push(c);return b}
function Da(a){var f=Y.call(this,a);f.length&&c.call(this,f);var g=this.ke.xf,k=this.ke.index,f=[],k=n(k)&&this.md[k+1];g&&g.ac.length&&(f=pa(g,a,[],this.Fc));k&&k.ac.length&&(a=pa(k,a,f,this.Fc),f.push.apply(f,a));return b(f)}function pa(a,b,c,g){var k=a.entries,n=k.length,p=[],x,I=0;if(!k.length)return p;for(;I<n;){x=k[I];if(x.Wb<=b)x.Wb+x.duration>=b&&p.push(f(x,a.ac[I],g));else{var F=p.length&&p[p.length-1]||c.length&&c[c.length-1];if(F&&F.Wb>b&&F.Wb!==x.Wb)break;F.wc!==x.wc&&p.push(f(x,a.ac[I],
g))}I++}return p}function b(b){return b.map(function(c,f){var k=c.duration,n;n=b.slice(f+1).filter(g.bind(null,c)).map(a).reduce(qa,0);c.duration=k+n;return c}).reduce(function(a,b){Za(a,b.id)||a.push(b);return a},[])}function g(a,b){return a.id===b.id&&a.displayTime+a.duration===b.displayTime}function a(a){return a.duration}function qa(a,b){return a+b}function Za(a,b){return a.some(function(a){return a.id===b})}function f(a,b,c){var f={};f.displayTime=a.Wb;f.duration=a.duration;f.originX=a.Kr;f.originY=
a.Lr;f.sizeX=a.kt;f.sizeY=a.mt;f.imageData=b;f.id=a.wc;f.rootContainerExtentX=c.Is;f.rootContainerExtentY=c.Js;return f}function c(a,b){var c=this,f=a[0],g=a[a.length-1],k,p;0<f.Ua&&(k=f.entries[0].wc,p=f.entries[f.entries.length-1]);0<g.Ua&&(n(k)||(k=g.entries[0].wc),p=g.entries[g.entries.length-1]);if(k){var f=p.wc+p.gk-k,x="o_"+k+"s_"+f;c.Wf[x]||(c.Wf[x]=!0,c.ld({url:c.od,offset:k,size:f},function(f,g){setTimeout(function(){delete c.Wf[x]},1E3);if(f)b&&b(f);else{var n=new ib(g);a.forEach(function(a){a.entries.forEach(function(b,
c){n.position=b.wc-k;a.ac[c]=n.na(b.gk);var f=a.ac[c];S("P"==String.fromCharCode(f[1]));S("N"==String.fromCharCode(f[2]));S("G"==String.fromCharCode(f[3]))})});b&&b(null)}}))}else b&&b(null)}function n(a){return"undefined"!==typeof a}function vb(a,b){var c=Object.create(a);a.errorString=b;return c}var xc=x(2).EventEmitter,ib=x(4),Wb=k.events={lm:"midxready",yn:"sidxready",Gi:"ready",ERROR:"error"},Fb={jm:"midxdownloaderror",km:"midxparseerror",Em:"nosidxfoundinmidx",wn:"sidxdownloaderror",xn:"sidxparseerror"};
k.prototype=Object.create(xc.prototype);k.prototype.constructor=k;F.Va=k},{2:2,4:4}],7:[function(x,F){var k=x(2).EventEmitter,S=x(9),aa=x(8)(),I=x(6),p=function Da(p,b){var g=this;if(!(g instanceof Da))return new Da(p,b);k.call(g);g.Ec=p.vk||console;g.ld=p.L;g.Dc=p.Uj;g.ua=null;g.jv=b.type;g.od=b.url;g.Xf=b.mf;g.nd=new I({url:g.od,offset:b.zk,size:b.Ak,L:g.ld,mf:g.Xf});g.nd.on("ready",function(){g.Ec.info("ready event fired by subtitle stream");g.emit("ready");g.ua=new S(g.Dc,g.nd.Pp.bind(g.nd),g.Ec);
g.ua.on("showsubtitle",g.emit.bind(g,"showsubtitle"));g.ua.on("removesubtitle",g.emit.bind(g,"removesubtitle"))});g.nd.on("error",g.emit.bind(g,"error"))};p.prototype=Object.create(k.prototype);p.prototype.Bc=function(k){null!==this.ua&&this.ua.Bc(k)};p.prototype.stop=function(){this.Ec.info("stop called");this.nd.removeAllListeners(["ready"]);null!==this.ua&&this.ua.stop()};p.prototype.pause=function(){this.Ec.info("pause called");null!==this.ua&&this.ua.pause()};p=aa([{L:"function",Uj:"function",
vk:"object"},{type:"string",url:"string",zk:"number",Ak:"number",mf:"number"}],p);F.Va=p},{2:2,6:6,8:8,9:9}],8:[function(x,F){function k(k){return Object.keys(k).every(function(x){return"function"===typeof k[x]})}F.Va=function(x){function F(b,g,a){a="undefined"!==typeof a.key?"Types: expected "+a.key:"Types: expected argument "+a.index;throw new TypeError(a+(" to be '"+b+"' but found '"+g+"'"));}function I(b,g,a){var k=Da[b];"undefined"!==typeof k?k(g)||F(b,g,a):b!==typeof g&&F(b,g,a)}function p(b,
g){var a;a=b.filter(function(a){return"object"!==typeof a&&-1===pa.indexOf(a)});a=a.concat(b.filter(function(a){return"object"===typeof a}).reduce(function(a,b){return a.concat(Object.keys(b).map(function(a){return b[a]}).filter(function(a){return-1===pa.indexOf(a)}))},[]));if(0<a.length)throw Error(a.join(",")+" are invalid types");return function(){var a=Array.prototype.slice.call(arguments);if(a.length!==b.length)throw new TypeError("Types: unexpected number of arguments");b.forEach(function(b,
f){var c=a[f];if("string"===typeof b)I(b,c,{index:f});else if("object"===typeof b)Object.keys(b).forEach(function(a){I(b[a],c[a],{key:a})});else throw Error("Types: unexpected type in type array");});return g.apply(this,a)}}var Y="number boolean string object function symbol".split(" "),Da;Da={array:function(b){return Array.isArray(b)}};if("undefined"!==typeof x){if("object"!==typeof x||!k(x))throw new TypeError("Types: extensions must be an object of type definitions");Object.keys(x).forEach(function(b){if("undefined"!==
typeof Da[b]||"undefined"!==typeof Y[b])throw new TypeError("Types: attempting to override a built in type with "+b);Da[b]=x[b]})}var pa=Object.keys(Da).concat(Y);return p(["array","function"],p)}},{}],9:[function(x,F){function k(k,b){return b.reduce(S.bind(this,k),[])}function S(k,b,g){var a=g.displayTime-k;k=g.displayTime+g.duration-k;var p=0<b.length?b[0].timeout:Infinity;return 0<a&&a<p?[{timeout:a,type:"showsubtitle",Dg:g}]:a===p?b.concat([{timeout:a,type:"showsubtitle",Dg:g}]):0<k&&k<p?[{timeout:k,
type:"removesubtitle",Dg:g}]:k===p?b.concat([{timeout:k,type:"removesubtitle",Dg:g}]):b}function aa(k,b){return-1<b.map(function(b){return b.id}).indexOf(k.id)}function I(k,b){return k.filter(function(g){return g!==b})}var p=x(2).EventEmitter,Y=x(8)({}),Da=function b(g,a,k){if(!(this instanceof b))return new b(g,a,k);p.call(this);var x=this;x.Dc=g;x.Jn=a;x.Pa=[];x.Ec=k||console;x.ua=setTimeout(function(){x.Bc(g())},10)};Da.prototype=Object.create(p.prototype);Da.prototype.stop=function(){var b=this;
clearTimeout(b.ua);b.Pa.forEach(function(g){b.emit("removesubtitle",g)});b.Pa=[]};Da.prototype.pause=function(){clearTimeout(this.ua)};Da.prototype.Bc=function(b,g){var a=this,p;clearTimeout(this.ua);p=a.Jn(b);g="number"===typeof g?g:0;a.Pa.forEach(function(f){f.displayTime<=b&&b<f.displayTime+f.duration||(a.Pa=I(a.Pa,f),a.emit("removesubtitle",f))});if(null!==p&&0<p.length){p.forEach(function(f){f.displayTime<=b&&b<f.displayTime+f.duration&&!aa(f,a.Pa)&&(a.emit("showsubtitle",f),a.Pa=a.Pa.concat([f]))});
var x=k(a.Dc(),p);0<x.length&&(a.ua=setTimeout(function(){x[0].displayTime>=a.Dc()&&x.forEach(function(b){"showsubtitle"===b.type&&(a.Pa=a.Pa.concat([b.Dg]));"removesubtitle"===b.type&&(a.Pa=I(a.Pa,b.Dg));a.emit(b.type,b.Dg)});a.Bc(a.Dc())},x[0].timeout))}else p=250*Math.pow(2,g),a.Ec.warn("rebuffering subtitles, checking buffer again in "+p+"ms"),a.ua=setTimeout(function(){a.Bc(a.Dc(),g+1)},p)};F.Va=Y(["function","function","object"],Da)},{2:2,8:8}],10:[function(x,F){F.Va={Cg:function(k){var x=k.length,
F;F=0;var I,p=0,Y;if(!(0<=x))throw Error("bad string");for(I=x;I--;)Y=k.charCodeAt(I),128>Y?F++:F=2048>Y?F+2:F+3;F=new Uint8Array(F);for(I=0;I<x;I++)Y=k.charCodeAt(I),128>Y?F[p++]=Y:(2048>Y?F[p++]=192|Y>>>6:(F[p++]=224|Y>>>12,F[p++]=128|Y>>>6&63),F[p++]=128|Y&63);return F},sg:function(k){for(var x=0,F,I=k.length,p="";x<I;){F=k[x++];if(!(0<=F&&255>=F))throw Error("bad utf8");if(F&128)if(192===(F&224))F=((F&31)<<6)+(k[x++]&63);else if(224===(F&240))F=((F&15)<<12)+((k[x++]&63)<<6)+(k[x++]&63);else throw Error("unsupported utf8 character");
p+=String.fromCharCode(F)}return p}}},{}]},{},[1])})();
